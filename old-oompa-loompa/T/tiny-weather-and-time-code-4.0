Keran's MUSH/MUX Weather and Time Code Package Version 4.0 beta
TinyMUSH 2.2 Code and Installation Instructions

This code and accompanying materials are copyright (C) 1996, 1997,
 1998, 1999 by Keran (keranset@mail1.nai.net).
You can do anything with this code except sell it or claim credit for
 the parts I wrote. Use at your own risk, and all that. Thanks to
My Sandbox for the port site.

This code will run on TinyMUSH 2.2.2, and in all probability, later
versions. (It may run on earlier releases as is, but I haven't tried
it.)

TinyMUSH 3.0 is not released, at the time this port is prepared.
This code is expected to run on it.

It seems likely that for original TinyMUSH 3.0 installations, it
will be better to install the MUX version of this code than this
port to TinyMUSH 2.2. The MUX version is the native version, is
slightly more efficient and less cumbersome in spots, allows royalty
to use some of the admin commands, and allows the Storm Maker to
use zones. The MUX version will probably become the native TinyMUSH
3.0 version.


Features:

Time functions for determining the year, month, season, time of day,
  tide, and moon phase; 
A weathermaker that determines a different weather type every day; 
Day and night length that vary by season. The length of the longest
  day can be set by hours or by latitude;
A weather description bank with descriptions that vary by time of day
  and season; 
A collection of outdoor parent rooms that make it easy to write
  descriptions that vary by time of day, season, weather, and the
  visibility of the moon, in different styles;
Indoor parent rooms for writing descriptions that vary with lighting
  conditions and the visual capability of the viewer;
A parent room hierarchy that means you can write your own parent rooms
  and easily have them recognized as the correct type of room.
Configurable time compression ratios, in two different modes. You can
  accelerate all time with clock compression, or skip days with
  calendar compression; 
Simple adjustable weather modelling; 
An optional quasi-Gregorian calendar in addition to the native
  calendar, and an option for taking the date from the system clock
  in 1:1 time; 
Clock code that can send out messages to specified receivers at given
  times, such as sunrise, moonset, other time of day transitions, tide
  changes, at specific hours, every hour, every half hour, or every
  quarter hour.
An auxiliary bank of descriptions varying by season, time of day, and
  weather, geared to surroundings with a lot of leafy trees, to
  illustrate how to make auxiliary desc banks for different
  environments; 
Regional weather, and a sample slave weather station.
A fairly realistic moon; 
Diurnal or semi-diurnal tides synchronized with the moon;
A Storm Maker that can be used to do global, area, and room type emits
  to allow the production of storms, earthquakes, blackouts, etc.
A test room for ensuring that the whole thing works.
The code is intended to be readable and adjustable by a competent
  coder, allowing it to be set up in numerous non-vanilla ways, which
  are discussed at some length in the configuration section of the
  +help.


Changes between 3.0 and 4.0:

-- The Time Functions object was too big in 3.0, and it would have been
staggering with the 4.0 moon on it. The moon and tide functions now have
an object all to themselves. Miscellaneous functions and weather desc
functions now also reside on a separate object.

-- The Emits Bank now sends its sunrise, sunset, time of day, etc.,
messages to rooms on which &hear-weather-emits=1, as opposed to
&hear-global-emits. It will also send tide emits to rooms on which 
&hear-tide-emits=1.

-- There are new times at which the Clock can trigger events.
Meridian-transit is when the moon reaches its zenith. It can also
trigger events every hour without your needing to specify the hours,
every half-hour, or every quarter-hour.

-- There's a new command on the Wizard Weather and Time Commands object
to allow you to compute the length of the longest day by giving a
latitude.

-- The moon's behavior is now astronomically sane. The tides are
synchronized with the moon.

-- There's a Storm Maker that can be used to changed the day's weather
and can broadcast effects messages to selected groups of rooms, making
it possible to generate local storms, earthquakes, etc.

-- There is now a system clock calendar mode. If you're going to run
in 1:1 and you want to run off the system clock and get a 365-day year
complete with dates, and stay in synchronization with the real year,
you can.

-- There is a hierarchy of parent rooms, including indoor rooms with
lighting variations, and several more outdoor parent rooms. This works
in conjunction with the Storm Maker; you can add your own parent rooms
to it.

-- The +help has been reorganized drastically. It may not be any
clearer, but it's at least different. There are now three sections to
the +help, general, admin commands, and configuration. I have, I hope,
located the information builders need once the code has been installed
in general +help instead of burying it in the config section.

-- Bug fixes will be noted in the changes.txt file in the same ftp
directory I distribute the code from.


For this installation, you need to be a wizard.

There are three global functions which are best loaded on #1; God
needs to set this up. However, if necessary, you may also load
globals on any wiz-inherit item whose dbref is lower than the dbref
of anything that needs to call weather and time code.

You need a configuration change to the server. Function_invocation_limit
should be set to approximately 12,500. No, that is not a typo. And, no,
it's highly unlikely to bring your server to its knees. CPUs improve
every year, and most games can easily handle this code; it's possible
that on a large and very heavily loaded server that this could cause
difficulties, but generally speaking you won't even notice this config
change. The reason it's required is that the set of functions invoked
when the variable-desc Parent Rooms include calls for a moon desc is
extremely large; the 4.0 moon is complex. +today also probably won't
work right if you don't set the function invocation limit up, and the
moon phase may not be computed correctly.

If you don't know /anything/ about code, don't attempt this. Get a
code wiz. You don't need to be a psychocoder to install it, but you
really should have at least passing familiarity with the basics of
how code works.


The items in Keran's Weather and Time Code package are

#85 Keran's Time Functions
#83 Keran's Tree Weather Descriptions
#82 Keran's Weather Long Description Bank
#81 Keran's Box of Weather and Time Stuff, with Notes
#78 Keran's Weathermaker
#77 Keran's Wizard Weather and Time Commands
#76 Keran's Slave Weather Station
#75 Keran's Clock
#51 Keran's Emits Bank
#50 Keran's Global Command Object
#80 Keran's Weather and Time Help - Admin Commands
#79 Keran's Weather and Time Help - Configuration Considerations
#71 Keran's Weather and Time Help - General
#338 Keran's Miscellaneous Functions
#339 Keran's Storm Maker
#340 Keran's Moon and Tide Functions

Rooms:

#72 Keran's Parent of Separable Day-Night and Season Desc Outdoor
 Rooms
#341 Keran's Parent of Season-and-Day-Night Varying Outdoor Rooms
#344 Keran's Parent of Windowed Indoor Rooms
#347 Keran's Parent of Windowless Indoor Rooms
#350 Keran's Parent of Separable Day-Night-Dawn-Dusk and Season
 Desc Outdoor Rooms
#353 Keran's Parent of Separable Desc Outdoor Rooms
#356 Keran's Parent of Weather-and-Day-Night Varying Outdoor Rooms
#359 Keran's Grandparent of Windowed Indoor Rooms
#362 Keran's Grandparent of Windowless Indoor Rooms
#367 Keran's Grandparent of Outdoor Rooms
#370 Keran's Great-grandparent of Rooms
#373 Keran's Test Room


The procedure for installing this code involves:

-- Creating the items.
-- Editing the code section of this text file to replace my dbrefs
   with yours.
-- Loading the attributes onto the individual items.
-- Putting Keran's Global Command Object in the Master Room.
-- Putting everything else in the box in your Auxiliary Room.
-- Adding global function loads to #1.
-- Adding the +help entry point to your own +help.
-- Reconfiguring the server's function_invocation_limit.
-- @triggering the Clock. 
-- Deciding what configuration you want and setting it up.

*	*	*

There are too many items to make @editing tolerable. It's easier to
edit the text file. Begin by creating the following and noting the
item numbers.

@create Keran's Time Functions
@create Keran's Tree Weather Descriptions
@create Keran's Weather Long Description Bank
@create Keran's Box of Weather and Time Stuff, with Notes
@create Keran's Weathermaker
@create Keran's Wizard Weather and Time Commands
@create Keran's Slave Weather Station
@create Keran's Clock
@create Keran's Emits Bank
@create Keran's Global Command Object
@create Keran's Weather and Time Help - Admin Commands
@create Keran's Weather and Time Help - Configuration Considerations
@create Keran's Weather and Time Help - General
@create Keran's Miscellaneous Functions
@create Keran's Storm Maker
@create Keran's Moon and Tide Functions
@dig/teleport Keran's Parent of Windowed Indoor Rooms
@dig/teleport Keran's Parent of Windowless Indoor Rooms
@dig/teleport Keran's Parent of Separable Day-Night and Season Desc Outdoor Rooms
@dig/teleport Keran's Parent of Season-and-Day-Night Varying Outdoor Rooms
@dig/teleport Keran's Parent of Season-and-Day-Night-Dawn-Dusk Outdoor Rooms
@dig/teleport Keran's Parent of Separable Day-Night-Dawn-Dusk and Season Outdoor Rooms
@dig/teleport Keran's Parent of Weather-and-Day-Night Varying Outdoor Rooms
@dig/teleport Keran's Grandparent of Windowed Indoor Rooms
@dig/teleport Keran's Grandparent of Windowless Indoor Rooms
@dig/teleport Keran's Grandparent of Outdoor Rooms
@dig/teleport Keran's Great-grandparent of Rooms
@dig/teleport Keran's Test Room

Now do a search-and-replace on all the text in the code section
below. Search for the database reference numbers in my item list
farther up the page, and replace with the dbrefs of the corresponding
items you just created. Upload the code itself item by item from the
code section.

A caution: it may happen that one of your objects may turn out to
have the same dbref as a /different/ one of my objects. In that
case, the order in which you execute the search-and-replace
operations is important. If, for example, one of your objects
turns out to be numbered #75, and it isn't the Clock, you'll
need to do the search-and-replace for the Clock in the code
section before you do the search-and-replace for whatever object
came out numbered #75, because if you do the Clock replace
afterward, all the references to the Clock and all the references
to whatever object is your #75 will end up pointing to the Clock.

What to do if you're upgrading from 3.0:
There are various approaches, depending on what you've done with 3.0
If you've done significant amounts of custom coding or complex setup,
you very probably want to do a new installation of 4.0 and leave 3.0
working as is, then port your changes to 4.0 gradually; after that, you
can do a brute-force database edit to fix dbrefs. (Note to TinyMUSH dev
team: what I really want is RCS for softcode. <grinning, ducking, and
running>)

If you have a 3.0 setup with no significant dependent code or building,
you can do a new 4.0 installation and simply discard the 3.0 stuff.

A common case will be to have nothing particularly unusual in the setup
--no recoding, no complex regional weather, etc.--but to have code or
building that calls 3.0 functions by dbref--usually, this means
functions from the 3.0 Time Functions object--and possibly to have
rooms parented to the 3.0 Outdoor Parent Room. There are two approaches
you can take to this:

1) Erase the attributes from your 3.0 objects, and load the 4.0
attributes onto the corresponding objects; make the new 4.0 objects in
the usual way; then alter a couple of the 4.0 items so dependent code
can use some of the 3.0 references instead.

2) Ditto, but instead of altering any 4.0 items for 3.0 compatibility,
comb through your database with some editing code to switch all the
references to 4.0. This is more work up front; however, what you have
when you get done will be a pure 4.0 installation and you won't have
to contend with possible incompatibilities in bug fixes, add-ons,
documentation, etc.; it's also slightly more efficient.

Procedure:

@nuke the 3.0 +help items (Common function help, Uncommon function
help, Topics). They're expendable.

Your basic erase-the-objects procedure is easily done with @dolist
lattr(<3.0 item>)=&## <3.0 item>. Remember to include the Global
Command Object and the Outdoor Parent Room, which won't be in the box
with the other stuff.

Rename the box to Keran's Box of Weather and Time Stuff, with Notes.
Rename the Outdoor Parent Room to Keran's Parent of Separable Day-Night
and Season Desc Outdoor Rooms. You can rename all the other 3.0 stuff
if you want; it won't hurt anything if you don't, but having all the
names start with 'Keran's' makes it easier to keep track of the parts
of the package.

Now @create all remaining items from 4.0. When you get done, you'll
have the 4.0 blank items, but the dbrefs of those 4.0 items that existed
in 3.0 will be the same as your 3.0 dbrefs in your new installation.
Search and replace the dbrefs in the code section below so they refer to
your items instead of mine, and upload the code onto your items.

For the edit-the-code approach:

	1) If you've set &hear-global-emits to 1 on significant numbers of
individual rooms, @edit the Emits bank so:
@edit Emits Bank/*=hear-weather-emits,hear-global-emits
Then replace &hear-weather-emits=1 on all the parent rooms with
&hear-global-emits=1.

	If you haven't individually set &hear-global-emits on many rooms,
skip this and change the attribute on the individual rooms from
&hear-global-emits=1 to &hear-weather-emits=1.

	2) Patch the Time Functions object so all the functions likely
to be called from it by external code in 3.0 can still be called from
it in 4.0, as follows:

&RANDWORD Time Functions=[extract(%0, add(1, rand(words(%0))), 1)]
&TILDE2BLANK Time Functions=[edit(v(0),~,%b)]
&BLANK2TILDE Time Functions=[edit(v(0),%b,~)]
&LONG-WEATHER Time Functions=[u(#82/[u(#85/season)][u(#85/day-night-dawn-dusk)][u(#78/weathertype)])]
&SHORT-WEATHER Time Functions=[u(#78/[u(#85/season)][u(#78/weathertype)])]
&TREE-WEATHER Time Functions=[u(#83/trees_[u(#85/season)]_[u(#85/day-night)]_[u(#78/weathertype)])]
&SLAVE-LONG-WEATHER Time Functions=[u(#82/[u(#85/season)][u(#85/day-night-dawn-dusk)][u(#76/slave-weathertype)])]
&SLAVE-SHORT-WEATHER Time Functions=[u(#78/[u(#85/season)][u(#76/slave-weathertype)])]
&SLAVE-TREE-WEATHER Time Functions=[u(#83/trees_[u(#85/season)]_[u(#85/day-night)]_[u(#76/slave-weathertype)])]
&WINDOW Time Functions=[lcstr(first(u(long-weather)))] [rest(u(long-weather))]
&MOON-ADJECTIVE Time Functions=[switch(u(moon-phase), new, black, waxing crescent, faint, first quarter, dim, waxing gibbous, bright, full, brilliant, waning gibbous, bright, last quarter, dim, waning crescent, faint)]
&MOON-PHASE Time Functions=[u(#340/moon-phase)]
&TIDE Time Functions=[u(#340/tide)]

Search and replace my dbrefs above with yours, naturally.

For the edit-the-database approach:

	Proceed with a normal 4.0 installation from here. Then edit the
database.

	Here follows code for doing mass edits that should catch most of
the differences between 3.0 and 4.0; it's possible that for given
installations, there may be other items you want to add to the list of
things to be edited. Edit the code below, replacing #85 with the dbref
of your Time Functions object, #338 with the dbref of your
Miscellaneous Functions object, and #340 with the dbref of your Moon
and Tide Functions object. This code should be placed on a
wizard/inherit object(you can put it on yourself if you want). To run
it, type:
	edit <first dbref>, <last dbref>
This allows you to edit a block of items at once. Keep the number of
items you edit at a time reasonable--20 might a reasonable value--so
you don't load the server too heavily all at once, or run into various
limits; you may need to adjust that number downward, or may be able to
adjust it upward. You might start, for example, with edit 0, 19.

	Remember *not* to edit the object this code is actually on. Stop
one object before it and start again one object afterward.

	It takes some 10-15 minutes to do a thousand objects, generally
speaking.

&FIRST-ITEM-EDIT me=$edit *, *: &counter me=%0; &cutoff me = %1; think iter(lattr(#%0), set(#%0, ##:[edit(get(#%0/##), #85/moon-phase, #340/moon-phase)])); think iter(lattr(#%0), set(#%0, ##:[edit(get(#%0/##), #85/tide, #340/tide)])); think iter(lattr(#%0), set(#%0, ##:[edit(get(#%0/##), #85/randword, #338/randword)])); think iter(lattr(#%0), set(#%0, ##:[edit(get(#%0/##), #85/blank2tilde, #338/blank2tilde)])); think iter(lattr(#%0), set(#%0, ##:[edit(get(#%0/##), #85/tilde2blank, #338/tilde2blank)])); think iter(lattr(#%0), set(#%0, ##:[edit(get(#%0/##), #85/moon-adjective, #340/moon-adjective)])); think iter(lattr(#%0), set(#%0, ##:[edit(get(#%0/##), #85/long-weather, #338/long-weather)])); think iter(lattr(#%0), set(#%0, ##:[edit(get(#%0/##), #85/short-weather, #338/short-weather)])); think iter(lattr(#%0), set(#%0, ##:[edit(get(#%0/##), #85/tree-weather, #338/tree-weather)])); think iter(lattr(#%0), set(#%0, ##:[edit(get(#%0/##), #85/window, #338/lowercase-long-weather)])); think iter(lattr(#%0), set(#%0, ##:[edit(get(#%0/##), #85/slave-short-weather, #338/slave-short-weather)])); think iter(lattr(#%0), set(#%0, ##:[edit(get(#%0/##), #85/slave-long-weather, #338/slave-long-weather)])); think iter(lattr(#%0), set(#%0, ##:[edit(get(#%0/##), #85/slave-tree-weather, #338/slave-tree-weather)])); @switch hasattr(#%0, hear-global-emits) = 1, {&hear-weather-emits #%0 = [get(#%0/hear-global-emits)]; &hear-global-emits #%0}, @@; @trigger me/next-item-edit

&NEXT-ITEM-EDIT me=&counter me = [add(v(counter), 1)]; think iter(lattr(#[v(counter)]), set(#[v(counter)], ##:[edit(get(#[v(counter)]/##), #85/moon-phase, #340/moon-phase)])); think iter(lattr(#[v(counter)]), set(#[v(counter)], ##:[edit(get(#[v(counter)]/##), #85/tide, #340/tide)])); think iter(lattr(#[v(counter)]), set(#[v(counter)], ##:[edit(get(#[v(counter)]/##), #85/randword, #338/randword)])); think iter(lattr(#[v(counter)]), set(#[v(counter)], ##:[edit(get(#[v(counter)]/##), #85/blank2tilde, #338/blank2tilde)])); think iter(lattr(#[v(counter)]), set(#[v(counter)], ##:[edit(get(#[v(counter)]/##), #85/tilde2blank, #338/tilde2blank)])); think iter(lattr(#[v(counter)]), set(#[v(counter)], ##:[edit(get(#[v(counter)]/##), #85/moon-adjective, #340/moon-adjective)])); think iter(lattr(#[v(counter)]), set(#[v(counter)], ##:[edit(get(#[v(counter)]/##), #85/long-weather, #338/long-weather)])); think iter(lattr(#[v(counter)]), set(#[v(counter)], ##:[edit(get(#[v(counter)]/##), #85/short-weather, #338/short-weather)])); think iter(lattr(#[v(counter)]), set(#[v(counter)], ##:[edit(get(#[v(counter)]/##), #85/tree-weather, #338/tree-weather)])); think iter(lattr(#[v(counter)]), set(#[v(counter)], ##:[edit(get(#[v(counter)]/##), #85/window, #338/lowercase-long-weather)])); think iter(lattr(#[v(counter)]), set(#[v(counter)], ##:[edit(get(#[v(counter)]/##), #85/slave-short-weather, #338/slave-short-weather)])); think iter(lattr(#[v(counter)]), set(#[v(counter)], ##:[edit(get(#[v(counter)]/##), #85/slave-long-weather, #338/slave-long-weather)])); think iter(lattr(#[v(counter)]), set(#[v(counter)], ##:[edit(get(#[v(counter)]/##), #85/slave-tree-weather, #338/slave-tree-weather)])); @switch hasattr(#[v(counter)], hear-global-emits) = 1, {&hear-weather-emits #[v(counter)] = [get(#[v(counter)]/hear-global-emits)]; &hear-global-emits #[v(counter)]}, @@; @switch lt(v(counter), v(cutoff)) = 1, @trigger me/next-item-edit, think Stopped at #[v(cutoff)]



At this point, whether you're upgrading or doing a new installation,
you should have a large collection of objects and rooms with the code on
them, but with nothing actually running yet.

Type 'note 1' where the box can hear you and make sure you have all
the stuff listed.

Check flags. Everything should be set safe. The box should be set
commands. The Global Command object should be set commands and
inherit. The Wizard Weather and Time Command object, the Clock, and
the Storm Maker should be set commands and inherit. The Emits Bank
should be set inherit. All functions objects and description banks
should be set visual; so should the Weathermaker and the Slave Weather
Station.

Check @uselocks. The Global Commands object shouldn't be locked; the
Wizard Weather and Time Command object, the Clock, and the Storm Maker
should be @uselocked to wizards.

@link the Global Command object to the Master Room and put it there.
@link the box to your Auxiliary Room and put it there. @link all the
other items to the box and put them there. The Storm Maker is unlocked
because whoever's using it may want to carry it around the IC landscape
to watch how their effects are coming across.

#1 needs to do this:
Read +wtc global-setup to see how to set up the global functions. The
code should run correctly before the global setup, but the
documentation will be incorrect; it assumes the functions to be global.
Set function_invocation_limit on your server up to 12500; this can be
done with @admin function_invocation_limit = 12500, but Keran prefers
to edit the config file in the server account to keep track of config
changes. Not setting the function_invocation_limit up will mean that
descriptions in children of the Parent Rooms will sometimes fail to
evaluate completely, on a somewhat erratic basis, with the moon descs
on clear or fair nights being the usual place for the code to break;
you /won't/ see a FUNCTION INVOCATION LIMIT EXCEEDED error.

Back to an ordinary wizard:
@trigger Clock/startup.
@trigger Storm Maker/startup (unless you have a hardcoded children()
  function).

Test the installation so far by typing '+today'. You should get
intelligible results. If the function invocation limit is not
set up, you'll probably get nonsense partway through. You should
still get reasonable results if you evaluate all the functions
called by +today on the Global Command Object one at a time, that
is, say [u(time functions/hour)], etc.

Type @ps. You should see the Clock in the wait queue.

Type 'note 2' where the box can hear you for instructions on
installing the initial +help entries.

Type +wtc and read all the entries marked with a *; you may want to
read others besides. You can then type +wta to see the commands you
can use to set up the basic configuration options like the length of
the longest day, the kind of tide, the time compression, the calendar
mode, etc.

Check the Clock, and make sure it has the following in its
triggerlist attributes:

&TRIGGERLIST-TIME~OF~DAY clock=<#Weathermaker> <#Emits Bank> <#Test Room>
&TRIGGERLIST-SUN clock=<#Emits Bank> <#Test Room>
&TRIGGERLIST-MOON clock=<#Emits Bank> <#Test Room>
&TRIGGERLIST-TIDE clock=<#Emits Bank> <#Test Room>
&TRIGGERLIST-HOUR clock=<#Emits Bank> <#Test Room>
&TRIGGERLIST-EVERY~HALFHOUR clock=<#Test Room>
&TRIGGERLIST-EVERY~QUARTERHOUR clock=<#Test Room>
&TRIGGERLIST-EVERY~HOUR clock=<#Test Room>

When you reach this point, you should have a working basic
installation.

I've added a Test Room to the package for 4.0. The acid test of
whether your installation is working, aside from getting sensible
results from +today, is whether you hear all the emits the Clock can
trigger, and all the global emits from the Emits Bank. To this end,
the Test room has on it &trigger-at-<time> attributes which will
@emit to whatever's in the room; it has all the varieties of
&trigger-at-<time> attributes the clock can @trigger, and therefore
also serves as an example of how to create Clock-@triggered effects
on other objects. It also has &hear-weather-emits and &hear-tide-emits
set to one, and therefore if you're in it, you should hear all the
emits the Emits bank sends out. The easiest way to use this is to set
clock compression up to about 24:1 and drop a listening object in it.
You should then hear all the emits from the room and all the global
emits from the Emits Bank, and, over the course of several virtual
days (several real-time hours), the emits from the Emits Bank should
vary with a changing weather type. (You will almost certainly want
to use the Clock's del command to remove the Test Room from the
every~halfhour and every~halfhour triggerlists after you've heard
them a few times; otherwise you'll get spammed unmercifully. You
may want to remove the hourly triggers as well after determining
that they work.)

A note: the room has emits for every time at which the clock can
trigger them. The Emits Bank doesn't. There are no global emits for
the beginnings of the time periods denoted noon, afternoon, midnight,
or after midnight, first; there are global emits at the hours of 0
and 12, instead. Secondly, global emits about the moon rising,
setting, or reaching its zenith are only heard during clear and fair
nights when the moon is not new, so there will be times when you
should hear an emit about the moon from the room, but not from the
Emits Bank.

If you set up regional weather, you will need to @trigger Slave
Weather Station/startup after it's set up; it should be in the
semaphore queue (type @ps) after you do.

There will be future upgrades, but I'm not anticipating making any
more massive structural changes as I did between 3.0 and 4.0.



----------------------------------------------------------------------------------------------

CODE SECTION


#85 - Keran's Time Functions

@lock Keran's Time Functions=#0
@Desc Keran's Time Functions=This object has the major timing functions on it. It belongs in the Auxiliary room and has no commands on it. It should be set visual.
&VERSION Keran's Time Functions=4.0
&AUTHOR Keran's Time Functions=Keran@Keranset Island
&TIME-BEGINS Keran's Time Functions=827380800
&STARTING-YEAR Keran's Time Functions=0
&CALENDAR-COMPRESSION Keran's Time Functions=1
&CLOCK-COMPRESSION Keran's Time Functions=1
&SOLSTICE-DAY-LENGTH Keran's Time Functions=18
&SECS-ELAPSED-TODAY Keran's Time Functions=[mod(sub(secs(), u(time-begins)), u(secs-per-day))]
&SECS-ELAPSED-THIS-YEAR Keran's Time Functions=[sub(sub(secs(), u(#85/time-begins)), mul(u(#85/native-year), u(#85/days-per-year), 24, u(#85/secs-per-hour)))]
&SECS-ELAPSED-CALENDAR-MONTH Keran's Time Functions=[mod(sub(secs(), u(time-begins)), u(secs-per-calendar-month))]
&SECS-PER-DAY Keran's Time Functions=[mul(u(secs-per-hour), 24)]
&SECS-PER-HOUR Keran's Time Functions=[fdiv(3600, u(clock-compression))]
&SECS-PER-HALFDAY Keran's Time Functions=[mul(u(secs-per-hour), 12)]
&SECS-PER-QUARTERDAY Keran's Time Functions=[mul(u(secs-per-hour), 6)]
&SECS-PER-HALFHOUR Keran's Time Functions=[div(u(secs-per-hour), 2)]
&SECS-PER-YEAR Keran's Time Functions=[mul(u(days-per-year), u(secs-per-day))]
&SECS-PER-CALENDAR-MONTH Keran's Time Functions=[mul(u(secs-per-day), u(days-per-calendar-month))]
&DAYS-PER-CALENDAR-MONTH Keran's Time Functions=[div(u(days-per-year), 12)]
&DAY-FROM-0 Keran's Time Functions=[div(sub(secs(), u(time-begins)), u(secs-per-day))]
&DAY-OF-YEAR Keran's Time Functions=[mod(u(day-from-0), u(days-per-year))]
&DAYS-PER-YEAR Keran's Time Functions=[div(u(base-days-per-year), u(calendar-compression))]
&DAYS-PER-SEASON Keran's Time Functions=[div(u(days-per-year), 4)]
&YEAR Keran's Time Functions=[u(native-year)]
&SEASON Keran's Time Functions=[u(native-season)]
&HOUR Keran's Time Functions=[u(calculated-hour)]
&BASE-DAYS-PER-YEAR Keran's Time Functions=360
&WEEK Keran's Time Functions=[add(div(mul(sub(u(day-of-calendar-month), 1), u(calendar-compression)), 7), 1)]
&CALENDAR-MONTH Keran's Time Functions=the~[elements(first~month~of~spring second~month~of~spring third~month~of~spring first~month~of~summer second~month~of~summer third~month~of~summer first~month~of~autumn second~month~of~autumn third~month~of~autumn first~month~of~winter second~month~of~winter third~month~of~winter, u(number-of-calendar-month))]
&NUMBER-OF-CALENDAR-MONTH Keran's Time Functions=[add(mod(div(u(day-from-0), u(days-per-calendar-month)), 12), 1)]
&DAY-OF-CALENDAR-MONTH Keran's Time Functions=[add(mod(u(day-of-year), u(days-per-calendar-month)), 1)]
&GREGORIAN-MONTH Keran's Time Functions=[elements(March April May June July August September October November December January February, u(number-of-calendar-month))]
&GREGORIAN-SEASON Keran's Time Functions=[elements(spring summer autumn winter, add(mod(div(u(day-from-0), u(days-per-season)), 4), 1))]
&GREGORIAN-YEAR Keran's Time Functions=[switch(u(gregorian-month), January, add(u(native-year), 1), February, add(u(native-year), 1), u(native-year))]
&NATIVE-SEASON Keran's Time Functions=[elements(spring summer autumn winter, add(mod(div(u(day-from-0), u(days-per-season)), 4), 1))]
&NATIVE-YEAR Keran's Time Functions=[add(div(u(day-from-0), u(days-per-year)), u(starting-year))]
&MONTH Keran's Time Functions=[u(calendar-month)]
&LAST-MIDNIGHT Keran's Time Functions=[add(mul(u(day-from-0), u(secs-per-day)), u(time-begins))]
&NEXT-MIDNIGHT Keran's Time Functions=[add(mul(add(u(day-from-0), 1), u(secs-per-day)), u(time-begins))]
&MIDNIGHT-BEFORE-LAST Keran's Time Functions=[add(mul(sub(u(day-from-0), 1), u(secs-per-day)), u(time-begins))]
&LAST-NOON Keran's Time Functions=[switch(gt(secs(), add(u(#85/last-midnight), u(#85/secs-per-halfday))), 1, [add(u(#85/last-midnight), u(#85/secs-per-halfday))], [sub(u(#85/last-midnight), u(#85/secs-per-halfday))])]
&NOON-BEFORE-LAST Keran's Time Functions=[sub(u(last-noon), u(secs-per-day))]
&NEXT-NOON Keran's Time Functions=[add(u(last-noon), u(secs-per-day))]
&DAY-LENGTH-VARIATION Keran's Time Functions=[round(mul(sub(u(solstice-day-length), 12), u(#85/secs-per-hour)), 0)]
&SUN-CYCLE Keran's Time Functions=[fdiv(u(#85/day-of-year), u(#85/days-per-year))]
&DAY-LENGTH Keran's Time Functions=[round(add(mul(sin(fdiv(mul(mul(pi(), 2), u(day-of-year)), u(days-per-year))), u(day-length-variation)), u(secs-per-halfday)), 0)]
&NIGHT-LENGTH Keran's Time Functions=[sub(u(secs-per-day), u(day-length))]
&SUNSET Keran's Time Functions=[add(div(u(night-length), 2), u(day-length))]
&SUNRISE Keran's Time Functions=[div(u(night-length), 2)]
&IS-MIDNIGHT Keran's Time Functions=[or(gt(u(secs-elapsed-today), sub(u(secs-per-day), u(secs-per-halfhour))), lt(u(secs-elapsed-today), u(secs-per-halfhour)))]
&IS-DAWN Keran's Time Functions=[and(gt(u(secs-elapsed-today), sub(u(sunrise), u(secs-per-halfhour))), lt(u(secs-elapsed-today), add(u(sunrise), u(secs-per-halfhour))))]
&IS-MORNING Keran's Time Functions=[and(gt(u(secs-elapsed-today), add(u(sunrise), u(secs-per-halfhour))), lt(u(secs-elapsed-today), sub(u(secs-per-halfday), u(secs-per-halfhour))))]
&IS-NOON Keran's Time Functions=[and(gt(u(secs-elapsed-today), sub(u(secs-per-halfday), u(secs-per-halfhour))), lt(u(secs-elapsed-today), add(u(secs-per-halfday), u(secs-per-halfhour))))]
&IS-AFTERNOON Keran's Time Functions=[and(gt(u(secs-elapsed-today), add(u(secs-per-halfday), u(secs-per-halfhour))), lt(u(secs-elapsed-today), sub(u(sunset), u(secs-per-halfhour))))]
&IS-DUSK Keran's Time Functions=[and(gt(u(secs-elapsed-today), sub(u(sunset), u(secs-per-halfhour))), lt(u(secs-elapsed-today), add(u(sunset), u(secs-per-halfhour))))]
&IS-AFTER-MIDNIGHT Keran's Time Functions=[and(gt(u(secs-elapsed-today), u(secs-per-halfhour)), lt(u(secs-elapsed-today), sub(u(sunrise), u(secs-per-halfhour))))]
&IFDAWN Keran's Time Functions=[switch(u(is-dawn), 1, dawn, u(ifmorning))]
&IFMORNING Keran's Time Functions=[switch(u(is-morning), 1, morning, u(ifnoon))]
&IFNOON Keran's Time Functions=[switch(u(is-noon), 1, noon, u(ifafternoon))]
&IFAFTERNOON Keran's Time Functions=[switch(u(is-afternoon), 1, afternoon, u(ifdusk))]
&IFDUSK Keran's Time Functions=[switch(u(is-dusk), 1, dusk, u(day-night))]
&IFAFTERMIDNIGHT Keran's Time Functions=[switch(u(is-after-midnight), 1, after midnight, u(ifdawn))]
&TIME-OF-DAY Keran's Time Functions=[switch(u(is-midnight), 1, midnight, u(ifaftermidnight))]
&DAY-NIGHT-DAWN-DUSK Keran's Time Functions=[switch(u(is-dawn), 1, dawn, u(ifdusk))]
&DAY-NIGHT Keran's Time Functions=[switch(and(lt(u(secs-elapsed-today), u(sunset)), gt(u(secs-elapsed-today), u(sunrise))), 1, day, night)]
&SYSTEM-WEEKDAY Keran's Time Functions=[switch(mid(time(), 0, 3), Mon, Monday, Tue, Tuesday, Wed, Wednesday, Thu, Thursday, Fri, Friday, Sat, Saturday, Sun, Sunday)]
&SYSTEM-MONTH Keran's Time Functions=[switch(mid(time(), 4, 3), Jan, January, Feb, February, Mar, March, Apr, April, May, May, Jun, June, Jul, July, Aug, August, Sep, September, Oct, October, Nov, November, Dec, December)]
&SYSTEM-DATE Keran's Time Functions=[mid(time(), 8, 2)]
&SYSTEM-TIME Keran's Time Functions=[mid(time(), 11, 9)]
&SYSTEM-HOUR Keran's Time Functions=[mid(time(), 11, 2)]
&SYSTEM-YEAR Keran's Time Functions=[add(mid(time(), 20, 4), u(starting-year))]
&SYSTEM-SEASON Time Functions=[switch(u(system-month), January, winter, February, winter, March, spring, April, spring, May, spring, June, summer, July, summer, August, summer, September, autumn, October, autumn, November, autumn, December, winter)]
&CALCULATED-HOUR Keran's Time Functions=[div(u(secs-elapsed-today), u(secs-per-hour))]
&THIS-YEAR-BEGAN Keran's Time Functions=[sub(u(#85/last-midnight), mul(u(#85/day-of-year), u(#85/secs-per-day)))]
&CLOCK-FACE-HOUR Keran's Time Functions=[switch(u(hour), 0, 12, 13, 1, 14, 2, 15, 3, 16, 4, 17, 5, 18, 6, 19, 7, 20, 8, 21, 9, 22, 10, 23, 11, u(hour))]
&SECS-PER-QUARTERHOUR Keran's Time Functions=[div(u(secs-per-hour), 4)]
&HALFHOUR Keran's Time Functions=[u(calculated-halfhour)]
&QUARTERHOUR Keran's Time Functions=[u(calculated-quarterhour)]
&CALCULATED-HALFHOUR Keran's Time Functions=[div(u(secs-elapsed-today), u(secs-per-halfhour))]
&CALCULATED-QUARTERHOUR Keran's Time Functions=[div(u(secs-elapsed-today), u(secs-per-quarterhour))]
&SYSTEM-HALFHOUR Keran's Time Functions=[add(mul(mid(time(), 11, 2), 2), div(mid(time(), 14, 2), 30))]
&SYSTEM-QUARTERHOUR Keran's Time Functions=[add(mul(mid(time(), 11, 2), 4), div(mid(time(), 14, 2), 15))]
@set Keran's Time Functions=VISUAL
@set Keran's Time Functions=SAFE


#83 - Keran's Tree Weather Descriptions

@lock Keran's Tree Weather Descriptions=#0
&TREES_SPRING_DAY_FAIR Keran's Tree Weather Descriptions=[v(trees_spring_day_pollen)]
&TREES_SPRING_DAY_CLEAR Keran's Tree Weather Descriptions=[v(trees_spring_day_pollen)]
&TREES_SPRING_DAY_STORMY Keran's Tree Weather Descriptions=Gusts of wind tear through the tree limbs and howl around rocks, turning the leaves over so that you can see their silvery undersides.
&TREES_SPRING_NIGHT_STORMY Keran's Tree Weather Descriptions=[v(trees_stormy)]
&TREES_SPRING_NIGHT_OVERCAST Keran's Tree Weather Descriptions=[v(trees_spring_frogs)]
&TREES_SPRING_NIGHT_CLEAR Keran's Tree Weather Descriptions=[v(trees_spring_frogs)]
&TREES_SUMMER_NIGHT_CLEAR Keran's Tree Weather Descriptions=The leaves of the trees and bushes rustle in the breeze. Crickets and katydids sing throughout the night.
&TREES_AUTUMN_NIGHT_CLEAR Keran's Tree Weather Descriptions=[v(trees_autumn_night)]
&TREES_AUTUMN_NIGHT_STORMY Keran's Tree Weather Descriptions=[v(trees_stormy)] Fallen leaves blow past you in the dark.
&TREES_SUMMER_NIGHT_STORMY Keran's Tree Weather Descriptions=[v(trees_stormy)]
&TREES_SUMMER_DAY_STORMY Keran's Tree Weather Descriptions=[v(trees_stormy)]
&TREES_AUTUMN_DAY_STORMY Keran's Tree Weather Descriptions=[v(trees_stormy)] Red, orange and gold leaves swirl past you on the wind.
&TREES_SPRING_DAY_OVERCAST Keran's Tree Weather Descriptions=[v(trees_spring_day_pollen)]
&TREES_SPRING_DAY_RAIN Keran's Tree Weather Descriptions=Raindrops patter against the fresh leaves, and glisten like silver beads on their bright green surfaces. The wet tree trunks have darkened from grey to brown.
&TREES_SUMMER_DAY_RAIN Keran's Tree Weather Descriptions=Raindrops patter against the leaves, and glisten like silver beads on their deep green surfaces. The wet tree trunks have darkened from grey to brown.
&TREES_AUTUMN_DAY_RAIN Keran's Tree Weather Descriptions=Raindrops patter against the leaves, and glisten like silver beads on their fiery vermillion and gold surfaces. The wet tree trunks have darkened from grey to brown.
&TREES_AUTUMN_NIGHT_RAIN Keran's Tree Weather Descriptions=[v(trees_night_rain)]
&TREES_SUMMER_NIGHT_RAIN Keran's Tree Weather Descriptions=[v(trees_night_rain)]
&TREES_SPRING_NIGHT_RAIN Keran's Tree Weather Descriptions=[v(trees_night_rain)]
&TREES_SUMMER_DAY_CLEAR Keran's Tree Weather Descriptions=The deep green leaves of the trees and bushes rustle in the breeze, which provides welcome cooling from the heat of the blazing sun.
&TREES_AUTUMN_DAY_CLEAR Keran's Tree Weather Descriptions=[v(trees_autumn_day)]
&TREES_AUTUMN_DAY_OVERCAST Keran's Tree Weather Descriptions=[v(trees_autumn_day)]
&TREES_AUTUMN_NIGHT_OVERCAST Keran's Tree Weather Descriptions=[v(trees_autumn_night)]
&TREES_WINTER_DAY_OVERCAST Keran's Tree Weather Descriptions=Snow lingers in the forks of the broadleafed trees and on the needle-clad branches of the conifers.
&TREES_WINTER_NIGHT_OVERCAST Keran's Tree Weather Descriptions=Snow lingers in the forks of the broadleafed trees and on the needle-clad branches of the conifers, limning them palely in the darkness.
&TREES_WINTER_NIGHT_FAIR Keran's Tree Weather Descriptions=Blowing snow drifts against the trunks of the dark trees.
&TREES_WINTER_DAY_FAIR Keran's Tree Weather Descriptions=Blowing snow drifts against the trunks of the trees.
&TREES_WINTER_NIGHT_CLEAR Keran's Tree Weather Descriptions=Blowing snow drifts against the trunks of the dark trees, clinging to their windward sides.
&TREES_WINTER_DAY_CLEAR Keran's Tree Weather Descriptions=[v(trees_winter_clear)]
&TREES_SPRING_NIGHT_FAIR Keran's Tree Weather Descriptions=[v(trees_spring_frogs)]
&TREES_SPRING_FROGS Keran's Tree Weather Descriptions=You can hear peepfrogs, bullfrogs, and treefrogs singing. The leaves of the trees and bushes rustle in the wind.
&TREES_STORMY Keran's Tree Weather Descriptions=Gusts of wind tear through the tree limbs and howl around rocks.
&TREES_NIGHT_RAIN Keran's Tree Weather Descriptions=Raindrops patter against the leaves, invisible in the darkness.
&TREES_WINTER_CLEAR Keran's Tree Weather Descriptions=Blowing snow drifts against the trunks of the trees, clinging to their windward sides.
&TREES_SUMMER_DAY_OVERCAST Keran's Tree Weather Descriptions=The deep green leaves of the trees are unstirred.
&TREES_SUMMER_NIGHT_OVERCAST Keran's Tree Weather Descriptions=The leaves of the trees and bushes are unstirred.
&TREES_SUMMER_DAY_FAIR Keran's Tree Weather Descriptions=The shade under the deep green leaves of the trees is welcome relief from the hot glare of the sun.
&TREES_SUMMER_NIGHT_FAIR Keran's Tree Weather Descriptions=The shadows under the canopy of leaves are deep, and you can hear cicadas and crickets singing all around you.
&TREES_AUTUMN_DAY Keran's Tree Weather Descriptions=Fiery red, gold, and orange leaves rustle and blow past you, swirling in the wind.
&TREES_AUTUMN_DAY_FAIR Keran's Tree Weather Descriptions=[v(trees_autumn_day)]
&TREES_AUTUMN_NIGHT Keran's Tree Weather Descriptions=Leaves on the ground rustle, unseen, stirred by the winds. Falling leaves blow past you, whirled around by the wind in the dark.
&TREES_AUTUMN_NIGHT_FAIR Keran's Tree Weather Descriptions=[v(trees_autumn_night)]
&TREES_SPRING_DAY_POLLEN Keran's Tree Weather Descriptions=The wind rustles the bright green leaves of trees and bushes and carries pollen, downy seeds, and the fragrance of wildflowers along with it.
&TREES_WINTER_DAY_LIGHTSNOW Keran's Tree Weather Descriptions=Snowflurries dust the bare branches of the broadleaves and the needles of the conifers.
&TREES_WINTER_NIGHT_LIGHTSNOW Keran's Tree Weather Descriptions=Snowflurries dust the bare branches of the broadleaves and the needles of the conifers, giving them faint pale outlines which render them visible in the darkness.
&TREES_WINTER_DAY_SLEET Keran's Tree Weather Descriptions=Rain freezes on the bare twigs of the broadleafed trees and the needles of the conifers, coating them with a layer of glistening silver ice and weighing the branches down.
&TREES_WINTER_NIGHT_SLEET Keran's Tree Weather Descriptions=Rain freezes on the tree limbs. Occasionally you hear the crack of a branch breaking, weighed down by its coating of ice.
&TREES_WINTER_DAY_BLIZZARD Keran's Tree Weather Descriptions=The whirling curtain of snow accumulates in the forks of the trees and piles up in drifts against their trunks.
&TREES_WINTER_NIGHT_BLIZZARD Keran's Tree Weather Descriptions=The whirling curtain of snow accumulates in the forks of the trees, outlining them in the darkness, and piles up in drifts against their trunks.
&TREES_NIGHT_FOG Keran's Tree Weather Descriptions=The dark shapes of nearby trees loom at you suddenly out of the deep grey fog as you approach them.
&TREES_WINTER_NIGHT_FOG Keran's Tree Weather Descriptions=In the darkness and the veils of fog, the bare branches of the trees fade from sight.
&TREES_WINTER_DAY_FOG Keran's Tree Weather Descriptions=The bare branches of the trees form stark silhouettes of darker grey.
&TREES_AUTUMN_DAY_FOG Keran's Tree Weather Descriptions=Only the nearest tree branches, half-bereft of leaves, show their full color; more distant trees and branches are colorless and indistinct in the pallid grey fog, looking ghostly and not quite real.
&TREES_SUMMER_DAY_FOG Keran's Tree Weather Descriptions=Only the nearest tree branches show their full color; more distant trees and branches are colorless and indistinct in the pallid grey fog, looking ghostly and not quite real.
&TREES_AUTUMN_NIGHT_FOG Keran's Tree Weather Descriptions=[v(trees_night_fog)]
&TREES_SUMMER_NIGHT_FOG Keran's Tree Weather Descriptions=[v(trees_night_fog)]
&TREES_SPRING_NIGHT_FOG Keran's Tree Weather Descriptions=[v(trees_night_fog)]
&TREES_SPRING_DAY_FOG Keran's Tree Weather Descriptions=Only the nearest tree branches show the full color of their buds and new leaves; more distant trees and branches are colorless and indistinct in the pallid grey fog, looking ghostly and not quite real.
&TREES_SPRING_DAY_LIGHTSNOW Keran's Tree Weather Descriptions=[v(trees_spring_day_pollen)]
&TREES_SPRING_NIGHT_LIGHTSNOW Keran's Tree Weather Descriptions=[v(trees_spring_frogs)]
&TREES_SPRING_NIGHT_SLEET Keran's Tree Weather Descriptions=[v(trees_night_rain)]
&TREES_SPRING_DAY_SLEET Keran's Tree Weather Descriptions=Raindrops patter against the fresh leaves, and glisten like silver beads on their bright green surfaces. The wet tree trunks have darkened from grey to brown.
&TREES_SPRING_DAY_BLIZZARD Keran's Tree Weather Descriptions=Gusts of wind tear through the tree limbs and howl around rocks, turning the leaves over so that you can see their silvery undersides.
&TREES_SPRING_NIGHT_BLIZZARD Keran's Tree Weather Descriptions=[v(trees_stormy)]
&TREES_WINTER_NIGHT_RAIN Keran's Tree Weather Descriptions=Rain freezes on the tree limbs. Occasionally you hear the crack of a branch breaking, weighed down by its coating of ice.
&TREES_WINTER_DAY_RAIN Keran's Tree Weather Descriptions=Rain freezes on the bare twigs of the broadleafed trees and the needles of the conifers, coating them with a layer of glistening silver ice and weighing the branches down.
&TREES_WINTER_DAY_STORMY Keran's Tree Weather Descriptions=The whirling curtain of snow accumulates in the forks of the trees and piles up in drifts against their trunks.
&TREES_WINTER_NIGHT_STORMY Keran's Tree Weather Descriptions=The whirling curtain of snow accumulates in the forks of the trees, outlining them in the darkness, and piles up in drifts against their trunks.
@Desc Keran's Tree Weather Descriptions=This is an auxiliary weather description bank. It has different descriptions for a temperate environment with a lot of leafy trees that vary by season and whether it's day or night. It belongs in the Auxiliary room and has no commands on it.
&VERSION Keran's Tree Weather Descriptions=4.0
&AUTHOR Keran's Tree Weather Descriptions=Keran@Keranset Island
@set Keran's Tree Weather Descriptions=VISUAL
@set Keran's Tree Weather Descriptions=SAFE


#82 - Keran's Weather Long Description Bank

@lock Keran's Weather Long Description Bank=#0
&AUTUMNDAWNRAIN Keran's Weather Long Description Bank=Cold rain is falling as the sky begins to lighten to overcast grey. A raw wind blows from the east.
&AUTUMNDAYRAIN Keran's Weather Long Description Bank=Chilly rain falls from a grey sky. It's bleak and raw. The wind blows from the east.
&AUTUMNDUSKRAIN Keran's Weather Long Description Bank=A chilling rain falls as the grey sky darkens in the twilight. It's cold and wet. The wind blows from the east.
&AUTUMNNIGHTRAIN Keran's Weather Long Description Bank=Cold rain falls from a grey-black sky without moon or stars. A raw wind blows from the east.
&AUTUMNNIGHTCLEAR Keran's Weather Long Description Bank=The deep blue night sky is clear and cloudless, and the stars glitter. An icy wind blows from the northwest.
&AUTUMNNIGHTSTORMY Keran's Weather Long Description Bank=Icy rain pours from grey-black clouds driven by a howling northeast wind.
&AUTUMNDUSKSTORMY Keran's Weather Long Description Bank=A cold rain driven by a howling northeast wind drenches you while the clouded sky fades from grey to black.
&AUTUMNDAYSTORMY Keran's Weather Long Description Bank=Chilling rain pours from thick grey clouds, driven by a furious northeast wind.
&AUTUMNDAWNSTORMY Keran's Weather Long Description Bank=Cold rain pours from clouds slowly lightening from black to grey, driven by a howling northeaster wind.
&AUTUMNDUSKCLEAR Keran's Weather Long Description Bank=The sun sets and the evening stars begin to appear in a blue and cloudless sky. A biting wind blows from the northwest.
&AUTUMNDAYCLEAR Keran's Weather Long Description Bank=The sky is brilliant blue and cloudless, the sunlight is bright, and a brisk wind blows from the northwest.
&AUTUMNDAWNCLEAR Keran's Weather Long Description Bank=It's a chilly morning and the brightening sky is clear and cloudless. The northwest wind is biting.
&AUTUMNNIGHTOVERCAST Keran's Weather Long Description Bank=The sky is grey-black, without moon or star. It's hard for human eyes to see anything in the deep shadows round about, without a light. The wind is chilly.
&AUTUMNDUSKOVERCAST Keran's Weather Long Description Bank=The grey of the clouds begins to darken. A chilling wind blows from the west.
&AUTUMNDAWNOVERCAST Keran's Weather Long Description Bank=The overcast sky lightens from grey-black to cloudy grey as the sun rises. A chill wind blows from the northwest.
&AUTUMNDAYOVERCAST Keran's Weather Long Description Bank=The sky is grey and cloudy, and nothing casts a shadow. The northwest wind is chilly.
&AUTUMNNIGHTFAIR Keran's Weather Long Description Bank=A chilly wind blows from the west, driving dark clouds before it and blotting out the stars in patches overhead. The air is clear and elsewhere they glitter brightly in the dark sapphire sky.
&AUTUMNDUSKFAIR Keran's Weather Long Description Bank=The fair weather clouds in the west turn orange, gold, carmine, and purple as the sun sets. A chill wind blows from the west.
&AUTUMNDAYFAIR Keran's Weather Long Description Bank=Fair weather clouds drift through the blue sky from the west. The wind is gusty.
&AUTUMNDAWNFAIR Keran's Weather Long Description Bank=Fair weather clouds glow pink and white-gold in the southeast, catching the rays of the rising sun while the earth remains in shadow. A cool wind blows from the west.
&WINTERNIGHTRAIN Keran's Weather Long Description Bank=Icy rain and sleet fall invisibly from a grey-black sky. It's very dark and the ice makes walking on the slippery ground difficult. A raw wind blows from the northeast.
&WINTERDUSKRAIN Keran's Weather Long Description Bank=Darkness comes early as thick clouds block the fading light of grey day. Freezing rain and sleet fall, coating everything with ice and making the ground slippery. Raw winds blow from the northeast.
&WINTERDAYRAIN Keran's Weather Long Description Bank=Sleet and freezing rain fall from heavy clouds, coating everything with ice and making the ground slippery. The world looks silver in the icy grey light. A raw wind blows from the northeast.
&WINTERDAWNRAIN Keran's Weather Long Description Bank=Darkness lingers and the dawn that breaks is grey. Sleet and freezing rain fall from heavy clouds, coating everything with ice and making the walking treacherous. Raw winds blow from the northeast.
&WINTERNIGHTFAIR Keran's Weather Long Description Bank=A cold wind blows from the west, driving charcoal clouds before it and blotting out the stars in isolated patches overhead. The air is clear and elsewhere the stars shine brightly.
&WINTERDUSKFAIR Keran's Weather Long Description Bank=The fair weather clouds in the west turn purple, gold, and vermillion as the sun sets. The snow, in shadow, looks blue. A cold wind blows from the west.
&WINTERNIGHTCLEAR Keran's Weather Long Description Bank=The icy northwest wind howls, blowing snow about in savage gusts. The cold is intense. The sky is clear deep blue and the stars glitter, brilliant as diamonds.
&WINTERDAWNCLEAR Keran's Weather Long Description Bank=The light of a cruelly cold dawn breaks in the southeast. The sky is clear and the northwest wind blasts snow across the landscape in gusts. Your breath fogs in the frigid air.
&WINTERDUSKCLEAR Keran's Weather Long Description Bank=The cold becomes intense as the light fades from the sky. The evening stars glitter brightly. The northwest wind blows the snow about in freezing gusts.
&WINTERDAWNFAIR Keran's Weather Long Description Bank=Fair weather clouds glow pink in the southeast, catching the rays of the rising sun while the earth remains in shadow. A cold wind blows from the west. You can see your breath misting in the cold air.
&WINTERDAWNOVERCAST Keran's Weather Long Description Bank=Dawn's light is grey. A thin layer of translucent cloud obscures the sun, showing only a bright patch in the sky. The air is cold and slightly damp.
&WINTERDUSKOVERCAST Keran's Weather Long Description Bank=The sky is a dull iron grey, and darkness closes in early. The air is cold and damp.
&WINTERNIGHTOVERCAST Keran's Weather Long Description Bank=The sky is grey-black, moonless and starless. Human eyes can distinguish the snow from everything else, and not much more: every shape that isn't snow-covered is a black shadow. The air is damp and cold. There is little wind.
&WINTERDAYCLEAR Keran's Weather Long Description Bank=The sky is cloudless and brilliant blue. The northwest wind is icy, blowing snow across the landscape in swirling white gusts.
&WINTERDAYOVERCAST Keran's Weather Long Description Bank=The air is damp and cold, the sky a translucent grey, brighter to the south. Nothing casts a shadow.
&WINTERDAYFAIR Keran's Weather Long Description Bank=Fair weather clouds drift through the blue sky from the west, along with the wind. The sunlight on the snow is dazzling, and it gleams on the ice.
&SUMMERDAYRAIN Keran's Weather Long Description Bank=A light rain falls from a grey sky. It's warm and there's a slight wind from the southeast.
&SUMMERDUSKRAIN Keran's Weather Long Description Bank=Light rain falls as the grey clouds darkens in the twilight. It's warm and there's a gentle wind from the southeast.
&SUMMERNIGHTRAIN Keran's Weather Long Description Bank=Soft rain falls from a grey-black sky without moon or stars. A warm gentle wind blows from the southeast.
&SUMMERDAWNRAIN Keran's Weather Long Description Bank=Soft rain is falling as the sky lightens to overcast grey. A warm breeze blows from the southeast.
&SUMMERNIGHTCLEAR Keran's Weather Long Description Bank=The deep blue night sky is clear and cloudless, and the stars glitter. A cool breeze blows from the west.
&SUMMDERDAWNPRECIP Keran's Weather Long Description Bank=Soft rain is falling as the sky lightens to cloudy grey. A warm breeze blows from the southeast.
&SUMMERDAWNOVERCAST Keran's Weather Long Description Bank=The sky pales in the east, turning overcast grey. There's little wind, and it's warm and humid.
&SUMMERDAWNFAIR Keran's Weather Long Description Bank=The sky turns a lighter blue and the stars fade out. It's clear and there's a soft breeze from the west.
&SUMMERNIGHTSTORMY Keran's Weather Long Description Bank=Heavy rain drenches you in the dark as it falls from grey-black clouds, driven by a howling east wind.
&SUMMERDUSKSTORMY Keran's Weather Long Description Bank=Driving rain pours from clouds darkening from grey to black as daylight fades, propelled by a furious east wind.
&SUMMERDAWNSTORMY Keran's Weather Long Description Bank=Heavy rain pours from clouds slowly lightening from black to grey, propelled by a howling east wind.
&SUMMERDAYSTORMY Keran's Weather Long Description Bank=Heavy rain pours from dark grey clouds, propelled by a furious east wind.
&SUMMERNIGHTOVERCAST Keran's Weather Long Description Bank=The sky is grey-black, moonless and starless. It's hard for human eyes to see anything in the deep shadows round about, without a light. It's warm, still, and humid.
&SUMMERDUSKOVERCAST Keran's Weather Long Description Bank=The grey of the clouds begins to darken, and the temperature drops slightly. It's warm and still.
&SUMMERDAYOVERCAST Keran's Weather Long Description Bank=The sky is grey and cloudy, and nothing casts a shadow. It's hot, humid, and still.
&SUMMERNIGHTFAIR Keran's Weather Long Description Bank=The night is warm and sultry, and dark clouds hide the stars in patches. Elsewhere they shine brightly. Dew forms on the ground.
&SUMMERDUSKFAIR Keran's Weather Long Description Bank=The sun sets, the western clouds turning purple, red, and gold. It's hazy and warm.
&SUMMERDAYFAIR Keran's Weather Long Description Bank=Towering white clouds drift slowly through the blue sky. It's hazy and hot, and the glare of the sun seems to drain the color from the landscape.
&SUMMERDUSKCLEAR Keran's Weather Long Description Bank=The sun sets and the evening stars begin to appear in a blue and cloudless sky. There's a cool breeze from the west.
&SUMMERDAYCLEAR Keran's Weather Long Description Bank=The sky is clear brilliant blue and there's a light breeze from the west. It's warm.
&SUMMERDAWNCLEAR Keran's Weather Long Description Bank=The sky starts to lighten and the stars fade out. The sky is clear and there's a cool breeze from the west.
&SPRINGNIGHTSTORMY Keran's Weather Long Description Bank=Cold driving rain pours down upon you in the dark from black clouds, propelled by a howling northeast wind.
&SPRINGDUSKSTORMY Keran's Weather Long Description Bank=Twilight falls and the clouds darken from grey to charcoal as cold driving rain pours from them, lashed by a raging northeast wind.
&SPRINGDAYSTORMY Keran's Weather Long Description Bank=Cold rain pours from thick grey clouds, driven by a howling northeast wind.
&SPRINGDAWNSTORMY Keran's Weather Long Description Bank=A cold driving rain pours from clouds slowly lightening from black to grey, propelled by a howling northeasterly wind.
&SPRINGNIGHTOVERCAST Keran's Weather Long Description Bank=The sky is grey-black, moonless and starless. It's hard for human eyes to see anything in the deep shadows round about, without a light. It's cool and a light breeze blows from the southwest.
&SPRINGDUSKOVERCAST Keran's Weather Long Description Bank=The grey of the clouds begins to darken, and it becomes cooler. A light wind is blowing from the southwest.
&SPRINGDAYOVERCAST Keran's Weather Long Description Bank=The sky is cloudy grey, and nothing casts a shadow. The southwest wind is mild.
&SPRINGDAWNOVERCAST Keran's Weather Long Description Bank=The sky begins to lighten. It's grey and overcast. A light wind blows from the southwest.
&SPRINGDAWNCLEAR Keran's Weather Long Description Bank=The sky begins to brighten as the stars fade out. It's a chilly morning and the sky is clear blue and cloudless.
&SPRINGDAYCLEAR Keran's Weather Long Description Bank=The sky is blue and cloudless, the sunlight is bright, and a cool wind blows from the northwest.
&SPRINGDUSKCLEAR Keran's Weather Long Description Bank=The sun sets and the evening stars begin to appear in a blue and cloudless sky. A cool wind blows from the northwest.
&SPRINGNIGHTCLEAR Keran's Weather Long Description Bank=The deep blue night sky is clear and cloudless, and the stars glitter. A brisk breeze blows from the northwest.
&SPRINGDAWNFAIR Keran's Weather Long Description Bank=The blue sky brightens. The sun lights the fair weather clouds in the east with pink and pale gold before it touches the ground, which remains in shadow. A mild breeze blows from the west.
&SPRINGDAYFAIR Keran's Weather Long Description Bank=Fair weather clouds sail across the blue sky, propelled by light breezes from the west. It's warm in the sun, cool in the shade, and the air is clear and dry.
&SPRINGDUSKFAIR Keran's Weather Long Description Bank=Oranges, reds, and golds light the fair weather clouds, shadowed in purple, around the setting sun. A soft breeze blows from the west.
&SPRINGNIGHTFAIR Keran's Weather Long Description Bank=A cool breeze blows from the west, driving dark clouds before it which blot out the stars in patches overhead. Elsewhere they glitter brightly in the dark sapphire sky.
&SPRNGDAYOVERCAST Keran's Weather Long Description Bank=The sky is cloudy grey, and nothing casts a shadow. A light wind blows from the southwest.
&SPRINGDAWNRAIN Keran's Weather Long Description Bank=Rain is falling as the sky begins to lighten to overcast grey. It's cool and there's a slight wind from the east.
&SPRINGDAYRAIN Keran's Weather Long Description Bank=A light rain falls from a grey sky. It's cool and there's a mild wind from the east.
&SPRINGNIGHTRAIN Keran's Weather Long Description Bank=Light rain falls from a grey-black sky without moon or stars. It's chilly and there's a fresh wind from the east.
&SPRINGDUSKRAIN Keran's Weather Long Description Bank=A light rain falls as the grey sky darkens in the twilight. The temperature is moderate and there's a slight wind from the east.
&WINTERDAWNLIGHTSNOW Keran's Weather Long Description Bank=The overcast sky slowly lightens from the grey-black of night to pale grey. Powdery snow falls from the clouds.
&WINTERDAYLIGHTSNOW Keran's Weather Long Description Bank=Snow flurries drift silently down from the pale grey sky. The air is damp and cold, and there is little wind.
&WINTERDUSKLIGHTSNOW Keran's Weather Long Description Bank=Darkness closes in early as thick grey clouds block the sun. A light snow is falling. There is scant wind.
&WINTERNIGHTLIGHTSNOW Keran's Weather Long Description Bank=The sky is grey-black, without moon or stars. The air is cold and wet, and there is little wind. Snow flurries fall. It is easier to feel the flakes landing than it is to see them, in the darkness.
&WINTERDUSKSLEET Keran's Weather Long Description Bank=Darkness comes early as thick clouds block the fading light of grey day. Freezing rain and sleet fall, coating everything with ice and making the ground slippery. Raw winds blow from the northeast.
&WINTERDAYSLEET Keran's Weather Long Description Bank=Sleet and freezing rain fall from heavy clouds, coating everything with ice and making the ground slippery. The world looks silver in the icy grey light. A raw wind blows from the northeast.
&WINTERDAWNSLEET Keran's Weather Long Description Bank=Darkness lingers and the dawn that breaks is grey. Sleet and freezing rain fall from heavy clouds, coating everything with ice and making the walking treacherous. Raw winds blow from the northeast.
&WINTERNIGHTSLEET Keran's Weather Long Description Bank=Icy rain and sleet fall invisibly from a grey-black sky. It's very dark and the ice makes walking on the slippery ground difficult. A raw wind blows from the northeast.
&WINTERNIGHTBLIZZARD Keran's Weather Long Description Bank=Night has come, and heavy snow falls. It's difficult to walk through the accumulating drifts, and difficult to see. It's hard to keep a sense of direction in the darkness and the blinding, swirling snow.
&WINTERDAYBLIZZARD Keran's Weather Long Description Bank=Heavy snow falls, making it hard to walk through the accumulating drifts, and occasionally even hard to see. All the world seems grey and white. The wind blows the snow about from the east, and it swirls around objects and never falls straight down.
&WINTERDAWNBLIZZARD Keran's Weather Long Description Bank=Dawn breaks to reveal snow falling from a dark sky that gradually lightens to grey-white. The snowfall is heavy and piles up in drifts, blown about by the shifting wind.
&WINTERDUSKBLIZZARD Keran's Weather Long Description Bank=Snow falls heavily in the deepening twilight, making it hard to walk through the accumulating drifts, and hard to see. The wind blows the snow about from the east, and it swirls around objects and never falls straight down.
&AUTUMNNIGHTFOG Keran's Weather Long Description Bank=The world is dark and foggy. Everything is half-hidden, nothing clearly seen. It's chilly and the air feels damp. No wind blows.
&AUTUMNDAYFOG Keran's Weather Long Description Bank=Everything is grey, veiled by mist. It's chilly and the air feels damp. There is no wind.
&AUTUMNDUSKFOG Keran's Weather Long Description Bank=Everything is grey, veiled by darkening twilit mist. There is little wind. It's chilly and the air feels damp.
&AUTUMNDAWNFOG Keran's Weather Long Description Bank=The sky slowly changes from dark grey to pale. Everything is veiled by fog. The air feels damp and chilly, and there is little wind.
&WINTERDAWNFOG Keran's Weather Long Description Bank=The sky slowly lightens from deep grey to pale, and a chilly mist veils everything.
&WINTERDAYFOG Keran's Weather Long Description Bank=The landscape looks ghostly and drained of color in the cold pale fog.
&WINTERNIGHTFOG Keran's Weather Long Description Bank=The night is shrouded in cold bleak mist, dark grey and colorless. The ground is icy and the air wet.
&WINTERDUSKFOG Keran's Weather Long Description Bank=The pale grey mists darken and begin to freeze, forming a slick of ice over the ground.
&SUMMERNIGHTFOG Keran's Weather Long Description Bank=Everything is half-hidden, nothing clearly seen in the dark fog. It's warm and still.
&SUMMERDUSKFOG Keran's Weather Long Description Bank=Everything is grey, veiled by darkening twilit mist. It's still, warm, and the air feels damp.
&SUMMERDAWNFOG Keran's Weather Long Description Bank=The sky begins to lighten from dark grey to pale, for the world is veiled by fog. It's still, warm, and the air feels damp.
&SUMMERDAYFOG Keran's Weather Long Description Bank=Everything is pale grey, veiled by mist. It's warm, humid, and still.
&SPRINGNIGHTFOG Keran's Weather Long Description Bank=The world is dark and foggy. Everything is half-hidden, nothing clearly seen. It almost feels as if you walk through some otherworld. It's cool and the air feels damp and still.
&SPRINGDUSKFOG Keran's Weather Long Description Bank=The mist begins to darken as twilight comes. It's cool and the air feels damp. There is no wind.
&SPRINGDAYFOG Keran's Weather Long Description Bank=Everything is grey, veiled by mist. It's cool and the air feels damp. There is no wind.
&SPRINGDAWNFOG Keran's Weather Long Description Bank=It grows lighter, and you see that everything is veiled by fog. It's moderately cool and the air feels damp and still.
&SPRINGDAWNSLEET Keran's Weather Long Description Bank=Rain is falling as the sky begins to lighten to overcast grey. It's cool and there's a slight wind from the east.
&SPRINGDAYSLEET Keran's Weather Long Description Bank=A light rain falls from a grey sky. It's cool and there's a mild wind from the east.
&SPRINGDUSKSLEET Keran's Weather Long Description Bank=A light rain falls as the grey sky darkens in the twilight. The temperature is moderate and there's a slight wind from the east.
&SPRINGNIGHTSLEET Keran's Weather Long Description Bank=Light rain falls from a grey-black sky without moon or stars. It's chilly and there's a fresh wind from the east.
&SPRINGNIGHTLIGHTSNOW Keran's Weather Long Description Bank=The sky is grey-black, moonless and starless. It's hard for human eyes to see anything in the deep shadows round about, without a light. It's cool and a light breeze blows from the southwest.
&SPRINGDAWNLIGHTSNOW Keran's Weather Long Description Bank=The sky begins to lighten. It's grey and overcast. A light wind blows from the southwest.
&SPRINGDAYLIGHTSNOW Keran's Weather Long Description Bank=The sky is cloudy grey, and nothing casts a shadow. The southwest wind is mild.
&SPRINGDUSKLIGHTSNOW Keran's Weather Long Description Bank=The grey of the clouds begins to darken, and it becomes cooler. A light wind is blowing from the southwest.
&SPRINGDAWNBLIZZARD Keran's Weather Long Description Bank=A cold driving rain pours from clouds slowly lightening from black to grey, propelled by a howling northeasterly wind.
&SPRINGDAYBLIZZARD Keran's Weather Long Description Bank=Cold rain pours from thick grey clouds, driven by a howling northeast wind.
&SPRINGDUSKBLIZZARD Keran's Weather Long Description Bank=Twilight falls and the clouds darken from grey to charcoal as cold driving rain pours from them, lashed by a raging northeast wind.
&SPRINGNIGHTBLIZZARD Keran's Weather Long Description Bank=Cold driving rain pours down upon you in the dark from black clouds, propelled by a howling northeast wind.
&WINTERDAWNSTORMY Keran's Weather Long Description Bank=Dawn breaks to reveal snow falling from a dark sky that gradually lightens to grey-white. The snowfall is heavy and piles up in drifts, blown about by the shifting wind.
&WINTERDAYSTORMY Keran's Weather Long Description Bank=Heavy snow falls, making it hard to walk through the accumulating drifts, and occasionally even hard to see. All the world seems grey and white. The wind blows the snow about from the east, and it swirls around objects and never falls straight down.
&WINTERDUSKSTORMY Keran's Weather Long Description Bank=Snow falls heavily in the deepening twilight, making it hard to walk through the accumulating drifts, and hard to see. The wind blows the snow about from the east, and it swirls around objects and never falls straight down.
&WINTERNIGHTSTORMY Keran's Weather Long Description Bank=Night has come, and heavy snow falls. It's difficult to walk through the accumulating drifts, and difficult to see. It's hard to keep a sense of direction in the darkness and the blinding, swirling snow.
@Desc Keran's Weather Long Description Bank=This is the main bank of long weather descriptions that vary with the seasons and whether it's day, night, dawn, or dusk. It belongs in the Auxiliary room and has no commands on it.
&VERSION Keran's Weather Long Description Bank=4.0
&AUTHOR Keran's Weather Long Description Bank=Keran@Keranset Island
@set Keran's Weather Long Description Bank=VISUAL
@set Keran's Weather Long Description Bank=SAFE


#81 -  Keran's Box of Weather and Time Stuff, with Notes

@lock Keran's Box of Weather and Time Stuff, with Notes=#0
@Desc Keran's Box of Weather and Time Stuff, with Notes=Put me in the Auxiliary Room. Type 'note 1' and 'note 2' to read the notes.
&NOTE1 Keran's Box of Weather and Time Stuff, with Notes=$note 1: @pemit %# =%rThe items in Keran's Weather Code package are:%r%r#85 Keran's Time Functions%r#83 Keran's Tree Weather Descriptions%r#82 Keran's Weather Long Description Bank%r#81 Keran's Box of Weather and Time Stuff, with Notes%r#78 Keran's Weathermaker%r#77 Keran's Wizard Weather and Time Commands%r#76 Keran's Slave Weather Station%r#75 Keran's Clock%r#51 Keran's Emits Bank%r#50 Keran's Global Command Object%r#80 Keran's Weather and Time Help - Admin Commands%r#79 Keran's Weather and Time Help - Configuration Considerations%r#71 Keran's Weather and Time Help - General%r#338 Keran's Miscellaneous Functions%r#339 Keran's Storm Maker%r#340 Keran's Moon and Tide Functions%r%rRooms:%r%r#72 Keran's Parent of Separable Day-Night and Season Desc Outdoor Rooms%r#341 Keran's Parent of Season-and-Day-Night Varying Outdoor Rooms%r#344 Keran's Parent of Windowed Indoor Rooms%r#347 Keran's Parent of Windowless Indoor Rooms%r#350 Keran's Parent of Separable Day-Night-Dawn-Dusk and Season Desc Outdoor Rooms%r#353 Keran's Parent of Separable Desc Outdoor Rooms%r#356 Keran's Parent of Weather-and-Day-Night Varying Outdoor Rooms%r#359 Keran's Grandparent of Windowed Indoor Rooms%r#362 Keran's Grandparent of Windowless Indoor Rooms%r#367 Keran's Grandparent of Outdoor Rooms%r#370 Keran's Great-grandparent of Rooms%r#373 Keran's Test Room%r
&HELP_+TODAY Keran's Box of Weather and Time Stuff, with Notes=%r+today%r%r+Today returns information about the time of day, month, season, year, tides, weather, etc.%r
&HELP_+PARENTS Keran's Box of Weather and Time Stuff, with Notes=%r+parents%r%r+Parents returns a list of parent rooms you can use to build rooms with descriptions that vary according to the time of day, weather, etc. You build your room, @parent it to one of the parent rooms, and look at it to see instructions for how to write descriptions that vary according to environmental conditions. You can simply write descriptions for day, night, winter, summer, etc., and the parent room will switch them at the appropriate times.%r%rThere are two indoor parent rooms, one for rooms with windows and one for rooms without, and several outdoor parent rooms which have style variations in the variable descs returned. The parent rooms are set visual and you can examine <dbref> to see how they work.%r%r+help +parents2 for more.%r
&HELP_+PARENTS2 Keran's Box of Weather and Time Stuff, with Notes=%rThe outdoor room style variations are:%r%rSeparable Day-Night - This room will return a description consisting of an unchanging desc, a day/night desc, a spring/summer/autumn/winter desc, a weather desc, and a moon desc. You can suppress any elements you don't want, e.g., you can prevent it from showing a moon description.%r%rSeparable Day-Night-Dawn-Dusk - As above, but instead of returning a description that varies only by day and night, it returns different descriptions at day, night, dawn, and dusk.%r%rSeason and Day-Night - Returns a desc for summer-night, a desc for summer-day, a desc for autumn-night, a desc for autumn-day, and so on. Also returns a moon desc and a weather desc.%r%rSeason and Day-Night-Dawn-Dusk - As above, but also returns distinct dawn and dusk descriptions, e.g, winter-dawn, winter-dusk, etc.%r%rWeather and Day-Night - Returns descriptions that combine day-night and weather variations, e.g., fair-night, fair-day, overcast-day, etc. Also returns a moon desc.%r
&HELP_RANDWORD Keran's Box of Weather and Time Stuff, with Notes=%rrandword(<word1> <word2> <word3> <etc.>)%r%rRandword() returns a random word from the list.%r
&HELP_TILDE2BLANK Keran's Box of Weather and Time Stuff, with Notes=%rtilde2blank(<string>)%r%rTilde2blank() takes a string as its argument and replaces all the spaces with tildes (~).%r
&HELP_BLANK2TILDE Keran's Box of Weather and Time Stuff, with Notes=%rblank2tilde(<string>)%r%rTilde2blank() takes a string as its argument and replaces all the tildes (~) with spaces.%r
&HELP_WEATHER+TIME Keran's Box of Weather and Time Stuff, with Notes=%rKeran's Weather and Time Code is a configurable MUSH/MUX softcode package for maintaining virtual or in-character environments. It has +help divided into three sections:%r%r+wt - +help for common commands, functions and topics generally useful to builders and coders.%r%r+wta - Admin commands.%r%r+wtc - Configuration considerations. Extensive and sometimes complex, since there are many non-vanilla ways to set up this code, depending on the environment you're trying to model. This is version 4.0.%r
&NOTE2 Keran's Box of Weather and Time Stuff, with Notes=$note 2: @pemit %# = {%r+Help for Keran's Weather and Time Code Package%r%rAdd the following to your regular +help for global commands:%r%tweather+time +parents +today%r%rAdd the following to your +help for global functions:%r%tblank2tilde randword tilde2blank%r%rThe +help entries for these commands and functions are stored on this box, as attributes named &help_<item>; move them to your regular +help.%r}
@set Keran's Box of Weather and Time Stuff, with Notes=VISUAL
@set Keran's Box of Weather and Time Stuff, with Notes=SAFE
@set Keran's Box of Weather and Time Stuff, with Notes=COMMANDS


#78 - Keran's Weathermaker

@lock Keran's Weathermaker=#0
&SUMMERCLEAR Keran's Weathermaker=It's clear, warm, and breezy.
&SUMMERFAIR Keran's Weathermaker=It's fair and very warm, with a few clouds in the sky.
&SUMMEROVERCAST Keran's Weathermaker=It's overcast and warm.
&SUMMERRAIN Keran's Weathermaker=It's raining and warm.
&SUMMERSTORMY Keran's Weathermaker=It's raining hard, with thunder and flashes of lightning.
&SPRINGCLEAR Keran's Weathermaker=It's clear, cool, and breezy.
&SPRINGFAIR Keran's Weathermaker=It's fair and mild, with a few clouds in the sky.
&SPRINGOVERCAST Keran's Weathermaker=It's cloudy and mild.
&SPRINGRAIN Keran's Weathermaker=It's raining and cool.
&SPRINGSTORMY Keran's Weathermaker=It's raining hard and the winds are strong.
&WINTERCLEAR Keran's Weathermaker=It's clear, cold, and windy.
&WINTERFAIR Keran's Weathermaker=It's fair and chilly.
&WINTEROVERCAST Keran's Weathermaker=It's cloudy, cold, and damp.
&AUTUMNCLEAR Keran's Weathermaker=It's clear, cool, and windy.
&AUTUMNFAIR Keran's Weathermaker=It's fair and cool.
&AUTUMNOVERCAST Keran's Weathermaker=It's cloudy and cool.
&AUTUMNRAIN Keran's Weathermaker=It's raining and chilly.
&AUTUMNSTORMY Keran's Weathermaker=It's raining hard and the winds are strong.
&WINTERLIGHTSNOW Keran's Weathermaker=It's snowing.
&WINTERSLEET Keran's Weathermaker=It's sleeting.
&WINTERBLIZZARD Keran's Weathermaker=It's snowing heavily.
&WINTERFOG Keran's Weathermaker=It's foggy and cold.
&AUTUMNFOG Keran's Weathermaker=It's foggy and cool.
&SUMMERFOG Keran's Weathermaker=It's foggy and warm.
&SPRINGFOG Keran's Weathermaker=It's foggy and cool.
&SPRINGTYPE-CLEAR Keran's Weathermaker=[u(#338/randword,clear clear clear clear clear fair fair fair fair fair fair fair fair fair rain fog stormy overcast)]
&SUMMERTYPE-CLEAR Keran's Weathermaker=[u(#338/randword,clear clear clear clear fair fair fair fair fair fair fair fair fair fair rain fog fog stormy overcast)]
&AUTUMNTYPE-CLEAR Keran's Weathermaker=[u(#338/randword,clear clear clear clear clear fair fair fair fair fair fair fair fair fair rain fog stormy overcast)]
&WINTERTYPE-CLEAR Keran's Weathermaker=[u(#338/randword,clear clear clear clear fair fair fair fair fair fair fair fair fair fair clear fog lightsnow sleet blizzard overcast)]
&SPRINGTYPE-FAIR Keran's Weathermaker=[u(#338/randword,clear fair fair fair fair fair fair fair fair fair fair fair fair fair fair fair rain rain rain rain fog fog fog stormy overcast overcast overcast)]
&SUMMERTYPE-FAIR Keran's Weathermaker=[u(#338/randword,clear fair fair fair fair fair fair fair fair fair fair fair fair rain rain rain fog fog fog fog fog fog stormy overcast overcast overcast)]
&AUTUMNTYPE-FAIR Keran's Weathermaker=[u(#338/randword,clear fair fair fair fair fair fair fair fair fair fair fair fair fair fair fair rain rain rain rain fog fog fog stormy overcast overcast overcast overcast)]
&WINTERTYPE-FAIR Keran's Weathermaker=[u(#338/randword,clear fair fair fair fair fair fair fair fair fair fair fair fair fair fair fair clear clear clear clear fog lightsnow lightsnow blizzard lightsnow lightsnow lightsnow sleet overcast overcast overcast)]
&SPRINGTYPE-OVERCAST Keran's Weathermaker=[u(#338/randword,clear fair fair fair fair fair fair fair fair fair fair rain rain rain rain rain rain rain fog fog fog fog fog fog fog stormy overcast overcast overcast overcast)]
&SUMMERTYPE-OVERCAST Keran's Weathermaker=[u(#338/randword,clear fair fair fair fair fair fair fair fair rain rain rain rain rain fog fog fog fog fog fog fog fog fog fog fog fog stormy overcast overcast overcast overcast)]
&AUTUMNTYPE-OVERCAST Keran's Weathermaker=[u(#338/randword,clear fair fair fair fair fair fair fair fair fair fair rain rain rain rain rain rain rain fog fog fog fog fog fog fog stormy overcast overcast overcast overcast)]
&WINTERTYPE-OVERCAST Keran's Weathermaker=[u(#338/randword,clear fair fair fair fair fair fair fair fair fair fair sleet sleet sleet sleet sleet sleet sleet fog fog lightsnow lightsnow lightsnow lightsnow lightsnow blizzard overcast overcast overcast overcast)]
&SPRINGTYPE-RAIN Keran's Weathermaker=[u(#338/randword,clear clear clear clear clear fair fair fair fair fair fair fair fair fair fair fair fair fair fair fair rain rain rain rain fog fog fog fog stormy overcast overcast overcast)]
&SUMMERTYPE-RAIN Keran's Weathermaker=[u(#338/randword,clear clear clear clear clear fair fair fair fair fair fair fair fair fair fair fair fair fair fair fair rain rain rain fog fog fog fog fog fog fog fog fog stormy overcast overcast overcast overcast)]
&AUTUMNTYPE-RAIN Keran's Weathermaker=[u(#338/randword,clear clear clear clear clear fair fair fair fair fair fair fair fair fair fair fair fair fair fair rain rain rain rain fog fog fog fog stormy stormy overcast overcast overcast)]
&WINTERTYPE-SLEET Keran's Weathermaker=[u(#338/randword,clear clear clear clear clear fair fair fair fair fair fair fair fair fair fair fair fair fair fair sleet sleet sleet sleet lightsnow fog fog blizzard overcast overcast overcast)]
&WINTERTYPE-LIGHTSNOW Keran's Weathermaker=[u(#338/randword,clear clear clear clear clear fair fair fair fair fair fair fair fair fair fair fair fair fair fair sleet sleet sleet sleet lightsnow lightsnow lightsnow lightsnow fog blizzard blizzard overcast overcast overcast overcast)]
&SPRINGTYPE-FOG Keran's Weathermaker=[u(#338/randword,clear clear clear clear clear fair fair fair fair fair fair fair fair fair fair fair fair fair rain rain rain rain rain fog fog fog fog fog stormy overcast overcast overcast)]
&SUMMERTYPE-FOG Keran's Weathermaker=[u(#338/randword,clear clear clear clear clear fair fair fair fair fair fair fair fair fair fair fair fair fair rain rain rain rain rain fog fog fog fog fog fog fog fog fog fog stormy overcast overcast overcast)]
&AUTUMNTYPE-FOG Keran's Weathermaker=[u(#338/randword,clear clear clear clear clear fair fair fair fair fair fair fair fair fair fair fair fair fair rain rain rain rain rain fog fog fog fog fog stormy overcast overcast overcast)]
&WINTERTYPE-FOG Keran's Weathermaker=[u(#338/randword,clear clear clear clear clear fair fair fair fair fair fair fair fair fair fair fair fair fair fog lightsnow lightsnow sleet sleet sleet sleet blizzard overcast overcast)]
&SPRINGTYPE-STORMY Keran's Weathermaker=[u(#338/randword,clear clear clear clear clear clear clear fair fair fair fair rain fog stormy overcast)]
&SUMMERTYPE-STORMY Keran's Weathermaker=[u(#338/randword,clear clear clear clear clear clear clear clear clear clear clear fair fair fair fair rain fog fog fog stormy overcast)]
&AUTUMNTYPE-STORMY Keran's Weathermaker=[u(#338/randword,clear clear clear clear clear clear clear clear clear clear clear fair fair fair fair rain fog stormy overcast)]
&WINTERTYPE-STORMY Keran's Weathermaker=[u(#338/randword,clear clear clear clear clear clear clear clear clear clear clear clear fair fair fair fair sleet lightsnow fog blizzard overcast)]
&SPRINGTYPE-SLEET Keran's Weathermaker=[u(#338/randword,clear clear clear clear clear fair fair fair fair fair fair fair fair fair fair fair fair fair fair fair rain rain rain rain fog fog fog fog stormy overcast overcast overcast)]
&SPRINGTYPE-LIGHTSNOW Keran's Weathermaker=[u(#338/randword,clear clear clear clear clear fair fair fair fair fair fair fair fair fair fair fair fair fair fair fair rain rain rain rain fog fog fog fog stormy overcast overcast overcast)]
&WINTERTYPE-RAIN Keran's Weathermaker=[u(#338/randword,clear clear clear clear clear fair fair fair fair fair fair fair fair fair fair fair fair fair fair sleet sleet sleet sleet lightsnow fog fog blizzard overcast overcast overcast)]
&SPRINGSLEET Keran's Weathermaker=It's raining.
&SPRINGLIGHTSNOW Keran's Weathermaker=It's cloudy and cool.
&SPRINGBLIZZARD Keran's Weathermaker=It's raining hard and the winds are strong.
&SPRINGTYPE-BLIZZARD Keran's Weathermaker=[u(#338/randword,clear clear clear clear clear clear clear fair fair fair fair rain fog stormy overcast)]
&WINTERSTORMY Keran's Weathermaker=It's snowing heavily.
&WINTERRAIN Keran's Weathermaker=It's sleeting.
&TRIGGER-AT-DAWN Keran's Weathermaker=&weathertype-old me=[u(weathertype)]; &weathertype me=[u([u(#85/season)]type-[u(weathertype-old)])]; @notify #76
@Desc Keran's Weathermaker=The Weathermaker selects the weather for the day, triggered by the clock. It also writes the phase of the moon at sunset on the Timing Functions object for a routine that keeps the moon phase from changing while the moon is visible in the sky. If you have set up regional weather, it notifies the Slave Weather Station to select weather for the day. It belongs in the Auxiliary Room.
&VERSION Keran's Weathermaker=4.0
&AUTHOR Keran's Weathermaker=Keran@Keranset Island
&WINTERTYPE-BLIZZARD Keran's Weathermaker=[u(#338/randword,clear clear clear clear clear clear clear fair fair fair fair sleet fog blizzard lightsnow overcast)]
&WEATHERTYPE Keran's Weathermaker=overcast
&WEATHERTYPE-OLD Keran's Weathermaker=rain
@set Keran's Weathermaker=VISUAL
@set Keran's Weathermaker=SAFE


#77 - Keran's Wizard Weather and Time Commands

@lock Keran's Wizard Weather and Time Commands=#0
&IS-WIZARD Keran's Wizard Weather and Time Commands=[hasflag(%#, wizard)]
@lock/UseLock Keran's Wizard Weather and Time Commands=IS-WIZARD/1
&GREGORIAN Keran's Wizard Weather and Time Commands=$gregorian: &month #85 = \[u(gregorian-month)\]; &season #85 = \[u(gregorian-season)\]; &year #85 = \[u(gregorian-year)\]; &hour #85 = \[u(calculated-hour)\]; &halfhour #85 = \[u(calculated-halfhour)\]; &quarterhour #85 = \[u(calculated-quarterhour)\]; @switch u(#85/calendar-compression) = 4, &base-days-per-year #85=384, &base-days-per-year #85=360; @edit #50/today = +abeyance, +today; @edit #50/today-system = +today,+abeyance
&NATIVE Keran's Wizard Weather and Time Commands=$native: &month #85 = \[u(calendar-month)\]; &season #85 = \[u(native-season)\]; &year #85 = \[u(native-year)\]; &hour #85 = \[u(calculated-hour)\]; &halfhour #85 = \[u(calculated-halfhour)\]; &quarterhour #85 = \[u(calculated-quarterhour)\]; @switch u(#85/calendar-compression) = 4, &base-days-per-year #85=384, &base-days-per-year #85=360; @edit #50/today = +abeyance,+today; @edit #50/today-system = +today,+abeyance
&CLOCK Keran's Wizard Weather and Time Commands=$clock *: &calendar-compression #85 = 1; &base-days-per-year #85 = 360; &clock-compression #85 = %0
&CALENDAR1 Keran's Wizard Weather and Time Commands=$calendar 1: &clock-compression #85 = 1; &base-days-per-year #85 = 360; &calendar-compression #85 = 1
&CALENDAR2 Keran's Wizard Weather and Time Commands=$calendar 2: &clock-compression #85 = 1; &base-days-per-year #85 = 360; &calendar-compression #85 = 2
&CALENDAR3 Keran's Wizard Weather and Time Commands=$calendar 3: &clock-compression #85 = 1; &base-days-per-year #85 = 360; &calendar-compression #85 = 3
&CALENDAR4 Keran's Wizard Weather and Time Commands=$calendar 4: &clock-compression #85 = 1; &base-days-per-year #85 = 384; &calendar-compression #85 = 4
&START-TIME Keran's Wizard Weather and Time Commands=$start time *: &time-begins #85 = [convtime(%0)]; &weathertype #78=fair; &weathertype-old #78=fair; &weathertype-master #76=fair; &slave-weathertype-old #76=fair; &slave-weathertype=fair
&STARTING-YEAR Keran's Wizard Weather and Time Commands=$starting year *: &starting-year #85 = %0
&REMOVE-REGIONAL-WEATHER Keran's Wizard Weather and Time Commands=$no regional: &trigger-at-dawn #78={&weathertype-old me=\[u(weathertype)\]; &weathertype me=\[u(\[u(#85/season)\]type-\[u(weathertype-old)\])\]}
&ADD-REGIONAL-WEATHER Keran's Wizard Weather and Time Commands=$regional: &trigger-at-dawn #78={&weathertype-old me=\[u(weathertype)\]; &weathertype me=\[u(\[u(#85/season)\]type-\[u(weathertype-old)\])\]; @notify #76}
@Desc Keran's Wizard Weather and Time Commands=This object has commands for making the most common configuration changes on it. It writes to the Time Functions Object and the Weathermaker. It has no globals and should be kept in the Auxiliary room.
&VERSION Keran's Wizard Weather and Time Commands=4.0
&AUTHOR Keran's Wizard Weather and Time Commands=Keran@Keranset Island
&LONGEST-DAY Keran's Wizard Weather and Time Commands=$longest day *: &solstice-day-length #85=%0
&AXIAL-TILT Keran's Wizard Weather and Time Commands=[mul(fdiv(23.5, 360), pi(), 2)]
&DAY-LENGTH-BY-LATITUDE Keran's Wizard Weather and Time Commands=$latitude *: &solstice-day-length #85 = [round(mul(24, sub(1, [fdiv(mul(fdiv([atan(mul([fdiv(1, sin(u(#77/axial-tilt)))], [sqrt([sub([power(fdiv([cos(u(#77/axial-tilt))], [sin(mul(fdiv(%0, 360), pi(), 2))]), 2)], 1)])]))], mul(pi(), 2)), 360), 180)])), 2)]
&SYSTEM Keran's Wizard Weather and Time Commands=$system: &month #85 = \[u(system-month)\]; &season #85 = \[u(system-season)\]; &year #85 = \[u(system-year)\]; &hour #85 = \[u(system-hour)\]; &halfhour #85 = \[u(system-halfhour)\]; &quarterhour #85 = \[u(system-quarterhour)\]; &clock-compression #85 = 1; &base-days-per-year #85 = 365; &calendar-compression #85 = 1; @edit #50/today = +today,+abeyance; @edit #50/today-system = +abeyance,+today
&SEMI-TIDE Keran's Wizard Weather and Time Commands=$semidiurnal tide: &tide #340 = \[u(semi-tide)\]
&DI-TIDE Keran's Wizard Weather and Time Commands=$diurnal tide: &tide #340 = \[u(di-tide)\]
@set Keran's Wizard Weather and Time Commands=INHERIT
@set Keran's Wizard Weather and Time Commands=VISUAL
@set Keran's Wizard Weather and Time Commands=SAFE
@set Keran's Wizard Weather and Time Commands=COMMANDS


#76 - Keran's Slave Weather Station

@lock Keran's Slave Weather Station=#0
&SPRINGTYPE-CLEAR Keran's Slave Weather Station=[u(#338/randword,[u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] clear fair overcast rain fog stormy)]
&SUMMERTYPE-CLEAR Keran's Slave Weather Station=[u(#338/randword,[u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] clear fair overcast rain fog stormy)]
&AUTUMNTYPE-CLEAR Keran's Slave Weather Station=[u(#338/randword,[u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] clear fair overcast rain fog stormy)]
&WINTERTYPE-CLEAR Keran's Slave Weather Station=[u(#338/randword,[u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] clear fair overcast sleet lightsnow fog blizzard)]
&SPRINGTYPE-FAIR Keran's Slave Weather Station=[u(#338/randword,[u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] clear fair overcast rain fog stormy)]
&SUMMERTYPE-FAIR Keran's Slave Weather Station=[u(#338/randword,[u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] clear fair overcast rain fog stormy)]
&AUTUMNTYPE-FAIR Keran's Slave Weather Station=[u(#338/randword,[u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] clear fair overcast rain fog stormy)]
&WINTERTYPE-FAIR Keran's Slave Weather Station=[u(#338/randword,[u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] clear fair overcast sleet lightsnow fog blizzard)]
&SPRINGTYPE-OVERCAST Keran's Slave Weather Station=[u(#338/randword,[u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] clear fair overcast rain fog stormy)]
&SUMMERTYPE-OVERCAST Keran's Slave Weather Station=[u(#338/randword,[u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] clear fair overcast rain fog stormy)]
&AUTUMNTYPE-OVERCAST Keran's Slave Weather Station=[u(#338/randword,[u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] clear fair overcast rain fog stormy)]
&WINTERTYPE-OVERCAST Keran's Slave Weather Station=[u(#338/randword,[u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] clear fair overcast sleet lightsnow fog blizzard)]
&SPRINGTYPE-RAIN Keran's Slave Weather Station=[u(#338/randword,[u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] clear fair overcast rain fog stormy)]
&SUMMERTYPE-RAIN Keran's Slave Weather Station=[u(#338/randword,[u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] clear fair overcast rain fog stormy)]
&AUTUMNTYPE-RAIN Keran's Slave Weather Station=[u(#338/randword,[u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] clear fair overcast rain fog stormy)]
&WINTERTYPE-SLEET Keran's Slave Weather Station=[u(#338/randword,[u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] clear fair overcast sleet lightsnow fog blizzard)]
&WINTERTYPE-LIGHTSNOW Keran's Slave Weather Station=[u(#338/randword,[u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] clear fair overcast sleet lightsnow fog blizzard)]
&SPRINGTYPE-FOG Keran's Slave Weather Station=[u(#338/randword,[u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] clear fair overcast rain fog stormy)]
&SUMMERTYPE-FOG Keran's Slave Weather Station=[u(#338/randword,[u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] clear fair overcast rain fog stormy)]
&AUTUMNTYPE-FOG Keran's Slave Weather Station=[u(#338/randword,[u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] clear fair overcast rain fog stormy)]
&WINTERTYPE-FOG Keran's Slave Weather Station=[u(#338/randword,[u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] clear fair overcast sleet lightsnow fog blizzard)]
&SPRINGTYPE-STORMY Keran's Slave Weather Station=[u(#338/randword,[u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] clear fair overcast rain fog stormy)]
&SUMMERTYPE-STORMY Keran's Slave Weather Station=[u(#338/randword,[u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] clear fair overcast rain fog stormy)]
&AUTUMNTYPE-STORMY Keran's Slave Weather Station=[u(#338/randword,[u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] clear fair overcast rain fog stormy)]
&WINTERTYPE-STORMY Keran's Slave Weather Station=[u(#338/randword,[u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] clear fair overcast sleet lightsnow fog blizzard)]
&SPRINGTYPE-SLEET Keran's Slave Weather Station=[u(#338/randword,[u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] clear fair overcast rain fog stormy)]
&SPRINGTYPE-LIGHTSNOW Keran's Slave Weather Station=[u(#338/randword,[u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] clear fair overcast rain fog stormy)]
&WINTERTYPE-RAIN Keran's Slave Weather Station=[u(#338/randword,[u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] [u(weathertype-master)] clear fair overcast sleet lightsnow fog blizzard)]
&GENERATOR Keran's Slave Weather Station=@wait me={&slave-weathertype-old me = [u(slave-weathertype)]; &weathertype-master me = [u(#78/weathertype-old)]; &slave-weathertype me = [u([u(#85/season)]type-[u(weathertype-master)])]; @trigger me/generator}
@Startup Keran's Slave Weather Station=@drain me; @trigger me/generator
&WEATHERTYPE-MASTER Keran's Slave Weather Station=rain
&WEATHERTYPE Keran's Slave Weather Station=overcast
&WEATHERTYPE-OLD Keran's Slave Weather Station=overcast
@Desc Keran's Slave Weather Station=This Slave Weather Station is an optional part of the weather code. It is only useful if you want to run regional weather (+topic regional for help). It is notified by the Weathermaker to select its own weather for the day. It has no commands and should be kept in the Auxiliary room or a regional auxiliary room. Set it visual and safe.
&VERSION Keran's Slave Weather Station=4.0
&AUTHOR Keran's Slave Weather Station=Keran@Keranset Island
&SLAVE-WEATHERTYPE Keran's Slave Weather Station=rain
&SLAVE-WEATHERTYPE-OLD Keran's Slave Weather Station=fair
@set Keran's Slave Weather Station=VISUAL
@set Keran's Slave Weather Station=SAFE


#75 - Keran's Clock

@lock Keran's Clock=#0
&ISWIZARD Keran's Clock=[hasflag(%#, wizard)]
@lock/UseLock Keran's Clock=ISWIZARD/1
@Startup Keran's Clock=@trigger me/loop
&LOOP Keran's Clock=@trigger me/routine-time-of-day; @trigger me/routine-hour; @trigger me/routine-halfhour; @trigger me/routine-quarterhour; @trigger me/routine-tide; @trigger me/routine-moon; @trigger me/routine-sun; @wait 60 = @trigger me/loop
&DAY-NIGHT-DAWN-DUSK Keran's Clock=night
&LAST-DAY-NIGHT-DAWN-DUSK Keran's Clock=night
&ROUTINE-TIME-OF-DAY Keran's Clock=&last-time-of-day me = [u(time-of-day)]; &time-of-day me = [u(#85/time-of-day)]; @switch [comp(u(last-time-of-day), u(time-of-day))] = 0, @@, @dolist [v(triggerlist-time~of~day)] = @trigger ##/trigger-at-[u(#338/blank2tilde, u(#85/time-of-day))]
&ROUTINE-HOUR Keran's Clock=&last-hour me = [u(hour)]; &hour me = [u(#85/hour)]; @switch [comp(u(hour), u(last-hour))] = 0, @@, {@dolist [v(triggerlist-hour)] = @trigger ##/trigger-at-[u(#85/hour)]; @dolist [v(triggerlist-every~hour)] = @trigger ##/trigger-at-every~hour}
&ROUTINE-TIDE Keran's Clock=&last-tide me = [u(tide)]; &tide me = [u(#340/tide)]; @switch [comp(u(tide), u(last-tide))] = 0, @@, @dolist [v(triggerlist-tide)] = @trigger ##/trigger-at-[u(#338/blank2tilde, u(#340/tide))]
&ROUTINE-MOON Keran's Clock=&last-moon-up me = [u(moon-up)]; &moon-up me = [u(#340/moon-up)]; @switch [comp(u(moon-up), u(last-moon-up))] = 0, @@, 1, @dolist [v(triggerlist-moon)] = @trigger ##/trigger-at-moonrise, -1, @dolist [v(triggerlist-moon)] = @trigger ##/trigger-at-moonset; &last-meridian-transit me = [u(meridian-transit)]; &meridian-transit me = [gt(secs(), u(#340/meridian-transit))]; @switch [comp(u(meridian-transit), u(last-meridian-transit))] = 0, @@, 1, @dolist [v(triggerlist-moon)] = @trigger ##/trigger-at-meridian~transit
&ROUTINE-SUN Keran's Clock=&last-day-night me = [u(day-night)]; &day-night me = [u(#85/day-night)]; @switch [comp(u(day-night), u(last-day-night))] = 0, @@, -1, @dolist [v(triggerlist-sun)] = @trigger ##/trigger-at-sunrise, 1, @dolist [v(triggerlist-sun)] = @trigger ##/trigger-at-sunset
&HOUR Keran's Clock=17
&LAST-HOUR Keran's Clock=17
&ADD-TO-TRIGGERLIST Keran's Clock=$add * *: &triggerlist-%1 me = [setunion(%0, v(triggerlist-%1))]
&DELETE-FROM-TRIGGERLIST Keran's Clock=$del * *: &triggerlist-%1 me = [setdiff(v(triggerlist-%1), %0)]
@Desc Keran's Clock=The Clock runs a continual loop in which it checks the time of day and then @triggers various objects based on the time of day. It must trigger the Weathermaker, and the Time of Day Emits Bank if you want to use emits. You can add other objects to the list of objects it will @trigger. It has commands on it and should be kept in the Auxiliary room. It should be owned by a wizard and flagged inherit, commands, and safe.
&TRIGGERLIST-TIME~OF~DAY Keran's Clock=#78 #51 #373
&VERSION Keran's Clock=4.0
&AUTHOR Keran's Clock=Keran@Keranset Island
&TRIGGERLIST-SUN Keran's Clock=#51 #373
&TRIGGERLIST-MOON Keran's Clock=#51 #373
&TRIGGERLIST-TIDE Keran's Clock=#51 #373
&TIME-OF-DAY Keran's Clock=dusk
&DAY-NIGHT Keran's Clock=day
&LAST-TIME-OF-DAY Keran's Clock=dusk
&LAST-DAY-NIGHT Keran's Clock=day
&MOON-UP Keran's Clock=0
&LAST-MOON-UP Keran's Clock=0
&MERIDIAN-TRANSIT Keran's Clock=1
&LAST-MERIDIAN-TRANSIT Keran's Clock=1
&ROUTINE-HALFHOUR Keran's Clock=&last-halfhour me = [u(halfhour)]; &halfhour me = [u(#85/halfhour)]; @switch [comp(u(halfhour), u(last-halfhour))] = 0, @@, @dolist [v(triggerlist-every~halfhour)] = @trigger ##/trigger-at-every~halfhour
&ROUTINE-QUARTERHOUR Keran's Clock=&last-quarterhour me = [u(quarterhour)]; &quarterhour me = [u(#85/quarterhour)]; @switch [comp(u(quarterhour), u(last-quarterhour))] = 0, @@, @dolist [v(triggerlist-every~quarterhour)] = @trigger ##/trigger-at-every~quarterhour
&HALFHOUR Keran's Clock=35
&LAST-HALFHOUR Keran's Clock=35
&QUARTERHOUR Keran's Clock=71
&LAST-QUARTERHOUR Keran's Clock=71
&TRIGGERLIST-HOUR Keran's Clock=#51 #373
&TIDE Keran's Clock=low and slack
&LAST-TIDE Keran's Clock=low and slack
&TRIGGERLIST-EVERY~HALFHOUR Keran's Clock=#373
&TRIGGERLIST-EVERY~QUARTERHOUR Keran's Clock=#373
&TRIGGERLIST-EVERY~HOUR Keran's Clock=#373
@set Keran's Clock=INHERIT
@set Keran's Clock=VISUAL
@set Keran's Clock=SAFE
@set Keran's Clock=COMMANDS


#51 - Keran's Emits Bank

@lock Keran's Emits Bank=#0
&TRIGGER-AT-DAWN Keran's Emits Bank=@dolist search(eroom=not(comp(u(##/hear-weather-emits), 1))) = @pemit/contents ## = [switch(u(#78/weathertype), clear, The stars in the east begin to look washed out as the sapphire night sky pales., fair, A faint sheen touches the clouds in the sapphire night sky to the east., fog, The eastern mist pales almost imperceptibly., lightsnow, {The dark grey sky in the east pales as damp, cold dawn approaches.}, blizzard, {Faintly, a grey pallor illuminates the thick snowfall.}, sleet, A faint gleam touches the eastern sky through the sleet and the cold wind., rain, {Through the veils of rain, the clouds to the east pale.}, stormy, The stormy sky lightens faintly to the east., overcast, Faint grey light seeps through a leaden layer of clouds toward the east.)]
&TRIGGER-AT-SUNRISE Keran's Emits Bank=@dolist search(eroom=not(comp(u(##/hear-weather-emits), 1))) = @pemit/contents ## = [switch(u(#78/weathertype), clear, Pink-gold light gilds the land as the sun creeps over the eastern horizon into a cloudless blue sky., fair, {The sun rises, painting the eastern clouds with a pink and pale gold glow.}, rain, Rain falls in the dawn's light., overcast, A grey dawn breaks., fog, Everything is half-concealed by fog in the grey half-light., stormy, Rain falls in wind-lashed sheets at dawn., lightsnow, {Through the snow flurries, the translucent grey sky brightens to the east.}, sleet, Freezing rain falls in the grey light of dawn., blizzard, Snow cascades from the sky in the half-light of dawn.)]
&TRIGGER-AT-DUSK Keran's Emits Bank=@dolist search(eroom=not(comp(u(##/hear-weather-emits), 1))) = @pemit/contents ## = [switch(u(#78/weathertype), clear, Shadows lengthen and the light turns golden as the sun sinks toward the west through a clear sky., fair, {Purple, gold, and vermillion clouds grace the western sky as the sun descends toward the west.}, overcast, The soft light dims at dusk., rain, A rainy late afternoon gives way to evening., fog, The misty light dims slightly., stormy, {The clouds darken further, rain drenching the landscape as evening approaches.}, lightsnow, {Through the drifting snowflakes, the translucent pale grey of the sky deepens.}, sleet, Sleet coats the ground with ice as evening draws near., blizzard, The whiteness of the whirling snow fades to blanched grey.)]
&TRIGGER-AT-SUNSET Keran's Emits Bank=@dolist search(eroom=not(comp(u(##/hear-weather-emits), 1))) = @pemit/contents ## = [switch(u(#78/weathertype), clear, The evening stars come out as the red-orange sun sinks below the horizon., fair, {The orange-red sun sinks below the western horizon, leaving a darkening tapestry of purple and red-gold clouds behind it.}, overcast, {A featureless blanket of grey cloud covers the evening sky.}, fog, Twilight deepens the grey of the fog., rain, The shower soaks the earth as twilight deepens., stormy, {The last light in the west begins to fail, heralding a stormy night.}, lightsnow, Snow flurries fall from a darkening grey sky., sleet, {In the deepening twilight, the freezing rain makes the footing treacherous.}, blizzard, Blinding snow spills from the sky as the twilight deepens.)]
&TRIGGER-AT-NIGHT Keran's Emits Bank=@dolist search(eroom=not(comp(u(##/hear-weather-emits), 1))) = @pemit/contents ## = [switch(u(#78/weathertype), clear, The stars glitter like diamonds in the deep sapphire blue of the night sky., fair, {Brindled clouds conceal a few patches of starlit sky.}, overcast, {The night is moonless and starless.}, fog, {Fog and darkness shroud the world.}, rain, Raindrops sprinkle down from a night sky obscured by dark grey clouds., stormy, Wailing wind blows rain through the darkness., blizzard, Snow swirls about you in gusts as night falls., sleet, {As night falls, the icy rain is whipped about by the wind.}, lightsnow, {The night is raw. Snow flurries drift down from the overcast sky.})]
@Desc Keran's Emits Bank=This is an emitter bank containing messages that are broadcast to outdoor rooms at first light, sunrise, sunset, moonrise, moonset, nightfall, etc. The messages vary with the weathertype. It is triggered by the Clock. It belongs in the Auxiliary room and has no commands on it.
&TRIGGER-AT-MORNING Keran's Emits Bank=@dolist search(eroom=not(comp(u(##/hear-weather-emits), 1))) = @pemit/contents ## = [switch(u(#78/weathertype), clear, The sun climbs into a brilliant blue sky., fair, The sun ascends in a bright blue sky filled with fluffy fair weather clouds and a few wisps of cirrus., overcast, The light from the overcast sky is diffuse and nothing casts a shadow., rain, It's a wan grey morning. Rain patters to earth., stormy, {Furious winds drive rain into the ground at angle. The morning sky is slate grey.}, sleet, Icing rain plates the world with silver in the cold light of morning., lightsnow, {The pallid gleam of the sun rises behind a veil of pearlescent grey, from which snow flurries drift. The air is chilly and damp.}, blizzard, {Heavy, wet snow falls throughout the morning.}, fog, Pale grey mists half-hide the world around you.)]
&TRIGGER-AT-12 Keran's Emits Bank=@dolist search(eroom=not(comp(u(##/hear-weather-emits), 1))) = @pemit/contents ## = [switch(u(#78/weathertype), clear, The sun blazes overhead in the clear blue sky., fair, {The sun shines overhead, bracketed by puffy fair weather clouds.}, overcast, A thick layer of stratus clouds cloaks the sky at mid-day., fog, The fog is grey-white in the light of mid-day., rain, Droplets splash in puddles at mid-day., stormy, {Torrential rains fall at mid-day, driven by raging winds.}, sleet, Freezing rain pours from the sky at mid-day., lightsnow, Light snow wafts gently down from the pale grey mid-day sky., blizzard, The world is lost in whiteness as snow blows about you at mid-day.)]
&TRIGGER-AT-0 Keran's Emits Bank=@dolist search(eroom=not(comp(u(##/hear-weather-emits), 1))) = @pemit/contents ## = [switch(u(#78/weathertype), clear, Stars glitter brilliantly in the deep blue of the midnight sky., fair, {Stars sparkle in the midnight sky, obscured here and there by clouds.}, overcast, Charcoal clouds fill the midnight sky., fog, It's hard to see through the midnight darkness and the fog., rain, {Rain falls at midnight, unseen in the darkness.}, stormy, The ferocity of the gale is unabated at midnight., lightsnow, {Powdery snow drifts down from the grey-black midnight sky, felt rather than seen in the darkness.}, sleet, Sleet spatters from the midnight sky., blizzard, The blizzard and the darkness of midnight hide everything.)]
&TRIGGER-AT-MOONRISE Keran's Emits Bank=@switch u(#340/moon-phase) = new, @@, {@switch u(#85/day-night) = night, {@dolist search(eroom=not(comp(u(##/hear-weather-emits), 1))) = @pemit/contents ## = [switch(u(#78/weathertype), clear, {The [u(#340/moon-phase)] moon rises into the sapphire blue of the night sky, dimming the light of the twinkling stars.}, fair, {Framed by a rack of clouds, the [u(#340/moon-phase)] moon rises into the deep blue of the starlit sky.},,)]}}
&TRIGGER-AT-MOONSET Keran's Emits Bank=@switch u(#340/moon-phase) = new, @@, {@switch u(#85/day-night) = night, {@dolist search(eroom=not(comp(u(##/hear-weather-emits), 1))) = @pemit/contents ## = [switch(u(#78/weathertype), clear, {The [u(#340/moon-phase)] moon sets, leaving the stars to spangle the crystalline night sky.}, fair, {The [u(#340/moon-phase)] moon, tracing a nearby wisp of cloud in silver, sinks below the western horizon. The stars sparkle in the ultramarine sky, distant and serene.},,)]}}
&TRIGGER-AT-AFTER~MIDNIGHT Keran's Emits Bank=@emit It's after midnight.
&TRIGGER-AT-AFTERNOON Keran's Emits Bank=@emit It's afternoon.
&TRIGGER-AT-NOON Keran's Emits Bank=@emit It's noon.
&TRIGGER-AT-MIDNIGHT Keran's Emits Bank=@emit It's midnight.
&VERSION Keran's Emits Bank=4.0
&AUTHOR Keran's Emits Bank=Keran@Keranset Island
&TRIGGER-AT-HIGH~AND~SLACK Keran's Emits Bank=@dolist search(eroom=not(comp(u(##/hear-tide-emits), 1))) = @pemit/contents ## = The tide is high and slack.
&TRIGGER-AT-LOW~AND~SLACK Keran's Emits Bank=@dolist search(eroom=not(comp(u(##/hear-tide-emits), 1))) = @pemit/contents ## = The tide is low and slack.
&TRIGGER-AT-LOW~AND~EBBING Keran's Emits Bank=@dolist search(eroom=not(comp(u(##/hear-tide-emits), 1))) = @pemit/contents ## = The tide is low and ebbing.
&TRIGGER-AT-LOW~AND~RISING Keran's Emits Bank=@dolist search(eroom=not(comp(u(##/hear-tide-emits), 1))) = @pemit/contents ## = The tide is low and rising.
&TRIGGER-AT-HIGH~AND~RISING Keran's Emits Bank=@dolist search(eroom=not(comp(u(##/hear-tide-emits), 1))) = @pemit/contents ## = The tide is high and rising.
&TRIGGER-AT-HIGH~AND~EBBING Keran's Emits Bank=@dolist search(eroom=not(comp(u(##/hear-tide-emits), 1))) = @pemit/contents ## = The tide is high and ebbing.
&TRIGGER-AT-MERIDIAN~TRANSIT Keran's Emits Bank=@switch u(#340/moon-phase) = new, @@, {@switch u(#85/day-night) = night, {@dolist search(eroom=not(comp(u(##/hear-weather-emits), 1))) = @pemit/contents ## = [switch(u(#78/weathertype), clear, {The [u(#340/moon-phase)] moon reaches its zenith, [u(#340/moon-adjective)]ly illuminating all below.}, fair, {The [u(#340/moon-phase)] moon gleams overhead, its light turning the clouds to tarnished silver.},,)]}}
@set Keran's Emits Bank=INHERIT
@set Keran's Emits Bank=VISUAL
@set Keran's Emits Bank=SAFE


#50 - Keran's Global Command Object

@lock Keran's Global Command Object=#0
@Desc Keran's Global Command Object=This object is part of Keran's Weather and Time Code Package, and has global commands on it. It belongs in the Master Room and should be set inherit and commands.
&AUTHOR Keran's Global Command Object=Keran@Keranset Island
&VERSION Keran's Global Command Object=4.0
&TODAY-SYSTEM Keran's Global Command Object=$+abeyance: @pemit %#=It's [squish([mid(time(), 0, 20)] [u(#85/year)])]. The [u(#340/moon-phase)] moon [switch(u(#340/moon-up), 1, is up., 0, isn't up.)] The tide is [u(#340/tide)].%r[u(#338/long-weather)]
&PARENTS Keran's Global Command Object=$+parents: @pemit %# = Available parent rooms are:%r [iter(iter(children(#370), children(##)), ## [name(##)]%r)]
&WT Keran's Global Command Object=$+wt *: @pemit %# = [u(#71/help_%0)]
&WT-LIST Keran's Global Command Object=$+wt: @pemit %# = [u(#71/list)]
&WTA Keran's Global Command Object=$+wta *: @pemit %# = [u(#80/%0)]
&WTC Keran's Global Command Object=$+wtc *: @pemit %# = [u(#79/%0)]
&WTC-LIST Keran's Global Command Object=$+wtc: @pemit %# = [u(#79/topic-list)]
&WTA-LIST Keran's Global Command Object=$+wta: @pemit %# = [u(#80/topic-list)]
&TODAY Keran's Global Command Object=$+today: @pemit %#=It's hour [u(#85/hour)] in the day, in week [u(#85/week)] of [u(#338/tilde2blank, u(#85/month))], in the year [u(#85/year)]. The [u(#340/moon-phase)] moon [switch(u(#340/moon-up), 1, is up., 0, isn't up.)] The tide is [u(#340/tide)].%r[u(#338/long-weather)]
@set Keran's Global Command Object=INHERIT
@set Keran's Global Command Object=VISUAL
@set Keran's Global Command Object=SAFE
@set Keran's Global Command Object=COMMANDS


#80 - Keran's Weather and Time Help - Admin Commands

&CLOCK-COMMANDS Keran's Weather and Time Help - Admin Commands=%radd <dbref> <triggerlist>%rdel <dbref> <triggerlist>%r%rThese are the commands on the Clock allowing you to add or delete items from the Clock's triggerlists, so that the Clock can trigger commands on them at appropriate times. You must be where the Clock can hear you in order to use them. <dbref> is the number of the item to be added to the Clock's triggerlists, and <triggerlist> is which triggerlist to use. The triggerlist must be time~of~day, sun, moon, tide, hour, every~hour, every~halfhour, or every~quarterhour. An item to be triggered must have an attribute &trigger-at-<time> = <action to be triggered>, where <time> is dawn, sunrise, morning, noon, afternoon, dusk, sunset, night, midnight, after~midnight, moonrise, moonset, meridian~transit, every~hour, every~halfhour, every~quarterhour, 0 through 23, high~and~rising, high~and~slack, high~and~ebbing, low~and~ebbing, low~and~slack, low~and~rising. Use &trigger-at-0 and &trigger-at-12 for triggering at precisely midnight and noon; the times of day called noon and midnight are time stretches.%r%rThe Clock triggers the Weathermaker at dawn and the Emits Bank at various times of day and hours, by default.%r
&CALENDARS Keran's Weather and Time Help - Admin Commands=%rgregorian%rnative%rsystem%r%rThese commands, on the Wizard Weather and Time Command object, change the calendar to the named calendar mode. You must be where the Wiz Weather Command object can hear you to execute it. See +wtc calendars for an explanation of the calendar options.%r
&CLOCK-COMPRESSION Keran's Weather and Time Help - Admin Commands=%rclock <number>%r%rThis command sets the compression mode to clock and the clock compression ratio to <number>, where <number> is a small whole number, or a decimal ratio of small whole numbers by which 3600 can be evenly divided, e.g, 1.5 (3:2). (Other ratios might work, but Keran hasn't tested them.) You must be where the Wizard Weather and Time Command object can hear you to execute it. See +wtc compression, +wtc clock-compression.%r
&CALENDAR-COMPRESSION Keran's Weather and Time Help - Admin Commands=%rcalendar <number>%r%rThis command sets the compression mode to calendar and the calendar compression to <number>, where <number> is 1, 2, 3, or 4. You must be where the Wizard Weather and Time Command object can hear you to execute it. See +wtc compression, +wtc calendar-compression.%r
&START-TIME Keran's Weather and Time Help - Admin Commands=%rstart time <time>%r%rThis command on the Wizard Weather and Time Command object sets the real time from which the Weather and Time Code should begin its reckoning. The format for <time> is the same returned by time(); you don't have to correctly specify the weekday. Any three letters will do. The Wiz Weather Command object must be able to hear you for it to work.%r%rThis command also resets &weathertype and &weathertype-old on the Weathermaker, and &weathertype-master, &slave-weathertype-old, and &slave-weathertype on the Slave Weather Station, because if the new start time changes the season, it is possible that the current weathertypes may be inappropriate.%r
&STARTING-YEAR Keran's Weather and Time Help - Admin Commands=%rstarting year <year>%r%rThis command on the Wizard Weather and Time Command object sets the virtual starting year. <year> must be an integer. You must be where the Wiz Weather Command Object can hear you for it to work.%r
&REGIONAL Keran's Weather and Time Help - Admin Commands=%rregional%rno regional%r%rThese commands on the Wizard Weather and Time Command object set up the Weathermaker to @notify the Slave Weather Station at dawn to select its own weather, or remove such notification. You must be where the Wiz Weather Command Object can hear you for them to work. Setting up regional weather can be quite involved; see +wtc regional-weather for a discussion thereof.%r
&LONGEST-DAY Keran's Weather and Time Help - Admin Commands=%rlongest day <hours>%r%rThis command on the Wizard Weather and Time Command object sets the length of the longest day, in hours; the day length varies with the season. <hours> can be any number from 12 to just under 24, but there are definitely things that will break as you approach 24 hours of daylight, if you're attempting midnight sun effects in a polar setting, and Keran hasn't identified all of them. You must be where the Wiz Weather Command Object can hear you for it to work.%r
&LATITUDE Keran's Weather and Time Help - Admin Commands=%rlatitude <degrees>%r%rThis command on the Wizard Weather and Time Command object sets the length of the longest day by calculating it from latitude; the day length varies with the season. <lattitude> can be any number greater than 0 and less than or equal to 66. If you have an equatorial setting, use the longest day command to set a day length of 12 hours, instead of giving this command a latitude of 0; a division-by-0 error will occur. Keran hasn't done testing to determine exactly how close you can get to the poles before the code starts doing jarring things; it is conceivable that latitude 66 may be too high. You must be where the Wiz Weather Command Object can hear you for this command to work.%r
&TIDE Keran's Weather and Time Help - Admin Commands=%rsemidiurnal tide%rdiurnal tide%r%rThis commands on the Wizard Weather and Time Command object set the tide to either diurnal or semidiurnal mode. Diurnal tides have one high tide and one low tide per day, and are characteristic of areas on very large ocean basins, like the Pacific; semidiurnal times have two high tides and two low tides per day, and are characteristic of smaller oceans like the Atlantic. The tide is semidiurnal by default. You must be where the Wiz Weather Command Object can hear you for these commands to work.%r
&TOPIC-LIST Keran's Weather and Time Help - Admin Commands=%rThese commands are to be found on the Wizard Weather and Time Command Object, the Clock, or the Stormmaker. You must be a wizard to execute some of them, and wizard or royalty to execute others. The items the commands are on must be able to hear you.%r%r[ljust(calendar-compression, 22)][ljust(calendars, 22)][ljust(clock-commands, 22)]%r[ljust(clock-compression, 22)][ljust(latitude, 22)][ljust(longest-day, 22)]%r[ljust(regional, 22)][ljust(starting-year, 22)][ljust(start-time, 22)]%r[ljust(stormmaker, 22)][ljust(tide, 22)]%r%r+wta <name> for +help.%r
&STORMMAKER Keran's Weather and Time Help - Admin Commands=%rweather <weathertype>%rslave <weathertype>%r%rThese commands are all on the Stormmaker. You have to be somewhere where it can hear you to run them.%r%rThe weather and slave commands allow you to change the weathertype on the Weather Maker or the Slave Weather Station to something appropriate to the sort of effects you want to produce. <Weathertype> should be clear, fair, overcast, fog, rain, stormy, sleet, lightnow, or blizzard, appropriate to the season.%r%r+wta stormmaker2 for more.%r
&STORMMAKER2 Keran's Weather and Time Help - Admin Commands=%reverywhere <string>%routside <string>%rwindow <string>%rinside <string>%rzone <dbref>=<string>%rsearch <attribute>=<string>%r%rThese commands send the strings supplied, capitalized, to the contents of all rooms that fall into the appropriate categories. Everywhere, window, outside, and inside will only work correctly if all of the rooms in your IC area are parented to an appropriate parent room (see +wtc parent-room-hierarchy). Zone will send the string to the contents of any room @chzoned to the dbref given. Search will send the string to the contents of any room that has the attribute specified.%r%rZone is meaningless and doesn't work on TinyMUSH 2.2.%r
@Desc Keran's Weather and Time Help - Admin Commands=This is +wta, the admin command +help for Keran's Weather and Time Code Package. It should be set visual and safe, and it belongs in the Auxiliary room. The items documented on this object are expected to be useful to admins.
@set Keran's Weather and Time Help - Admin Commands=VISUAL
@set Keran's Weather and Time Help - Admin Commands=SAFE


#79 - Keran's Weather and Time Help - Configuration Considerations

&TOPIC-LIST Keran's Weather and Time Help - Configuration Considerations=%r[ljust(*bugs, 22)][ljust(*calendars, 22)][ljust(*calendar-compression, 22)]%r[ljust(*clock-compression, 22)][ljust(*compression, 22)][ljust(*global-emits, 22)]%r[ljust(*global-setup, 22)][ljust(foreign-timing, 22)][ljust(moons, 22)]%r[ljust(next-version, 22)][ljust(*parameters, 22)][ljust(*parent-room-hierarchy, 22)]%r[ljust(regional-weather, 22)][ljust(varying-the-weather, 22)][ljust(weather-modelling, 22)]%r[ljust(TinyMUSH-3.0, 22)]%r%rItems marked with a * are important for normal operations.%r%r+wtc <name> for +help.%r
@Desc Keran's Weather and Time Help - Configuration Considerations=This object has +help for various topics related to setting up and configuring Keran's Weather and Time Code. It has no commands and should be kept in the Auxiliary room.
&BUGS Keran's Weather and Time Help - Configuration Considerations=%rThis code has been tested at calendar compression ratios of 1:1, 2:1, 3:1, and 4:1, and at clock compression ratios of 4:1, 3:1, 2:1, 1:1, and 3:2. It appears to work; however, the testing period has not been long enough to let it cycle through a whole year. It is supposed to work correctly and consistently at these ratios; if it doesn't, please tell Keran (keranset@mail1.nai.net).%r%rKeran posts bug fixes in a changes file at the distribution site, ftp://telmaron.telmaron.com/pub/keranset/.%r%rSome known aberrations:%r%rOccasionally, you'll see a message from the Emits bank doubled. This isn't a bug in the Weather and Time Code; it's an aberration in the behavior of the server, and shows up in other code with timed @triggers as well. It doesn't happen often; there's no softcode fix for it.%r%r+wtc bugs2 for more.%r
&BUGS2 Keran's Weather and Time Help - Configuration Considerations=%rRarely, you'll find that for some reason, the weathertypes will not be correctly written to the Weathermaker, which, naturally, breaks everything in the code that depends on the weathertype. This has happened about 3 times at Keranset over the past couple of years. To fix it, manually set weathertypes on the Weathermaker, like so:%r%r&weathertype weathermaker=fair%r&weathertype-old weathermaker=fair%r%rA mysterious and erratic failure to completely evaluate a function can be a sign that the function_invocation_limit for the server is set too low. If you can evaluate a function individually but it fails up as part of something else--a variable desc--this is probably the problem. Set the function_invocation_limit up until it stops happening.%r%rKeran's Weather and Time code, when correctly installed, doesn't write to anything in the database other than itself, when your server is operating normally, unlike some other public code releases.%r
&CALENDARS Keran's Weather and Time Help - Configuration Considerations=%rKeran's weather and timing code comes with three possibilities for calendars: native, Gregorian, and system. System is a true Gregorian calendar that runs off the system clock in 1:1 time compression; the date and time will always be identical to whatever your system clock returns, except that you can change the year. The other two calendars are quasi-Gregorian and the native format, both of which have 360 day years (usually) and 30 day months.%r%rIn the quasi-Gregorian calendar in which December, January, and February constitute winter; March, April, and May, spring; June, July, and August, summer; and September, October, and November, autumn. The dates of the solstices and equinoxes are not accurate in this mode; winter, and the winter solstice, fall on December 1, not December 21 as is the case in the real world.%r%rIn the native calendar, the year and the first month of spring both begin on the vernal equinox.%r%rSee +wta calendars for +help on switching between calendars.%r%rRecoder's notes: calculations are made using the native mode; then month, season, and year are recalculated to produce the quasi-Gregorian timing.%r
&CALENDAR-COMPRESSION Keran's Weather and Time Help - Configuration Considerations=%rIn calendar compression, an IC day passes in 24 real hours, and IC time is accelerated by skipping days in each month, season, and year. At 3:1 calendar compression, for example, an IC month passes in 10 24-hour days. The calendar compression ratio above must be a small positive integer; the code as supplied is designed to handle calendar compression rations of 1, 2, 3, and 4. See +wta calendar-compression for +help on the commands to set the calendar compression.%r%rRecoder's notes: since the code works by counting days, fractional ratios do not work. In order not to break the moon, which has 8 phases and needs at least 8 counted days per month to go through an entire phase cycle, the minimum value of base-days-per-year is 8 phases * 12 months * calendar-compression, and it must be evenly divisible by both 8 and 12. The default value for the base days per year is 360; all calendar compression ratios of 3:1 or lower, as well as typical clock compression ratios, work with this value. The Wizard Weather Command object automatically sets an appropriate value for the base days per year if you use it to reset the calendar compression to 1, 2, 3, or 4.%r
&CLOCK-COMPRESSION Keran's Weather and Time Help - Configuration Considerations=%rWhen IC time is accelerated using clock compression, an IC hour goes by in less than a real hour. The number of seconds in an IC hour is determined by dividing 3600 (the number of seconds in a real hour) by the clock compression ratio. The clock compression ratio is expected to be a small positive number by which 3600 can be evenly divided. It may have a fractional part; for example, you can evenly divide 3600 by 1.5 (a 3 IC hour: 2 real hour ratio). 4, 3, 2, 1, and 1.5 are all acceptable clock compression ratios.%r%rThe effect of using ratios with fractional parts, like 1.5 (3:2), 1.25 (5:4), or 2.5 (5:2), is that it will desynchronize IC time and real time; that is, if a player logs in at the same time of day all the time, it won't always be the same time of day ICly. This can be useful if you wish to accommodate players who log in from other time zones at odd hours.%r%rSee +wta clock-compression for +help on how to set the clock compression.%r
&COMPRESSION Keran's Weather and Time Help - Configuration Considerations=%rThere are two different ways to accelerate IC time in Keran's weather and timing code: clock compression and calendar compression. It is assumed that you will only use one of them at a time, although so far it's produced reasonable results if both the clock and the calendar are compressed; Keran's testing of this has not been rigourous. The code has been tested at clock compression ratios of 4:1, 3:1, 2:1, 3:2, and 1:1, and at calendar compression ratios of 4:1, 3:1, 2:1, and 1:1.%r%rIn clock compression, a day goes by faster than it does in real time. For example, if you have a clock compression ratio of 3:1, 24 IC hours will go by in 8 real hours. In calendar compression, on the other hand, a day goes by in 24 hours, but you skip days, so that months, seasons and years pass more quickly. For example, if you have a calendar compression ratio of 2:1, 12 IC months will pass in 6 real months. See +wtc clock-compression, +wtc calendar-compression.%r
&GLOBAL-SETUP Keran's Weather and Time Help - Configuration Considerations=%rYou should put these attributes on #1 to set up the required global +functions:%r%r&SETUP-GLOBAL-FUNCTIONS #1 = @function randword = <dbref of Miscellaneous Functions>/randword; @function tilde2blank = <dbref of Miscellaneous Functions>/tilde2blank; @function blank2tilde = <dbref of Miscellaneous Functions>/blank2tilde%r@startup #1 = @trigger me/setup-global-functions%r%rFor version 4.0 of the Weather and Time Code, you'll need to kick the function_invocation_limit on the server up to handle the recoded in variable descs in children of the parent rooms. Setting function_invocation_limit to 12500 seems to suffice.%r
&GLOBAL-EMITS Keran's Weather and Time Help - Configuration Considerations=%rThe contents of any room which has an attribute &hear-weather-emits set to 1 will hear the weather emits from the Emits Bank, assuming the Emits Bank is on the Clock's lists of items to @trigger (it is, by default). Those supplied are usually only appropriate for outdoor rooms. The outdoor parent rooms and their children are set to hear weather emits by default; if you want to turn off the weather emits in a child of an outdoor parent room, set &hear-weather-emits <room #> = 0.%r%rAny room which has an attribute &hear-tide-emits set to 1 will hear the tide emits from the Emits Bank, assuming the Emits Bank is on the Clock's list of items to trigger at tide changes.%r%rSee +wta clock-commands for information on adding items to the Clock's triggerlists.%r
&FOREIGN-TIMING Keran's Weather and Time Help - Configuration Considerations=%rIn some cases you may wish to use this weather system with other timing code, replacing the Clock and the Time Functions Object. This is not recommended, as the timing code is the guts of the package, but an experienced coder should be able to manage it.%r%rRecoder's notes: in order to use foreign timing code and preserve most of the functionality of this weather system, the timing code must capable of the following:%r%rIt must, at the very least, distinguish between day and night; preferably, it distinguishes between day, night, dawn, and dusk.%rIt must distinguish the seasons spring, summer, autumn, and winter.%rIn order for the parent rooms to work as they do in this system, there must be a function that tells whether the moon is up or not.%rThere must be a clock capable of triggering the Weathermaker at dawn.%r%rIt is beyond the scope of this +help to attempt to explain exactly what steps must be undertaken to make the weather code work with foreign timing; however, the weather system was coded with readability and simplicity of code in mind (given the complexity of the system).%r
&MOONS Keran's Weather and Time Help - Configuration Considerations=%rAdding moons is easier in 4.0 than it was in 3.0, in the sense that you can @clone the Moon and Tide object, strip the unnecessary tide commands off the new object, and set &moon-daylength-difference on the new object to the difference between the amount of time it takes the moon to get around the sky, and 24 hours, in hours. That is to say, if it takes the moon 24.8 hours to get around the sky (the correct figure for Earth's moon, and the default setting for the existing moon), then moon-daylength-difference should be set to .8; if it takes 26 hours, it should be set to 2; if it takes 23.5 hours, it should be set to -.5. The code will handle all the phase and rise-and-set time recalculations, etc., from there, as far as determining how the new moon behaves. However, if you want the new moon to show up in +today, or in the variable descs in the parent rooms, you'll need to edit it in.%r
&PARAMETERS Keran's Weather and Time Help - Configuration Considerations=%rThis is a list of the parameters that you can set to control the basic operation of the Weather and Time Code. See +wta for +help for the commands you can use to set them. The somewhat complex ones are often explained in other +wtc topics.%r%rcompression mode%rcalendar%rcalendar compression ratio%rclock compression ration%rlongest-day-length/latitude%rdiurnal/semidiurnal tide%rregional weather%rstarting-year%rstart-time%r
&PARENT-ROOM-HIERARCHY Keran's Weather and Time Help - Configuration Considerations=%rThere are several parent rooms supplied with version 4.0 of the Weather and Time Code. The parent rooms make it comparatively easy to write rooms whose descriptions vary by time of day, season, weather, lighting conditions, etc. They can be used individually; as supplied, however, they exist in a hierarchy that determines what kind of rooms get what emits from the Stormmaker. You can create your own parent rooms and @parent them to the appropriate ancestors, which avoids your having to recode the Stormmaker to add parent rooms.%r%rAt the top of the hierarchy is the Great-grandparent of Rooms. Any room which is a remote descendant of this room is considered IC, and will receive certain emits from the Stormmaker; those rooms which are not descendants of this room are considered OOC and will not hear Stormmaker emits.%r%r+wtc parents2 for more.%r
&PARENTS2 Keran's Weather and Time Help - Configuration Considerations=%rThe next layer of the hierarchy comprises three rooms:%r%rGrandparent of Outdoor Rooms%rGrandparent of Windowless Indoor Rooms%rGrandparent of Windowed Indoor Rooms%r%rIt is possible to direct Stormmaker emits to the children of only one Grandparent Room, or to those of two of the three. For instance, emits for thunder should go to all three kinds of room; emits for lightning should only go to those with a view outside--Outdoor Rooms and Windowed Indoor Rooms; emits for a power blackout might only go to both kinds of Indoor Room.%r%rNeither the Great-Grandparent nor any of the Grandparent Rooms contain any variable description coding; this is all to be found on the Parent Rooms. There are seven Parent Rooms supplied, two indoor and five outdoor:%r%r+wtc parents3 for more.%r
&PARENTS3 Keran's Weather and Time Help - Configuration Considerations=%rParent of Windowless Indoor Rooms%rParent of Windowed Parent Rooms%rParent of Separable Day-Night and Season Desc Outdoor Rooms%rParent of Season-and-Day-Night Varying Outdoor Rooms%rParent of Separable Day-Night-Dawn-Dusk and Season Desc Outdoor Rooms%rParent of Separable Desc Outdoor Rooms%rParent of Weather-and-Day-Night Varying Outdoor Rooms%r%rThe +parents command returns the names and dbrefs of all grandchildren of the Great-Grandparent of Rooms, so that players can easily refer to a list of which parent rooms are available. The differences between the various outdoor parent rooms are differences in flavors of variable descriptions they'll return. See +wt parents.%r%r+wtc parents4 for more.%r
&PARENTS4 Keran's Weather and Time Help - Configuration Considerations=%rYou may decide that the existing parent rooms are insufficient. For example, you could decide to create a Shore Parent Room whose children would automatically hear tide emits from the Emits Bank. You might do this by @cloning one of the outdoor parent rooms, renaming the clone to Shore Parent Room, setting a &hear-tide-emits Shore Parent Room=1 on it, and then @parenting the Shore Parent to the Grandparent of Outdoor Rooms.%r%rYou might decide that the existing kinds of room are insufficient, so that you need to create a new Grandparent Room. Usually, the reason for doing this, as opposed to creating a new parent room, is that instead of needing to write a new variation on variable description code, you need a new class of room because you're going to recode the Stormmaker to accommodate a very different environment.%r%r+wtc parents5 for more.%r
&PARENTS5 Keran's Weather and Time Help - Configuration Considerations=%rFor instance, if you had a setting that involved humans in a sea lab interacting with civilized dolphins, you might need a Grandparent of Underwater Rooms, because undersea rooms might not appropriately receive messages relating to indoor human environments or surface weather, but you might want to be able to send distinct environmental event messages to them.%r%rThe Stormmaker is slightly misnamed. It's actually a Transient Environmental Effects Generator, and can be used to produce events besides storms--earthquakes, blackouts, and unusual sights in the sky are all within its purview.%r
&REGIONAL-WEATHER Keran's Weather and Time Help - Configuration Considerations=%rWith regional weather set up, different areas of the MUSH experience different weather at the same time. The regions should be about a day apart--since large weather systems move at vastly different speeds that may vary between 5 and 50 miles per hour, depending on the energy of the system, a certain amount of compromise is necessary; 200-300 miles might be a good figure. The Weathermaker becomes the master weather generator, and should control the weather in the region where storms enter the virtual landscape; Slave Weather Stations control the weather in other regions. For example, say your MUSH's landscape covered the southern New England coast; weather systems there have a large tendency to reach the southwestern portions before the northeastern, and so you would set the Weathermaker up to control the southwesternmost region and the first Slave Weather Station up to control a region 200-300 miles northeastward. It is possible to daisy-chain Slave Weather Stations; you could then have a second Slave Weather Station another 200-300 miles northeastward, using the first Slave Weather Station as its master.%r%r+wtc regional2 for more.%r
&REGIONAL2 Keran's Weather and Time Help - Configuration Considerations=%rThe Weathermaker uses yesterday's weather--its own weather--to determine what today's probably is. The Slave Weather Station models weather in a similar fashion, but it uses its master's previous day's weather to determine what its own probably will be. In the default configuration, usually the slave will select the master's weather of the previous day for its own weather, but sometimes it will select something else. In this way weather systems seem to move from one region to another, with some variation.%r%rTo set up regional weather, you need to do the following:%r%r1) Determine the areas on your MUSH that belong to each region, and which region will belong to the Weathermaker.%r%r2) Set up the Weathermaker for regional weather by typing 'regional' where the Wizard Weather Command object can hear you. This changes the &generator attribute on the Weathermaker so that, after picking its own weather, it notifies the slave to select a new weathertype for the day also. If you wish to remove this later, the 'no regional' command on the Wizard Weather Command object will do it.%r%r+wtc regional3 for more.%r
&REGIONAL3 Keran's Weather and Time Help - Configuration Considerations=%r3) You will need to make it clear in your documentation somewhere that rooms in the Slave Region should use the slave weather functions instead of the master weather functions. One set of slave weather functions is included on the Time Functions Object as an example.%r%r4) You can't use a single Emits Bank to broadcast time of day messages to multiple regions unless you change the messages on it: the ones supplied vary with the weather, and all regions may not have the same weather. To set up an Emits Bank for a second region, you will need to set &hear-weather-emits on rooms in it to 0, and select another attribute name that can be searched for, such as &hear-slaveweather-emits, like so:%r%r&hear-slaveweather-emits <room>=1%r&hear-weather-emits <room> = 0%r%r+wtc regional4 for more.%r
&REGIONAL4 Keran's Weather and Time Help - Configuration Considerations=Then @clone the Emits Bank, rename the copy to Slave Emits Bank, and @edit it so that its searches use your new attribute name instead of &hear-weather-emits:%r%r@edit Slave Emits Bank=hear-weather-emits, hear-slaveweather-emits%r%rAdd the Slave Emits Bank's database # to the Clock's triggerlists (type +wta clock-commands for help on this).%r%r+wtc regional5 for more.%r
&REGIONAL5 Keran's Weather and Time Help - Configuration Considerations=%rIf you wish to make another slave station, you will have to do the following:%r%r1) Clone the Slave Weather Station.%r%r2) Edit the *first* Slave Weather Station's &generator attribute so that it reads:%r%r@wait me={&weathertype-old me = \[u(weathertype)\]; &weathertype-master me = \[u(<dbref of Weathermaker>/weathertype-old)\]; &weathertype me = \[u(\[u(<dbref of Time Functions>/season)\]type-\[u(weathertype-master)\])\]; @notify <database # of Secondary Slave Weather Station>; @trigger me/generator}%r%rThis change causes it to notify the Secondary Slave Station to select its own weathertype of the day.%r%r+wtc regional6 for more.%r
&REGIONAL6 Keran's Weather and Time Help - Configuration Considerations=%r3) Now edit the &generator attribute on the Secondary Slave Station, so that the &weathertype-master command refers not to the Weathermaker, but to the first Slave Weather Station; it's going to read the first slave, not the Weathermaker, to determine its probable weather.%r%rYou will need to add another set of slave functions to the Miscellaneous Functions object, possibly called slave2-* instead of slave-*, set rooms in the Secondary Slave region with a &hear-slave2weather-emits attribute on it instead of &hear-weather-emits, and @clone another edited copy of the Emits Bank whose dbref must be added to the Clock's triggerlists.%r%rThere are various ways to approach regional weather architecture. You can set up more than one slave station that depends directly on the Weathermaker, or on a higher-ranking Slave Weather Station. You can set up more than one Weathermaker to have multiple independent masters.%r%r+wtc regional7 for more.%r
&REGIONAL7 Keran's Weather and Time Help - Configuration Considerations=%rIt's been asked whether you can to use this weather and timing code to set up different time zones. It has not been tested, but it seems likely that you could make second copy of the Time Functions Object and change time-begins slightly, so that it began 3600 secs / clock-compression after time-begins on the first Time Functions Object. It would be a nuisance to document this; you would no longer have a globally-valid value for hour, time-of-day, etc. You would probably need more than one Weathermaker and more than one set of parent rooms, if you're using the parent rooms, to make it work without significant code alterations.%r
&TIDE Keran's Weather and Time Help - Configuration Considerations=%rSome places, typically those on the shores of huge oceans like the Pacific, have diurnal tide cycles, or one high and one low tide per day, while others have semi-diurnal tide cycles with two high tides and two low tides per day. See +wta tide for +help setting the tide cycle.%r
&VARYING-THE-WEATHER Keran's Weather and Time Help - Configuration Considerations=%rThere are three fundamental ways to vary the weather produced by the weather code. They are:%r%r1) Changing the frequency with which various weathertypes are selected at each season. Instructions for how to do this are provided in +wtc weather-modelling.%r%rExperienced recoders may introduce new weathertypes; see +wtc weather-modelling.%r%r2) Changing the descriptions of the weathertypes by writing new desc banks. This is conceptually very simple, though laborious. You rewrite the descriptions in the desc banks to fit the kind of environment you want descriptions for. The descriptions in the Long Weather Description Bank assume a temperate climate; you could write desc banks for areas where the climate was usually warmer or colder. The Tree Weather Description Bank, supplied as an example of environmental variation with auxiliary desc banks, assumes a temperate, relatively wet climate with many leafy trees. It would be possible to write desc banks for conifer forests, grassland, deserts, tundra, cities, shores, the sky, or any sort of environment you like.%r%r+wtc varying2 for more.%r
&VARYING2 Keran's Weather and Time Help - Configuration Considerations=%r3) Varying the weather from place to place by using regional weather. Here it is not the quality of the weather that varies, but when it arrives at different regions. Instructions for setting up regional weather can be found in +wtc regional-weather.%r
&WEATHER-MODELLING Keran's Weather and Time Help - Configuration Considerations=%rThe Weathermaker saves yesterday's weathertype, and then uses the season and yesterday's weathertype to determine which routine it should use to pick the weather for today. For example, the springtype-clear attribute is used to generate today's weather if it was clear yesterday and the season is spring. The springtype-clear attribute selects today's weather at random from among the following types: (clear clear clear clear clear fair fair fair fair fair fair fair fair fair rain fog stormy overcast). The more often a weathertype is repeated, the more likely it is to be selected. Clear weather is generally a strong high pressure area, and a brisk clear day is more often followed by another, or by a day not so brisk where there are many fair weather clouds, than it is to be followed directly by rain, storm, fog, or overcast skies. The probability of the weathertypes varies from season to season; fog is always more likely in summer, while sleet, snow, and blizzards only appear in winter.%r%r+wtc modelling2 for more.%r
&MODELLING2 Keran's Weather and Time Help - Configuration Considerations=%rTo change the probability of a given weathertype being selected, you need to add or reduce the number of times it appears in arguments to randword() in the &<season>type-<weathertype> attrbutes on the Weathermaker. For instance, if you want less fog in summer, reduce the number of times 'fog' appears in the &summertype-<weathertype> attributes. You might, e.g., execute the following:%r%r@edit weathermaker/summertype-* = fog fog fog fog fog,fog fog%r%rRecoder's notes: if you add a weathertype to the code, you will need to account for it in the &<season>type-<weathertype> selectors on the Weathermaker, in the &<season><weathertype> short descriptions on the Weathermaker, in the &<season><day|night|dawn|dusk><weathertype> attributes in the long desc bank, and in appropriate attributes in any auxiliary desc banks you may using, like the Tree Weather Description Bank.%r%r+wtc modelling3 for more.%r
&MODELLING3 Keran's Weather and Time Help - Configuration Considerations=%rThere is one non-obvious point, however: the season changes at virtual midnight, while a new weathertype for the day is not selected until virtual dawn. If you add a weathertype that isn't going to appear in all seasons, you will need to add settings and descriptions for it in the next season to cover the hours between midnight and dawn. For example, sleet, lightsnow, and blizzard are only selected by the Weathermaker in winter; there are &springtype-sleet, &springtype-lightsnow, and &springtype-blizzard weather selector attributes on the weathermaker, which may be invoked on the first day of spring if the last day of winter's weather was frozen preciptation; these selectors only include spring weather in the possibilities they choose between, naturally. There are also &springsleet, &springlightsnow, and &springblizzard short descriptions on the weathermaker, and &spring<day|night|dawn|dusk>sleet, &spring<day|night|dawn|dusk>lightsnow, and &spring<day|night|dawn|dusk>blizzard attributes on the Long Description Bank. The content of these descriptions does not describe winter weather, but spring; they correspond to the spring rain, overcast, and stormy descriptions respectively, so as not to contradict the seasonal descriptions in children of the various parent rooms.%r
&NEXT-VERSION Keran's Weather and Time Help - Configuration Considerations=%rThere have been major structural changes between 3.0 and 4.0 in order to accommodate the revision of the moon and tides for reasonableness, and the Stormmaker. Keran doesn't currently have any plans for revisions involving such structural changes, but there will probably eventually be an astronomical add-on that handles constellations and planets.%r
&TINYMUSH-3.0 Keran's Weather and Time Help - Configuration Considerations=%rThis code is expected to run on TinyMUSH 3.0, which Keran hasn't actually seen very much of at the time of this writing. However, you should take note of a couple of points if you're upgrading from TinyMUSH 2.2 to TinyMUSH 3.0:%r%r1) The zone command on the Storm Maker will probably suddenly work, if you configure zones, assuming TM 3.0 has MUX's inzone() function.%r2) There's a global load, not mentioned in the docs with the other globals, of a softcoded function called children(), used by the Storm Maker and the Global Command Object. This replicates the hardcoded children() function of MUX. Since children() will probably be hardcoded in TM 3.0, you will almost certainly want to delete the @startup attribute on the Storm Maker when converting from TM 2.2 to TM 3.0, since it loads the softcoded children() global. Aside from that, there isn't anything that looks likely to break, although the 2.2 coding is a bit clunky in spots compared to the MUX coding for want of ifelse(), setr() and table().%r%rThe functionality of this TM 2.2 port will still not be identical to that of the native MUX version after a TinyMUSH 3.0 upgrade. The original MUX version makes use of royalty and powers, and most of the admin commands except those on the Wizard Weather and Time Command object are @locked to wizards and royalty, rather than wizards only, in the MUX version.%r
@set Keran's Weather and Time Help - Configuration Considerations=VISUAL
@set Keran's Weather and Time Help - Configuration Considerations=SAFE


#71 - Keran's Weather and Time Help - General

@lock Keran's Weather and Time Help - General=#0
&LIST Keran's Weather and Time Help - General=%rGlobal commands and topics:%r[iter(sort(u(#71/global-commands)), ljust(##, 20))]%r%rGlobal functions:%r[iter(sort(u(#71/global-functions)), ljust(##, 20))]%rOther common time and weather functions:%r%r[ljust(clock-face-hour, 20)][ljust(day-night, 20)][ljust(day-night-dawn-dusk, 20)]%r[ljust(hour, 20)][ljust(inside+outside, 20)][ljust(long-weather, 20)]%r[ljust(month, 20)][ljust(moon-phase, 20)][ljust(moon-up, 20)]%r[ljust(moonrise, 20)][ljust(moonset, 20)][ljust(season , 20)]%r[ljust(short-weather, 20)][ljust(slave-weather, 20)][ljust(sunrise, 20)]%r[ljust(sunset, 20)][ljust(tide, 20)][ljust(time-of-day, 20)]%r[ljust(tree-weather, 20)][ljust(weathertype, 20)][ljust(week, 20)]%r[ljust(year, 20)]%r%r+wt <name> for help.
&VERSION Keran's Weather and Time Help - General=4.0
&AUTHOR Keran's Weather and Time Help - General=Keran@Keranset Island
&GLOBAL-COMMANDS Keran's Weather and Time Help - General=+today +parents weather+time
&COMMON-FUNCTIONS Keran's Weather and Time Help - General=clock-face-hour day-night day-night-dawn-dusk hour inside+outside long-weather month moon-phase moon-up moonrise moonset season short-weather slave-weather sunrise sunset tide time-of-day tree-weather weathertype week year
&GLOBAL-FUNCTIONS Keran's Weather and Time Help - General=randword tilde2blank blank2tilde
&HELP_+WT Keran's Weather and Time Help - General=%r+wt%r%rThis is the main +help for Keran's Weather and Time Code, a configurable MUSH/MUX softcode package for creating virtual or in-character environments. This +help describes features useful to ordinary builders and coders. +wta, +wtc, and +wtx call up +help for administration, configuration, and documentation for recoders.%r
&HELP_RANDWORD Keran's Weather and Time Help - General=%rrandword(<word1> <word2> <word3> <etc.>)%r%rRandword() returns a random word from the list. %r
&HELP_TILDE2BLANK Keran's Weather and Time Help - General=%rtilde2blank(<string>)%r%rTilde2blank() takes a string as its argument and replaces all the spaces with tildes (~). %r
&HELP_BLANK2TILDE Keran's Weather and Time Help - General=%rblank2tilde(<string>)%r%rTilde2blank() takes a string as its argument and replaces all the tildes (~) with spaces. %r
&HELP_TIDE Keran's Weather and Time Help - General=%ru(#340/tide)%ru(#340/high-low-tide)%r%rTide returns the state of the tide. Possibilities are low and rising, high and rising, slack high water, high and ebbing, low and ebbing, and slack low water. The default setting for the tide is semi-diurnal, that is, there are two tide cycles per day. But they may also be diurnal. In either case, the tide cycle is synchronized to the moon. High-low-tide returns whether the tide is high is low.%r
&HELP_MOONSET Keran's Weather and Time Help - General=%ru(#340/moonset)%r%rThe time of moonset, in seconds.%r
&HELP_MOONRISE Keran's Weather and Time Help - General=%ru(#340/moonrise)%r%rThe time of moonrise, in seconds.%r
&HELP_WEATHERTYPE Keran's Weather and Time Help - General=%ru(#78/weathertype)%r%rReturns the weathertype generated by the weathermaker for the day. May be clear, fair, overcast, fog, rain, stormy, sleet, lightsnow, or blizzard.%r
&HELP_MOON-UP Keran's Weather and Time Help - General=%ru(#340/moon-up)%r%rReturns 1 if the moon is up and 0 if it isn't.%r
&HELP_TREE-WEATHER Keran's Weather and Time Help - General=%ru(#338/tree-weather)%r%rReturns a description of the surroundings varying by day, night, dawn, dusk, and weather conditions, in an environment with leafy trees. A new weathertype for the day is generated shortly after dawn.%r
&HELP_SHORT-WEATHER Keran's Weather and Time Help - General=%ru(#338/short-weather)%ru(#338/lowercase-short-weather)%r%rReturns a one-line description of the weather which varies with the season and weather conditions. A new weathertype for the day is generated shortly after dawn. Lowercase-short-weather is identical, but the first word is not capitalized; for instance, if you were describing a window view, you might prefix lowercase-short-weather with some phrase like, 'Outside, '.%r
&HELP_LONG-WEATHER Keran's Weather and Time Help - General=%ru(#338/long-weather)%ru(#338/lowercase-long-weather)%r%rReturns a description of the weather which varies with season, day, night, dawn, or dusk, and the weather conditions clear, fair, overcast, fog, rain, stormy, sleet, lightsnow, blizzard. A new weathertype for the day is generated shortly after dawn. Lowercase-long-weather is identical, but the first word is not capitalized; for instance, if you were describing a window view, you might prefix lowercase-long-weather with some phrase like, 'Outside, '.%r
&HELP_SUNSET Keran's Weather and Time Help - General=%ru(#85/sunset)%r%rReturns the number of seconds after virtual midnight that sunset takes place. If you need the time as secs(), add u(#85/sunset) to u(#85/last-midnight).%r
&HELP_SUNRISE Keran's Weather and Time Help - General=%ru(#85/sunrise)%r%rReturns the number of seconds after virtual midnight that sunrise takes place. If you need the time as secs(), add u(#85/sunrise) to u(#85/last-midnight).%r
&HELP_DAY-NIGHT-DAWN-DUSK Keran's Weather and Time Help - General=%ru(#85/day-night-dawn-dusk)%r%rReturns day, night, dawn, or dusk.%r
&HELP_DAY-NIGHT Keran's Weather and Time Help - General=%ru(#85/day-night)%r%rReturns virtual day or night. %r
&HELP_TIME-OF-DAY Keran's Weather and Time Help - General=%ru(#85/time-of-day)%r%rReturns day, night, dawn, dusk, noon, midnight, morning, afternoon, or after midnight. %r
&HELP_HOUR Keran's Weather and Time Help - General=%ru(#85/hour)%r%rReturns the last hour struck in virtual time, in 24-hour format. Midnight is 0.%r
&HELP_MOON-PHASE Keran's Weather and Time Help - General=%ru(#340/moon-phase)%r%rReturns the phase of the moon, which may be new, waxing crescent, first quarter, waxing gibbous, full, waning gibbous, last quarter, waning crescent. %r
&HELP_SEASON Keran's Weather and Time Help - General=%ru(#85/season)%r%rReturns the season. Possibilities are spring, summer, autumn, or winter. %r
&HELP_MONTH Keran's Weather and Time Help - General=%ru(#85/month)%r%rReturns the virtual month. %r
&HELP_YEAR Keran's Weather and Time Help - General=%ru(#85/year)%r%rReturns the virtual year. %r
&HELP_WEEK Keran's Weather and Time Help - General=%ru(#85/week)%r%rReturns the number of the week in the current month; may range from 1-5. Meaningless if the date is taken from the system clock.%r
&HELP_CLOCK-FACE-HOUR Keran's Weather and Time Help - General=%ru(#85/clock-face-hour)%r%rReturns the virtual hour in 12-hour time instead of 24-hour time, e.g., hour 21 is 9 on a clock's face. Midnight is 12.%r
@Desc Keran's Weather and Time Help - General=This is +wt, the main +help for Keran's Weather and Time Code Package. It should be set visual and safe, and it belongs in the Auxiliary room. The items documented on this object are expected to be generally useful to builders and coders.
&HELP_+PARENTS Keran's Weather and Time Help - General=%r+parents%r%r+Parents returns a list of parent rooms you can use to build rooms with descriptions that vary according to the time of day, weather, etc. You build your room, @parent it to one of the parent rooms, and look at it to see instructions for how to write descriptions that vary according to environmental conditions. You can simply write descriptions for day, night, winter, summer, etc., and the parent room will switch them at the appropriate times.%r%rThere are two indoor parent rooms, one for rooms with windows and one for rooms without, and several outdoor parent rooms which have style variations in the variable descs returned. The parent rooms are set visual and you can examine <dbref> to see how they work.%r%r+wt +parents2 for more.%r
&HELP_+PARENTS2 Keran's Weather and Time Help - General=%rThe outdoor room style variations are:%r%rSeparable Day-Night - This room will return a description consisting of an unchanging desc, a day/night desc, a spring/summer/autumn/winter desc, a weather desc, and a moon desc. You can suppress any elements you don't want, e.g., you can prevent it from showing a moon description.%r%rSeparable Day-Night-Dawn-Dusk - As above, but instead of returning a description that varies only by day and night, it returns different descriptions at day, night, dawn, and dusk.%r%rSeason and Day-Night - Returns a desc for summer-night, a desc for summer-day, a desc for autumn-night, a desc for autumn-day, and so on. Also returns a moon desc and a weather desc.%r%rSeason and Day-Night-Dawn-Dusk - As above, but also returns distinct dawn and dusk descriptions, e.g, winter-dawn, winter-dusk, etc.%r%rWeather and Day-Night - Returns descriptions that combine day-night and weather variations, e.g., fair-night, fair-day, overcast-day, etc. Also returns a moon desc%r
&HELP_+TODAY Keran's Weather and Time Help - General=%r+today%r%r+Today returns information about the time of day, month, season, year, tides, weather, etc.%r
&HELP_DATE+TIME Keran's Weather and Time Help - General=%ru(#85/year)%ru(#85/season)%ru(#85/month)%ru(#85/week)%ru(#85/hour)%ru(#85/clock-face-hour)%r%rA collection of functions returning the virtual or in-character date and time. Season is spring, summer, autumn, or winter. Month may return either the Gregorian month or the months of a non-Gregorian calendar, depending on which has been configured. Week returns which week it is in the month, which may be 1-5. Hour returns the hour in 24 hour format; midnight is hour 0. Clock-face-hour returns the hour in 12-hour format; midnight and noon are both 12.%r
&HELP_INSIDE+OUTSIDE Keran's Weather and Time Help - General=%ru(#338/is-outside)%ru(#338/is-inside)%ru(#338/has-outside-view)%ru(#338/is-inside-with-window)%ru(#338/is-inside-without-window)%r%rIf your room has been @parented to one of the parent rooms that's part of this package, and the parent room hierarchy has been installed, then this function will return 1 if the given condition is true and 0 if it's not. This can be useful for determining whether something can be sensed in a given room, e.g., lightning should only be seen in rooms that are outside or have windows, but thunder may be heard anywhere. These functions won't work on Penn installations with safer_ufun set.%r
&HELP_SLAVE-WEATHER Keran's Weather and Time Help - General=%ru(#76/slave-weathertype)%ru(#338/slave-short-weather)%ru(#338/slave-long-weather)%ru(#338/slave-tree-weather)%r%rIf regional weather has been configured, there may be more than one weather region. This code comes with one slave weather station which produces a weathertype for the day sometimes differing from that of the master Weathermaker. The slave weather functions work precisely like long-weather, short-weather, and tree-weather, which see, but are selected according to the Slave Weather Station's weathertype.%r%rIt is possible to have multiple slave stations and there may be more than one set of slave weather functions; these must be locally defined and documented.%r
&HELP_CLOCK-COMMANDS Keran's Weather and Time Help - General=%r+clock add <dbref> <triggerlist>%r+clock del <dbref> <triggerlist>%r%rIf these commands are enabled, they you to add or delete items from the Clock's triggerlists, so that the Clock can trigger commands on them at appropriate times. <dbref> is the number of the item to be added to the Clock's triggerlists, and <triggerlist> is which triggerlist to use. The triggerlist must be time-of-day, sun, moon, tide, hour, every-hour, every-half-hour, or every-quarterhour. An item to be triggered must have an attribute &trigger-at-<time> = <action to be triggered>, where <time> is dawn, sunrise, morning, noon, afternoon, dusk, sunset, night, midnight, after~midnight, moonrise, moonset, meridian~transit, every~hour, every~halfhour, every~quarterhour, 0 through 23, high~and~rising, high~and~slack, high~and~ebbing, low~and~ebbing, low~and~slack, low~and~rising. Use &trigger-at-0 and &trigger-at-12 for triggering at precisely midnight and noon; the times of day called noon and midnight are time stretches.%r
&HELP_WEATHER+TIME Keran's Weather and Time Help - General=%rKeran's Weather and Time Code is a configurable MUSH/MUX softcode package for maintaining virtual or in-character environments. It has +help divided into three sections:%r%r+wt - +help for common commands, functions and topics generally useful to builders and coders.%r%r+wta - Admin commands.%r%r+wtc - Configuration considerations. Extensive and sometimes complex, since there are many non-vanilla ways to set up this code, depending on the environment you're trying to model.%r
@set Keran's Weather and Time Help - General=VISUAL
@set Keran's Weather and Time Help - General=SAFE


#338 - Keran's Miscellaneous Functions

&RANDWORD Keran's Miscellaneous Functions=[extract(%0, add(1, rand(words(%0))), 1)]
&TILDE2BLANK Keran's Miscellaneous Functions=[edit(v(0),~,%b)]
&BLANK2TILDE Keran's Miscellaneous Functions=[edit(v(0),%b,~)]
&LONG-WEATHER Keran's Miscellaneous Functions=[u(#82/[u(#85/season)][u(#85/day-night-dawn-dusk)][u(#78/weathertype)])]
&SHORT-WEATHER Keran's Miscellaneous Functions=[u(#78/[u(#85/season)][u(#78/weathertype)])]
&TREE-WEATHER Keran's Miscellaneous Functions=[u(#83/trees_[u(#85/season)]_[u(#85/day-night)]_[u(#78/weathertype)])]
&SLAVE-LONG-WEATHER Keran's Miscellaneous Functions=[u(#82/[u(#85/season)][u(#85/day-night-dawn-dusk)][u(#76/slave-weathertype)])]
&SLAVE-SHORT-WEATHER Keran's Miscellaneous Functions=[u(#78/[u(#85/season)][u(#76/slave-weathertype)])]
&SLAVE-TREE-WEATHER Keran's Miscellaneous Functions=[u(#83/trees_[u(#85/season)]_[u(#85/day-night)]_[u(#76/slave-weathertype)])]
&LOWERCASE-LONG-WEATHER Keran's Miscellaneous Functions=[lcstr(first(u(long-weather)))] [rest(u(long-weather))]
&LOWERCASE-SHORT-WEATHER Keran's Miscellaneous Functions=[lcstr(first(u(short-weather)))] [rest(u(short-weather))]
&ITER-R Keran's Miscellaneous Functions=[tilde2blank(edit([iter(%0, blank2tilde(name(##)))], %b, %r))]
&IS-OUTSIDE Keran's Miscellaneous Functions=[not(comp(parent(parent(locate(%#, %0, *))), #367))]
&IS-INSIDE-WITH-WINDOW Keran's Miscellaneous Functions=[not(comp(parent(parent(locate(%#, %0, *))), #359))]
&IS-INSIDE-WITHOUT-WINDOW Keran's Miscellaneous Functions=[not(comp(parent(parent(locate(%#, %0, *))), #362))]
&HAS-OUTSIDE-VIEW Keran's Miscellaneous Functions=[or(u(is-outside, %0), u(is-inside-with-window, %0))]
&IS-INSIDE Keran's Miscellaneous Functions=[or(u(is-inside-without-window, locate(%#, %0, *)), u(is-inside-with-window, locate(%#, %0, *)))]
@Desc Keran's Miscellaneous Functions=This object has several important functions on it, including three that should be installed as globals. (randword, blank2tilde, tilde2blank). It belongs in the Auxiliary room and has no commands on it. It should be set visual and inherit.
@set Keran's Miscellaneous Functions=INHERIT
@set Keran's Miscellaneous Functions=VISUAL
@set Keran's Miscellaneous Functions=SAFE
&HAS-SOFTFLAG Keran's Miscellaneous Functions=[hasattr(%0,%1)]


#339 - Keran's Storm Maker

&ISWIZARD Keran's Storm Maker=[hasflag(%#, wizard)]
@lock Keran's Storm Maker=ISWIZARD/1
&EVERYWHERE Keran's Storm Maker=$everywhere *: @dolist iter(iter(children(#370), children(##)), children(##)) = @pemit/contents ## = [capstr(%0)]
&WINDOW Keran's Storm Maker=$window *: @dolist setunion(iter(children(#367), children(##)), iter(children(#359), children(##))) = @pemit/contents ## = [switch(hasattr(##, window-prefix), 1, [u(##/window-prefix)] [lcstr(%0)], [capstr(%0)])]
&OUTSIDE Keran's Storm Maker=$outside *: @dolist iter(children(#367), children(##)) = @pemit/contents ## = [capstr(%0)]
@lock/UseLock Keran's Storm Maker=ISWIZARD/1
&CHANGE-MASTER-WEATHER Keran's Storm Maker=$weather *: &weathertype #78=%0; &weathertype-master #76=%0
&CHANGE-SLAVE-WEATHER Keran's Storm Maker=$slave *: &weathertype #76=%0
&INSIDE Keran's Storm Maker=$inside *: @dolist setunion(iter(children(#362), children(##)), iter(children(#359), children(##))) = @pemit/contents ## = [capstr(%0)]
&ZONE Keran's Storm Maker=$zone *=*: @dolist inzone(%0) = @pemit/contents ## = [capstr(%1)]
&SEARCH-ATTRIBUTE Keran's Storm Maker=$search *=*: @dolist search(eroom=\[hasattr(##, %0)\]) = @pemit/contents ## = [capstr(%1)]
@Desc Keran's Storm Maker=This item can be used to trigger local storm effects. It should be set inherit, commands, and safe, and should be kept in the Auxiliary room when not in use.
&CHILDREN Keran's Storm Maker=search(eval=not(comp(parent(##), %0)))
@Startup Keran's Storm Maker=@function/privileged children=#339/children
@set Keran's Storm Maker=INHERIT
@set Keran's Storm Maker=VISUAL
@set Keran's Storm Maker=SAFE
@set Keran's Storm Maker=COMMANDS


#340 - Keran's Moon and Tide Functions

@lock Keran's Moon and Tide Functions=#0
&TIDE Keran's Moon and Tide Functions=[u(semi-tide)]
&SEMI-TIDE Keran's Moon and Tide Functions=[switch(u(semi-low-and-rising), 1, low and rising,)][switch(u(semi-high-and-rising), 1, high and rising,)][switch(u(semi-slack-high-water), 1, high and slack,)][switch(u(semi-high-and-ebbing), 1, high and ebbing,)][switch(u(semi-low-and-ebbing), 1, low and ebbing,)][switch(u(semi-slack-low-water), 1, low and slack,)]
&SEMI-SLACK-HIGH-WATER Keran's Moon and Tide Functions=[or([and(gte(secs(), u(#340/semi-slack-high-water-begins-1)), lt(secs(), u(#340/semi-slack-high-water-ends-1)))], [and(gte(secs(), u(#340/semi-slack-high-water-begins-2g)), lt(secs(), u(#340/semi-slack-high-water-ends-2)))])]
&SEMI-HIGH-AND-EBBING Keran's Moon and Tide Functions=[or([and(gte(secs(), u(#340/semi-slack-high-water-ends-1)), lt(secs(), u(#340/semi-mid-ebb-1)))], [and(gte(secs(), u(#340/semi-slack-high-water-ends-2)), lt(secs(), u(#340/semi-mid-ebb-2)))])]
&SEMI-LOW-AND-EBBING Keran's Moon and Tide Functions=[or([and(gte(secs(), u(#340/semi-mid-ebb-1)), lt(secs(), u(#340/semi-slack-low-water-begins-1)))], [and(gte(secs(), u(#340/semi-mid-ebb-2)), lt(secs(), u(#340/semi-slack-low-water-begins-2)))])]
&SEMI-SLACK-LOW-WATER Keran's Moon and Tide Functions=[or([and(gte(secs(), u(#340/semi-slack-low-water-begins-1)), lt(secs(), u(#340/semi-slack-low-water-ends-1)))], [and(gte(secs(), u(#340/semi-slack-low-water-begins-2)), lt(secs(), u(#340/semi-slack-low-water-ends-2)))])]
&SEMI-LOW-AND-RISING Keran's Moon and Tide Functions=[or([and(gte(secs(), u(#340/semi-slack-low-water-ends-1)), lt(secs(), u(#340/semi-mid-flood-1)))], [and(gte(secs(), u(#340/semi-slack-low-water-ends-2)), lt(secs(), u(#340/semi-mid-flood-2)))])]
&SEMI-HIGH-AND-RISING Keran's Moon and Tide Functions=[or([and(gte(secs(), u(#340/semi-mid-flood-1)), lt(secs(), u(#340/semi-slack-high-water-begins-2l)))], [and(gte(secs(), u(#340/semi-mid-flood-2)), lt(secs(), u(#340/semi-next-cycle-begins)))])]
&SEMI-SLACK-HIGH-WATER-BEGINS-1 Keran's Moon and Tide Functions=[u(meridian-transit)]
&SEMI-EBB-BEGINS-1 Keran's Moon and Tide Functions=[add(u(meridian-transit), u(#85/secs-per-halfhour))]
&SEMI-SLACK-HIGH-WATER-ENDS-1 Keran's Moon and Tide Functions=[add(u(meridian-transit), u(#85/secs-per-hour))]
&SEMI-MID-EBB-1 Keran's Moon and Tide Functions=[add(u(meridian-transit), u(#85/secs-per-halfhour), div(u(secs-per-moonday), 8))]
&SEMI-SLACK-LOW-WATER-BEGINS-1 Keran's Moon and Tide Functions=[add(u(meridian-transit), div(u(secs-per-moonday), 4))]
&SEMI-FLOOD-BEGINS-1 Keran's Moon and Tide Functions=[add(u(meridian-transit), u(#85/secs-per-halfhour), div(u(secs-per-moonday), 4))]
&SEMI-SLACK-LOW-WATER-ENDS-1 Keran's Moon and Tide Functions=[add(u(meridian-transit), u(#85/secs-per-hour), div(u(secs-per-moonday), 4))]
&SEMI-MID-FLOOD-1 Keran's Moon and Tide Functions=[add(u(meridian-transit), u(#85/secs-per-halfhour), mul(div(u(secs-per-moonday), 8), 3))]
&SEMI-SLACK-HIGH-WATER-BEGINS-2L Keran's Moon and Tide Functions=[add(u(meridian-transit), div(u(secs-per-moonday), 2))]
&SEMI-SLACK-HIGH-WATER-BEGINS-2G Keran's Moon and Tide Functions=[add(u(last-meridian-transit), div(u(secs-per-moonday), 2))]
&SEMI-EBB-BEGINS-2 Keran's Moon and Tide Functions=[add(u(last-meridian-transit), u(#85/secs-per-halfhour), div(u(secs-per-moonday), 2))]
&SEMI-SLACK-HIGH-WATER-ENDS-2 Keran's Moon and Tide Functions=[add(u(last-meridian-transit), u(#85/secs-per-hour), div(u(secs-per-moonday), 2))]
&SEMI-MID-EBB-2 Keran's Moon and Tide Functions=[add(u(last-meridian-transit), u(#85/secs-per-halfhour), mul(div(u(secs-per-moonday), 8), 5))]
&SEMI-SLACK-LOW-WATER-BEGINS-2 Keran's Moon and Tide Functions=[add(u(last-meridian-transit), mul(div(u(secs-per-moonday), 4), 3))]
&SEMI-FLOOD-BEGINS-2 Keran's Moon and Tide Functions=[add(u(last-meridian-transit), u(#85/secs-per-halfhour), mul(div(u(secs-per-moonday), 4), 3))]
&SEMI-SLACK-LOW-WATER-ENDS-2 Keran's Moon and Tide Functions=[add(u(last-meridian-transit), u(#85/secs-per-hour), mul(div(u(secs-per-moonday), 4), 3))]
&SEMI-MID-FLOOD-2 Keran's Moon and Tide Functions=[add(u(last-meridian-transit), u(#85/secs-per-halfhour), mul(div(u(secs-per-moonday), 8), 7))]
&SEMI-NEXT-CYCLE-BEGINS Keran's Moon and Tide Functions=[add(u(last-meridian-transit), u(secs-per-moonday))]
&DI-TIDE Keran's Moon and Tide Functions=[switch(u(di-low-and-rising), 1, low and rising,)][switch(u(di-high-and-rising), 1, high and rising,)][switch(u(di-slack-high-water), 1, high and slack,)][switch(u(di-high-and-ebbing), 1, high and ebbing,)][switch(u(di-low-and-ebbing), 1, low and ebbing,)][switch(u(di-slack-low-water), 1, low and slack,)]
&DI-SLACK-HIGH-WATER Keran's Moon and Tide Functions=[and(gte(secs(), u(#340/di-slack-high-water-begins)), lt(secs(), u(#340/di-slack-high-water-ends)))]
&DI-LOW-AND-EBBING Keran's Moon and Tide Functions=[and(gte(secs(), u(#340/di-mid-ebb)), lt(secs(), u(#340/di-slack-low-water-begins-l)))]
&DI-HIGH-AND-EBBING Keran's Moon and Tide Functions=[and(gte(secs(), u(#340/di-slack-high-water-ends)), lt(secs(), u(#340/di-mid-ebb)))]
&DI-SLACK-LOW-WATER Keran's Moon and Tide Functions=[and(gte(secs(), u(#340/di-slack-low-water-begins-g)), lt(secs(), u(#340/di-slack-low-water-ends)))]
&DI-LOW-AND-RISING Keran's Moon and Tide Functions=[and(gte(secs(), u(#340/di-slack-low-water-ends)), lt(secs(), u(#340/di-mid-flood)))]
&DI-HIGH-AND-RISING Keran's Moon and Tide Functions=[and(gte(secs(), u(#340/di-mid-flood)), lt(secs(), u(#340/di-next-cycle-begins)))]
&DI-SLACK-HIGH-WATER-BEGINS Keran's Moon and Tide Functions=[u(meridian-transit)]
&DI-EBB-BEGINS Keran's Moon and Tide Functions=[add(u(meridian-transit), u(#85/secs-per-hour))]
&DI-SLACK-HIGH-WATER-ENDS Keran's Moon and Tide Functions=[add(u(meridian-transit), mul(u(#85/secs-per-hour), 2))]
&DI-MID-EBB Keran's Moon and Tide Functions=[add(u(meridian-transit), u(#85/secs-per-hour), div(u(secs-per-moonday), 4))]
&DI-SLACK-LOW-WATER-BEGINS-L Keran's Moon and Tide Functions=[add(u(meridian-transit), div(u(secs-per-moonday), 2))]
&DI-SLACK-LOW-WATER-BEGINS-G Keran's Moon and Tide Functions=[add(u(last-meridian-transit), div(u(secs-per-moonday), 2))]
&DI-FLOOD-BEGINS Keran's Moon and Tide Functions=[add(u(last-meridian-transit), u(#85/secs-per-hour), div(u(secs-per-moonday), 2))]
&DI-SLACK-LOW-WATER-ENDS Keran's Moon and Tide Functions=[add(u(last-meridian-transit), mul(u(#85/secs-per-hour),2), div(u(secs-per-moonday), 2))]
&DI-MID-FLOOD Keran's Moon and Tide Functions=[add(u(last-meridian-transit), u(#85/secs-per-hour), mul(div(u(secs-per-moonday), 4), 3))]
&DI-NEXT-CYCLE-BEGINS Keran's Moon and Tide Functions=[add(u(last-meridian-transit), u(secs-per-moonday))]
&MOON-PHASE Keran's Moon and Tide Functions=[switch(u(transit-of-new), 1, new,)][switch(u(transit-of-waxing-crescent), 1, waxing crescent,)][switch(u(transit-of-first-quarter), 1, first quarter,)][switch(u(transit-of-waxing-gibbous), 1, waxing gibbous,)][switch(u(transit-of-full), 1, full,)][switch(u(transit-of-waning-gibbous), 1, waning gibbous,)][switch(u(transit-of-last-quarter), 1, last quarter,)][switch(u(transit-of-waning-crescent), 1, waning crescent,)]
&TRANSIT-OF-FULL Keran's Moon and Tide Functions=[or([lte(u(meridian-transit), add(u(midnight-before-mt), div(5400, u(#85/clock-compression))))], [gt(u(meridian-transit), add(u(midnight-before-mt), div(81000, u(#85/clock-compression))))])]
&TRANSIT-OF-WANING-GIBBOUS Keran's Moon and Tide Functions=[and([gt(u(meridian-transit), add(u(midnight-before-mt), div(5400, u(#85/clock-compression))))], [lte(u(meridian-transit), add(u(midnight-before-mt), div(16200, u(#85/clock-compression))))])]
&TRANSIT-OF-LAST-QUARTER Keran's Moon and Tide Functions=[and([gt(u(meridian-transit), add(u(midnight-before-mt), div(16200, u(#85/clock-compression))))], [lte(u(meridian-transit), add(u(midnight-before-mt), div(27000, u(#85/clock-compression))))])]
&TRANSIT-OF-WANING-CRESCENT Keran's Moon and Tide Functions=[and([gt(u(meridian-transit), add(u(midnight-before-mt), div(27000, u(#85/clock-compression))))], [lte(u(meridian-transit), add(u(midnight-before-mt), div(37800, u(#85/clock-compression))))])]
&TRANSIT-OF-NEW Keran's Moon and Tide Functions=[and([gt(u(meridian-transit), add(u(midnight-before-mt), div(37800, u(#85/clock-compression))))], [lte(u(meridian-transit), add(u(midnight-before-mt), div(48600, u(#85/clock-compression))))])]
&TRANSIT-OF-WAXING-CRESCENT Keran's Moon and Tide Functions=[and([gt(u(meridian-transit), add(u(midnight-before-mt), div(48600, u(#85/clock-compression))))], [lte(u(meridian-transit), add(u(midnight-before-mt), div(59400, u(#85/clock-compression))))])]
&TRANSIT-OF-FIRST-QUARTER Keran's Moon and Tide Functions=[and([gt(u(meridian-transit), add(u(midnight-before-mt), div(59400, u(#85/clock-compression))))], [lte(u(meridian-transit), add(u(midnight-before-mt), div(70200, u(#85/clock-compression))))])]
&TRANSIT-OF-WAXING-GIBBOUS Keran's Moon and Tide Functions=[and([gt(u(meridian-transit), add(u(midnight-before-mt), div(70200, u(#85/clock-compression))))], [lte(u(meridian-transit), add(u(midnight-before-mt), div(81000, u(#85/clock-compression))))])]
&MOONDAY-BEGINS Keran's Moon and Tide Functions=[add(mul(u(moonday-from-0), u(secs-per-moonday)), u(#85/time-begins))]
&MERIDIAN-TRANSIT Keran's Moon and Tide Functions=[add(u(moonday-begins), div(u(secs-per-moonday), 2))]
&LAST-MERIDIAN-TRANSIT Keran's Moon and Tide Functions=[sub(u(meridian-transit), u(secs-per-moonday))]
&MIDNIGHT-BEFORE-MERIDIAN-TRANSIT Keran's Moon and Tide Functions=[switch(gt(sub(u(#340/meridian-transit), u(#85/last-midnight)), u(#85/secs-per-day)), 1, u(#85/next-midnight), [switch(lt(sub(u(#340/meridian-transit), u(#85/last-midnight)), 0), 1, u(#85/midnight-before-last), u(#85/last-midnight))])]
&NOON-BEFORE-MERIDIAN-TRANSIT Keran's Moon and Tide Functions=[switch(gt(sub(u(#340/meridian-transit), u(#85/last-noon)), u(#85/secs-per-day)), 1, u(#85/next-noon), [switch(lt(sub(u(#340/meridian-transit), u(#85/last-noon)), 0), 1, u(#85/noon-before-last), u(#85/last-noon))])]
&SECS-PER-MOONDAY Keran's Moon and Tide Functions=[round(mul(u(#340/moonday-in-hours), u(#85/secs-per-hour)), 0)]
&MOONDAY-FROM-0 Keran's Moon and Tide Functions=[div(sub(secs(), u(#85/time-begins)), u(secs-per-moonday))]
&MOONRISE Keran's Moon and Tide Functions=[sub(u(meridian-transit), div(u(moon-up-length), 2))]
&MOONSET Keran's Moon and Tide Functions=[add(u(meridian-transit), div(u(moon-up-length), 2))]
&MOON-UP Keran's Moon and Tide Functions=[switch([gt(secs(), u(moonrise))], 0, 0, 1, {[switch([lt(secs(), u(moonset))], 0, 0, 1, 1)]})]
&MOON-UP-LENGTH Keran's Moon and Tide Functions=[round(add(mul([sin(mul(mul(pi(), 2), add(u(sun-cycle-by-moonday), u(moon-cycle))))], u(#85/day-length-variation)), u(#85/secs-per-halfday)), 0)]
&MOON-CYCLE Keran's Moon and Tide Functions=[fdiv(sub(u(#340/meridian-transit), u(#340/noon-before-meridian-transit)), u(#85/secs-per-day))]
&SUN-CYCLE-BY-MOONDAY Keran's Moon and Tide Functions=[fdiv(u(moonday-of-year), u(moondays-per-year))]
&MOONDAY-OF-YEAR Keran's Moon and Tide Functions=[sub(u(#340/moonday-from-0), div(mul(u(#85/days-per-year), u(#85/native-year), u(#85/secs-per-day)), u(#340/secs-per-moonday)))]
&MOONDAYS-PER-YEAR Keran's Moon and Tide Functions=[fdiv(u(#85/secs-per-year), u(#340/secs-per-moonday))]
&DAY-OF-LUNAR-MONTH Keran's Moon and Tide Functions=[add(mod(u(moonday-from-0), 30), 1)]
&MOONDAY-IN-HOURS Keran's Moon and Tide Functions=[add(24, mul(u(moon-daylength-difference), u(#85/calendar-compression)))]
&MOON-ADJECTIVE Keran's Moon and Tide Functions=[switch(u(me/moon-phase), new, black, waxing crescent, faint, first quarter, dim, waxing gibbous, bright, full, brilliant, waning gibbous, bright, last quarter, dim, waning crescent, faint)]
@Desc Keran's Moon and Tide Functions=This object contains the functions that determine the moon and tides. It belongs in the Auxiliary room and has no commands on it. It should be set visual.
&HIGH-LOW-TIDE Keran's Moon and Tide Functions=[elements(u(#340/tide), 1)]
&MOON-DAYLENGTH-DIFFERENCE Keran's Moon and Tide Functions=.8
&MIDNIGHT-BEFORE-MT Keran's Moon and Tide Functions=[switch(gt(sub(u(#340/meridian-transit), u(#85/last-midnight)), u(#85/secs-per-day)), 1, u(#85/next-midnight), [switch(lt(sub(u(#340/meridian-transit), u(#85/last-midnight)), 0), 1, u(#85/midnight-before-last), u(#85/last-midnight))])]
@set Keran's Moon and Tide Functions=VISUAL
@set Keran's Moon and Tide Functions=SAFE


#72 - Keran's Parent of Separable Day-Night and Season Desc Outdoor Rooms

@tel #72
@Desc here=[squish([u(unchanging-desc)] [u([u(#85/day-night)]-desc)] [u([u(#85/season)]-desc)])][u(separator)][squish([u(weather-desc)] [switch(u(#85/day-night), night, {[switch(u(#340/moon-phase), new,, {[switch(u(#340/moon-up), 1, {[switch(u(#78/weathertype), clear, u(moon-desc), fair, u(moon-desc))]})]})]})])]%r[u(instructions)]
&NIGHT-DESC here=This is what the place is like by night.
&SPRING-DESC here=This is what the place is like in spring.
&SUMMER-DESC here=This is what the place is like in summer.
&WINTER-DESC here=This is what the place is like in winter.
&WEATHER-DESC here=[u(#338/short-weather)]
&UNCHANGING-DESC here=This part of the desc never changes.
&AUTUMN-DESC here=This is what the place is like in autumn.
&MOON-DESC here=This is the desc of the [u(#340/moon-phase)] moon.
&INSTRUCTIONS here=%rHow to describe an outdoor room with seasonal and weather variations: %r&unchanging-desc here=This part of the description of the place never changes.%r&night-desc here=What the place is like at night.%r&day-desc here=What the place is like by day.%r&spring-desc here=What the place is like during spring.%r&summer-desc here=What the place is like during summer.%r&autumn-desc here=What the place is like during autumn.%r&winter-desc here=What the place is like during winter.%rDon't put things that are only true in specific weather conditions in the descriptions listed above; it'll look funny if you describe a blue sky and the weathermaker comes up with rain.%r&weather-desc here=\[u(#338/short-weather)\] or \[u(#338/long-weather)\]. You can also add \[u(#338/tree-weather)\] or any other environmental weather descriptions that have been written. To use the environmental effects, do something like &weather-desc here=\[u(#338/short-weather)\] \[u(#338/tree-weather)\]%r&moon-desc here=Describe the \[u(#340/moon-phase)\] moon as it shines on the scenery at night.%r&instructions here=\\%rThis last will turn off these instructions. You can suppress any other part of the description the same way, e.g.: &moon-desc here=\\%r&hear-weather-emits here=0 turns the sunrise, sunset, etc. messages from the emits bank off; setting it to 1 turns them on.%r&hear-tide-emits here = 1 turns the tide emits on; setting it to 0 turns them off.
&DAY-DESC here=This is what the place is like by day.
&SEPARATOR here=%r%r
&VERSION here=4.0
&AUTHOR here=Keran@Keranset Island
&HEAR-WEATHER-EMITS here=1
@set here=FLOATING
@set here=VISUAL
@set here=PARENT_OK
@set here=SAFE


#341 - Keran's Parent of Season-and-Day-Night Varying Outdoor Rooms

@tel #341
@Desc here=[squish([u([u(#85/season)]-[u(#85/day-night)]-desc)])][u(separator)][squish([u(weather-desc)] [switch(u(#85/day-night), night, {[switch(u(#340/moon-phase), new,, {[switch(u(#340/moon-up), 1, {[switch(u(#78/weathertype), clear, u(moon-desc), fair, u(moon-desc))]})]})]})])]%r[u(instructions)]
&UNCHANGING-DESC here=\
&SPRING-NIGHT-DESC here=This is what the place is like on a spring night.
&SUMMER-NIGHT-DESC here=This is what the place is like on a summer night.
&AUTUMN-NIGHT-DESC here=This is what the place is like on an autumn night.
&WINTER-NIGHT-DESC here=This is what the place is like on a winter night.
&SPRING-DAY-DESC here=This is what the place is like on a spring day.
&SUMMER-DAY-DESC here=This is what the place is like on a summer day.
&AUTUMN-DAY-DESC here=This is what the place is like on an autumn day.
&WINTER-DAY-DESC here=This is what the place is like on a winter day.
&WEATHER-DESC here=[u(#338/short-weather)]
&MOON-DESC here=This is the desc of the [u(#340/moon-phase)] moon.
&SEPARATOR here=%r%r
&INSTRUCTIONS here=%rHow to describe an outdoor room with seasonal and day-night variations: %r&spring-day-desc here=What the place is like during a spring day.%r&spring-night-desc here=What the place is like during a spring night.%rAnd so on. The variations are spring-day-desc, spring-night-desc, summer-day-desc, summer-night-desc, autumn-day-desc, autumn-night-desc, winter-day-desc, and winter-night-desc.%rDon't put things that are only true in specific weather conditions in the descriptions listed above; it'll look funny if you describe a blue sky and the weathermaker comes up with rain.%r&weather-desc here=\[u(#338/short-weather)\] or \[u(#338/long-weather)\]. You can also add \[u(#338/tree-weather)\] or any other environmental weather descriptions that have been written. To use the environmental effects, do something like &weather-desc here=\[u(#338/short-weather)\] \[u(#338/tree-weather)\]%r&moon-desc here=Describe the \[u(#340/moon-phase)\] moon as it shines on the scenery at night.%r&instructions here=\\%rThis last will turn off these instructions. You can suppress any other part of the description the same way, e.g.: &moon-desc here=\\%r&hear-weather-emits here=0 turns the sunrise, sunset, etc. messages from the emits bank off; setting it to 1 turns them on.%r&hear-tide-emits here = 1 turns the tide emits on; setting it to 0 turns them off.
&HEAR-WEATHER-EMITS here=1
&VERSION here=4.0
&AUTHOR here=Keran@Keranset Island
@set here=FLOATING
@set here=VISUAL
@set here=PARENT_OK
@set here=SAFE


#344 - Keran's Parent of Windowed Indoor Rooms

@tel #344
&LIGHT here=$light: @set me=light; @pemit/contents me=[u(light-action, %#)]
&LIGHTS-OUT here=$lights out: @set me=!light; @pemit/contents me=[u(lights-out-action, %#)]
&NORMAL-VISION here=[switch(hasflag(me, light), 1, [u(artificial-light-desc)], {[switch([u(#85/day-night)], day, [u(day-desc)], {[switch([u(portable-light)], 1, [u(portable-light-desc)], [u(night-desc)])]})]})]
&NIGHT-VISION here=[switch(hasflag(me, light), 1, [u(artificial-light-desc)], {[switch([u(#85/day-night)], day, [u(day-desc)], {[switch([u(portable-light)], 1, [u(portable-light-desc)], [u(night-vision-desc)])]})]})]
&DAYBLIND-VISION here=[switch(hasflag(me, light), 1, [u(dayblind-desc)], {[switch([u(#85/day-night)], day, [u(dayblind-desc)], {[switch([u(portable-light)], 1, [u(portable-light-desc)], [u(dark-vision-desc)])]})]})]
&WINDOW-PREFIX here=Outside,
&OUTSIDE-DESC here=%r%r[u(window-prefix)] [u(#338/lowercase-short-weather)]
&DAY-DESC here=This is what the room looks like by natural daylight to creatures that aren't blinded by bright light.
&DAYBLIND-DESC here=This is what the room looks like when lit to any creature blinded by bright light.
&ARTIFICIAL-LIGHT-DESC here=This is what the room looks like by electric light, firelight, etc.
&NIGHT-DESC here=This is what the room looks like to ordinary humans at night.
&NIGHT-VISION-DESC here=This is what the room looks like at night to creatures that can see in the dark.
&LIGHT-ACTION here=[name(%0)] lights the oil lamps.
&LIGHTS-OUT-ACTION here=[name(%0)] quenches the oil lamps.
&INSTRUCTIONS here=%r%rHow to describe variable lighting conditions in an indoor room with windows:%r&artificial-light-desc here=What the room looks like by firelight, electric light, etc., at any time of day. Overrides portable light and daylight.%r&portable-light-desc here=What the room looks like at night if it's lit by candle, flashlight, etc. This desc appears at night if the lights are out and there is something in the room set light, or carrying something set light.%r&day-desc here=What the room looks like by natural daylight. Overrides portable light.%r&night-desc here=What the room looks like at night with no artificial light sources.%r&dayblind-desc here=What the room looks like by natural or artificial light to creatures blinded by bright light.%r&night-vision-desc here=What the room looks like at night without artificial light to creatures that can see at night. %r&dark-vision-desc here=What the room looks like at night to creatures that can see in complete darkness. May be set to \[u(night-vision)\] if you're not trying to describe infravision or some such thing.%rThe vision type of a creature is determined by whether it has a dayblind, night-vision, or dark-vision attribute; no such attribute means normal human vision. Only one such attribute should be set on any creature.%r&window-prefix here=Some phrase that lets the viewer know that they're looking through a window, door, etc., at something outside. For example: 'Through the window, you can see that '. Used by the Storm Generator.%r&outside-desc here=A description of what the viewer sees when they look out, for example: Outside, \[u(#338/lowercase-short-weather)\]. Or Outside, \[u(#338/lowercase-long-weather)\].%r&light-action here=\[name(%%0)\] flips the light switch, lights the oil lamps, kindles a fire, or whatever.%r&lights-out-action here=\[name(%%0)\] turns off the lights, snuffs the oil lamps, douses the fire, and so on.%r@set here=commands%r'Light' turns the lights on; 'lights out' turns them off.%r&instructions here=\\ to turn these instructions off.%r&<name>-desc=\\ will turn any of the descriptions off.%rChildren of the Windowed Indoor Parent Room receive both visual and audible effects from the Storm Generator.
&DAY-NIGHT here=day
&DARK-VISION here=[switch(hasflag(me, light), 1, [u(artificial-light-desc)], {[switch([u(#85/day-night)], day, [u(day-desc)], {[switch([u(portable-light)], 1, [u(portable-light-desc)], [u(dark-vision-desc)])]})]})]
&DARK-VISION-DESC here=What the room looks like at night to creatures that can see in complete darkness.
&CARRIED-LIGHT-DESC here=What the room looks like when it's lit with a flashlight, candle, etc.
&PORTABLE-LIGHT here=[or([gt([iter(lcon(me), switch(hasflag(##, light), 1, [setq(0, add(r(0), 1))][r(0)]))], 0)], [gt(iter([iter(lcon(me), lcon(##))], switch(hasflag(##, light), 1, [setq(0, add(r(0), 1))][r(0)])), 0)])]
&PORTABLE-LIGHT-DESC here=What the room looks like when lit by candle, flashlight, torch, etc.
&VERSION here=4.0
&AUTHOR here=Keran@Keranset Island
@set here=FLOATING
@set here=VISUAL
@set here=PARENT_OK
@set here=SAFE
@set here=COMMANDS
@Desc here=[switch(u(#338/has-softflag,%#,dayblind), 1, u(dayblind-vision), {[switch(u(#338/has-softflag,%#,night-vision), 1, u(night-vision), {[switch(u(#338/has-softflag,%#,dark-vision), 1, u(dark-vision), u(normal-vision))]})]})][u(outside-desc)][u(instructions)]



#347 - Keran's Parent of Windowless Indoor Rooms

@tel #347
&LIGHT here=$light: @set me=light; @pemit/contents me=[u(light-action, %#)]
&LIGHTS-OUT here=$lights out: @set me=!light; @pemit/contents me=[u(lights-out-action, %#)]
&LIGHT-ACTION here=[name(%0)] lights the oil lamps.
&LIGHTS-OUT-ACTION here=[name(%0)] quenches the oil lamps.
&NORMAL-VISION here=[switch(hasflag(me, light), 1, [u(artificial-light-desc)], {[switch([u(portable-light)], 1, [u(portable-light-desc)], [u(dark-desc)])]})]
&NIGHT-VISION here=[switch(hasflag(me, light), 1, [u(artificial-light-desc)], {[switch([u(portable-light)], 1, [u(portable-light-desc)], [u(dark-desc)])]})]
&DAYBLIND-VISION here=[switch(hasflag(me, light), 1, [u(dayblind-desc)], {[switch([u(portable-light)], 1, [u(portable-light-desc)], [u(dark-vision-desc)])]})]
&DARK-VISION here=[switch(hasflag(me, light), 1, [u(artificial-light-desc)], {[switch([u(portable-light)], 1, [u(portable-light-desc)], [u(dark-vision-desc)])]})]
&DAYBLIND-DESC here=What the room looks like to a creature blinded by bright light when it's lit.
&ARTIFICIAL-LIGHT-DESC here=What the room looks like when it's lit.
&DARK-DESC here=What the room looks like to a creature that can't see in complete blackness when it isn't lit.
&INSTRUCTIONS here=%r%rHow to describe variable lighting conditions in an indoor room without windows:%r&artificial-light-desc here=What the room looks like by firelight, electric light, etc., at any time of day. Overrides portable light.%r&portable-light-desc here=What the room looks like at night if it's lit by candle, flashlight, etc. This desc appears if the lights are out and there is something in the room set light, or carrying something set light.%r&dark-desc here=What the room looks like when unlit to creatures that can't see in complete darkness.%r&dayblind-desc here=What the room looks like by natural or artificial light to creatures blinded by bright light.%r&dark-vision-desc here=What the room looks like at night to creatures that can see in complete darkness.%rThe vision type of a creature is determined by whether it has a dayblind, night-vision, or dark-vision attribute; no such attribute means normal human vision. Only one such attribute should be set on any creature.%r&light-action here=\[name(%%0)\] flips the light switch, lights the oil lamps, kindles a fire, or whatever.%r&lights-out-action here=\[name(%%0)\] turns off the lights, snuffs the oil lamps, douses the fire, and so on.%r@set here=commands%r'Light' turns the lights on; 'lights out' turns them off.%r&instructions here=\\ to turn these instructions off.%r&<name>-desc=\\ will turn any of the descriptions off.%rChildren of the Windowless Indoor Parent Room hear audible effects produced by the Storm Generator, but no visuals.%r
&DARK-VISION-DESC here=What the room looks like to creatures that can see in complete darkness when it's not lit.
&PORTABLE-LIGHT here=[or([gt([iter(lcon(me), switch(hasflag(##, light), 1, [setq(0, add(r(0), 1))][r(0)]))], 0)], [gt(iter([iter(lcon(me), lcon(##))], switch(hasflag(##, light), 1, [setq(0, add(r(0), 1))][r(0)])), 0)])]
&PORTABLE-LIGHT-DESC here=What the room looks like when lit by candle, flashlight, torch, etc.
&VERSION here=4.0
&AUTHOR here=Keran@Keranset Island
@set here=DARK
@set here=FLOATING
@set here=VISUAL
@set here=PARENT_OK
@set here=SAFE
@set here=COMMANDS
@Desc here=[switch(u(#338/has-softflag,%#,dayblind), 1, u(dayblind-vision), {[switch(u(#338/has-softflag,%#,night-vision), 1, u(night-vision), {[switch(u(#338/has-softflag,%#,dark-vision), 1, u(dark-vision), u(normal-vision))]})]})][u(instructions)]



#350 - Keran's Parent of Separable Day-Night-Dawn-Dusk and Season Desc Outdoor Rooms

@tel #350
@Desc here=[squish([u([u(#85/season)]-[u(#85/day-night-dawn-dusk)]-desc)])][u(separator)][squish([u(weather-desc)] [switch(u(#85/day-night), night, {[switch(u(#340/moon-phase), new,, {[switch(u(#340/moon-up), 1, {[switch(u(#78/weathertype), clear, u(moon-desc), fair, u(moon-desc))]})]})]})])]%r[u(instructions)]
&UNCHANGING-DESC here=\
&SPRING-NIGHT-DESC here=This is what the place is like on a spring night.
&SUMMER-NIGHT-DESC here=This is what the place is like on a summer night.
&AUTUMN-NIGHT-DESC here=This is what the place is like on an autumn night.
&WINTER-NIGHT-DESC here=This is what the place is like on a winter night.
&SPRING-DAY-DESC here=This is what the place is like on a spring day.
&SUMMER-DAY-DESC here=This is what the place is like on a summer day.
&AUTUMN-DAY-DESC here=This is what the place is like on an autumn day.
&WINTER-DAY-DESC here=This is what the place is like on a winter day.
&WEATHER-DESC here=[u(#338/short-weather)]
&MOON-DESC here=This is the desc of the [u(#340/moon-phase)] moon.
&SEPARATOR here=%r%r
&INSTRUCTIONS here=%rHow to describe an outdoor room with seasonal and day-night variations: %r&spring-day-desc here=What the place is like during a spring day.%r&spring-night-desc here=What the place is like during a spring night.%rAnd so on. The variations are spring-day-desc, spring-night-desc, spring-dawn-desc, spring-dusk-desc, summer-day-desc, summer-night-desc, summer-dawn-desc, summer-dusk-desc, autumn-day-desc, autumn-night-desc, autumn-dawn-desc, autumn-dusk-desc, winter-day-desc, winter-night-desc, winter-dawn-desc, and winter-dusk-desc.%rDon't put things that are only true in specific weather conditions in the descriptions listed above; it'll look funny if you describe a blue sky and the weathermaker comes up with rain.%r&weather-desc here=\[u(#338/short-weather)\] or \[u(#338/long-weather)\]. You can also add \[u(#338/tree-weather)\] or any other environmental weather descriptions that have been written. To use the environmental effects, do something like &weather-desc here=\[u(#338/short-weather)\] \[u(#338/tree-weather)\]%r&moon-desc here=Describe the \[u(#340/moon-phase)\] moon as it shines on the scenery at night.%r&instructions here=\\%rThis last will turn off these instructions. You can suppress any other part of the description the same way, e.g.: &moon-desc here=\\%r&hear-weather-emits here=0 turns the sunrise, sunset, etc. messages from the emits bank off; setting it to 1 turns them on.%r&hear-tide-emits here = 1 turns the tide emits on; setting it to 0 turns them off.
&SPRING-DAWN-DESC here=This is what the place is like on a spring dawn.
&SUMMER-DAWN-DESC here=This is what the place is like on a summer dawn.
&AUTUMN-DAWN-DESC here=This is what the place is like on an autumn dawn.
&WINTER-DAWN-DESC here=This is what the place is like on a winter dawn.
&WINTER-DUSK-DESC here=This is what the place is like on a winter dusk.
&AUTUMN-DUSK-DESC here=This is what the place is like on an autumn dusk.
&SUMMER-DUSK-DESC here=This is what the place is like on a summer dusk.
&SPRING-DUSK-DESC here=This is what the place is like on a spring dusk.
&HEAR-WEATHER-EMITS here=1
&VERSION here=4.0
&AUTHOR here=Keran@Keranset Island
@set here=FLOATING
@set here=VISUAL
@set here=PARENT_OK
@set here=SAFE


#353 - Keran's Parent of Separable Desc Outdoor Rooms

@tel #353
@Desc here=[squish([u(unchanging-desc)] [u([u(#85/day-night-dawn-dusk)]-desc)] [u([u(#85/season)]-desc)])][u(separator)][squish([u(weather-desc)] [switch(u(#85/day-night), night, {[switch(u(#340/moon-phase), new,, {[switch(u(#340/moon-up), 1, {[switch(u(#78/weathertype), clear, u(moon-desc), fair, u(moon-desc))]})]})]})])]%r[u(instructions)]
&NIGHT-DESC here=This is what the place is like by night.
&SPRING-DESC here=This is what the place is like in spring.
&SUMMER-DESC here=This is what the place is like in summer.
&WINTER-DESC here=This is what the place is like in winter.
&WEATHER-DESC here=[u(#338/short-weather)]
&UNCHANGING-DESC here=This part of the desc never changes.
&AUTUMN-DESC here=This is what the place is like in autumn.
&MOON-DESC here=This is the desc of the [u(#340/moon-phase)] moon.
&INSTRUCTIONS here=%rHow to describe an outdoor room with seasonal and weather variations: %r&unchanging-desc here=This part of the description of the place never changes.%r&night-desc here=What the place is like at night.%r&day-desc here=What the place is like by day.%r&dawn-desc here=What the place is like at dawn.&dusk-desc here=What the place is like at dusk.%r&spring-desc here=What the place is like during spring.%r&summer-desc here=What the place is like during summer.%r&autumn-desc here=What the place is like during autumn.%r&winter-desc here=What the place is like during winter.%rDon't put things that are only true in specific weather conditions in the descriptions listed above; it'll look funny if you describe a blue sky and the weathermaker comes up with rain.%r&weather-desc here=\[u(#338/short-weather)\] or \[u(#338/long-weather)\]. You can also add \[u(#338/tree-weather)\] or any other environmental weather descriptions that have been written. To use the environmental effects, do something like &weather-desc here=\[u(#338/short-weather)\] \[u(#338/tree-weather)\]%r&moon-desc here=Describe the \[u(#340/moon-phase)\] moon as it shines on the scenery at night.%r&instructions here=\\%rThis last will turn off these instructions. You can suppress any other part of the description the same way, e.g.: &moon-desc here=\\%r&hear-weather-emits here=0 turns the sunrise, sunset, etc. messages from the emits bank off; setting it to 1 turns them on.%r&hear-tide-emits here = 1 turns the tide emits on; setting it to 0 turns them off.
&DAY-DESC here=This is what the place is like by day.
&SEPARATOR here=%r%r
&VERSION here=4.0
&AUTHOR here=Keran@Keranset Island
&HEAR-WEATHER-EMITS here=1
&DAWN-DESC here=This is what the place is like at dawn.
&DUSK-DESC here=This is what the place is like at dusk.
@set here=FLOATING
@set here=VISUAL
@set here=PARENT_OK
@set here=SAFE


#356 - Keran's Parent of Weather-and-Day-Night Varying Outdoor Rooms

@tel #356
@Desc here=[squish([u([u(#78/weathertype)]-[u(#85/day-night)]-desc)] [switch(u(#85/day-night), night, {[switch(u(#340/moon-phase), new,, {[switch(u(#340/moon-up), 1, {[switch(u(#78/weathertype), clear, u(moon-desc), fair, u(moon-desc))]})]})]})])]%r[u(instructions)]
&NIGHT-DESC here=This is what the place is like by night.
&SPRING-DESC here=This is what the place is like in spring.
&SUMMER-DESC here=This is what the place is like in summer.
&WINTER-DESC here=This is what the place is like in winter.
&WEATHER-DESC here=[u(#338/short-weather)]
&UNCHANGING-DESC here=This part of the desc never changes.
&AUTUMN-DESC here=This is what the place is like in autumn.
&MOON-DESC here=This is the desc of the [u(#340/moon-phase)] moon.
&INSTRUCTIONS here=%rHow to describe an outdoor room with weather and day-night variations: %r&clear-day-desc here=What the place is like on a clear day.%r&clear-night-desc here=What the place is like on a clear night.%r&fair-day-desc here=What the place is like on a fair day.%r&fair-night-desc here=What the place is like on a fair night.%rEtc. The weathertypes are clear, fair, overcast, rain, fog, stormy, lightsnow, sleet, and blizzard.%r&moon-desc here=Describe the \[u(#340/moon-phase)\] moon as it shines on the scenery at night.%r&instructions here=\\%rThis last will turn off these instructions. You can suppress any other part of the description the same way, e.g.: &moon-desc here=\\%r&hear-weather-emits here=0 turns the sunrise, sunset, etc. messages from the emits bank off; setting it to 1 turns them on.%r&hear-tide-emits here = 1 turns the tide emits on; setting it to 0 turns them off.
&DAY-DESC here=This is what the place is like by day.
&SEPARATOR here=%r%r
&VERSION here=4.0
&AUTHOR here=Keran@Keranset Island
&HEAR-WEATHER-EMITS here=1
&CLEAR-DAY-DESC here=What the place looks like on a clear day.
&CLEAR-NIGHT-DESC here=What the place looks like on a clear night.
&FAIR-NIGHT-DESC here=What the place looks like on a fair night.
&FAIR-DAY-DESC here=What the place looks like on a fair day.
&OVERCAST-DAY-DESC here=What the place looks like on an overcast day.
&OVERCAST-NIGHT-DESC here=What the place looks like on an overcast night.
&RAIN-NIGHT-DESC here=What the place looks like on a rainy night.
&RAIN-DAY-DESC here=What the place looks like on a rainy day.
&STORMY-DAY-DESC here=What the place looks like on a stormy day.
&STORMY-NIGHT-DESC here=What the place looks like on a stormy night.
&FOG-NIGHT-DESC here=What the place looks like on a foggy night.
&FOG-DAY-DESC here=What the place looks like on a foggy day.
&SLEET-DAY-DESC here=What the place looks like on a sleety day.
&SLEET-NIGHT-DESC here=What the place looks like on a sleety night.
&LIGHTSNOW-NIGHT-DESC here=What the place looks like on a night with light snow.
&LIGHTSNOW-DAY-DESC here=What the place looks like on a day with light snow.
&BLIZZARD-DAY-DESC here=What the place looks like on a day with a blizzard.
&BLIZZARD-NIGHT-DESC here=What the place looks like on a night with a blizzard.
@set here=FLOATING
@set here=VISUAL
@set here=PARENT_OK
@set here=SAFE


#359 - Keran's Grandparent of Windowed Indoor Rooms

@tel #359
@Desc here=Descendants of this room are indoors and have outside views.
@set here=FLOATING
@set here=VISUAL
@set here=PARENT_OK
@set here=SAFE


#362 - Keran's Grandparent of Windowless Indoor Rooms

@tel #362
@Desc here=Descendants of this room are indoors and have no view of outside.
@set here=FLOATING
@set here=VISUAL
@set here=PARENT_OK
@set here=SAFE


#367 - Keran's Grandparent of Outdoor Rooms

@tel #367
@Desc here=Descendants of this room are outdoors.
@set here=FLOATING
@set here=VISUAL
@set here=PARENT_OK
@set here=SAFE


#370 - Keran's Great-grandparent of Rooms

@tel #370
@Desc here=Descendants of this room are IC.
@set here=FLOATING
@set here=VISUAL
@set here=PARENT_OK
@set here=SAFE


#373 - Keran's Test Room

@tel #373
&HEAR-WEATHER-EMITS here=1
&HEAR-TIDE-EMITS here=1
&INSTRUCTIONS here=\
@Desc here=It's [u(#85/time-of-day)]. The weather is [u(#78/weathertype)]. The season is [u(#85/season)].
&TRIGGER-AT-EVERY~HOUR here=@pemit/contents me=@Emitted every hour.
&TRIGGER-AT-EVERY~HALFHOUR here=@pemit/contents me=@Emitted every halfhour.
&TRIGGER-AT-EVERY~QUARTERHOUR here=@pemit/contents me=@Emitted every quarterhour.
&TRIGGER-AT-DAWN here=@pemit/contents me=@Emitted at dawn.
&TRIGGER-AT-SUNRISE here=@pemit/contents me=@Emitted at sunrise.
&TRIGGER-AT-MORNING here=@pemit/contents me=@Emitted at morning.
&TRIGGER-AT-NOON here=@pemit/contents me=@Emitted at noon.
&TRIGGER-AT-AFTERNOON here=@pemit/contents me=@Emitted at afternoon.
&TRIGGER-AT-DUSK here=@pemit/contents me=@Emitted at dusk.
&TRIGGER-AT-SUNSET here=@pemit/contents me=@Emitted at sunset.
&TRIGGER-AT-NIGHT here=@pemit/contents me=@Emitted at night.
&TRIGGER-AT-MIDNIGHT here=@pemit/contents me=@Emitted at midnight.
&TRIGGER-AT-AFTER~MIDNIGHT here=@pemit/contents me=@Emitted at after~midnight.
&TRIGGER-AT-MOONRISE here=@pemit/contents me=@Emitted at moonrise.
&TRIGGER-AT-MOONSET here=@pemit/contents me=@Emitted at moonset.
&TRIGGER-AT-MERIDIAN~TRANSIT here=@pemit/contents me=@Emitted at meridian~transit.
&TRIGGER-AT-0 here=@pemit/contents me=@Emitted at 0.
&TRIGGER-AT-1 here=@pemit/contents me=@Emitted at 1.
&TRIGGER-AT-2 here=@pemit/contents me=@Emitted at 2.
&TRIGGER-AT-3 here=@pemit/contents me=@Emitted at 3.
&TRIGGER-AT-4 here=@pemit/contents me=@Emitted at 4.
&TRIGGER-AT-5 here=@pemit/contents me=@Emitted at 5.
&TRIGGER-AT-6 here=@pemit/contents me=@Emitted at 6.
&TRIGGER-AT-7 here=@pemit/contents me=@Emitted at 7.
&TRIGGER-AT-8 here=@pemit/contents me=@Emitted at 8.
&TRIGGER-AT-9 here=@pemit/contents me=@Emitted at 9.
&TRIGGER-AT-10 here=@pemit/contents me=@Emitted at 10.
&TRIGGER-AT-11 here=@pemit/contents me=@Emitted at 11.
&TRIGGER-AT-12 here=@pemit/contents me=@Emitted at 12.
&TRIGGER-AT-13 here=@pemit/contents me=@Emitted at 13.
&TRIGGER-AT-14 here=@pemit/contents me=@Emitted at 14.
&TRIGGER-AT-15 here=@pemit/contents me=@Emitted at 15.
&TRIGGER-AT-16 here=@pemit/contents me=@Emitted at 16.
&TRIGGER-AT-17 here=@pemit/contents me=@Emitted at 17.
&TRIGGER-AT-18 here=@pemit/contents me=@Emitted at 18.
&TRIGGER-AT-19 here=@pemit/contents me=@Emitted at 19.
&TRIGGER-AT-20 here=@pemit/contents me=@Emitted at 20.
&TRIGGER-AT-21 here=@pemit/contents me=@Emitted at 21.
&TRIGGER-AT-22 here=@pemit/contents me=@Emitted at 22.
&TRIGGER-AT-23 here=@pemit/contents me=@Emitted at 23.
&TRIGGER-AT-HIGH~AND~RISING here=@pemit/contents me=@Emitted at high and rising.
&TRIGGER-AT-HIGH~AND~SLACK here=@pemit/contents me=@Emitted at high and slack.
&TRIGGER-AT-HIGH~AND~EBBING here=@pemit/contents me=@Emitted at high and ebbing.
&TRIGGER-AT-LOW~AND~EBBING here=@pemit/contents me=@Emitted at low and ebbing.
&TRIGGER-AT-LOW~AND~SLACK here=@pemit/contents me=@Emitted at low and slack.
&TRIGGER-AT-LOW~AND~RISING here=@pemit/contents me=@Emitted at low and rising.
@set here=FLOATING
@set here=SAFE











