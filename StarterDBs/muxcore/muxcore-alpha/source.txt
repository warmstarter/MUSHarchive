@@
@@ Initial setup. Locking #1, create the Master Room, set up base Wizards.
@@
@set me=QUIET
think [repeat(=,77)]%r%r[center(ansi(hc,Setting up MUX Core 1.0 Alpha),77)]%r%r[repeat(=,77)]
think [ansi(hc,MUX Core:)] Performing initial setup. Creating the Master Room and basic Wizards.
@lock/use me=me
@lock/enter me=me
@dig Master Room
@set #2=FLOATING
@pcreate CodeWIZ=potrzebie
@pcreate BuildWIZ=potrzebie
@set #3=WIZARD ANSI !UNINSPECTED
@set #4=WIZARD ANSI !UNINSPECTED
@chown here=#4
@set here=!HALTED
@tel #2
@chown here=#4
@set here=!HALTED
@@
@@ #5: <GF> Global Functions
@@
think [ansi(hc,MUX Core:)] Creating the Global Functions Object.
@create <GF> Global Functions=5
@startup <GF> Global Functions=@dolist lattr(me/FN.*)=@function after(##,FN.)=me/##;@dolist lattr(me/FPRIV.*)=@function/privileged after(##,FPRIV.)=me/##
&FN.ISSTAFF <GF> Global Functions=orflags(%0,WZ)
&FN.ISMEMBER <GF> Global Functions=t(grab(%0,%1,%2))
&FN.PARTIAL <GF> Global Functions=localize(ifelse(setr(0,grab(%0,%1*,%2)),%q0,0))
&FN.ISPOSINT <GF> Global Functions=and(gt(%0,0),regmatch(%0,^\[0-9\]*$))
&FN.ROLLXDY <GF> Global Functions=case(0,isposint(%0),#-1 INVALID NUMBER OF DICE,lte(%0,v(D.MAXDICE)),#-2 NUMBER OF DICE MUST BE 1-[v(D.MAXDICE)],and(lte(%1,v(D.MAXFACES)),isposint(%1)),#-3 NUMBER OF FACES MUST BE 1-[v(D.MAXFACES)],iter(lnum(%0),die(1,%1)))
&FN.HEADER <GF> Global Functions=%xh%xx[switch(%0,,repeat(-+-,26),cpad(%xh%xx%[ %xn%xh%0%xx %],78,%xh%xx-+-))]
&FN.FOOTER <GF> Global Functions=%xh%xx[switch(%0,,repeat(-+-,26),[repeat(-+-,17)][cpad(%xh%xx%[ %xn%xh%0%xx %],27,%xh%xx-+-)])]%r
&FN.CAPALL <GF> Global Functions=[edit(edit(edit(iter(lcstr(%0),capstr(##)),%bOf%b,%bof%b),%bThe%b,%bthe%b),%bAnd%b,%band%b)]
&FN.SUBHEADER <GF> Global Functions=%xh%xx[switch(%0,,repeat(-,78),cpad(%b%xh%0%xn%b,78,%xh%xx-))]
&FN.ALERT <GF> Global Functions=%xh%xx%1%xn%xw%1%xh%xw%1 %0
&FPRIV.TAGS <GF> Global Functions=localize(ifelse(isstaff(owner(%@)),case(setr(0,locate(%#,%0,*)),#-1,#-1 NOT FOUND,get(%q0/_TAGS)),Permission denied.))
&FPRIV.HASTAG <GF> Global Functions=localize(ifelse(isstaff(owner(%@)),case(setr(0,locate(%#,%0,*)),#-1,#-1 NOT FOUND,ismember(tags(%q0),lcstr(%1))),Permission denied.))
&FPRIV.ANDTAGS <GF> Global Functions=localize(ifelse(isstaff(owner(%@)),case(setr(0,locate(%#,%0,*)),#-1,#-1 NOT FOUND,eq(words(setinter(tags(%q0),lcstr(%1))),words(%1))),Permission denied.))
&FPRIV.ORTAGS <GF> Global Functions=localize(ifelse(isstaff(owner(%@)),case(setr(0,locate(%#,%0,*)),#-1,#-1 NOT FOUND,gt(words(setinter(tags(%q0),lcstr(%1))),0)),Permission denied.))
&D.MAXDICE <GF> Global Functions=30
&D.MAXFACES <GF> Global Functions=100
&D.TAGLIST.PLAYER <GF> Global Functions=vampire
&D.MUXCORE.VERSION <GF> Global Functions=1.0 Alpha
@chown <GF> Global Functions=#3
@set <GF> Global Functions=!HALTED INHERIT SAFE
@tr #5/startup
@@
@@ #6: <PG> Player Globals
@@ 
think [ansi(hc,MUX Core:)] Setting up player globals.
@create <PG> Player Globals=5
&CMD.FINGER <PG> Player Globals=$+finger *:@switch [isdbref(setr(0,ifelse(strmatch(%0,me),%#,pmatch(%0))))]=0,{@pemit %#=No such player.},{@pemit %#=[header([name(%q0)] (%q0)[if(isstaff(%#),%b[flags(%q0)])])]%r[ljust(%xhAlias:%xn [get(%q0/ALIAS)][case(1,hasflag(%q0,WIZARD),%b(Wizard),hasflag(%q0,ROYALTY),%b(Staff))],39)]%xh%xx|%xn[ljust(switch([hasflag(%q0,CONNECTED)][hasflag(%q0,DARK)][isstaff(%q0)][isstaff(%#)][hasattr(%q0,DARK-TIME)],0*,%xhLast On: %xn[first(get(%q0/LAST),.)],11101,%xhLast On: %xn[first(get(%q0/DARK-TIME),.)],11100,%xhLast On: %xn[first(get(%q0/last),.)],%xhOn For: %b%xn[singletime(conn(%q0))]%b%b%xhIdle: %xn[singletime(idle(%q0))]),39)]%r[ljust(%xhSex:%xn %b%b[get(%q0/SEX)],39)]%xh%xx|%xn[ljust(%xhMail:%xn[space(4)][extract(setr(1,mail(%q0)),2,1)] Unread / [add(extract(%q1,1,1),extract(%q1,3,1))] Total,39)]%r[ljust(%xhEmail:%xn [get(%q0/EMAIL)],39)]%xh%xx|%xn%r%xh%xx[subheader()]%xn%r[iter(cat(setinter(iter(v(D.FINGER-LIST),first(%i0,:),|),lcstr(lattr(%q0))),lcstr(lattr(%q0/FINGER-*))),%xh[rjust([ifelse(ismember(v(D.FINGER-LIST),%i0:*,|),rest(grab(v(D.FINGER-LIST),%i0:*,|),:),capall(edit(rest(%i0,finger-),_,%b)))]:,12)]%xn%b[wrap(get(%q0/%i0),65,,,,13)],,%r)]%r[if(isstaff(%#),[subheader()]%r%xhLast IP: %b%b%xn[get(%q0/LASTIP)]%r%xhLast Site: %xn[get(%q0/LASTSITE)]%r)][footer()]}
&D.FINGER-LIST <PG> Player Globals=fullname:Full Name|age:Age|app-age:Apparent Age|position:Position|fame:Fame|rp-prefs:RP-Prefs|alts:Alts|themesong:Theme Song|quote:Quote|hours:Hours|temperament:Temperament|vacation:Vacation|url:URL|wiki:Wiki Page
&CMD.STAFF <PG> Player Globals=$+staff:@pemit %#=[header(Online Staff)]%r%xh[ljust(Name,14)][ljust(Alias,6)][ljust(Position,35)][ljust(Status,10)][ljust(Idle,6)]%r[subheader()]%r[iter(setinter(objeval(%#,lwho()),get(#8/D.STAFFLIST)),[ljust(name(%i0),13)]%b[ljust(get(%i0/ALIAS),5)]%b[ljust(get(%i0/POSITION),33)]%b%b[ljust(if(and(isstaff(%#),hasflag(%i0,DARK)),DARK,if(hasflag(%i0,transparent),Off Duty,On Duty)),9)]%b[singletime(idle(%i0))],|,%r)]%r[footer()]
&CMD.STAFF/ALL <PG> Player Globals=$+staff/all:@pemit %#=[setq(0,cat(setinter(objeval(%#,lwho()),get(#8/D.STAFFLIST)),setdiff(get(#8/D.STAFFLIST),objeval(%#,lwho()))))][header(Staff List)]%r%xh[ljust(Name,14)][ljust(Alias,7)][ljust(Position,35)][ljust(Last,10)]%r[subheader()]%r[iter(%q0,[ljust(name(%i0),13)]%b[ljust(get(%i0/ALIAS),6)]%b[ljust(get(%i0/POSITION),33)]%b%b[switch([hasflag(%i0,CONNECTED)][hasflag(%i0,DARK)][isstaff(%i0)][isstaff(%#)][hasattr(%i0,DARK-TIME)],0*,first(get(%i0/last),.),11101,first(get(%i0/dark-time),.),11100,first(get(%i0/last),.),Connected)],,%r)]%r[footer()]
&CMD.UPTIME <PG> Player Globals=$+uptime:@pemit %#=[mudname()] runtime stats:%r%tMUSH boot time.......: [starttime()]%r%tCurrent time.........: [time()]%r%tIn operation for.....: [div(sub(convtime(time()),convtime(starttime())),86400)] days, [div(mod(sub(convtime(time()),convtime(starttime())),86400),3600)] hours, [div(mod(sub(convtime(time()),convtime(starttime())),3600),60)] minutes, [mod(sub(convtime(time()),convtime(starttime())),60)] seconds.
&CMD.PLUSWHO <PG> Player Globals=$+who:@pemit %#=[header(Online Players)]%r%xh%b[ljust(Player,14)][ljust(Sex,4)][ljust(Alias,7)][ljust(Idle,8)][ljust(Status,8)]Location%r[subheader()];@pemit %#=[list(objeval(%#,lwho()),[if(isstaff(%i0),%xh%xr*%xn,%b)][ljust(name(%i0),14)][ljust(switch(get(%i0/SEX),F*,F,M*,M,N),4)][ljust(get(%i0/ALIAS),7)][ljust(singletime(idle(%i0)),8)][ljust(get(%i0/D.IC-STATUS),8)][ljust(ifelse(isstaff(%#),name(loc(%i0)),ifelse(or(hasflag(%i0,UNFINDABLE),hasflag(loc(%i0),UNFINDABLE)),Unfindable,name(loc(%i0)))),38)])];@pemit %#=[subheader()]%r[setq(0,words(objeval(%#,lcon())))][center(There [if(gt(%q0,1),are,is)] %q0 player[if(gt(%q0,1),s)] online.,78)]%r[footer()]
&CMD.3WHO <PG> Player Globals=$+3who:@pemit %#=[setq(1,iter(lnum(add(div(words(setr(0,objeval(%#,lwho()))),3),1)),extract(%q0,add(1,mul(sub(inum(),1),3)),3),,|))][header(Online Players)]%r%b[repeat(|NAME[space(9)]On for Idle,3)]|%r%b|----------- ------- ----|----------- ------- ----|----------- ------- ----|;@pemit %#=[list(%q1,%b|[case(words(%i0),3,[ljust(name(first(%i0)),14)]%b[rjust(singletime(conn(first(%i0))),4)]%b[rjust(singletime(idle(first(%0))),4)]|[ljust(name(first(rest(%i0))),14)]%b[rjust(singletime(conn(first(rest(%i0)))),4)]%b[rjust(singletime(idle(first(rest(%0)))),4)]|[ljust(name(last(%i0)),14)]%b[rjust(singletime(conn(last(%i0))),4)]%b[rjust(singletime(idle(last(%0))),4)]|,2,[ljust(name(first(%i0)),14)]%b[rjust(singletime(conn(first(%i0))),4)]%b[rjust(singletime(idle(first(%0))),4)]|[ljust(name(first(rest(%i0))),14)]%b[rjust(singletime(conn(first(rest(%i0)))),4)]%b[rjust(singletime(idle(first(rest(%0)))),4)]|[space(24)]|,[ljust(name(first(%i0)),14)]%b[rjust(singletime(conn(first(%i0))),4)]%b[rjust(singletime(idle(first(%0))),4)]|[space(24)]|[space(24)]|)],|)];@pemit %#=[subheader()]%r[center(There [if(gt(words(%q1),1),are,is)] [words(%q1)] player[if(gt(words(%q1),1),s)] online.,78)]%r[footer()]
&CMD.WHERE <PG> Player Globals=$+where:@pemit %#=[setq(u,regraball(iter(objeval(%#,lwho()),if(or(hasflag(%i0,UNFINDABLE),hasflag(loc(%i0),UNFINDABLE)),%i0)),.+))][setq(f,setdiff(objeval(%#,lwho()),%qu))][setq(l,sortby(me/SORTBY.WHERE,setunion(iter(ifelse(isstaff(%#),%qu %qf,%qf),loc(%i0)),)))][header(+Where)];@pemit %#=[list(%ql,[ifelse(or(isstaff(%#),and(hasflag(%i0,JUMP_OK),elock(%i0/TPORTLOCK,%#))),[ljust([name(%i0)](%i0),40,.)],[ljust(name(%i0),40,.)])]%b[wrap(itemize(iter(setinter(lcon(%i0),ifelse(isstaff(%#),%qu %qf,%qf)),[name(%i0)][if(ismember(%qu,%i0),*)],,|),|),37,,,,41)])];@if and(not(isstaff(%#)),%qu)={@pemit %#=[rjust(UNFINDABLE,40,.)]%b[wrap(itemize(iter(%qu,name(%i0),,|),|),37,,,,41)]};@wait 0={@pemit %#=[if(and(isstaff(%#),t(%qu)),%r%b%b'*' denotes an Unfindable player.%r)][footer()]}
&SORTBY.WHERE <PG> Player Globals=comp(name(%0),name(%1))
&CMD.JNOTES <PG> Player Globals=$+jnotes *:@switch [strmatch(%0,*/*)][or(strmatch(%#,pmatch(%0)),strmatch(%0,me))]=01,{@if [setq(0,%#)][t(setr(2,regraball(iter(lattr(%q0/jnote-*),ifelse(hasflag(%#/%i0,hidden),,%i0)),.+)))]={@pemit %#=[header(Judgenotes for [name(%q0)])]%r[space(3)]#[space(3)]Title[space(32)]Approval%r[subheader()]%r[iter(%q2,%b%b[rjust(inum(),2)]:%b%b[ljust(capall(rest(%i0,-)),35)]%b%b[ljust(first(first(get(%#/%i0),|),%(),32)],,%r)]%r[footer()]},{@pemit %#=You have no visible judgenotes.}},00,{@switch [isstaff(%#)][switch(1,isdbref(pmatch(%0)),1[setq(0,pmatch(%0))],isdbref(locate(%#,%0,*)),1[setq(0,locate(%#,%0,*))],0)][t(attrcnt(%q0/JNOTE-*))]=0*,{@pemit %#=You may only check your own judgenotes.},10*,{@pemit %#=No matches: %0},110,{@pemit %#=No judgenotes for [name(%q0)].},111,{@pemit %#=[header(Judgenotes for [name(%q0)])]%r*%b%b#[space(3)]Title[space(32)]Approval%r[subheader()]%r[iter(lattr(%q0/jnote-*),[ljust(if(hasflag(%q0/%i0,hidden),ansi(hr,*)),2)][rjust(inum(),2)]:%b%b[ljust(capall(rest(%i0,-)),35)]%b%b[ljust(first(first(get(%q0/%i0),|),%(),30)],,%r)]%r[footer()]}}
&CMD.JNOTE/PITCH <PG> Player Globals=$+jnote/pitch *=*:@switch [setq(0,edit(secure(%0),%b,_))][not(strmatch(%0,*/*))][not(hasattr(%#,JNOTE-%q0))]=10,{@pemit %#=You already have a note by that name.},11,{&JNOTE-%q0 %#=Proposed by [name(%#)] (%#), [time()]|%1;@lock %#/JNOTE-%q0;@trigger #23/TRIG_CREATE=%#,locate(%vj,JNOTE,i),1,[strtrunc(%0,30)],%r%t[name(%#)] has proposed the following jnote:%r%r"[strtrunc(%1,6000)]"%r%r%tApproving or Completing this job will automatically approve the jnote. Denying this job will notify the character and remove the note from their character object.;@pemit %#=Your note has been proposed. Please see +myjobs for follow-up info, or to add additional details. Please allow time for staff to process your job.},{@@}
&CMD.JNOTE/PITCH-OBJ <PG> Player Globals=$+jnote/pitch */*=*:@switch [setq(0,edit(secure(%1),%b,_))][isdbref(setr(1,locate(%#,%0,*)))][controls(%#,%q1)][not(hasattr(%q1,JNOTE-%q0))]=0*,{@pemit %#=No match, or too many matches. Please be more specific.},10*,{@pemit %#=You do not control [name(%q1)].},110,{@pemit %#=[name(%q1)] already have a note by that name.},111,{&JNOTE-%q0 %q1=Proposed by [name(%#)] (%#), [time()]|%1;@lock %q1/JNOTE-%q0;@trigger #23/TRIG_CREATE=%q1,locate(%vj,JNOTE,i),1,[strtrunc(%1,30)],%r%t[name(%#)] has proposed the following jnote:%r%r"[strtrunc(%1,6000)]" for [name(%q1)](%q1):%r%r%tApproving or Completing this job will automatically approve the jnote. Denying this job will notify the character and remove the note from their character object.,%q1 %#;@pemit %#=Your note has been proposed. Please see +myjobs for follow-up info, or to add additional details. Please allow time for staff to process your job.}
&CMD.JNOTES-ARG <PG> Player Globals=$+jnotes */*:@switch [or(strmatch(%#,pmatch(%0)),strmatch(%0,me))]=1,{@if [setq(j,ifelse(isnum(%1),extract(lattr(%#/JNOTE-*),%1,1),JNOTE-[edit(secure(%1),%b,_)]))][setq(0,%#)][or(and(hasattr(%#,%qj),not(hasflag(%#/%qj,hidden))),and(hasattr(%#,%qj),isstaff(%#)))]={@pemit %#=[header(Judgenote: [capall(rest(%qj,-))])]%r[if(isstaff(%#),Type: [ifelse(hasflag(%#/%qj,hidden),Hidden,Visible)]%r)]Approval: [first(get(%#/%qj),|)]%r%b%b[rest(get(%#/%qj),|)]%r[footer()]},{@pemit %#=You have no visible judgenote by that [ifelse(isnum(%1),number,name)].}},{@switch [isstaff(%#)][switch(1,isdbref(pmatch(%0)),1[setq(0,pmatch(%0))],isdbref(locate(%#,%0,*)),1[setq(0,locate(%#,%0,*))],0)][setq(j,ifelse(isnum(%1),extract(lattr(%q0/JNOTE-*),%1,1),JNOTE-[edit(secure(%1),%b,_)]))][hasattr(%q0,%qj)]=0*,{@pemit %#=You may only check your own judgenotes.},10*,{@pemit %#=No matches: %0},110,{@pemit %#=No judgenote '%1' for [name(%q0)].},111,{@pemit %#=[header(Judgenote: [name(%q0)]/[capall(rest(%qj,-))])]%rType: [ifelse(hasflag(%q0/%qj,hidden),Hidden,Visible)]%rApproval: [first(get(%q0/%qj),|)]%r%b%b[rest(get(%q0/%qj),|)]%r[footer()]}}
&CMD.JNOTE/SHOW <PG> Player Globals=$+jnote/show * to *:@switch [setq(j,ifelse(isnum(%1),extract(lattr(%#/JNOTE-*),%1,1),JNOTE-[edit(secure(%0),%b,_)]))][and(hasattr(%#,%qj),not(hasflag(%#/%qj,hidden)),strmatch(get(%#/%qj),Approved*))]=0,{@pemit %#=You have no approved, visible jnote by that [ifelse(isnum(%0),number,name)].},1,{@dolist/delim , %1={@if [isdbref(setr(0,pmatch(##)))]={@tr me/TR.JUDGE=%q0,[name(%#)] shows you %p "[rest(%qj,-)]" jnote. Verification: [setr(1,mid(sha1(%# [secs(,6)]),0,5))].;@pemit %q0=[header(Judgenote: [name(%#)]/[capall(rest(%qj,-))] (%q1))]%rApproval: [first(get(%#/%qj),|)]%r%b%b[rest(get(%#/%qj),|)]%r[footer()]},{@pemit %#=No such player: ##}};@pemit %#=Done. You show your %0 jnote to [itemize(%1,\,)].}
&CMD.VERIFY <PG> Player Globals=$+verify:@switch [hasattr(%#,_JUDGE)]=0,{@pemit %#=You currently have no verification data on your character.},{@pemit %#=[header(Last 20 Verification Items)]%r[iter(revwords(get(%#/_JUDGE),|),[convsecs(first(%i0,:))]: [wrap(rest(%i0,:),53,,,,26)],|,%r)]%r[footer()]}
&CMD.BGADD <PG> Player Globals=$+bgadd *=*:@switch [not(hasattr(%#,D.APPROVAL))][isnum(%0)]=0*,{@pemit %#=You may not make changes to your background, as it is currently [lcstr(first(get(%#/D.APPROVAL)))].},10,{@pemit %#=Invalid section number.},11,{&D.BG.%0 %#=[strcat(get(%#/D.BG.%0),%1)];@pemit %#=[get(%#/D.BG.%0)]}
&CMD.BGCLEAR <PG> Player Globals=$+bgclear *:@switch [not(hasattr(%#,D.APPROVAL))][and(isnum(%0),hasattr(%#,D.BG.%0))]=0*,{@pemit %#=You may not make changes to your background, as it is currently [lcstr(first(get(%#/D.APPROVAL)))].},10,{@pemit %#=Invalid section number.},11,{&D.BG.%0 %#;@pemit %#=Background section %0 cleared.}
&CMD.BGLIST <PG> Player Globals=$+bglist:@switch [t(lattr(%#/D.BG.*))]=0,{@pemit %#=You have no background sections set.},{@pemit %#=Background sections: [iter(lattr(%#/D.BG.*),last(%i0,.))]}
&CMD.BGEDIT <PG> Player Globals=$+bgedit *=*/*:@switch [not(hasattr(%#,D.APPROVAL))][and(isnum(%0),hasattr(%#,D.BG.%0))]=0*,{@pemit %#=You may not make changes to your background, as it is currently [lcstr(first(get(%#/D.APPROVAL)))].},10,{@pemit %#=Invalid section number.},11,{@edit %#/D.BG.%0=%1,%2;@pemit %#=[get(%#/D.BG.%0)]}
&CMD.BG <PG> Player Globals=$+bg *:@switch [not(strmatch(%0,*/*))][and(isnum(%0),hasattr(%#,D.BG.%0))]=10,{@pemit %#=Invalid section number.},{@pemit %#=[header(Background Section %0 of [words(lattr(%#/D.BG.*))])]%r[get_eval(%#/D.BG.%0)]%r[footer()]}
&CMD.BGSUBMIT <PG> Player Globals=$+bgsubmit:@switch [t(setr(0,lattr(%#/D.BG.*)))]=0,{@pemit %#=You must have at least one background section set to submit your background.},{@dolist %q0={@lock %#/##};&D.APPROVAL %#=Submitted for approval on [time()];@lock %#/D.APPROVAL;@tr #23/TRIG_CREATE=%#,locate(%vj,APPS,i),,BG For [name(%#)],%r%t[name(%#)] has submitted [words(%q0)] background sections for approval. They will not be able to edit their background while it is submitted for approval. Completing or approving this job will finalize their approval and set their D.APPROVAL attribute. Denying this job will unlock their background sections and allow them to continue editing.;@pemit %#=Done. Your background has been submitted for approval. Please allow time for staff to process your request. In the mean time, you may see +myjobs for followup details on your approval.}
&CMD.LOCK <PG> Player Globals=$lock *:@switch/first [setr(e,locate(%#,%0,e))]|[isdbref(setr(z,zone(%qe)))][u(%qz/FN.CANLOCK,%#,%qe)]=#-1|*,{@pemit %#=No such exit: %0},#-2|*,{@pemit %#=Too many matches. Please be more specific.},*|0*,{@pemit %#=That exit is not part of a building project.},*|10,{@pemit %#=You do not have a key.},*|11,{@lock %qe=LOCK/1;@pemit %#=You lock [name(%qe)].;@oemit %#=%N locks [name(%qe)].;@lock [setr(1,regrab(iter(lexits(loc(%qe)),if(strmatch(where(%qe),loc(%i0)),%i0)),.+))]=LOCK/1;@remit [where(%q1)]=Someone locks [name(%q1)] from the other side.}
&CMD.UNLOCK <PG> Player Globals=$unlock *:@switch/first [setr(e,locate(%#,%0,e))]|[isdbref(setr(z,zone(%qe)))][u(%qz/FN.CANLOCK,%#,%qe)]=#-1|*,{@pemit %#=No such exit: %0},#-2|*,{@pemit %#=Too many matches. Please be more specific.},*|0*,{@pemit %#=That exit is not part of a building project.},*|10,{@pemit %#=You do not have a key.},*|11,{@unlock %qe;@pemit %#=You unlock [name(%qe)].;@oemit %#=%N unlocks [name(%qe)].;@unlock [setr(1,regrab(iter(lexits(loc(%qe)),if(strmatch(where(%qe),loc(%i0)),%i0)),.+))];@remit [where(%q1)]=Someone unlocks [name(%q1)] from the other side.}
&CMD.BREQUEST <PG> Player Globals=$+brequest *=*:@switch [not(hasflag(%#,SUSPECT))][not(t(locate(%vb,ZMO: %0,i)))]=0*,{@pemit %#=You cannot access the build request system at this time.},10,{@pemit %#=Name is already in use. Please be more specific, ie: %N's House.},11,{@tr #23/TRIG_CREATE=%#,locate(%vj,BUILD,i),1,[strtrunc(%0,30)],%r%t[name(%#)] has proposed the following build project:%r%r"[strtrunc(%1,6000)]"%r%r%tApproving or Completing this job will automatically advance the project to the next stage. Denying this job will notify the character and destroy the project. Please use the +build system to set up the project as needed.,,,1;@pemit %#=Your project has been proposed. Please see +myjobs for follow-up info, or to add additional details. Please allow time for staff to process your job.}
&CMD.BUILDCHECK <PG> Player Globals=$+buildcheck:@switch [haspower(%#,BUILDER)][isdbref(zone(%#))]=0*,{@pemit %#=Only builders can use this command.},10,{@pemit %#=You do not currently have a build in progress.},11,{@pemit %#=[header(Building Check: [rest(name(zone(%#)),:%b)])][null(iter(search(%#),[setq(1,case(type(%i0),EXIT,e,THING,t,ROOM,r))][setq(%q1,setunion(r(%q1),%i0))]))];@if %qr={@pemit %#=[subheader(Rooms)];@pemit %#=[list(%qr,[rjust(inum(),2)]: [name(%i0)](%i0)%r[space(4)]Desc: [ifelse(strlen(get(%i0/desc)),Set,Not Set)])]};@if %qe={@pemit %#=[subheader(Exits)];@pemit %#=[list(%qe,[rjust(inum(),2)]: [name(%i0)](%i0)%r[space(4)]Desc: [ifelse(strlen(get(%i0/DESC)),Set,Not Set)]%tSucc: [ifelse(strlen(get(%i0/SUCC)),Set,Not Set)]%tOsucc: [ifelse(strlen(get(%i0/OSUCC)),Set,Not Set)]%tOdrop: [ifelse(strlen(get(%i0/ODROP)),Set,Not Set)])]};@if %qt={@pemit %#=[subheader(Objects)];@pemit %#=[list(%qt,[rjust(inum(),2)]: [name(%i0)](%i0))]};@wait 0={@pemit %#=[footer()]}}
&CMD.BUILD/SUBMIT <PG> Player Globals=$+build/submit:@switch [haspower(%#,BUILDER)][isdbref(zone(%#))]=0*,{@pemit %#=Only builders can use this command.},10,{@pemit %#=You do not currently have a build in progress.},11,{@tr #23/TRIG_CREATE=%#,locate(%vj,BUILD,i),1,Approval Requested,%r%t[name(%#)] has completed their building project and requested approval. Approving or Completing this job will automatically advance the project to Live status and link the exits in the IC Loc set on the build project. Denying this job will notify the character and leave the build set as In Progress. Please use the +build system to set up the project as needed.;@pemit %#=Your project has been proposed. Please see +myjobs for follow-up info, or to add additional details. Please allow time for staff to process your job.}
&CMD.VIEW <PG> Player Globals=$+view:@pemit %#=[switch(words(lattr(loc(%#)/view-*)),0,There are no views set on your location.,The following views are set on your location:%r[iter(lattr(loc(%#)/view-*),%b%b[edit(lcstr(after(##,VIEW-)),_,%b)])])][setq(0,iter(lcon(loc(%#)),switch([gte(words(lattr(##/view-*)),1)]:[strmatch(type(##),PLAYER)][not(hasflag(##,connected))],1:10,##,1:0?,##)))][switch(words(%q0),0,,%RThe following objects have views set on them:%R[iter(%q0,%b%b[name(##)])])]
&CMD.VIEW-ARG <PG> Player Globals=$+view *:@swi/first [pos(/,%0)]:[setq(0,locate(%#,before(%0,/),*))]%q0=#-1:#-?,{@pemit %#=I can't find that here!},#-1:*,{@pemit %#=[switch(words(lattr(%q0/view-*)),0,There are no views set on that item.,The following views are set on that item:%R[iter(lattr(%q0/view-*),%b%b[edit(lcstr(after(##,VIEW-)),_,%b)])])]},{@verb %q0=%#,view-[setq(1,edit(after(%0,/),%b,_))]%q1,There is no such view on that item,oview-%q1,,aview-%q1
&CMD.SELFBOOT <PG> Player Globals=$+selfboot:@dol rest(ports(%N))=@boot/port ##;@pemit %#=You booted your frozen connections.
&CMD.OOC <PG> Player Globals=$ooc *: @pemit/contents %l=<OOC> %N[switch(mid(%0,0,1),:,%b[delete(%0,0,1)],;,[delete(%0,0,1)],%bsays\, "%0")]
&CMD.OOC-SHORT <PG> Player Globals=$'*: @pemit/contents %l=<OOC> %N[switch(mid(%0,0,1),:,%b[delete(%0,0,1)],;,[delete(%0,0,1)],%bsays\, "%0")]
&CMD.INFO <PG> Player Globals=$+info:@pemit %#=[header(General Info)]%r[edefault(%#/INFO-GENERAL,Not set.)][if(words(setr(0,setdiff(lattr(%#/INFO-*),INFO-GENERAL))),%r[subheader(Other Info)]%r%b[edit(table(iter(%q0,capall(edit(rest(%i0,INFO-),_,%b)),,|),19,78,|),%r,%r%b)]%r[subheader()]%rType "+info me/<name>" to view your info.%r[footer()],%r[footer()])]
&CMD.INFO-ARG <PG> Player Globals=$+info *:@switch [setq(0,switch(first(%0,/),me,%#,pmatch(first(%0,/))))][isdbref(%q0)][strmatch(%0,*/*)][hasattr(%q0,INFO-[edit(rest(%0,/),%b,_)])]=0*,{@pemit %#=No such player: %0},10?,{@pemit %#=[header(General Info: [name(%q0)])]%r[edefault(%q0/INFO-GENERAL,Not set.)][if(words(setr(1,setdiff(lattr(%q0/INFO-*),INFO-GENERAL))),%r[subheader(Other Info for [name(%q0)])]%r%b[edit(table(iter(%q1,capall(edit(rest(%i0,INFO-),_,%b)),,|),19,78,|),%r,%r%b)]%r[subheader()]%rType "+info <player>/<name>" to view a player's info.%r[footer()],%r[footer()])]},110,{@pemit %#=[name(%q0)] does not have a "[rest(%0,/)]" info.},111,{@pemit %#=[header([capall(edit(rest(%0,/),%b,_))] Info: [name(%q0)])]%r[get_eval(%q0/INFO-[edit(rest(%0,/),%b,_)])]%r[footer()]}
&CMD.BEGINNER <PG> Player Globals=$+beginner:@pemit %#=[header(Commands for Beginners)]%rHere is a quick primer on game commands for beginners, or forgetful old-timers!%r%r[ljust(say <message>,25,.)]%b%b[wrap(Says <message> to everyone in your current room. This command can be abbreviated as "<message>.,51,,,,27)]%r[ljust(ooc <message>,25,.)]%b%b[wrap(Sends an ooc message to everyone in your current room. This command can be abbreviated as '<message>.,51,,,,27)]%r[ljust(page <players>=<message>,25,.)]%b%b[wrap(Sends a private message to the listed players. Player names can be separated by spaces or commas.,51,,,,27)]%r[ljust(look <object or person>,25,.)]%b%b[wrap(Shows you the description of an object or person. "Look" by itself shows you your current room.,51,,,,27)]%r[ljust(pose <message>,25,.)]%b%b[wrap(Show an action to the room\, e.g.\, John Doe types "pose grins and waves." and the room sees "John Doe grins and waves." Abbreviated as :<message>.,51,,,,27)]%r[ljust(who,25,.)]%b%b[wrap(Shows you a list of people who are connected to the game.,51,,,,27)]%r[ljust(+who,25,.)]%b%b[wrap(Shows a modified WHO.,51,,,,27)]%r[ljust(+help,25,.)]%b%b[wrap(The global +help system.,51,,,,27)]%r[ljust(+staff\[/all\],25,.)]%b%b[wrap(+Staff shows you all connected game staff\, and +staff/all shows all staff regardless of connection status. If you are confused or need help\, feel free to use the "page" command to contact a staffer.,51,,,,27)]%r[ljust(pub <message>,25,.)]%b%b[wrap(All players join the Public channel with the alias "pub". This command sends <message> to all players on the Public channel.,51,,,,27)]%r%rNOTE: Commands are typically not case sensitive. To see this information again, type: +beginner. For more information, please see "+help beginner".%r[footer()]
&TR.JUDGE <PG> Player Globals=@dolist %0={&_JUDGE ##=[trim(insert(extract(get(##/_JUDGE),1,19,|),1,[secs()]:%1,|),r,|)];@pemit ##=%[[elements(time(),1 2 3 4)]%] (JUDGE) %1}
@Startup <PG> Player Globals=@tr me/TR.HANGOUTS
&TR.HANGOUTS <PG> Player Globals=&D.HANGOUTS me=[search(eroom=hastag(##,hangout))]
&CMD.HANGOUTS <PG> Player Globals=$+hangouts:@switch [t(v(D.HANGOUTS))]=0,{@pemit %#=There are currently no hangouts.},{@pemit %#=[header(Hangouts)]%r%bName[space(55)]# of Players%r[subheader()];@pemit %#=[list(v(D.HANGOUTS),[ljust(name(%i0),65,.)]%b[words(setinter(lcon(%i0),lwho()))])];@pemit %#=[footer()]}
&FN.JNOTES <PG> Player Globals=ifelse(isstaff(%#),attrcnt(%l/JNOTE-*),#-1)
@set <PG> Player Globals/FN.JNOTES = visual
&FN.DESC <PG> Player Globals=case(0,or(hastype(%@,ROOM),t(zone(%@))),This function is only for use by building code.,u(%1/fn.desc,%0))
@set <PG> Player Globals/FN.DESC = visual
@chown <PG> Player Globals=#3
@set <PG> Player Globals=!HALTED INHERIT SAFE
@vb #6=#12
@vj #6=#25
drop #6
@@
@@ #7: <WG> Wizard Globals
@@
think [ansi(hc,MUX Core:)] Setting up Wizard globals.
@create <WG> Wizard Globals=5
&ISWIZARD <WG> Wizard Globals=[hasflag(%#,WIZARD)]
@lock/UseLock <WG> Wizard Globals=ISWIZARD/1
&CMD.CRON <WG> Wizard Globals=$+cron:@pemit %#=[header(Cron Jobs)]%r%b#[space(3)]Name[space(22)]Mth[space(3)]Date[space(3)]Day[space(3)]Hour[space(2)]Minute[space(2)]Flags[space(3)]Args?%r[subheader()];@pemit %#=[list(lattr(%vc/CRON.TIME-*),[rjust(inum(),3)]:%b[ljust(lcstr(rest(%i0,-)),25)]%b[ljust(case(words(setr(1,extract(setr(0,get(%vc/%i0)),1,1,|))),0,,1,%q1,+++),3)][space(4)][case(words(setr(1,extract(%q0,2,1,|))),0,%b%b,1,%q1,++)][space(4)][ljust(case(words(setr(1,extract(%q0,3,1,|))),0,,1,%q1,+++),3)][space(4)][case(words(setr(1,extract(%q0,4,1,|))),0,%b%b,1,%q1,++)][space(5)][case(words(setr(1,extract(%q0,5,1,|))),0,%b%b,1,%q1,++)][space(6)][ifelse(ismember(setr(1,extract(%q0,6,1,|)),runonce),R,-)][ifelse(ismember(%q1,catchup),C,-)][space(6)][ifelse(t(last(%q0,|)),Y,N)])];@pemit %#=[footer()]
&CMD.CRON-ARG <WG> Wizard Globals=$+cron *:@switch [and(gt(%0,0),lte(%0,words(lattr(%vc/CRON.TIME-*))))]=0,{@pemit %#=There is no cron job by that number.},{@pemit %#=[header(Cron Job: [lcstr(setr(0,rest(extract(lattr(%vc/CRON.TIME-*),%0,1),-)))])]%r[rjust(%xhMonth:%xn,8)]%b[wrap(extract(setr(1,get(%vc/CRON.TIME-%q0)),1,1,|),69,,,,9)]%r[rjust(%xhDate:%xn,8)]%b[wrap(extract(%q1,2,1,|),69,,,,9)]%r[rjust(%xhDay:%xn,8)]%b[wrap(extract(%q1,3,1,|),69,,,,9)]%r[rjust(%xhHour:%xn,8)]%b[wrap(extract(%q1,4,1,|),69,,,,9)]%r[rjust(%xhMinute:%xn,8)]%b[wrap(extract(%q1,5,1,|),69,,,,9)]%r[rjust(%xhFlags:%xn,8)]%b[wrap(extract(%q1,6,1,|),69,,,,9)]%r[rjust(%xhArgs:%xn,8)]%b[wrap(last(%q1,|),69,,,,9)]%r%r[rjust(%xhComment:%xn,8)]%b[wrap(default(%vc/CRON.COMMENT-%q0,None.),69,,,,9)]%r[subheader(Code)]%r[default(%vc/CRON.JOB-%q0,None.)]%r[footer()]}
@chown <WG> Wizard Globals=#3
@set <WG> Wizard Globals=!HALTED INHERIT SAFE
@VC #7=#18
drop #7
@@
@@ #8: <SG> Staff Globals
@@
think [ansi(hc,MUX Core:)] Setting up Staff/Royalty globals.
@create <SG> Staff Globals=5
&CAN_USE <SG> Staff Globals=[isstaff(%#)]
@lock/UseLock <SG> Staff Globals=CAN_USE/1
&CMD.JOIN <SG> Staff Globals=$+join *:@switch [setr(n,locate(%#,*%0,p))]|[strmatch(loc(%#),setr(0,loc(*%0)))]=#-*,{@pemit %#=No such player: %0},*|1,{@pemit %#=You are already there.},{@pemit %#=[alert(You prepare to open a portal.,-)];@remit %q0=[alert([name(%#)] will be joining you shortly.,-)];@oemit %#=[alert([name(%#)] steps through a portal and vanishes.,-)];@wait 3={&join-from %#=loc(%#);@tel %#=%q0;@cemit Scan=[name(%#)] has joined [name(%qn)] at [name(%q0)].}}
&CMD.SUMMON <SG> Staff Globals=$+summon *:@switch [setr(n,locate(%#,*%0,p))]|[strmatch(loc(%#),setr(0,loc(*%0)))]=#-*,{@pemit %#=No such player: %0},*|1,{@pemit %#=They are already here.},{@pemit %#=[alert(You prepare to open a portal.,-)];@remit %q0=[alert([name(%#)] is summoning [name(*%0)].,-)];@oemit %l=[alert([name(%#)] opens a portal.,-)];&summon *%0=loc(*%0);@wait 3={@oemit %q0=%N summons [name(*%0)] away.;@pemit *%0=%N summons you away.;@remit %#=%N summons [name(*%0)].;@tel *%0=loc(%#);@cemit Scan=[name(%#)] has summoned [name(%qn)] to [name(loc(%#))].}}
&CMD.RETURN <SG> Staff Globals=$+return*:@switch [setq(0,trim(%0))][setr(1,gt(strlen(%q0),0))][gt(strlen(setr(2,get(%#/join-from))),0)][isdbref(locate(me,*%q0,p))][gt(strlen(setr(3,get(*%q0/summon))),0)]=00*,{@pemit %#=You do not have a return destination.},01*,{@pemit %#=[alert(You prepare to open a portal.,-)];@oemit %#=[alert([name(%#)] opens a portal.,-)];@wait 3={@tel %#=%q2;&join-from %#}},110?,{@pemit %#=No such player: %q0},1?10,{@pemit %#=[name(*%q0)] does not have a return location.},1?11,{@oemit *%q0=[alert([name(%#)] sends [name(*%q0)] back to [poss(*%q0)] former location.,-)];@pemit *%q0=%N sends you back to your former location.;@remit %q3=[alert([name(%#)] is returning [name(*%q0)] to this location.,-)];@wait 3={@tel *%q0=%q3;&summon *%q0;@oemit *%q0=%N returns [name(*%0)].;&summon *%q0.}}
&CMD.COMMANDS <SG> Staff Globals=$+commands *:@switch [setr(0,locate(%#,%0,*))]=#-*,{@pemit %#=Cannot find %0.},{@pemit %#=[header(Commands on [name(%q0)] (%q0))]%r[table(iter(filter(FIL.COMMANDS,lattr(%q0),,|,%q0),##: [mid(setr(1,get(%q0/##)),1,sub(pos(:,%q1),2))],|,|),39,78,|)]%r[footer()]}
&CMD.COMMANDS/NOCOL <SG> Staff Globals=$+commands/nocol *:@switch [setr(0,locate(%#,%0,*))]=#-*,{@pemit %#=Cannot find %0.},{@pemit %#=[header(Commands on [name(%q0)] (%q0))]%r[iter(filter(FIL.COMMANDS,lattr(%q0),,|,%q0),##: [mid(setr(1,get(%q0/##)),1,sub(pos(:,%q1),2))],|,%r)]%r[footer()]}
&FIL.COMMANDS <SG> Staff Globals=strmatch(get(%1/%0),$*)
&CMD.CONTENTS <SG> Staff Globals=$+contents *:@pemit %#=switch(setr(0,locate(%#,%0,*)),#-*,Cannot find %0.,switch(words(lcon(%q0)),0,name(%q0) (%q0) contains nothing,name(%q0) (%q0) contains:%r[iter(lcon(%q0),%t[name(##)] (##),,%r)]))
&CMD.DUTY <SG> Staff Globals=$+duty:@switch [hasflag(%#,transparent)]=1,{@set %#=!transparent;@pemit %#=Done. You are now on duty.},{@set %#=transparent;@pemit %#=Done. You are now off duty.}
&CMD.DARK <SG> Staff Globals=$+dark:@switch [hasflag(%#,DARK)]=1,{@set %#=!DARK;&DARK-TIME %#;@pemit %#=Done. You are no longer set dark.},{@set %#=DARK;&DARK-TIME %#=[time(,6)];@pemit %#=Done. You are now set dark.}
&CMD.JNOTE <SG> Staff Globals=$+jnote */*=*:@switch [switch(1,isdbref(pmatch(%0)),1[setq(0,pmatch(%0))],isdbref(locate(%#,%0,*)),1[setq(0,locate(%#,%0,*))],0)][setq(1,edit(secure(%1),%b,_))][hasattr(%q0,JNOTE-%q1)]=0?,{@pemit %#=No matches: %0},10,{&JNOTE-%q1 %q0=Proposed by [name(%#)] (%#), [time()]|%2;@set %q0/JNOTE-%q1=hidden;@lock %q0/JNOTE-%q1;@pemit %#=Proposed note added and set as hidden.},11,{@unlock %q0/JNOTE-%q1;&JNOTE-%q1 %q0=Proposed by [name(%#)] (%#), [time()]|%2;@set %q0/JNOTE-%q1=hidden;@lock %q0/JNOTE-%q1;@pemit %#=Proposed note OVERWRITTEN and set as hidden.}
&CMD.JNOTE/HIDE <SG> Staff Globals=$+jnote/hide */*:@switch [switch(1,isdbref(pmatch(%0)),1[setq(0,pmatch(%0))],isdbref(locate(%#,%0,*)),1[setq(0,locate(%#,%0,*))],0)][setq(1,edit(secure(%1),%b,_))][hasattr(%q0,JNOTE-%q1)]=0*,{@pemit %#=No matches: %0},10,{@pemit %#=No such judgenote '%1' on [name(%q0)].},11,{@unlock %q0/JNOTE-%q1;@set %q0/JNOTE-%q1=hidden;@lock %q0/JNOTE-%q1;@pemit %#=Done. Jnote '%1' on [name(%q0)] has been hidden.}
&CMD.JNOTE/UNHIDE <SG> Staff Globals=$+jnote/unhide */*:@switch [switch(1,isdbref(pmatch(%0)),1[setq(0,pmatch(%0))],isdbref(locate(%#,%0,*)),1[setq(0,locate(%#,%0,*))],0)][setq(1,edit(secure(%1),%b,_))][hasattr(%q0,JNOTE-%q1)]=0*,{@pemit %#=No matches: %0},10,{@pemit %#=No such judgenote '%1' on [name(%q0)].},11,{@unlock %q0/JNOTE-%q1;@set %q0/JNOTE-%q1=!hidden;@lock %q0/JNOTE-%q1;@pemit %#=Done. Jnote '%1' on [name(%q0)] is now visible.}
&CMD.JNOTE/APPROVE <SG> Staff Globals=$+jnote/approve */*:@switch [switch(1,isdbref(pmatch(%0)),1[setq(0,pmatch(%0))],isdbref(locate(%#,%0,*)),1[setq(0,locate(%#,%0,*))],0)][setq(j,ifelse(isnum(%1),extract(lattr(%q0/JNOTE-*),%1,1),JNOTE-[edit(secure(%1),%b,_)]))][hasattr(%q0,%qj)]=0*,{@pemit %#=No matches: %0},10,{@pemit %#=No judgenote '%1' for [name(%q0)].},11,{@unlock %q0/%qj;&%qj %q0=[replace(get(%q0/%qj),1,{Approved by [name(%#)] (%#), [time()]},|)];@lock %q0/%qj;@pemit %#=You have approved the '[rest(%qj,-)]' note on [name(%q0)].}
&CMD.JNOTE/UNAPPROVE <SG> Staff Globals=$+jnote/unapprove */*:@switch [switch(1,isdbref(pmatch(%0)),1[setq(0,pmatch(%0))],isdbref(locate(%#,%0,*)),1[setq(0,locate(%#,%0,*))],0)][setq(j,ifelse(isnum(%1),extract(lattr(%q0/JNOTE-*),%1,1),JNOTE-[edit(secure(%1),%b,_)]))][hasattr(%q0,%qj)]=0*,{@pemit %#=No matches: %0},10,{@pemit %#=No such judgenote '%1' on [name(%q0)].},11,{@unlock %q0/%qj;&%qj %q0=[replace(setr(2,get(%q0/%qj)),1,{UNAPPROVED by [name(%#)] (%#), [time()]},|)];@lock %q0/%qj;@pemit %#=You have unapproved the '[rest(%qj,-)]' note on [name(%q0)];@tr #23/TRIG_CREATE=%q0,locate(#21,JNOTE,i),1,[strtrunc(rest(%qj,-),30)],%r%t[name(%#)] has unapproved [name(%q0)]'s "[rest(%qj,-)]" note:%r%r"[strtrunc(rest(%q2,|),6000)]"%r%r%tApproving or Completing this job will APPROVE the jnote. Denying this job will notify the character and remove the note from their character object.}
&CMD.JNOTE/DELETE <SG> Staff Globals=$+jnote/delete */*:@switch [switch(1,isdbref(pmatch(%0)),1[setq(0,pmatch(%0))],isdbref(locate(%#,%0,*)),1[setq(0,locate(%#,%0,*))],0)][setq(j,ifelse(isnum(%1),extract(lattr(%q0/JNOTE-*),%1,1),JNOTE-[edit(secure(%1),%b,_)]))][hasattr(%q0,%qj)]=0*,{@pemit %#=No matches: %0},10,{@pemit %#=No such judgenote '%1' on [name(%q0)].},11,{@unlock %q0/%qj;&%qj %q0;@pemit %#=You have deleted the '[rest(%qj,-)]' note on [name(%q0)]}
&CMD.VERIFY <SG> Staff Globals=$+verify *:@switch [isdbref(setr(0,pmatch(%0)))][hasattr(%q0,_JUDGE)]=0*,{@pemit %#=No such player: %0},10,{@pemit %#=That character has no verification data stored.},11,{@pemit %#=[header(Last 20 Verification Items for [name(%q0)])]%r[iter(revwords(get(%q0/_JUDGE),|),[convsecs(first(%i0,:))]: [wrap(rest(%i0,:),53,,,,26)],|,%r)]%r[footer()]}
&CMD.BGLIST <SG> Staff Globals=$+bglist *:@switch [isdbref(setr(0,pmatch(%0)))][t(lattr(%q0/D.BG.*))]=0*,{@pemit %#=No such player: %0},10,{@pemit %#=[name(%q0)] has no background sections set.},11,{@pemit %#=Background sections for [name(%q0)]: [iter(lattr(%q0/D.BG.*),last(%i0,.))]}
&CMD.BGREAD <SG> Staff Globals=$+bg */*:@switch [isdbref(setr(0,pmatch(%0)))][hasattr(%q0,D.BG.%1)]=0*,{@pemit %#=No such player: %0},10,{@pemit %#=No such background section or [name(%q0)].},11,{@pemit %#=[header(Background Section %0 of [words(lattr(%#/D.BG.*))] for [name(%q0)])]%r[get_eval(%q0/D.BG.%0)]%r[footer()]}
&CMD.STAFF/UPDATE <SG> Staff Globals=$+staff/update:@tr me/daily;@pemit %#=Done. Staff list updated.
&CMD.TAG/ADD <SG> Staff Globals=$+tag/add *=*:@switch [setq(0,lcstr(%1))][regmatchi(%0,^(exit|player|room|thing|object|all)$,-1 1)][setq(1,case(%q1,object,thing,all,exit player room thing,%q1))][not(ismember(v(D.TAGLIST.[first(%q1)]),%q0))][not(gt(words(%q0),1))][not(gt(strlen(%q0),20))]=0*,{@pemit %#=Type must be exit, player, room, thing, or all.},10*,{@pemit %#=There is already a tag by that name.},110*,{@pemit %#=Tag names may not contain spaces.},1110,{@pemit %#=Tag names must be 20 characters or less.},1111,{@dolist %q1={&D.TAGLIST.## me=[setunion(v(D.TAGLIST.##),%q0)];@Pemit %#=Done. Tag '%q0' added to ## tags.}}
&CMD.TAG/DEL <SG> Staff Globals=$+tag/del *=*:@switch [setq(0,lcstr(%1))][regmatchi(%0,^(exit|player|room|thing|object|all)$,-1 1)][setq(1,case(%q1,object,thing,all,exit player room thing,%q1))][not(gt(words(%q0),1))]=0*,{@pemit %#=Type must be exit, player, room, thing, or all.},10,{@pemit %#=You may only delete one tag at a time.},11,{@dolist %q1={@pemit %#=[case(ismember(v(D.TAGLIST.##),%q0),0,There is no ## tag by that name.,1,[set(me,D.TAGLIST.##:[setdiff(v(D.TAGLIST.##),%q0)])]Tag '%q0' deleted from ## list. Tag not removed from ##s that have it.)]}}
&CMD.TAG <SG> Staff Globals=$+tag *=*:@switch [setq(0,locate(%#,%0,*))][setq(1,lcstr(%1))][case(%q0,#-1,0,1)][ismember(v(D.TAGLIST.[type(%q0)]),%q1)]=0*,{@pemit %#=Target not found.},10,{@pemit %#=There is no such tag for your target's object type.},11,{&_TAGS %q0=[setunion(get(%q0/_TAGS),%q1)];@pemit %#=Done. %xh[name(%q0)]%xn tagged '%q1'.}
&CMD.UNTAG <SG> Staff Globals=$+untag *=*:@switch [setq(0,locate(%#,%0,*))][setq(1,lcstr(%1))][case(%q0,#-1,0,1)][ismember(get(%q0/_TAGS),%q1)]=0*,{@pemit %#=Target not found.},10,{@pemit %#=[name(%q0)] does not have that tag.},11,{&_TAGS %q0=[setdiff(get(%q0/_TAGS),%q1)];@Pemit %#=Done. Tag '%q1' removed from %xh[name(%q0)]%xn.}
&CMD.TAGS <SG> Staff Globals=$+tags:@pemit %#=[header(Tag List)]%r[iter(lattr(me/D.TAGLIST.*),[subheader([capall(last(%i0,.))] Tags)]%r%b[edit(table(v(%i0),15,78),%r,%r%b)],,%r)]%r[footer()]
&D.TAGLIST.ROOM <SG> Staff Globals=hangout
&CMD.HANGOUTS/UPDATE <SG> Staff Globals=$+hangouts/update:@tr #6/TR.HANGOUTS;@pemit %#=Done. Hangouts list updated.
@Daily <SG> Staff Globals=&D.STAFFLIST me=[setdiff(search(eplayer=isstaff(##)),#1)]
@Startup <SG> Staff Globals=@tr me/daily
@chown <SG> Staff Globals=#3
@set <SG> Staff Globals=!HALTED INHERIT SAFE
drop #8
@@
@@ #9: Places Globals
@@
think [ansi(hc,MUX Core:)] Setting up the Places system.
@create <PG> Places Globals=5
@Desc <PG> Places Globals=The Places Code. Tables, rugs, beds, ladders, etc.
&EVAL_OBJ <PG> Places Globals=#10
&DO_CONFIGURE <PG> Places Globals=$configure * places: @switch/first [controls(%#,%l)]:[isnum(%0)]:%0=0:*:*, {@pemit %#=You do not control [name(%l)].},*:0:*, {@pemit %#=The number of places needs to be a number!},*:*:0, {@dolist rest(lnum(add(get(%l/PLACESMAX),1)))={@unlock %l/PLACE##;&PLACE## %l};@unlock %l/PLACESCLEANUP1;@unlock %l/PLACESCLEANUP2;@unlock %l/PLACESMAX;&PLACESCLEANUP1 %l;&PLACESCLEANUP2 %l;&PLACESMAX %l;@set %l=!MONITOR;@pemit %#=Places removed from [name(%l)].},{&PLACESMAX %l=%0;@dolist rest(lnum(add(%0,1)))={@unlock %l/PLACE##;&PLACE## %l=ulocal(SETUP_FN,##,add(rand(9),1))};@unlock %l/PLACESCLEANUP1;@unlock %l/PLACESCLEANUP2;@unlock %l/PLACESMAX;@set %l=MONITOR;&PLACESCLEANUP1 %l=v(PLACESCLEANUP1);&PLACESCLEANUP2 %l=v(PLACESCLEANUP2);&PLACENUMS %l=[repeat(|,%0)];@pemit %#=Configuration for %0 places complete.}
&DO_CONFIGURE_SPYING <PG> Places Globals=$configure spy* *: @switch/first [controls(%#,%l)]:[ucstr(%1)]=0:*, {@pemit %#=You do not control [name(%l)].},*:Yes, {@pemit %#=Setting this room to allow Spying. ;&SPYOK %L=Yes ;},*:No, {@pemit %#=Setting this room to disallow Spying. Please include a reason why it should not work in a note on the room. ;&SPYOK %L=No ;},{@pemit %#=The valid commands are:%r%tconfigure spying Yes%r%tconfigure spying No%rPlease use one of those.}
&SETUP_FN <PG> Places Globals=Table %0|%1|[add(rand(%1),1)]||I'm sorry, there's no room to add a place there.|I'm sorry, there's on place to move there.|You sit down at|sits down at|You stand and leave|stands and leaves|At your table|A table with 4 legs and some chairs around it.
&DO_UPDATE <PG> Places Globals=$update */*=*: @switch/first [controls(%#,%l)]:[and(isnum(%0),lte(%0,get(%l/PLACESMAX)))]:[member(NAME MAXPLACES CURPLACES FIXED FULL EMPTY JOIN OJOIN DEPART ODEPART PREFIX DESCRIBE,ucstr(%1))]=0:*:*, {@pemit %#=Permission denied.},*:0:*, {@pemit %#=I'm sorry, but '%0' isn't a valid place number.},*:*:0, {@pemit %#=I'm sorry, but '%1' isn't a valid configuration option.},{@unlock %l/PLACE%0;&PLACE%0 %l=ulocal(UPDATEINFO,%l,%0,%1,%2);@pemit %#=The %1 for [ulocal(GETINFO,%l,%0,NAME)] is now set to:%r[space(5)][ulocal(GETINFO,%l,%0,%1)]}
&DO_MV <PG> Places Globals=$mv from * to *: @switch/first 0=and(gt(%0,0),lte(%0,get(%l/PLACESMAX))), {@pemit %#='%0' is not a valid place number.},and(gt(%1,0),lte(%1,get(%l/PLACESMAX))), {@pemit %#='%1' is not a vaild place number.},not(words(ulocal(GETINFO,%l,%0,FIXED))), {@pemit %#=ulocal(GETINFO,%l,%0,FIXED)},not(words(ulocal(GETINFO,%l,%1,FIXED))), {@pemit %#=ulocal(GETINFO,%l,%1,FIXED)},sub(ulocal(GETINFO,%l,%0,CURPLACES),words(extract(get(%l/PLACENUMS),%0,1,|))), {@pemit %#=ulocal(GETINFO,%l,%0,EMPTY)},neq(ulocal(GETINFO,%l,%1,CURPLACES),ulocal(GETINFO,%l,%1,MAXPLACES)), {@pemit %#=ulocal(GETINFO,%l,%1,FULL)},{@unlock %l/PLACE%0;@unlock %l/PLACE%1;&PLACE%0 %l=ulocal(UPDATEINFO,%l,%0,CURPLACES,sub(ulocal(GETINFO,%l,%0,CURPLACES),1));&PLACE%1 %l=ulocal(UPDATEINFO,%l,%1,CURPLACES,add(ulocal(GETINFO,%l,%1,CURPLACES),1));@pemit %#=You move a place from [ulocal(GETINFO,%l,%0,NAME)] to [ulocal(GETINFO,%l,%1,NAME)].}
&PLACESCLEANUP1 <PG> Places Globals=^* has left.:placescleanup(%#)
&PLACESCLEANUP2 <PG> Places Globals=^* has disconnected.:placescleanup(%#)
&PLACESCLEANUPCMD <PG> Places Globals=$placescleanup(*):@switch [setq(0, U(WHICHPLACE, %#, %0))][r(0)]=>0, {&PLACENUMS %#=[replace(get(%#/PLACENUMS), r(0), remove(extract(get(%#/PLACENUMS), r(0), 1, |), %0), |)]}
&DO_JOIN <PG> Places Globals=$join *: @switch/first [not(ulocal(WHICHPLACE,%l,%#))] [lcstr(%0)]=0 *, {@pemit %#=Don't you think you should 'depart' first?},1 at #*, {@trig me/PLACEFUNCTION=%l,%#,[delete(rest(%0),0,1)]},1 at *, {@trig me/PLACEFUNCTION=%l,%#,[rest(%0)]},1 #*, {@trig me/PLACEFUNCTION=%l,%#,[delete(%0,0,1)]},1 with *, {@pemit[setq(1,locate(%#,rest(%0),niPT))][setq(0,ulocal(WHICHPLACE,%l,r(1)))]%#=switch(r(0),0,There isn't anyone named '[capstr(rest(%0))]' at a special place.,You go over to join [name(r(1))].);@trig me/[switch(r(0),0,-,PLACEFUNCTION)]=%l,%#,[r(0)]},{@switch [isnum(%0)][setq(1,locate(%#,%0,niPT))][setq(0,ulocal(WHICHPLACE,%l,r(1)))]=1,{@trig me/PLACEFUNCTION=%l,%#,%0 ;},{@pemit %#=switch(r(0),0,There isn't anyone named '[capstr(rest(%0))]' at a special place.,You go over to join [name(r(1))].);@trig me/[switch(r(0),0,-,PLACEFUNCTION)]=%l,%#,[r(0)]}}
&DO_SIT <PG> Places Globals=$sit *: @switch/first [not(ulocal(WHICHPLACE,%l,%#))] [lcstr(%0)]=0 *, {@pemit %#=Don't you think you should 'depart' first?},1 at #*, {@trig me/PLACEFUNCTION=%l,%#,[delete(rest(%0),0,1)]},1 at *, {@trig me/PLACEFUNCTION=%l,%#,[rest(%0)]},1 #*, {@trig me/PLACEFUNCTION=%l,%#,[delete(%0,0,1)]},1 with *, {@pemit[setq(1,locate(%#,rest(%0),niPT))][setq(0,ulocal(WHICHPLACE,%l,r(1)))]%#=switch(r(0),0,There isn't anyone named '[capstr(rest(%0))]' at a special place.,You go over to join [name(r(1))].);@trig me/[switch(r(0),0,-,PLACEFUNCTION)]=%l,%#,[r(0)]},{@switch [isnum(%0)][setq(1,locate(%#,%0,niPT))][setq(0,ulocal(WHICHPLACE,%l,r(1)))]=1,{@trig me/PLACEFUNCTION=%l,%#,%0},{@pemit %#=switch(r(0),0,There isn't anyone named '[capstr(rest(%0))]' at a special place.,You go over to join [name(r(1))].);@trig me/[switch(r(0),0,-,PLACEFUNCTION)]=%l,%#,[r(0)]}}
&PLACEFUNCTION <PG> Places Globals=@switch/first 0=[lte(%2, get(%0/PLACESMAX))], @pemit %1=Invalid Place Number '%2'.,[setq(1, extract(get(%0/PLACENUMS), %2, 1, |))][gt(ulocal(GETINFO, %0, %2, CURPLACES), words(r(1)))], {@pemit %1=There aren't any free spaces there.},{@verb %1=[setq(0,ulocal(getinfo,%0,%2,NAME))]%1,eval_msg,[U(GETINFO, %0, %2, JOIN)] [r(0)].,oeval_mesg,[U(GETINFO, %0, %2, OJOIN)] [r(0)].;@pemit/list [r(1)]= [name(%1)] joins you. ;&PLACENUMS %0=[replace(get(%0/PLACENUMS), %2, [r(1)]%1%b, |)]}
&DO_DEPART <PG> Places Globals=$depart:@switch [setq(1, U(WHICHPLACE, %l, %#))][setq(0,U(GETINFO,%l,r(1),NAME))][r(1)]=0, {@pemit %#=You aren't placed anywhere.},{&PLACENUMS %l=[replace(get(%l/PLACENUMS), r(1), [remove(extract(get(%l/PLACENUMS), r(1), 1, |), %#)], |)];@pemit/list [extract(get(%l/PLACENUMS), r(1), 1, |)]=%N has departed.;@pemit %#=[U(GETINFO, %l, r(1), DEPART)] [r(0)].;@pemit/list [ldelete(lcon(%L),match(lcon(%L),%#))]=%N [U(GETINFO, %l, r(1), ODEPART)] [r(0)].}
&DO_STAND <PG> Places Globals=$stand:@switch [setq(1, U(WHICHPLACE, %l, %#))][setq(0,U(GETINFO,%l,r(1),NAME))][r(1)]=0, {@pemit %#=You aren't placed anywhere.},{&PLACENUMS %l=[replace(get(%l/PLACENUMS), r(1), [remove(extract(get(%l/PLACENUMS), r(1), 1, |), %#)], |)];@pemit/list [extract(get(%l/PLACENUMS), r(1), 1, |)]=%N has departed.;@pemit %#=[U(GETINFO, %l, r(1), DEPART)] [r(0)].;@pemit/list [ldelete(lcon(%L),match(lcon(%L),%#))]=%N [U(GETINFO, %l, r(1), ODEPART)] [r(0)].}
&DO_PLACES <PG> Places Globals=$places: @pemit %#=switch(get(%l/PLACESMAX),,There are no special places here.,0,There are no special places here.,map(PLACES_FN,rest(lnum(add(get(%l/PLACESMAX),1)))))
&DO_PLACE <PG> Places Globals=$place *: @pemit %#=switch(get(%l/PLACESMAX),,There are no special places here.,0,There are no special places here.,map(PLACES_FN,edit(%0,#,)))
&PLACES_FN <PG> Places Globals=%r[setq(0,ulocal(GETINFO,%l,%0,CURPLACES))][setq(1,extract(get(%l/PLACENUMS),%0,1,|))][capstr(ulocal(GETINFO,%l,%0,NAME))] (#%0) has [setq(2,sub(r(0),words(r(1))))][switch(r(2),0,no empty places,1,1 empty place,[r(2)] empty places)].[switch(words(r(1)),0,,1,%r%tPresent is: %b[name(edit(r(1),%b,))].,%r%tPresent are: %b[ulocal(PLACE_LOOK,r(1))])]
&PLACE_LOOK <PG> Places Globals=itemize(iter(%0,moniker(itext()),,|),|)
&DO_PLOOK <PG> Places Globals=$plook: @pemit %#=[setq(0,edit(get(%l/PLACENUMS),|,))][fold(PLOOK_FOLD_FN,rest(lnum(add(get(%l/PLACESMAX),1))),-----)]%rNo place [space(3)] [setq(3,setdiff(setinter(lcon(%l),lwho()),r(0)))][rjust([words(r(3))] at no places,15)] [space(3)] [setq(4,sort(iter(r(3),name(##))))][ljust(mid(extract(r(4),1,1),0,14),14)] [ljust(mid(extract(r(4),2,1),0,14),14)] [ljust(mid(extract(r(4),3,1),0,14),14)][switch(gt(words(r(4)),3),1,ulocal(NAME_3COL_FN,extract(r(4),4,3999)))]%r-----
&PLOOK_FOLD_FN <PG> Places Globals=%0%r[setq(1,extract(get(%l/PLACENUMS),%1,1,|))]Place #[ljust(%1,5)] [rjust([sub(ulocal(GETINFO,%l,%1,CURPLACES),words(r(1)))] empty places,15)] [space(3)] [setq(2,sort(iter(r(1),name(##))))][ljust(mid(extract(r(2),1,1),0,14),14)] [ljust(mid(extract(r(2),2,1),0,14),14)] [ljust(mid(extract(r(2),3,1),0,14),14)][switch(gt(words(r(2)),3),1,ulocal(NAME_3COL_FN,extract(r(2),4,3999)))]
&NAME_3COL_FN <PG> Places Globals=[fold(NAME_3AUX_FN,rest(%0),%r[space(33)][ljust(mid(first(%0),0,14),15)])]
&NAME_3AUX_FN <PG> Places Globals=%0[switch(mod(words(%0),4),0,%r[space(33)][ljust(mid(%1,0,14),15)],[ljust(mid(%1,0,14),15)])]
&DO_PLOOK_NUMBER <PG> Places Globals=$plook *:@pemit %#=switch(get(%l/PLACESMAX),,There are no special places here.,0,There are no special places here.,%r[capstr(ulocal(GETINFO,%l,%0,NAME))]:%r[ulocal(GETINFO,%l,edit(%0,#,),DESCRIPTION)])
&DO_TT <PG> Places Globals=$tt *:@pemit/list [setq(0,ulocal(WHICHPLACE,%l,%#))][switch(r(0),0,%#[setq(1,You'll need to join a place first.)],[extract(get(%l/PLACENUMS),r(0),1,|)][setq(1,\{[ulocal(GETINFO,%l,r(0),PREFIX)], [switch(%0,:*,%N [delete(%0,0,1)],;*,%N[delete(%0,0,1)],"*,%N says "[delete(%0,0,1)]",|*,delete(%0,0,1),%N says "%0")]\})])]=r(1);@pemit/list [iter(lcon(%l),switch(strmatch([get(##/SPYING)],%l [r(0)]),1,##))]=(Overheard) [r(1)]
&DO_TTOOC <PG> Places Globals=$ttooc *:@pemit/list [setq(0,ulocal(WHICHPLACE,%l,%#))][switch(r(0),0,%#[setq(1,You'll need to join a place first.)],[extract(get(%l/PLACENUMS),r(0),1,|)][setq(1,<OOC> [ulocal(GETINFO,%l,r(0),PREFIX)]%, [switch(%0,:*,%N [delete(%0,0,1)],;*,%N[delete(%0,0,1)],"*,%N says "[delete(%0,0,1)]",|*,delete(%0,0,1),%N says "%0")])])]=r(1);@pemit/list [iter(lcon(%l),switch(strmatch([get(##/SPYING)],%l [r(0)]),1,##))]=(Overheard) [r(1)]
&WHICHPLACE <PG> Places Globals=[match(get(%0/PLACENUMS), *%1%b*, |)]
&GETINFO <PG> Places Globals=[extract(get(%0/PLACE%1),match(NAME MAXPLACES CURPLACES FIXED FULL EMPTY JOIN OJOIN DEPART ODEPART PREFIX DESCRIPTION,%2),1,|)]
&UPDATEINFO <PG> Places Globals=[replace(get(%0/PLACE%1),match(NAME MAXPLACES CURPLACES FIXED FULL EMPTY JOIN OJOIN DEPART ODEPART PREFIX DESCRIBE,%2),%3,|)]
&ATPLACE <PG> Places Globals=[extract(get(%0/PLACENUMS), %1, 1, |)]
&FUNC_ATPLACE <PG> Places Globals=[switch(or(controls(%#,%0),match(rloc(%l,100),rloc(%0,100))),1,extract(get(%0/PLACENUMS), %1, 1, |),PERMISSION DENIED)]
&FUNC_PLACEINFO <PG> Places Globals=[switch(or(controls(%#,%0),match(rloc(%l,100),rloc(%0,100))),1,extract(get(%0/PLACE%1),match(NAME MAXPLACES CURPLACES FIXED FULL EMPTY JOIN OJOIN DEPART ODEPART PREFIX,%2),1,|),PERMISSION DENIED)]
&FUNC_WHICHPLACE <PG> Places Globals=[switch(or(controls(%#,%0),match(rloc(%l,100),rloc(%0,100))),1,match(get(%0/PLACENUMS), *%1%b*, |),PERMISSION DENIED)]
&DO_MUTTER <PG> Places Globals=$mutter *=*: @remit [setq(0,locate(%#,%0,nimP))][switch(r(0),#-1,XX,#-2,XX,%l)]={[switch(%1,:* "*"*,{%N [first(delete(%1,0,1),")]%S mutters to [setq(1,ulocal(MUTTER_FN,extract(%1,2,1,")))][switch(r(0),%#,%oself,name(r(0)))][switch(r(1),...,.,{, "[r(1)]"})] [rest(rest(%1,"),")]},:*,{%N mutters to [switch(r(0),%#,%oself,name(r(0)))].},;* "*"*,{%N[first(delete(%1,0,1),")]%S mutters to [setq(1,ulocal(MUTTER_FN,extract(%1,2,1,")))][switch(r(0),%#,%oself,name(r(0)))][switch(r(1),...,.,{, "[r(1)]"})] [rest(rest(%1,"),")]},;*,{%N mutters to [switch(r(0),%#,%oself,name(r(0)))].},{[setq(1,ulocal(MUTTER_FN,%1))]%N mutters to [switch(r(0),%#,%oself,name(r(0)))][switch(r(1),...,.,{, "[r(1)]"})]})]};@pemit %#[setq(2,edit(edit(%1,<,),>,))]=switch(r(0),#-1,I don't see that here.,#-2,I'm not sure which %0 you mean.,ulocal(MUTTER_FROM_FN,%#,r(0),r(2)));@pemit [switch(r(0),%#,XX,r(0))]=ulocal(MUTTER_TO_FN,%#,r(0),r(2))
&DO_MUTTER_PLACE <PG> Places Globals=$mutter/place *=*: @switch and(gte(%0,1),lte(%0,get(%l/PLACESMAX)))=0, {@pemit %#=There is no such place here.},{@remit %l={[switch(%1,:* "*"*,{%N [first(delete(%1,0,1),")]%S mutters to [PlaceInfo(%l,%0,NAME)][setq(1,ulocal(MUTTER_FN,extract(%1,2,1,")))][switch(r(1),...,.,{, "[r(1)]"})] [rest(rest(%1,"),")]},:*,{%N mutters to [PlaceInfo(%l,%0,NAME)],},;* "*"*,{%N[first(delete(%1,0,1),")]%S mutters to [PlaceInfo(%l,%0,NAME)][setq(1,ulocal(MUTTER_FN,extract(%1,2,1,")))][switch(r(1),...,.,{, "[r(1)]"})] [rest(rest(%1,"),")]},;*,{%N mutters to [PlaceInfo(%l,%0,NAME)]},{[setq(1,ulocal(MUTTER_FN,%1))]%N mutters to [PlaceInfo(%l,%0,NAME)][switch(r(1),....,.,{, "[r(1)]"})]})]};@pemit/list [setq(2,edit(edit(%1,<,),>,))][setq(3,{[PlaceInfo(%l,%0,PREFIX)], [switch(r(2),:*,%N [delete(r(2),0,1)],;*,%N[delete(r(2),0,1)],%N says "[r(2)]")]})][setunion(AtPlace(%l,%0),%#)]=r(3)}
&DO_MUTTER_TT <PG> Places Globals=$mutter/tt *=*: @switch/first [setq(0,locate(%#,%0,nimP))][r(0)] [setq(9,WhichPlace(%l,%#))][switch(r(9),0,setq(9,WhichPlace(%l,r(0))))][r(9)]=#-1 *, {@pemit %#=I don't see that here.},#-2 *, {@pemit %#=I'm not sure which %0 you mean.},* 0, {@pemit %#=Neither you nor [name(r(0))] is at a special place.},{@pemit/list [setq(8,{[PlaceInfo(%l,r(9),PREFIX)], [switch(%1,:* "*"*,{%N [first(delete(%1,0,1),")]%S mutters to [setq(1,ulocal(MUTTER_FN,extract(%1,2,1,")))][switch(r(0),%#,%oself,name(r(0)))][switch(r(1),...,.,{, "[r(1)]"})] [rest(rest(%1,"),")]},:*,{%N mutters to [switch(r(0),%#,%oself,name(r(0)))].},;* "*"*,{%N[first(delete(%1,0,1),")]%S mutters to [setq(1,ulocal(MUTTER_FN,extract(%1,2,1,")))][switch(r(0),%#,%oself,name(r(0)))][switch(r(1),...,.,{, "[r(1)]"})] [rest(rest(%1,"),")]},;*,{%N mutters to [switch(r(0),%#,%oself,name(r(0)))].},{[setq(1,ulocal(MUTTER_FN,%1))]%N mutters to [switch(r(0),%#,%oself,name(r(0)))][switch(r(1),...,.,{, "[r(1)]"})]})]})][setunion(AtPlace(%l,r(9)),%# [r(0)])]=r(8);@pemit/list [iter(lcon(%l),switch(strmatch([get(##/SPYING)],%l [r(0)]),1,##))]=(Overheard) [r(8)]@pemit %#=[setq(2,edit(edit(%1,<,),>,))][ulocal(MUTTER_FROM_FN,%#,r(0),r(2))];@pemit r(0)=ulocal(MUTTER_TO_FN,%#,r(0),r(2))}
&DO_SPY <PG> Places Globals=$+spy *:@switch/first [member(get([parent(me)]/CANSPY),%#)]:[words(get(%l/PLACESMAX))]:[and(gte(%0,0),lte(%0,get(%l/PLACESMAX)))]:[member(get(%L/SPYOK),Yes)]=0:*:*:*,{@pemit %#=You can't do that.},*:0:*:*,{@pemit %#=There aren't any special places here.},*:*:0:*,{@pemit %#=Invalid place number: '%0'.},*:*:*:0,{@pemit %#=Spying can not be used in this room.},{@switch %0=0,{@unlock %#/SPYING;&SPYING %#;@Pemit %#=You cease listening to that place.},{@unlock %#/SPYING;&SPYING %#=%L %0;@lock %#/SPYING=me;@Pemit %#=You listen in on a nearby conversation.}}
&SPY_WHO <PG> Places Globals=$+spy/who:@switch isstaff(%#)=0,{@pemit %#=You're not authorized to do that.},{@pemit %#=[repeat(*,78)]%RCharacters currently possessing +spy capability:%R%R[iter(get([parent(me)]/CANSPY),switch(mod(member(get([parent(me)]/CANSPY),##),4),0,%R[ljust(name(##),15)],[ljust(name(##),15)]))]%R%R[repeat(*,78)]}
&SPY_ADD <PG> Places Globals=$+spy/add *:@switch orflags(%#,W)=0,{@pemit %#=You're not authorized to do that.},{@switch member(get([parent(me)]/CANSPY),num(*%0))=0,{&CANSPY [parent(me)]=cat(get([parent(me)]/CANSPY),num(*%0));@pemit %#=[name(num(*%0))] has been cleared for spying.},{@pemit %#=That person is already cleared for spying.}}
&SPY_REMOVE <PG> Places Globals=$+spy/remove *:@switch orflags(%#,W)=0,{@pemit %#=You're not authorized to do that.},{@switch member(get([parent(me)]/CANSPY),num(*%0))=0,{@pemit %#=That person is not in the Master Spy List.},{&CANSPY [parent(me)]=remove(get([parent(me)]/CANSPY),num(*%0));@pemit %#=[name(num(*%0))] is removed from the Master Spy List.}}
@Startup <PG> Places Globals=@dolist lattr(me/FUNC_*)=@function/privileged after(##,FUNC_)=me/##
@chown <PG> Places Globals=#3
@set <PG> Places Globals=!HALTED INHERIT SAFE
drop #9
@@
@@ #10: <PF> Places Functions
@@
@create <PF> Places Functions=5
@Desc <PF> Places Functions=This evaluator can be used with @verb to send literal messages with correct substitutions. To use it, go @verb [num(me)]=<actor>,eval_msg,,oeval_msg,,%{<msg>,<omsg>%}%rExtra arguments may be passed via setq(), and recovered in msg, omsg via %[r(X)%].
&EVAL_MSG <PF> Places Functions=[s(%0)]
&OEVAL_MSG <PF> Places Functions=[s(%1)]
&MUTTER_FN <PF> Places Functions=[edit(ulocal(DOTS_FN,ulocal(SELECT_WORDS_FN,%0)),%b...,...)]
&MUTTER_TO_FN <PF> Places Functions=[switch(%2,:*,{You sense [name(%0)] [delete(%2,0,1)]},;*,{You sense [name(%0)][delete(%2,0,1)]},{[name(%0)] whispers "%2"})]
&MUTTER_FROM_FN <PF> Places Functions=[switch(%0,%1,switch(%2,:*,{You sense "[name(%0)] [delete(%2,0,1)]"},;*,{You sense "[name(%0)][delete(%2,0,1)]"},{You mutter to yourself, "%2"}),switch(%2,:*,{[name(%1)] senses "[name(%0)] [delete(%2,0,1)]"},;*,{[name(%1)] senses "[name(%0)][delete(%2,0,1)]"},{You whisper "%2" to [name(%1)].}))]
&DOTS_FN <PF> Places Functions=[switch(%0,*... ...*,ulocal(DOTS_FN,edit(%0,... ...,...)),%0)]
&SELECT_WORDS_FN <PF> Places Functions=[switch(%0,*<*>*,[map(KILL_WORDS_FN,before(%0,<))] [before(after(%0,<),>)] [ulocal(SELECT_WORDS_FN,after(%0,>))],map(KILL_WORDS_FN,%0))]
&KILL_WORDS_FN <PF> Places Functions=[switch([rand(3)]%0,0,,1,,2,,0*,%0,...)]
&CANSPY <PF> Places Functions=#1
@chown <PF> Places Functions=#3
@set <PF> Places Functions=!HALTED SAFE
@parent #9=#10
@@
@@ #11: <BT> Building Tracker Globals
@@
think [ansi(hc,MUX Core:)] Setting up the Building Tracker system.
@create <BT> Building Tracker Globals=10
&ISSTAFF <BT> Building Tracker Globals=isstaff(%#)
@lock/UseLock <BT> Building Tracker Globals=ISSTAFF/1
&CMD.BUILD/CREATE <BT> Building Tracker Globals=$+build/create *=*:@switch/first [strmatch(#-1,locate(%vb,%0,i))][isdbref(setr(0,pmatch(%1)))]=0*,{@pemit %#=There is already a build project by that name. Please use something specific.},10,{@pemit %#=No such player: %1},11,{@tr %vb/TR.CREATE=[secure(%0)],%q0;@pemit %#=Done. New building project "[secure(%0)]" created for [name(%q0)].}
&CMD.BUILD <BT> Building Tracker Globals=$+build:@switch [t(lcon(%vb,OBJECTS))]=0,{@pemit %#=There are currently no building projects in the system.},{@pemit %#=[header(Building Projects)]%r[space(5)]#[space(2)]Name[space(16)]Player[space(10)]Builder[space(8)]Quota[space(2)]Status%r[subheader()];@pemit %#=[list(sortby(SORTBY.CREATED,lcon(%vb,OBJECT)),[ljust(first(default(%vb/D.PARENTLETTER.[parent(%i0)],!),|),1)]%b[rjust(inum(),4)]%b[ljust(rest(name(%i0),:%b),20)]%b[ljust(case(default(%i0/D.OOC_OWNER,0),0,None,name(get(%i0/D.OOC_OWNER))),15)]%b[ljust(case(setr(0,default(%i0/D.BUILDER,0)),0,None,ifelse(isdbref(%q0),name(%q0),%q0)),16)]%b[ljust(case(isdbref(%q0),0,max(get(%i0/D.QUOTA),0),get(%q0/QUOTA)),4)]%b[case(get(%i0/D.STATUS),0,Approval,1,In Progress,2,Live,Error)])];@pemit %#=[footer()]}
&CMD.BUILD-ARG <BT> Building Tracker Globals=$+build *:@switch [ifelse(isnum(%0),#[t(setr(0,extract(sortby(SORTBY.CREATED,lcon(%vb,OBJECTS)),%0,1)))],A[isdbref(setr(0,last(partial(iter(lcon(%vb,OBJECTS),[rest(name(%i0),:%b)]:%i0,,|),%0,|),:)))])]=#0,{@pemit %#=There is no project by that number.},A0,{@pemit %#=There is no project that matches that name.},?1,{@pemit %#=[header(Project Data: [rest(name(%q0),:%b)])]%r[rjust(%xhType:%xn,10)]%b%b[rest(setr(1,default(%vb/D.PARENTLETTER.[parent(%q0)],!|Unknown)),|)] ([first(%q1,|)])%r[rjust(%xhStatus:%xn,10)]%b%b[case(setr(1,get(%q0/D.STATUS)),0,Approval,1,In Progress,2,Live,Error)][if(or(eq(%q1,0),eq(%q1,1)),ifelse(hasflag(%q0,UNINSPECTED),%b(Uninspected),%b(Inspection Complete)))]%r[rjust(%xhOOC Owner:%xn,10)]%b%b[case(default(%q0/D.OOC_OWNER,0),0,None,name(get(%q0/D.OOC_OWNER)))]%r[rjust(%xhIC Owner:%xn,10)]%b%b[case(default(%q0/D.IC_OWNER,0),0,None,get(%q0/D.IC_OWNER))]%r[rjust(%xhBuilder:%xn,10)]%b%b[case(setr(1,default(%q0/D.BUILDER,0)),0,None,ifelse(isdbref(%q1),name(%q1),%q1))]%r[rjust(%xhQuota:%xn,10)]%b%b[case(isdbref(%q1),0,max(get(%q0/D.QUOTA),0),get(%q1/QUOTA))]%r[rjust(%xhIC Loc:%xn,10)]%b%b[setr(1,default(%q0/D.IC_LOC,None))][if(or(not(isdbref(%q1)),not(hastype(%q1,ROOM))),%b(Invalid Room))]%r[rjust(%xhDesc:%xn,10)]%b%b[get_eval(%q0/desc)]%r[footer()]}
&CMD.BUILD/SET <BT> Building Tracker Globals=$+build/set */*=*:@switch [ifelse(isnum(%0),#[t(setr(0,extract(sortby(SORTBY.CREATED,lcon(%vb,OBJECTS)),%0,1)))],A[isdbref(setr(0,last(partial(iter(lcon(%vb,OBJECTS),[rest(name(%i0),:%b)]:%i0,,|),%0,|),:)))])][t(setr(1,partial(Type|Status|OOC Owner|IC Owner|Builder|Quota|IC Loc|Desc,%1,|)))][first(setr(2,u(FN.GOOD[edit(%q1,%b,_)],%q0,%2)),|)]=#0*,{@pemit %#=There is no project by that number.},A0*,{@pemit %#=There is no project that matches that name.},?10*,{@pemit %#=That's not a valid field for a project. Please see the Project Data readout, and note that input is partially matched.},?110,{@pemit %#=[rest(%q2,|)]},?111,{@tr me/TR.SET[edit(%q1,%b,_)]=%q0,[rest(%q2,|)];@pemit %#=Done. Set [rest(name(%q0),:%b)]'s %q1 to: [rest(%q2,|)]}
&CMD.BUILD/APPROVE <BT> Building Tracker Globals=$+build/approve *:@switch [ifelse(isnum(%0),#[t(setr(0,extract(sortby(SORTBY.CREATED,lcon(%vb,OBJECTS)),%0,1)))],A[isdbref(setr(0,last(partial(iter(lcon(%vb,OBJECTS),[rest(name(%i0),:%b)]:%i0,,|),%0,|),:)))])][not(eq(setr(1,get(%q0/D.STATUS)),2))][first(setr(2,u(FN.APPROVE.%q1,%q0)),|)]=#0*,{@pemit %#=There is no project by that number.},A0*,{@pemit %#=There is no project that matches that name.},?10*,{@pemit %#=That project is already live on the grid and does not need approval.},?110,{@pemit %#=[rest(%q2,|)]},?111,{@pemit %#=Project [rest(name(%q0),:%b)] approved. You can now complete or approve the associated job, or +build/advance. If the build was opened by a Jobs request, please use the jobs system.;@set %q0=!UNINSPECTED}
&CMD.BUILD/ADVANCE <BT> Building Tracker Globals=$+build/advance *:@switch [ifelse(isnum(%0),#[t(setr(0,extract(sortby(SORTBY.CREATED,lcon(%vb,OBJECTS)),%0,1)))],A[isdbref(setr(0,last(partial(iter(lcon(%vb,OBJECTS),[rest(name(%i0),:%b)]:%i0,,|),%0,|),:)))])][not(eq(setr(1,get(%q0/D.STATUS)),2))][not(hasflag(%q0,UNINSPECTED))]=#0*,{@pemit %#=There is no project by that number.},A0*,{@pemit %#=There is no project that matches that name.},?10*,{@pemit %#=That project is already live on the grid.},?110,{@pemit %#=You cannot advance a project that has not been approved.},?111,{@pemit %#=Advancing [rest(name(%q0),:%b)]. Please wait...;@tr me/TR.ADVANCE.%q1=%q0,%#}
&CMD.BUILD/CHECK <BT> Building Tracker Globals=$+build/check *:@switch [ifelse(isnum(%0),#[t(setr(0,extract(sortby(SORTBY.CREATED,lcon(%vb,OBJECTS)),%0,1)))],A[isdbref(setr(0,last(partial(iter(lcon(%vb,OBJECTS),[rest(name(%i0),:%b)]:%i0,,|),%0,|),:)))])][not(eq(get(%q0/D.STATUS),0))][t(setr(l,search(get(%q0/D.BUILDER))))]=#0*,{@pemit %#=There is no project by that number.},A0*,{@pemit %#=There is no project that matches that name.},?10*,{@pemit %#=You can only check on projects that are In Progress or Live.},?110,{@pemit %#=No objects found for that builder.},?111,{@pemit %#=[header(Building Check: [rest(name(%q0),:%b)])][null(iter(%ql,[setq(1,case(type(%i0),EXIT,e,THING,t,ROOM,r))][setq(%q1,setunion(r(%q1),%i0))]))];@if %qr={@pemit %#=[subheader(Rooms)];@pemit %#=[list(%qr,[rjust(inum(),2)]: [name(%i0)](%i0)%r[space(4)]Desc: [ifelse(strlen(get(%i0/desc)),Set,Not Set)])]};@if %qe={@pemit %#=[subheader(Exits)];@pemit %#=[list(%qe,[rjust(inum(),2)]: [name(%i0)](%i0)%r[space(4)]Desc: [ifelse(strlen(get(%i0/DESC)),Set,Not Set)]%tSucc: [ifelse(strlen(get(%i0/SUCC)),Set,Not Set)]%tOsucc: [ifelse(strlen(get(%i0/OSUCC)),Set,Not Set)]%tOdrop: [ifelse(strlen(get(%i0/ODROP)),Set,Not Set)])]};@if %qt={@pemit %#=[subheader(Objects)];@pemit %#=[list(%qt,[rjust(inum(),2)]: [name(%i0)](%i0))]};@wait 0={@pemit %#=[footer()]}}
&CMD.BUILD/UNAPPROVE <BT> Building Tracker Globals=$+build/unapprove *:@switch [ifelse(isnum(%0),#[t(setr(0,extract(sortby(SORTBY.CREATED,lcon(%vb,OBJECTS)),%0,1)))],A[isdbref(setr(0,last(partial(iter(lcon(%vb,OBJECTS),[rest(name(%i0),:%b)]:%i0,,|),%0,|),:)))])][eq(get(%q0/D.STATUS),2)]=#0*,{@pemit %#=There is no project by that number.},A0*,{@pemit %#=There is no project that matches that name.},?10,{@pemit %#=You can only unapprove builds that are live.},?11,{@tel [setr(e,regrab(iter(lexits(get(%q0/D.IC_LOC)),if(strmatch(%q0,zone(%i0)),%i0)),.+))]=%vn;@link [regrab(iter(lexits(loc(%qe)),if(strmatch(get(%q0/D.IC_LOC),loc(%i0)),%i0)),.+)]=%vn;&D.STATUS %q0=1;@set %q0=UNINSPECTED;@pemit %#=Done. Project [rest(name(%q0),:%b)] unapproved and sent back to the Building Nexus(%vn).}
&CMD.BUILD/DESTROY <BT> Building Tracker Globals=$+build/destroy *:@switch [ifelse(isnum(%0),#[t(setr(0,extract(sortby(SORTBY.CREATED,lcon(%vb,OBJECTS)),%0,1)))],A[isdbref(setr(0,last(partial(iter(lcon(%vb,OBJECTS),[rest(name(%i0),:%b)]:%i0,,|),%0,|),:)))])][hasflag(%#,WIZARD)]=#0*,{@pemit %#=There is no project by that number.},A0*,{@pemit %#=There is no project that matches that name.},?10,{@pemit %#=Permission denied.},?11,{@pemit %#=Destroying [rest(name(%q0),:%b)]...;@tr me/TR.DESTROY=%q0,%#}
&CMD.BUILD/ADDTYPE <BT> Building Tracker Globals=$+build/addtype */*=*:@switch [null(iter(lattr(%vb/D.PARENTLETTER.*),[setr(z,get(%vb/%i0))][setq(l,setunion(%ql,first(%qz,|)))][setq(d,setunion(%qd,rest(%qz,|),|))]))][eq(strlen(%0),1)][not(ismember(%ql,%0))][lte(strlen(%1),30)][not(ismember(%qd,%1,|))][isdbref(%2)][hasattr(%2,FN.DESC)][not(hasattr(%vb,D.PARENTLETTER.%2))]=0*,{@pemit %#=The type letter should be one character only.},10*,{@pemit %#=That type letter is already in use.},110*,{@pemit %#=The type description should be brief: 30 characters or less.},1110*,{@pemit %#=That type description is already in use.},11110*,{@pemit %#=The type parent must be the dbref of the parent object.},111110*,{@pemit %#=The parent object must have an FN.DESC attribute that will append command information to the bottom of the room description.},1111110,{@pemit %#=That parent object is already being used for another type.},1111111,{@pemit %#=Done. Added type [capstr(%0)] ([capall(%1)]) with parent %2.;&D.PARRENTLETTER.%2 %vb=[capstr(%0)]|[capall(%1)]}
&CMD.BUILD/TYPES <BT> Building Tracker Globals=$+build/types:@switch [t(lattr(%vb/D.PARENTLETTER.*))]=0,{@pemit %#=There are currently no type parents defined.},{@pemit %#=[header(Building Project Parents)]%r[iter(sort(setdiff(lattr(%vb/D.PARENTLETTER.*),D.PARENTLETTER.#-1)),[rjust(inum(),2)]: [name(last(%i0,.))] ([last(%i0,.)])%r[space(4)]In Use: [words(children(last(%i0,.)))]%b%bType Letter: [first(get(%vb/%i0),|)]%b%bDescription: [rest(get(%vb/%i0),|)],,%r)]%r[footer()]}
&FN.GOODTYPE <BT> Building Tracker Globals=localize(case(1,hasattr(%vb,D.PARENTLETTER.%1),1|%1,t(setr(0,partial(iter(lattr(%vb/D.PARENTLETTER.*),[first(get(%vb/%i0),|)]:[last(%i0,.)],,|),%1,|))),1|[rest(%q0,:)],0|No such type. See +build/types for a list.))
&FN.GOODSTATUS <BT> Building Tracker Globals=localize(case(1,hasflag(%0,UNINSPECTED),0|You cannot advance the status of a build whose current status is uninspected.,not(eq(%1,inc(get(%0/D.STATUS)))),0|You may only increment a build's status by 1.,1))
&FN.GOODOOC_OWNER <BT> Building Tracker Globals=localize(case(isdbref(setr(0,pmatch(%1))),1,1|%q0,0|No such player: %1))
&FN.GOODIC_OWNER <BT> Building Tracker Globals=1|[secure(%1)]
&FN.GOODBUILDER <BT> Building Tracker Globals=case(1,isdbref(pmatch(%1)),0|There is already a builder character by that name.,not(eq(get(%0/D.STATUS),0)),0|You may only set a builder in the approval stage of a project.,1|%1)
&FN.GOODQUOTA <BT> Building Tracker Globals=case(0,isposint(%1),0|That's not a reasonable number for project quota.,1|%1)
&FN.GOODDESC <BT> Building Tracker Globals=1|%1
&FN.GOODIC_LOC <BT> Building Tracker Globals=case(0,isdbref(%1),0|That is not a valid dbref.,hastype(%1,ROOM),0|Link location must be a room.,1|%1)
&TR.SETTYPE <BT> Building Tracker Globals=@parent %0=%1
&TR.SETSTATUS <BT> Building Tracker Globals=&D.STATUS %0=[inc(get(%0/D.STATUS))];@set %0=UNINSPECTED
&TR.SETOOC_OWNER <BT> Building Tracker Globals=&D.OOC_OWNER %0=%1
&TR.SETIC_OWNER <BT> Building Tracker Globals=&D.IC_OWNER %0=%1
&TR.SETBUILDER <BT> Building Tracker Globals=&D.BUILDER %0=%1
&TR.SETQUOTA <BT> Building Tracker Globals=&D.QUOTA %0=%1;@quota [get(%0/D.BUILDER)]=%1
&TR.SETDESC <BT> Building Tracker Globals=@desc %0=%1
&TR.SETIC_LOC <BT> Building Tracker Globals=&D.IC_LOC %0=%1
&FN.APPROVE.0 <BT> Building Tracker Globals=case(0,hasflag(%0,UNINSPECTED),0|That project has already been approved at its current status.,hasattr(%0,D.BUILDER),0|There is no builder set for that project.,not(isdbref(pmatch(get(%0/D.BUILDER)))),0|The builder name for that project has been taken.,gte(get(%0/D.QUOTA),3),0|A project must have at least 3 quota to be created.,t(parent(%0)),0|That project does not have a build type set.,1)
&FN.APPROVE.1 <BT> Building Tracker Globals=case(0,hasflag(%0,UNINSPECTED),0|That project has already been approved at its current status.,hasattr(%0,D.BUILDER),0|There is no builder set for that project.,isdbref(pmatch(get(%0/D.OOC_OWNER))),0|The OOC Owner set on the project is not a valid player.,strlen(get(%0/D.IC_OWNER)),0|That project does not have an IC Owner set.,strlen(get(%q0/DESC)),0|Please provide a short description of the project.,t(hastype(get(%0/D.IC_LOC),ROOM)),0|The IC link location for this project must be a room.,isposint(get(%0/D.QUOTA)),0|You must set a positive amount of quota for the project.,1)
&TR.ADVANCE.0 <BT> Building Tracker Globals=@pcreate [setr(b,get(%0/D.BUILDER))]=[setr(0,mid(lcstr(sha1(secs(,6))),rand(32),8))];@power [pmatch(%qb)]=builder;@quota/set [pmatch(%qb)]=[get(%0/D.QUOTA)];@tel [pmatch(%qb)]=%vn;&D.BUILDER %0=[pmatch(%qb)];&D.OWNERS %0=[pmatch(%qb)];@pemit %1=%qb created as [pmatch(%qb)] and @tel'd to the Building Nexus. Password is: %q0;&D.INITIALPASS %0=%q0;@chzone [pmatch(%qb)]=%0;@pemit %1=%qb has been zoned to [name(%0)]. Everything %qb creates will inherit this zone.;@fo [pmatch(%qb)]={@dig {Building Nexus -- [setr(n,rest(name(%0),:%b))]}={%qn <[setr(l,iter(extract(%qn,1,2),mid(%i0,0,1),,@@))]>;%ql},{Out <O>;out;o;back}};@wait 0={@pemit %1=Initial room and exits dug in the Building Nexus.;&D.STATUS %0=1;@set %0=UNINSPECTED}
&TR.ADVANCE.1 <BT> Building Tracker Globals=@tel [setq(b,get(%0/D.BUILDER))][setr(e,first(setinter(lexits(%vn),search(%qb))))]=[setr(l,get(%0/D.IC_LOC))];@link [regrab(iter(lexits(loc(%qe)),if(strmatch(%vn,loc(%i0)),%i0)),.+)]=%ql;@pemit %1=Exits moved to [name(%ql)](%ql) and relinked accordingly.;&D.STATUS %0=2
&TR.DESTROY <BT> Building Tracker Globals=@if [get(%0/D.STATUS)]={@dolist [search(get(%0/D.BUILDER))]={@destroy/override/instant ##};@destroy/override/instant [get(%0/D.BUILDER)]};@wait 0={@destroy/override/instant %0;@pemit %1=Done. [rest(name(%0),:%b)] has been destroyed.}
&SORTBY.CREATED <BT> Building Tracker Globals=comp(convtime(get(%0/Created)),convtime(get(%1/Created)))
&APR_ACCESS <BT> Building Tracker Globals=not(hasflag(v(D.BUILD),UNINSPECTED))
&COM_ACCESS <BT> Building Tracker Globals=not(hasflag(v(D.BUILD),UNINSPECTED))
@vb #11=#12
@vn #11=#55
@chown <BT> Building Tracker=#3
@set <BT> Building Tracker Globals=!HALTED INHERIT SAFE
@power <BT> Building Tracker Globals=builder
drop #11
@@
@@ #12: <BT> Building Tracker
@@
@create <BT> Building Tracker=10
&TR.CREATE <BT> Building Tracker=@create ZMO: %0;&D.OOC_OWNER [setr(0,lastcreate())]=%1;&D.STATUS %q0=0;@set %q0=UNINSPECTED SAFE INHERIT;@desc %q0=Proposed build project.
&D.PARENTLETTER.#-1 <BT> Building Tracker=X|None
&D.PARENTLETTER.#46 <BT> Building Tracker=R|Residential
&D.PARENTLETTER.#47 <BT> Building Tracker=B|Business
@chown <BT> Building Tracker=#3
@set <BT> Building Tracker=!HALTED INHERIT SAFE
@tel #12=#11
@@
@@ #13: <HP> Help Commands: Player
@@
think [ansi(hc,MUX Core:)] Installing +Help and +Shelp commands.
@create <HP> Help Commands: Player=10
&CMD.HELP <HP> Help Commands: Player=$+help:@pemit %#=[setq(0,%vh)][header([mudname()] +Help Files)]%r%r[setq(1,get(%#/D.READ.HELP))][iter([get(%q0/D.CATEGORIES)][if(hasattr(%q0,D.CAT.UNCATEGORIZED),|Uncategorized)],[subheader(%i0)]%r[edit(columns(iter(lcstr(get(%q0/D.CAT.[edit(%i0,%b,_)])),[ifelse(or(eq(strlen(grab(%q1,%i0:*,|)),0),lt(rest(grab(%q1,%i0:*,|),:),first(get(%q0/D.HELP.%i0),|))),%xh%xr*%xn,|)]%i0),18,,1),|,%b)],|,%r)]%r[footer()]
&CMD.HELP_WITH_ARG <HP> Help Commands: Player=$+help *:@switch/first [setq(0,%vh)][setq(1,ulocal(%q0/FN.MATCHFILE,%0))][not(strmatch(%0,*/*))][first(%q1,:)][t(strlen(grab(get(%q0/D.CATEGORIES),%0,|)))]=0*,,11*,{@pemit %#=[setq(z,get(%q0/D.HELP.[rest(%q1,:)]))][u(%q0/FN.DISPLAYFILE,rest(%q1,:),%qz,%#)];&D.READ.HELP %#=[ifelse(setr(3,grab(setr(2,get(%#/D.READ.HELP)),[rest(%q1,:)]:*,|)),replace(%q2,member(%q2,%q3,|),[rest(%q1,:)]:[secs()],|),setunion(%q2,[rest(%q1,:)]:[secs()],|))]},101,{@pemit %#=[header([mudname()] +Help Files)]%r%r[setq(1,get(%#/D.READ.HELP))][subheader(setr(2,grab(get(%q0/D.CATEGORIES),%0,|)))]%r%b[edit(columns(iter(lcstr(get(%q0/D.CAT.[edit(%q2,%b,_)])),[ifelse(strlen(grab(%q1,%i0:*,|)),|,%xh%xr*%xn)]%i0),18,,1),|,%b)]%r[footer()]},{@pemit %#=No file or category matches '%0'.;@cemit Scan=Failed +help: %N tried '+help %xh%0%xn'.}
&CMD.HELP_SUB <HP> Help Commands: Player=$+help */*:@switch [setq(0,%vh)][setq(2,ulocal(%q0/FN.MATCHFILE,%0))][first(%q2,:)][hasattr(%q0,D.HELP.[rest(%q2,:)].%1)]=0*,{@pemit %#=No such main help file '%0'.},10,{@pemit %#=No such sub help file '%1' for '%0'.},11,{@pemit %#=[setq(z,get(%q0/D.HELP.[rest(%q2,:)].%1))][u(%q0/FN.DISPLAYSUBFILE,lcstr(rest(%q2,:)),lcstr(%1),%qz)];&D.READ.HELP %#=[ifelse(setr(3,grab(setr(4,get(%#/D.READ.HELP)),[rest(%q2,:)].%1:*,|)),replace(%q4,member(%q4,%q3,|),[rest(%q2,:)].[lcstr(%1)]:[secs()],|),setunion(%q4,[rest(%q2,:)].[lcstr(%1)]:[secs()],|))]}
@VH <HP> Help Commands: Player=#16
@chown <HP> Help Commands: Player=#3
@set <HP> Help Commands: Player=!HALTED INHERIT SAFE
drop #13
@@
@@ #14: <HS> Help Commands: Staff
@@
@create <HS> Help Commands: Staff=10
&CMD.HELP/ADD <HS> Help Commands: Staff=$+help/add *=*:@switch [setq(0,%vh)][not(gt(words(%0),1))][not(gt(strlen(%0),17))][setq(1,ulocal(%q0/FN.MATCHFILE,%0))][not(first(%q1,:))]=0*,{@pemit %#=Help file names must be one word.},10*,{@pemit %#=Help file names must not exceed 17 characters.},110,{@pemit %#=There is already a help file by that name or keyword.},111,{&D.HELP.%0 %q0=[secs()]|||[edit(%1,|,(pipe))];@pemit %#=Done. New file '%0' created.;+help/update}
&CMD.HELP/CAT <HS> Help Commands: Staff=$+help/cat *=*:@switch [setq(0,%vh)][setq(1,ulocal(%q0/FN.MATCHFILE,%0))][first(%q1,:)][t(strlen(grab(get(%q0/D.CATEGORIES),%1,|)))]=0*,{@pemit %#=No such no help file '%0'.},10,{@pemit %#=No such category '%1'.},11,{&D.HELP.[rest(%q1,:)] %q0=[replace(get(%q0/D.HELP.[rest(%q1,:)]),3,%1,|)];@Pemit %#=Done. Category of file '[rest(%q1,:)]' set to '[lcstr(%1)]'.;+help/update}
&CMD.HELP/ADDKEY <HS> Help Commands: Staff=$+help/addkey *=*:@switch [setq(0,%vh)][setq(f,ulocal(%q0/FN.MATCHFILE,%0))][first(%qf,:)][not(t(strlen(setr(1,grab(get(%q0/D.KEYWORDS),%1:*,|)))))]=0*,{@pemit %#=No such help file '%0'.},10,{@pemit %#=The keyword '%1' is already in use for file [rest(%q1,:)].},11,{&D.HELP.[rest(%qf,:)] %q0=[setq(2,get(%q0/D.HELP.[rest(%qf,:)]))][replace(%q2,2,setunion(extract(%q2,2,1,|),lcstr(%1)),|)];&D.KEYWORDS %q0=[setunion(get(%q0/D.KEYWORDS),[lcstr(%1)]:[rest(%qf,:)],|)];@pemit %#=Done. Keyword '[lcstr(%1)]' added as an alias for file '[rest(%qf,:)]'.;+help/update}
&CMD.HELP/DELKEY <HS> Help Commands: Staff=$+help/delkey *=*:@switch [setq(0,%vh)][setq(1,ulocal(%q0/FN.MATCHFILE,%0))][first(%q1,:)][and(strlen(setr(2,grab(get(%q0/D.KEYWORDS),%1:*,|))),strmatch(rest(%q1,:),rest(%q2,:)))]=0*,{@pemit %#=No such help file '%0'},10,{@pemit %#=No such keyword '%1' for main file '[rest(%q1,:)]'.},11,{&D.HELP.[rest(%q1,:)] %q0=[setq(3,get(%q0/D.HELP.[rest(%q1,:)]))][replace(%q3,2,setdiff(extract(%q3,2,1,|),lcstr(first(%q2,:))),|)];@pemit %#=Done. Keyword '[lcstr(%1)]' deleted as an alias for file '[rest(%q1,:)]'.;+help/update}
&CMD.HELP/ADDSUB <HS> Help Commands: Staff=$+help/addsub */*=*:@switch [setq(0,%vh)][not(gt(words(%1),1))][not(gt(strlen(%1,20)))][setq(1,ulocal(%q0/FN.MATCHFILE,%0))][first(%q1,:)][not(hasattr(%q0,D.HELP.[rest(%q1,:)].%1))]=0*,{@pemit %#=Sub-Title names must be one word.},10*,{@pemit %#=Sub-Title names must not exceed 20 characters.},110*,{@pemit %#=No such main help file '%0'.},1110,{@pemit %#=There is already a sub-file of '[rest(%q1,:)]' by that name.},1111,{&D.HELP.[rest(%q1,:)].%1 %q0=[secs()]|[edit(%2,|,(pipe))];@pemit %#=Done. New sub-file '%1' created.;+help/update}
&CMD.HELP/VIEWCODE <HS> Help Commands: Staff=$+help/viewcode *:@switch [setq(0,%vh)][setq(1,ulocal(%q0/FN.MATCHFILE,%0))][not(strmatch(%0,*/*))][first(%q1,:)]=0*,,10,{@pemit %#=No such main help file '[lcstr(%0)]'.},11,{@Pemit %#=The unparsed data for %xh[rest(%q1,:)]%xn follows:%r%b[translate(edit(last(get(%q0/D.HELP.[rest(%q1,:)]),|),(pipe),|),1)]}
&CMD.HELP/VIEWCODE-SUB <HS> Help Commands: Staff=$+help/viewcode */*:@switch [setq(0,%vh)][setq(1,ulocal(%q0/FN.MATCHFILE,%0))][first(%q1,:)][hasattr(%q0,D.HELP.[rest(%q1,:)].%1)]=0*,{@pemit %#=No such main help file '%0'.},10,{@pemit %#=No such sub help file '%1' for '[rest(%q1,:)]'.},11,{@pemit %#=The unparsed data for %xh[lcstr(rest(%q1,:))]/[lcstr(%1)]%xn follows:%r%b[translate(edit(last(get(%q0/D.HELP.[rest(%q1,:)].%1),|),(pipe),|),1)]}
&CMD.HELP/EDIT <HS> Help Commands: Staff=$+help/edit *=*,*:@switch [setq(0,%vh)][setq(1,ulocal(%q0/FN.MATCHFILE,%0))][first(%q1,:)]=0,{@pemit %#=No such main help file '%0'.},1,{&D.HELP.[rest(%q1,:)] %q0=[setq(2,get(%q0/D.HELP.[rest(%q1,:)]))][secs()]|[replace(rest(%q2,|),3,edit(extract(%q2,4,1,|),edit(%1,|,(pipe)),edit(%2,|,(pipe))),|)];@pemit %#=Done. Edit applied.;@fo %#=+help %0}
&CMD.HELP/EDITSUB <HS> Help Commands: Staff=$+help/editsub */*=*,*:@switch [setq(0,%vh)][setq(1,ulocal(%q0/FN.MATCHFILE,%0))][first(%q1,:)][hasattr(%q0,D.HELP.[rest(%q1,:)].%1)]=0*,{@pemit %#=No such main help file '%0'.},10,{@pemit %#=No such sub help file '%1' for '[rest(%q1,:)]'.},11,{&D.HELP.[rest(%q1,:)].%1 %q0=[setq(2,get(%q0/D.HELP.[rest(%q1,:)].%1))][secs()]|[edit(rest(%q2,|),edit(%2,|,(pipe)),edit(%3,|,(pipe)))];@pemit %#=Done. Edit applied.;@fo %#=+help %0/%1}
&CMD.HELP/STAFFHELP <HS> Help Commands: Staff=$+help/staffhelp:@pemit %#=[header([mudname()] Staff +Help Commands)]%r%b+help/add <filename>=<text>%r%b+help/cat <filename>=<category>%r%b+help/addkey <filename>=<additional keyword>%r%b+help/delkey <filename>=<keyword to delete>%r%b+help/edit <file>=<old>,<new> (Search and replace)%r%t - Note you can use ^,<text> to add to the very beginning%r%t[space(3)]of a file, and $,<text> to add to the very end.%r%b+help/viewcode (Returns unparsed text)%r[space(4)]CATEGORIES: [wrap(itemize(get(%vh/D.CATEGORIES),|),78,,,,16,,60)]%r%b+help/addsub <main file>/<sub file>=<text>%r%b+help/editsub <main>/<sub>=<old>,<new> (Same rules as above)%r%b+help/viewcode <main>/<sub>%r%r%b+help/update (Index help files)%r[footer()]
&CMD.HELP/UPDATE <HS> Help Commands: Staff=$+help/update:@tr %vh/startup=quiet;@pemit %#=Done. Help files and categories indexed.
&CMD.SHELP <HS> Help Commands: Staff=$+shelp:@pemit %#=[setq(0,%vs)][header([mudname()] +Shelp Files)]%r%r[setq(1,get(%#/D.READ.SHELP))][iter([get(%q0/D.CATEGORIES)][if(hasattr(%q0,D.CAT.UNCATEGORIZED),|Uncategorized)],[subheader(%i0)]%r[edit(columns(iter(lcstr(get(%q0/D.CAT.[edit(%i0,%b,_)])),[ifelse(or(eq(strlen(grab(%q1,%i0:*,|)),0),lt(rest(grab(%q1,%i0:*,|),:),first(get(%q0/D.SHELP.%i0),|))),%xh%xr*%xn,|)]%i0),18,,1),|,%b)],|,%r)]%r[footer()]
&CMD.SHELP_WITH_ARG <HS> Help Commands: Staff=$+shelp *:@switch/first [setq(0,%vs)][setq(1,ulocal(%q0/FN.MATCHFILE,%0))][not(strmatch(%0,*/*))][first(%q1,:)][t(strlen(grab(get(%q0/D.CATEGORIES),%0,|)))]=0*,,11*,{@pemit %#=[setq(z,get(%q0/D.SHELP.[rest(%q1,:)]))][u(%q0/FN.DISPLAYFILE,rest(%q1,:),%qz,%#)];&D.READ.SHELP %#=[ifelse(setr(3,grab(setr(2,get(%#/D.READ.SHELP)),[rest(%q1,:)]:*,|)),replace(%q2,member(%q2,%q3,|),[rest(%q1,:)]:[secs()],|),setunion(%q2,[rest(%q1,:)]:[secs()],|))]},101,{@pemit %#=[header([mudname()] +Shelp Files)]%r%r[setq(1,get(%#/D.READ.SHELP))][subheader(setr(2,grab(get(%q0/D.CATEGORIES),%0,|)))]%r%b[edit(columns(iter(lcstr(get(%q0/D.CAT.[edit(%q2,%b,_)])),[ifelse(strlen(grab(%q1,%i0:*,|)),|,%xh%xr*%xn)]%i0),18,,1),|,%b)]%r[footer()]},{@pemit %#=No file or category matches '%0'.;@cemit Scan=Failed +shelp: %N tried '+shelp %xh%0%xn'.}
&CMD.SHELP_SUB <HS> Help Commands: Staff=$+shelp */*:@switch [setq(0,%vs)][setq(2,ulocal(%q0/FN.MATCHFILE,%0))][first(%q2,:)][hasattr(%q0,D.SHELP.[rest(%q2,:)].%1)]=0*,{@pemit %#=No such main help file '%0'.},10,{@pemit %#=No such sub help file '%1' for '%0'.},11,{@pemit %#=[setq(z,get(%q0/D.SHELP.[rest(%q2,:)].%1))][u(%q0/FN.DISPLAYSUBFILE,lcstr(rest(%q2,:)),lcstr(%1),%qz)];&D.READ.SHELP %#=[ifelse(setr(3,grab(setr(4,get(%#/D.READ.SHELP)),[rest(%q2,:)].%1:*,|)),replace(%q4,member(%q4,%q3,|),[rest(%q2,:)].[lcstr(%1)]:[secs()],|),setunion(%q4,[rest(%q2,:)].[lcstr(%1)]:[secs()],|))]}
&CMD.SHELP/ADD <HS> Help Commands: Staff=$+shelp/add *=*:@switch [setq(0,%vs)][not(gt(words(%0),1))][not(gt(strlen(%0),17))][setq(1,ulocal(%q0/FN.MATCHFILE,%0))][not(first(%q1,:))]=0*,{@pemit %#=Help file names must be one word.},10*,{@pemit %#=Help file names must not exceed 17 characters.},110,{@pemit %#=There is already a help file by that name or keyword.},111,{&D.SHELP.%0 %q0=[secs()]|||[edit(%1,|,(pipe))];@pemit %#=Done. New file '%0' created.;+shelp/update}
&CMD.SHELP/CAT <HS> Help Commands: Staff=$+shelp/cat *=*:@switch [setq(0,%vs)][setq(1,ulocal(%q0/FN.MATCHFILE,%0))][first(%q1,:)][t(strlen(grab(get(%q0/D.CATEGORIES),%1,|)))]=0*,{@pemit %#=No such no help file '%0'.},10,{@pemit %#=No such category '%1'.},11,{&D.SHELP.[rest(%q1,:)] %q0=[replace(get(%q0/D.SHELP.[rest(%q1,:)]),3,%1,|)];@Pemit %#=Done. Category of file '[rest(%q1,:)]' set to '[lcstr(%1)]'.;+shelp/update}
&CMD.SHELP/ADDKEY <HS> Help Commands: Staff=$+shelp/addkey *=*:@switch [setq(0,%vs)][setq(f,ulocal(%q0/FN.MATCHFILE,%0))][first(%qf,:)][not(t(strlen(setr(1,grab(get(%q0/D.KEYWORDS),%1:*,|)))))]=0*,{@pemit %#=No such help file '%0'.},10,{@pemit %#=The keyword '%1' is already in use for file [rest(%q1,:)].},11,{&D.SHELP.[rest(%qf,:)] %q0=[setq(2,get(%q0/D.SHELP.[rest(%qf,:)]))][replace(%q2,2,setunion(extract(%q2,2,1,|),lcstr(%1)),|)];&D.KEYWORDS %q0=[setunion(get(%q0/D.KEYWORDS),[lcstr(%1)]:[rest(%qf,:)],|)];@pemit %#=Done. Keyword '[lcstr(%1)]' added as an alias for file '[rest(%qf,:)]'.;+shelp/update}
&CMD.SHELP/DELKEY <HS> Help Commands: Staff=$+shelp/delkey *=*:@switch [setq(0,%vs)][setq(1,ulocal(%q0/FN.MATCHFILE,%0))][first(%q1,:)][and(strlen(setr(2,grab(get(%q0/D.KEYWORDS),%1:*,|))),strmatch(rest(%q1,:),rest(%q2,:)))]=0*,{@pemit %#=No such help file '%0'},10,{@pemit %#=No such keyword '%1' for main file '[rest(%q1,:)]'.},11,{&D.SHELP.[rest(%q1,:)] %q0=[setq(3,get(%q0/D.SHELP.[rest(%q1,:)]))][replace(%q3,2,setdiff(extract(%q3,2,1,|),lcstr(first(%q2,:))),|)];@pemit %#=Done. Keyword '[lcstr(%1)]' deleted as an alias for file '[rest(%q1,:)]'.;+shelp/update}
&CMD.SHELP/ADDSUB <HS> Help Commands: Staff=$+shelp/addsub */*=*:@switch [setq(0,%vs)][not(gt(words(%1),1))][not(gt(strlen(%1,20)))][setq(1,ulocal(%q0/FN.MATCHFILE,%0))][first(%q1,:)][not(hasattr(%q0,D.SHELP.[rest(%q1,:)].%1))]=0*,{@pemit %#=Sub-Title names must be one word.},10*,{@pemit %#=Sub-Title names must not exceed 20 characters.},110*,{@pemit %#=No such main help file '%0'.},1110,{@pemit %#=There is already a sub-file of '[rest(%q1,:)]' by that name.},1111,{&D.SHELP.[rest(%q1,:)].%1 %q0=[secs()]|[edit(%2,|,(pipe))];@pemit %#=Done. New sub-file '%1' created.;s+help/update}
&CMD.SHELP/VIEWCODE <HS> Help Commands: Staff=$+shelp/viewcode *:@switch [setq(0,%vs)][setq(1,ulocal(%q0/FN.MATCHFILE,%0))][not(strmatch(%0,*/*))][first(%q1,:)]=0*,,10,{@pemit %#=No such main help file '[lcstr(%0)]'.},11,{@Pemit %#=The unparsed data for %xh[rest(%q1,:)]%xn follows:%r%b[translate(edit(last(get(%q0/D.SHELP.[rest(%q1,:)]),|),(pipe),|),1)]}
&CMD.SHELP/VIEWCODE-SUB <HS> Help Commands: Staff=$+shelp/viewcode */*:@switch [setq(0,%vs)][setq(1,ulocal(%q0/FN.MATCHFILE,%0))][first(%q1,:)][hasattr(%q0,D.SHELP.[rest(%q1,:)].%1)]=0*,{@pemit %#=No such main help file '%0'.},10,{@pemit %#=No such sub help file '%1' for '[rest(%q1,:)]'.},11,{@pemit %#=The unparsed data for %xh[lcstr(rest(%q1,:))]/[lcstr(%1)]%xn follows:%r%b[translate(edit(last(get(%q0/D.SHELP.[rest(%q1,:)].%1),|),(pipe),|),1)]}
&CMD.SHELP/EDIT <HS> Help Commands: Staff=$+shelp/edit *=*,*:@switch [setq(0,%vs)][setq(1,ulocal(%q0/FN.MATCHFILE,%0))][first(%q1,:)]=0,{@pemit %#=No such main help file '%0'.},1,{&D.SHELP.[rest(%q1,:)] %q0=[setq(2,get(%q0/D.SHELP.[rest(%q1,:)]))][secs()]|[replace(rest(%q2,|),3,edit(extract(%q2,4,1,|),edit(%1,|,(pipe)),edit(%2,|,(pipe))),|)];@pemit %#=Done. Edit applied.;@fo %#=+shelp %0}
&CMD.SHELP/EDITSUB <HS> Help Commands: Staff=$+shelp/editsub */*=*,*:@switch [setq(0,%vs)][setq(1,ulocal(%q0/FN.MATCHFILE,%0))][first(%q1,:)][hasattr(%q0,D.SHELP.[rest(%q1,:)].%1)]=0*,{@pemit %#=No such main help file '%0'.},10,{@pemit %#=No such sub help file '%1' for '[rest(%q1,:)]'.},11,{&D.SHELP.[rest(%q1,:)].%1 %q0=[setq(2,get(%q0/D.SHELP.[rest(%q1,:)].%1))][secs()]|[edit(rest(%q2,|),edit(%2,|,(pipe)),edit(%3,|,(pipe)))];@pemit %#=Done. Edit applied.;@fo %#=+shelp %0/%1}
&CMD.SHELP/STAFFHELP <HS> Help Commands: Staff=$+shelp/staffhelp:@pemit %#=[header([mudname()] Staff +Help Commands)]%r%b+shelp/add <filename>=<text>%r%b+shelp/cat <filename>=<category>%r%b+shelp/addkey <filename>=<additional keyword>%r%b+shelp/delkey <filename>=<keyword to delete>%r%b+shelp/edit <file>=<old>,<new> (Search and replace)%r%t - Note you can use ^,<text> to add to the very beginning%r%t[space(3)]of a file, and $,<text> to add to the very end.%r%b+shelp/viewcode (Returns unparsed text)%r[space(4)]CATEGORIES: [wrap(itemize(get(%vs/D.CATEGORIES),|),78,,,,16,,60)]%r%b+shelp/addsub <main file>/<sub file>=<text>%r%b+shelp/editsub <main>/<sub>=<old>,<new> (Same rules as above)%r%b+shelp/viewcode <main>/<sub>%r%r%b+shelp/update (Index help files)%r[footer()]
&CMD.SHELP/UPDATE <HS> Help Commands: Staff=$+shelp/update:@tr %vs/startup=quiet;@pemit %#=Done. Staff help files and categories indexed.
&ISSTAFF #14=isstaff(owner(%#))
@lock/uselock #14=ISSTAFF/1
@VH #14=#16
@VS #14=#17
@chown <HS> Help Commands: Staff=#3
@set <HS> Help Commands: Staff=!HALTED INHERIT SAFE
drop #14
@@
@@ #15: <HW> Help Commands: Wizard
@@
@create <HW> Help Commands: Wizard=10
&CMD.HELP/DELSUB <HW> Help Commands: Wizard=$+help/delsub */*:@switch [setq(0,%vh)][setq(1,ulocal(%q0/FN.MATCHFILE,%0))][first(%q1,:)][hasattr(%q0,D.HELP.[rest(%q1,:)].%1)]=0*,{@pemit %#=No such main help file '%0'.},10,{@pemit %#=No such sub help file '%1' for '[rest(%q1,:)]'.},11,{&D.HELP.[rest(%q1,:)].%1 %q0;@pemit %#=Done. Sub file '%1' of '[rest(%q1,:)]' deleted.;+help/update}}
&CMD.HELP/DELMAIN <HW> Help Commands: Wizard=$+help/del *:@switch [setq(0,%vh)][setq(1,ulocal(%q0/FN.MATCHFILE,%0))][first(%q1,:)][not(t(words(setr(2,lattr(%q0/D.HELP.[rest(%q1,:)].*)))))]=0*,{@pemit %#=No such main help file '%0'.},10,{@pemit %#=File '%0' still has sub files: [itemize(iter(lcstr(%q2),last(%i0,.)))].},11,{&D.HELP.[rest(%q1,:)] %q0;@pemit %#=Done. Main help file '[rest(%q1,:)]' deleted.;+help/update}
&CMD.HELP/DELALL <HW> Help Commands: Wizard=$+help/delall *:@switch [setq(0,%vh)][setq(1,ulocal(%q0/FN.MATCHFILE,%0))][first(%q1,:)][t(words(lattr(%q0/D.HELP.[rest(%q1,:)].*)))]=0*,{@pemit %#=No such main help file '%0'.},10,{@pemit %#=There are no sub files for that file.},11,{@wipe %q0/D.HELP.[rest(%q1,:)].*;@pemit %#=Done. All sub files for file '%0' deleted.;+help/update}
&CMD.HELP/WIZHELP <HW> Help Commands: Wizard=$+help/wizhelp:@pemit %#=[header([mudname()] Wizard +Help Commands)]%r%b+help/add <filename>=<text>%r%b+help/cat <filename>=<category>%r%b+help/addkey <filename>=<additional keyword>%r%b+help/delkey <filename>=<keyword to delete>%r%b+help/edit <file>=<old>,<new> (Search and replace)%r%t - Note you can use ^,<text> to add to the very beginning%r%t[space(3)]of a file, and $,<text> to add to the very end.%r%b+help/viewcode (Returns unparsed text)%r%b+help/delmain <filename>%r%b+help/delall <filename> (Deletes all sub files)%r[space(4)]CATEGORIES: [wrap(itemize(get(%vh/D.CATEGORIES),|),78,,,,16,,60)]%r%b+help/addsub <main file>/<sub file>=<text>%r%b+help/editsub <main>/<sub>=<old>,<new> (Same rules as above)%r%b+help/viewcode <main>/<sub>%r%b+help/delsub <main>/<sub>%r%r%b+help/update (Index help files)%r[footer()]
&CMD.SHELP/DELSUB <HW> Help Commands: Wizard=$+shelp/delsub */*:@switch [setq(0,%vs)][setq(1,ulocal(%q0/FN.MATCHFILE,%0))][first(%q1,:)][hasattr(%q0,D.SHELP.[rest(%q1,:)].%1)]=0*,{@pemit %#=No such main help file '%0'.},10,{@pemit %#=No such sub help file '%1' for '[rest(%q1,:)]'.},11,{&D.SHELP.[rest(%q1,:)].%1 %q0;@pemit %#=Done. Sub file '%1' of '[rest(%q1,:)]' deleted.;+shelp/update}}
&CMD.SHELP/DELMAIN <HW> Help Commands: Wizard=$+shelp/del *:@switch [setq(0,%vs)][setq(1,ulocal(%q0/FN.MATCHFILE,%0))][first(%q1,:)][not(t(words(setr(2,lattr(%q0/D.SHELP.[rest(%q1,:)].*)))))]=0*,{@pemit %#=No such main help file '%0'.},10,{@pemit %#=File '%0' still has sub files: [itemize(iter(lcstr(%q2),last(%i0,.)))].},11,{&D.SHELP.[rest(%q1,:)] %q0;@pemit %#=Done. Main help file '[rest(%q1,:)]' deleted.;+shelp/update}
&CMD.SHELP/DELALL <HW> Help Commands: Wizard=$+shelp/delall *:@switch [setq(0,%vs)][setq(1,ulocal(%q0/FN.MATCHFILE,%0))][first(%q1,:)][t(words(lattr(%q0/D.SHELP.[rest(%q1,:)].*)))]=0*,{@pemit %#=No such main help file '%0'.},10,{@pemit %#=There are no sub files for that file.},11,{@wipe %q0/D.SHELP.[rest(%q1,:)].*;@pemit %#=Done. All sub files for file '%0' deleted.;+shelp/update}
&CMD.SHELP/WIZHELP <HW> Help Commands: Wizard=$+shelp/wizhelp:@pemit %#=[header([mudname()] Wizard +Help Commands)]%r%b+shelp/add <filename>=<text>%r%b+shelp/cat <filename>=<category>%r%b+shelp/addkey <filename>=<additional keyword>%r%b+shelp/delkey <filename>=<keyword to delete>%r%b+shelp/edit <file>=<old>,<new> (Search and replace)%r%t - Note you can use ^,<text> to add to the very beginning%r%t[space(3)]of a file, and $,<text> to add to the very end.%r%b+shelp/viewcode (Returns unparsed text)%r%b+shelp/delmain <filename>%r%b+shelp/delall <filename> (Deletes all sub files)%r[space(4)]CATEGORIES: [wrap(itemize(get(%vs/D.CATEGORIES),|),78,,,,16,,60)]%r%b+shelp/addsub <main file>/<sub file>=<text>%r%b+shelp/editsub <main>/<sub>=<old>,<new> (Same rules as above)%r%b+shelp/viewcode <main>/<sub>%r%b+shelp/delsub <main>/<sub>%r%r%b+shelp/update (Index help files)%r[footer()]
&ISWIZARD #15=hasflag(%#,WIZARD)
@lock/uselock #15=ISWIZARD/1
@VH <HW> Help Commands: Wizard=#16
@VS <HW> Help Commands: Wizard=#17
@chown <HW> Help Commands: Wizard=#3
@set <HW> Help Commands: Wizard=!HALTED INHERIT SAFE
drop #15
@@
@@ #16: DB: +Help
@@
think [ansi(hc,MUX Core:)] Creating the +Help database and installing files.
@create DB: +Help=10
@Startup DB: +Help=@wipe me/D.CAT.*;@wipe me/D.KEYWORDS;@dolist [filter(me/FIL.FILELIST,lattr(me/D.HELP.*),,,help)]={@if [t(strlen(grab(v(D.CATEGORIES),setr(1,extract(v(##),3,1,|)),|)))]={&D.CAT.[edit(%q1,%b,_)] me=[setunion(v(D.CAT.[edit(%q1,%b,_)]),last(##,.))]},{&D.CAT.UNCATEGORIZED me=[setunion(v(D.CAT.UNCATEGORIZED),last(##,.))]};&D.KEYWORDS me=[setunion(v(D.KEYWORDS),iter(extract(v(##),2,1,|),%i0:[lcstr(last(##,.))],,|),|)]};@if [not(strmatch(%0,quiet))]={@cemit Scan=Help file categories and keywords indexed.}
&D.CATEGORIES DB: +Help=IC Commands|OOC Commands|Systems
&FIL.FILELIST DB: +Help=regmatchi(%0,^D\.HELP\.\[^.\]+$)
&FN.DISPLAYFILE DB: +Help=[header(+Help [capstr(%0)])]%r[if(isstaff(%#),%xh%xrKeywords: %0 [extract(%1,2,1,|)]%r[subheader()]%r)][edit(last(%1,|),(pipe),|)]%r%r[if(setr(0,lattr(me/D.HELP.%0.*)),[subheader()]%rUse %xh'+help %0/<Sub-Category>'%xn to read the following files:%r%r%b[wrap(iter(lcstr(%q0),ljust([ifelse(or(eq(strlen(grab(get(%2/D.READ.HELP),[rest(%i0,d.help.)]:*,|)),0),lt(rest(grab(get(%2/D.READ.HELP),[rest(%i0,d.help.)]:*,|),:),first(get(me/%i0),|))),%xh%xr*%xn,%b)][last(%i0,.)],18)),76,,,,1)]%r%r)][rjust(%xhLast Updated on [elements(convsecs(first(%1,|)),2 3 5)]%xn%b,78)]%r[footer()]
&FN.DISPLAYSUBFILE DB: +Help=[header(+Help [capstr(%0)]/[capstr(%1)])]%r[edit(last(%2,|),(pipe),|)]%r%r[rjust(%xhLast Updated on [elements(convsecs(first(%2,|)),2 3 5)]%xn%b,78)]%r[footer()]
&FN.MATCHFILE DB: +Help=[setq(0,num(me))][setq(2,0)][if(t(strlen(setr(1,grab(get(%q0/D.KEYWORDS),%0:*,|)))),setq(2,1:[rest(%q1,:)]))][if(hasattr(%q0,D.HELP.%0),setq(2,1:[lcstr(%0)]))]%q2
@chown DB: +Help=#3
@set DB: +Help=!HALTED INHERIT SAFE
+help/add +finger=%b%b[ansi(h,Syntax:)]%b+finger <name>%r%r%b%bThis command displays useful information about a player. You can also type '+finger me' to see your own finger information. There are a variety of built-in finger fields, but there are also additional fields that you can customize yourself. For more information on setting up your +finger, see the 'finger-setup' sub file.
+help/add +staff=%b%b[ansi(h,Syntax:)]%b+staff%r[space(10)]+staff/all%r%r%b%bThis command shows a list of all connected, visible staff along with their status and idle time. The second form of the command lists all staff, regardless of connection status, with online staffers shown first.
+help/add +uptime=%b%b[ansi(h,Syntax:)]%b+uptime%r%r%b%bThis command displays basic runtime statistics for the game, such as boot time, current server time, and the game server's uptime.
+help/add +who=%b%b[ansi(h,Syntax:)]%b+who%r%r%b%bThis command displays an alternate WHO that lists player sex, alias, idle time, status, and location (if not unfindable). For similar commands, see: +3who, +where, and +hangouts.
+help/add +jnotes=%b%b[ansi(h,Syntax:)]%b+jnotes me%r[space(10)]+jnotes me/<number or name>%r[space(10)]+jnote/pitch <title>=<data>%r[space(10)]+jnote/pitch <obj>/<title>=<data>%r[space(10)]+jnote/show <title> to <player>%r%r%b%bThis set of commands allows you to manage judgenotes on your character-- that is, notes approved by staff that denote additional powers or other information about your character which you may want recorded. The first command lists your jnotes, and the second command will view them. You can view notes either by number or by their title.%r%r%b%bThe third form of the command proposes a new jnote for your character. A job will be opened about the note, and if it is approved by staff, your note will be set. You may want to use the +myjobs command to stay apprised of the status of your request. The fourth form of the command functions similarly, but allows you to pitch notes for things that you control. The fifth form of the command shows your jnote to another player. They will see your note, and can verify its authenticity with the +verify command. 
+help/addsub +finger/finger-setup=The following finger categories are built-in. To set them, use &<field> me=<data>%r%r%b%b[ljust(FULLNAME,15,.)]%bYour character's full name.%r%b%b[ljust(AGE,15,.)]%bYour character's true age.%r%b%b[ljust(APP-AGE,15,.)]%bYour character's apparent age.%r%b%b[ljust(POSITION,15,.)]%bYour character's IC position.%r%b%b[ljust(FAME,15,.)]%bWhat your character is famous for.%r%b%b[ljust(RP-PREFS,15,.)]%bYour roleplay preferences.%r%b%b[ljust(ALTS,15,.)]%bThe names of your other characters.%r%b%b[ljust(THEMESONG,15,.)]%bYour character's theme song.%r%b%b[ljust(QUOTE,15,.)]%bA quote from your character, or that describes them.%r%b%b[ljust(HOURS,15,.)]%bYour typical online hours.%r%b%b[ljust(TEMPERAMENT,15,.)]%bA brief synopsis of your character's personality.%r%b%b[ljust(VACATION,15,.)]%bUseful for letting others know if you'll be away.%r%b%b[ljust(URL,15,.)]%bYour character website, if applicable.%r%b%b[ljust(WIKI,15,.)]%bYour character wiki page, if applicable.%r%r%b%bYou can also set up custom finger attributes. If you want to set an attribute called "More Detail" you could type &FINGER-MORE_DETAIL me=<data>, and it would show in your +finger. Note that field names longer than 11 characters are truncated.
+help/add +bg=%b%b[ansi(h,Syntax:)]%b+bgadd <number>=<text>%r[space(10)]+bgedit <number>=<old>/<new>%r[space(10)]+bgclear <number>%r[space(10)]+bglist%r[space(10)]+bg <number>%r[space(10)]+bgsubmit%r%r%b%bThis set of commands allows you to manage your character's background story. The first command adds a new section. The second allows you to edit that section in the event of typos or changes. The third clears a section completely to allow you to retart it. The fourth gives a list of all your background sections, and the fifth allows you to read them.%r%r%b%bThe final command submits your background for approval and sets your character as waiting for approval. A job is created regarding your background, which will allow staff to communicate with you more easily in the event that changes are necessary. If this job is approved, your background is approved as well. You may want to familiarize yourself with the +myjobs commands to stay up to date with the status of your approval.
+help/add locks=%b%b[ansi(h,Syntax:)]%block <exit>%r[space(10)]unlock <exit>%r%r%b%bThe lock and unlock commands allow you to lock or unlock exits that you have keys to. All exits in building projects (areas of the game outside the main "street" areas) have lists that show who controls them. A lock can be set as 'owners', 'tenants', 'keys', or 'none'. Each level can control locks set to the levels below it. For example, locks set 'none' cannot be locked or unlocked by anyone. Locks set to 'tenants' can only be unlocked by a tenant or an owner, and so forth.
+help/add +view=%b%b[ansi(h,Syntax:)]%b+view%r[space(10)]+view <target>%r[space(10)]+view <target>/<name>%r%r%b%bViews are a way to expand the detail of a thing with data that might not necessarily fit well, or concisely, in its description. To see a list of all views in your current location, including players, objects, and exits, type +view. The second command shows only a list of those views on the target. The final command allows you to read those views. Note that you can use 'me' to refer to yourself and 'here' to refer to your location.%r%r%b%bTo set a view, simply type &VIEW-<name> <target>=Stuff. The name should have spaces replaced with underscores (ie: &VIEW-EYE_COLOR me=Brown). You can only set views on things you control, such as yourself or objects you create.
+help/add +3who=%b%b[ansi(h,Syntax:)]%b+3who%r%r%b%bThis command is similar to +who, but shows the list sorted into three columns. This is useful for games with lots of players where the regular who or +who lists scroll off your screen.
+help/add +where=%b%b[ansi(h,Syntax:)]%b+where%r%r%b%bSimilar to +who, this command shows a list of online players sorted by their location. If the location is JUMP_OK and you pass its tportlock, you will be shown its dbref. If a player or the room they are in is unfindable, you will not be able to see them, but they will be listed in the "Unfindable" section at the end of the list. Staff will see all players regardless, but unfindable players will have a * by their name.
+help/add +selfboot=%b%b[ansi(h,Syntax:)]%b+selfboot%r%r%b%bThis command allows you to boot 'extra' connections that are sometimes left over as a result of losing your connection to the game.
+help/add ooc=%b%b[ansi(h,Syntax:)]%booc <message>%r%r%b%bThis command will show an OOC message to everyone in your current room. This is useful for communicating out of character when you are in an in-character area. Note that, just like a channel, you can use ":" or ";" to pose or pose/nospace to OOC.
+help/add +info=%b%b[ansi(h,Syntax:)]%b+info%r[space(10)]+info <player>%r[space(10)]+info <player>/<section>%r%r%b%bThe info system allows you to add visible sections of your character's backstory that other players might know. The first command shows you your general info, and will list other info sections if you have them set. The second form of the command allows you to see this information for another player (or for yourself if you use 'me'). The third command will view this info, on yourself or another.%r%r%b%bTo set your general info, type &INFO-GENERAL me=<text>. You can set other info sections by typing &INFO-<name> me=<text>. Note that <name> should have spaces replaced with underscores.
+help/add +hangouts=%b%b[ansi(h,Syntax:)]%b+hangouts%r%r%b%bStaff can tag certain rooms as being hangouts. By typing this command, you will see a list, along with the number of people currently in that hangout. This command will even show unfindable players in that location, but it will not show you their names.
+help/add +beginner=%b%b[ansi(h,Syntax:)]%b+beginner%r%r%b%bThis command will show you a list of useful game commands. This is a decent primer for people who are new to MU*ing to at least give them the basic commands they'll need to communicate with other players, who can better direct them to what they're looking for. If you have suggestions for commands that might go well on this list for your game, contact staff.
+help/add +help=%b%b[ansi(h,Syntax:)]%b+help%r[space(10)]+help <file>%r[space(10)]+help <file>/<subfile>%r%r%b%bThis set of commands allows you access the global +help system. Many players sometimes get confused that +help and help are separate systems, and so it is worth noting that 'help' is traditionally for commands, functions, and features that are built in to the server code, while '+help' is for commands that have been added on to the server through softcode.%r%r%b%bThe first command shows an index of all +help topics. The second command allows you to read a topic, and the third will allow you to read subtopics. Unlike the built-in help system-- and even some softcoded systems in use elsewhere-- +help files can have multiple keywords to make it easier to find the right file. For example, you can access any +help file whose name starts with a + without typing it. '+help hangouts' is identical to '+help +hangouts'.
+help/add credits=%b%bThis softcode system is principally the work of Soylent@BrazilMUX, however it builds on the work of several other people, and could not have happened without them:%r%r%b%b[ljust(+uptime,13,.)]%b[wrap(Written by Orion@Granite. It is included unmodified.,62,,,,16)]%r%b%b[ljust(+3who,13,.)]%b[wrap(Originally written by Ian@BrazilMUX. My modifications are certainly less elegant than the original.,62,,,,16)]%r%b%b[ljust(Backgrounds,13,.)]%b[wrap(The original system is by BEM@Granite. I have cleaned it up and integrated it with Anomaly Jobs.,62,,,,16)]%r%b%b[ljust(SGP,13,.)]%b[wrap(This system began as a rewrite of SGP. Numerous commands are retained from the original\, with and without modification. Including: +commands and +contents (added column view)\, +join +return and +summon (rewritten)\, +selfboot (unchanged)\, +info (rewritten)\, +finger (principally the same\, but cleaned up)\, +view (minor changes)\, and places (unchanged). Still other commands are inspired by the originals. Thanks to Audumla\, BEM@Granite\, and all the other fine folks who contributed.,62,,,,16)]%r%b%b[ljust(Myrddin,13,.)]%b[wrap(Myrddin's excellent bboard code is included with minor modifications. I have changed the date code (original code from 8BitMUSH) and included the +bbnext command (Obsidian@DynamixMUSH). My +Cron code is a rewrite of his original MUSHCron\, but including several new features and accounting for time drift due to server lag.,62,,,,16)]%r%b%b[ljust(Anomaly Jobs,13,.)]%bhttp://code.google.com/p/anomalyjobs/%r%r%b%bEverything else is mine. I'd like to thank Brazil, nails, and Ian for answering a ton of questions. If you have any questions\, please feel free to contact me at BrazilMUX\, or via the TinyMUX mailing list.
+help/add jobs=%b%b[ansi(h,Syntax:)]%b+myjobs%r[space(10)]+myjob <#>%r[space(10)]+myjob/add <#>=<comment>%r%r%b%bThese commands provide you with an interface to the Anomaly Jobs system, and allow you to see jobs that you created, or that are tagged for you. The +myjobs command shows a list of these jobs, along with various data about them. The second command allows you to read a job, and the third command will allow you to comment.%r%r%b%bFor other help with topics relating to jobs, please see +jhelp, especially '+jhelp player'.
+help/add building=%b%b[ansi(h,Syntax:)]%b+brequest <name>=<description>%r[space(10)]+buildcheck%r[space(10)]+build/submit%r%r%b%bThese commands assist players in building projects for the game. The first command allows you to request or pitch a project to staff. The name you use in your brequest will be the name of your project, and so you should use something specific like "Soylent's House", "715 East Central", or "Rhythm Nightclub". If your request is approved, login data for your builder character will be sent to you via @mail. You can use the 'myjobs' commands to stay up to date on the status of your request.%r%r%b%bThe second command allows you to check your project. It will show you a list of required fields for each of your rooms, exits, and objects. Once you are confident that you are finished, use +build/submit to notify staff. This will create a new job, and you can use the 'myjobs' commands to access it. You should use this to let staff know where you'd like your project linked. If approved, your project will automatically be linked to the grid. 
+help/add places=%b%b[ansi(h,Syntax:)]%r%b%b[ljust(Mv from <#> to <#>,27,.)]%bMoves a vacancy from one place to another.%r%b%b[ljust(Join <place name>,27,.)]%bPuts you at <place name>%r%b%b[ljust(Join at #<num>,27,.)]%bPuts you at place #<num>.%r%b%b[ljust(Join with <name>,27,.)]%bPuts you at the place with <name>.%r%b%b[ljust(Depart,27,.)]%bRemoves you from your place.%r%b%b[ljust(sit *,27,.)]%bAlias for Join.%r%b%b[ljust(Depart,27,.)]%bRemoves you from your place.%r%b%b[ljust(Places,27,.)]%bLists who's present at all places.%r%b%b[ljust(Place <num>,27,.)]%bLists who's present at place <num>.%r%b%b[ljust(Plook,27,.)]%bLists in column format everyone around the room.%r%b%b[ljust(Plook <num>,27,.)]%bLists name of <num> and virtual desc.%r%b%b[ljust(tt <message>,27,.)]%b(Tete a tete) Relays a message to all those at%r%b%b[space(28)]your place. This command takes the usual%r%b%b[space(28)]say/pose tokens, and TT |<message> will emit.%r%b%b[ljust(ttooc <message>,27,.)]%b(Tete a tete) Relays an OOC message%r%b%b[ljust(Update <#>/<Option>=<text>,27,.)]%bSee '+help places/places-options'%r%r%b%bPLACES are virtual places to sit, stand or occupy. You remain in the same room, but join a group of people within that room who may or may not be having a quiet conversation only with others placed with them.%r%r%b%bFor installation help, type '+help places/places-config'.%r%r%b%bThis code originally provided courtesy of Deirdre, Meg, and Osric of AmberMUSH. It has since been editted by Angel@Heaven
+help/add bboard=[space(5)]Myrddin's BBS is a global, multi-threaded board with a rich set of%r[space(5)]features. To see help on a particular topic, type '+help bboard/<topic>'%r[space(5)](Example: +help bboard/bbread).%r%r[space(5)]TOPIC[space(17)]DESCRIPTION%r[space(5)]~~~~~[space(17)]~~~~~~~~~~~%r[space(5)]bbread[space(16)]Reading bulletin board messages.%r[space(5)]bbpost[space(16)]Posting bulletin board messages.%r[space(5)]bbmisc[space(16)]Other commands (removing messages, unsubscribing%r[space(29)]groups, resubscribing to groups, etc)%r%r[space(5)]bbtimeout[space(13)]Expanded help on the topic of message timeouts.
+help/addsub places/places-config=%b%b[ansi(h,Syntax:)] configure <num> places%r[space(10)]unconfigure places%r%r%b%bNotes: A null fixed message means vacancies can be moved freely to and from the place.  This does not make sense for things like couches and rugs.  Set it to something like "That makes no sense." if you are using such a place.%r%r%b%b(O)Join and (O)depart messages take like this: \%N. All Join and Depart messages are appended with the place name.%r%r%b%bFunctions:%b%bWHICHPLACE(<loc num>,<dbnum>) gives the number of a place where%r[space(14)]<dbnum> is.%r[space(14)]ATPLACE(<loc num>,<place num>) gives you a list of things at a %r[space(14)]place.%r[space(14)]PLACEINFO(<loc num>,<place num>,<option>) gives the value of %r[space(14)]<option> at place.
+help/addsub places/places-options=%b%b[ansi(h,Syntax:)] update <place #>/<option>=<Text>%r%r%b%b[ljust(Option Description,21)] [ljust(<Option>,15)] Default Configuration Text%r%b%b[ljust(------------------,21)] [ljust(--------,15)] --------------------------%r%b%b[ljust(Place Name,21)] [ljust(NAME,15)] Table x%r%b%b[ljust(Maximum # of places,21)] [ljust(MAXPLACES,15)] Random%r%b%b[ljust(Current # of places,21)] [ljust(CURPLACES,15)] Random (1 >= # >= MAXPLACES)%r%b%b[ljust(Fixed fail message,21)] [ljust(FIXED,15)] <NULL>%r%b%b[ljust(Full fail message,21)] [ljust(FULL,15)] That table has no more room.%r%b%b[ljust(Join message,21)] [ljust(JOIN,15)] You sit down at <place>.%r%b%b[ljust(Ojoin message,21)] [ljust(OJOIN,15)] sits down at <place>.%r%b%b[ljust(Depart message,21)] [ljust(DEPART,15)] You stand and leave <place>.%r%b%b[ljust(Odepart message,21)] [ljust(ODEPART,15)] stands and leaves <place>.%r%b%b[ljust(Say prefix,21)] [ljust(PREFIX,15)] At your table%r%b%b[ljust(Description,21)] [ljust(DESCRIBE,15)] A table with 4 legs and some chairs
+help/addsub bboard/bbread=[space(5)]+bbread[space(25)]Scans joined bulletin board groups.%r[space(5)]+bbread <#>[space(21)]Scans messages in group <#>.%r[space(5)]+bbread <#>/<list>[space(14)]Reads message(s). <list> can be a single%r[space(40)]number, multiple numbers, or a range%r[space(40)]of numbers (ie. 1-6), or any combo.%r[space(5)]+bbread <#>/u[space(19)]Reads all unread messages in group <#>.%r[space(5)]+bbnext[space(25)]Reads your next unread message.%r[space(5)]+bbcatchup <#>[space(18)]Marks all messages in group <#> as read.%r[space(40)]You can use multiple group #'s/names%r[space(40)]or may use the word 'all' to catchup%r[space(40)]on all messages on all boards.%r%r[space(5)]+bbscan[space(8)]Totals unread postings (if any) in each joined group. You%r[space(20)]can place this command in your @aconnect, and it's%r[space(20)]recommended you do so.%r%rNote: You can use the boards name (or abbreviation) in place of it's number.
+help/addsub bboard/bbpost=[space(5)]+bbpost <#>/<title>[space(13)]This starts a post to group <#>.%r[space(5)]+bbwrite <text>[space(17)]This adds text to an already started post.%r[space(5)]+bb <text>[space(22)]Same as +bbwrite.%r[space(5)]+bbedit <area>=<old>/<new>[space(6)]Edits your post in progress. Valid areas%r[space(39)]are: text, title%r[space(5)]+bbproof[space(24)]Displays your current post in progress.%r[space(5)]+bbtoss[space(25)]Discards your current post in progress.%r[space(5)]+bbpost[space(25)]This will post your current post in%r[space(39)]progress.%r%r[space(5)]+bbpost <#>/<subject>=<body>[space(4)]Posts a message to group <#>. This is a%r[space(39)]quick way of posting a message with%r[space(39)]one command.%r[space(5)]+bbedit <#>/<#>=<old>/<new>[space(5)]Edits one of your posted messages.%r%rNote: You can use the boards name (or abbreviation) in place of it's number.
+help/addsub bboard/bbmisc=[space(5)]+bbremove <#>/<list>[space(12)]Removes a message by you. <list> can be a%r[space(39)]single number, a group of numbers, or a%r[space(39)]range (10-14).%r[space(5)]+bbmove <#>/<#> to <#>[space(10)]Moves one of your messages to a new group.%r[space(5)]+bbleave <#>[space(20)]Unsubscribe from group <#>.%r[space(5)]+bbjoin <#>[space(21)]Joins a group you've previously 'left'.%r[space(5)]+bblist[space(25)]Listing of all groups available to you%r[space(39)]along with their timeout values.%r[space(5)]+bbsearch <#>/<name>[space(12)]Shows you a list of <name>'s postings on%r[space(39)]group <#>.%r[space(5)]+bbtimeout <#>/<#>=<days>[space(7)]Changes timeout for a message to <days>.%r[space(5)]+bbnotify <#>=<on|off>[space(10)]Turn post notification for group <#> on%r[space(39)]or off.%r%r[space(2)]%rFor a '.sig', set an attribute on you called BB_SIG, and place your%rsignature in that.%r%rNote: You can use the board's name (or abbreviation) in place of its number.
+help/addsub bboard/bbtimeout=There's only a couple of things that need to be understood in order to take%rfull advantage of message timeouts.%r%r1: Once a day, the TR_TIMEOUT attribute on the bbpocket should be triggered.%r[space(3)]Some games already have a way of accomplishing this. For games that do not,%r[space(3)]simply have a wizard execute set the 'autotimeout' global parameter:%r[space(6)]+bbconfig autotimeout=on%r[space(3)]Turning that parameter on sets up the board to take care of its own daily%r[space(3)]triggering.[space(2)]Setting the paramenter to 'off' turns off the BBS's internal%r[space(3)]triggering.%r%r2: There are 3 different timeout values:%r%r[space(3)]The global parameter 'timeout' (set via the '+bbconfig timeout=<days>'%r[space(3)]command) sets a default timeout that will be set on any new bb groups%r[space(3)]created after the execution of this command.%r%r[space(3)]The group parameter 'timeout' (set via the '+bbconfig <#>/timeout=<days>'%r[space(3)]command) sets a default timeout for the group <#>. Any new messages%r[space(3)]posted to this group will inherit that timeout.%r%r[space(3)]The user command '+bbtimeout <group>/<message list>=<days>' will set the%r[space(3)]specified timeout on individual messages. Players can only modify their%r[space(3)]own messages, wizards can modify any messages. Players can only set%r[space(3)]timeouts equal to or less than the default timeout for the board, wizards%r[space(3)]can set any timeout.%r%r[space(3)]In all cases, a timeout of '0' indicates no timeout.
+help/cat +finger=OOC Commands
+help/addkey +finger=finger
+help/cat +staff=OOC Commands
+help/addkey +staff=staff +staff/all staff/all
+help/cat +uptime=OOC Commands
+help/addkey +uptime=uptime
+help/cat +who=OOC Commands
+help/addkey +who=who
+help/cat +jnotes=OOC Commands
+help/addkey +jnotes=jnotes +jnote jnote
+help/cat +bg=OOC Commands
+help/addkey +bg=bg +backgrounds backgrounds
+help/cat locks=IC Commands
+help/addkey locks=lock unlock +lock +unlock
+help/cat +view=IC Commands
+help/addkey +view=view +views views
+help/cat +3who=OOC Commands
+help/addkey +3who=3who
+help/cat +where=OOC Commands
+help/addkey +where=where
+help/cat +selfboot=OOC Commands
+help/addkey +selfboot=selfboot +boot boot
+help/cat ooc=OOC Commands
+help/cat +info=OOC Commands
+help/addkey +info=info
+help/cat +hangouts=OOC Commands
+help/addkey +hangouts=hangouts
+help/cat +beginner=OOC Commands
+help/addkey +beginner=beginner +beginners beginners
+help/cat +help=Systems
+help/addkey +help=help
+help/cat credits=Systems
+help/cat jobs=Systems
+help/addkey jobs=+jobs +myjobs myjobs
+help/cat building=Systems
+help/cat places=Systems
+help/cat bboard=Systems
@@
@@ #17: DB: +Shelp
@@
think [ansi(hc,MUX Core:)] Creating the +Shelp database and installing files.
@create DB: +Shelp=10
@Startup DB: +Shelp=@wipe me/D.CAT.*;@wipe me/D.KEYWORDS;@dolist [filter(me/FIL.FILELIST,lattr(me/D.SHELP.*),,,help)]={@if [t(strlen(grab(v(D.CATEGORIES),setr(1,extract(v(##),3,1,|)),|)))]={&D.CAT.[edit(%q1,%b,_)] me=[setunion(v(D.CAT.[edit(%q1,%b,_)]),last(##,.))]},{&D.CAT.UNCATEGORIZED me=[setunion(v(D.CAT.UNCATEGORIZED),last(##,.))]};&D.KEYWORDS me=[setunion(v(D.KEYWORDS),iter(extract(v(##),2,1,|),%i0:[lcstr(last(##,.))],,|),|)]};@if [not(strmatch(%0,quiet))]={@cemit Scan=Staff help file categories and keywords indexed.}
&D.CATEGORIES DB: +Shelp=Commands|Systems
&FIL.FILELIST DB: +Shelp=regmatchi(%0,^D\.SHELP\.\[^.\]+$)
&FN.DISPLAYFILE DB: +Shelp=[header(+Shelp [capstr(%0)])]%r[if(isstaff(%#),%xh%xrKeywords: %0 [extract(%1,2,1,|)]%r[subheader()]%r)][edit(last(%1,|),(pipe),|)]%r%r[if(setr(0,lattr(me/D.SHELP.%0.*)),[subheader()]%rUse %xh'+shelp %0/<Sub-Category>'%xn to read the following files:%r%r%b[wrap(iter(lcstr(%q0),ljust([ifelse(or(eq(strlen(grab(get(%2/D.READ.SHELP),[rest(%i0,d.shelp.)]:*,|)),0),lt(rest(grab(get(%2/D.READ.SHELP),[rest(%i0,d.shelp.)]:*,|),:),first(get(me/%i0),|))),%xh%xr*%xn,%b)][last(%i0,.)],18)),76,,,,1)]%r%r)][rjust(%xhLast Updated on [elements(convsecs(first(%1,|)),2 3 5)]%xn%b,78)]%r[footer()]
&FN.DISPLAYSUBFILE DB: +Shelp=[header(+Shelp [capstr(%0)]/[capstr(%1)])]%r[edit(last(%2,|),(pipe),|)]%r%r[rjust(%xhLast Updated on [elements(convsecs(first(%2,|)),2 3 5)]%xn%b,78)]%r[footer()]
&FN.MATCHFILE DB: +Shelp=[setq(0,num(me))][setq(2,0)][if(t(strlen(setr(1,grab(get(%q0/D.KEYWORDS),%0:*,|)))),setq(2,1:[rest(%q1,:)]))][if(hasattr(%q0,D.SHELP.%0),setq(2,1:[lcstr(%0)]))]%q2
@chown DB: +Shelp=#3
@set DB: +Shelp=!HALTED INHERIT SAFE
+shelp/add +contents=%b%b[ansi(h,Syntax:)] +contents <object>%r%r%b%bThis command gives you a list of the contents of <object>.
+shelp/add +duty=%b%b[ansi(h,Syntax:)] +duty%r%r%b%bThis command is a simple toggle. Using it once sets you off duty, and using it again sets you on duty. Your duty status is controlled by the TRANSPARENT flag.
+shelp/add +join=%b%b[ansi(h,Syntax:)] +join <player>%r%r%b%bThis command joins another player at their location. The player and the others in their room will be given notice that you are coming, and there will be a momentary delay before you arrive. When you are ready to return to your original location, type +return.
+shelp/add +summon=%b%b[ansi(h,Syntax:)] +summon <player>%r%r%b%bThis command summons a player to your location. They will be given warning, as will the others in your location, and there will be a momentary delay before they arrive. To return a player to their original location, use +return <player>.
+shelp/add +return=%b%b[ansi(h,Syntax:)] +return%r[space(10)]+return <player>%r%r%b%bThis command allows you to reverse a +summon or +join. +Return with no arguments returns you to your previous location after joining. +Return <player> returns a summoned player to their initial location. In both cases the appropriate rooms will be notified of an impending arrival, and there will be a momentary delay before they arrive.
+shelp/add +commands=%b%b[ansi(h,Syntax:)] +commands <object>%r[space(10)]+commands/nocol <object>%r%r%b%bThese commands allow you to see a list of the commands set on an object. The first version gives the display in two columns, however the /nocol switch will allow you to see the list as one column, which is useful for commands whose text would otherwise flow out of the columns.
+shelp/add +cron=%b%b[ansi(h,Syntax:)] +cron%r[space(10)]+cron <number>%r%r%b%bThese commands allow you to see the cron jobs set up on the cron object. Cron is a way of scheduling commands to run at precise times. The first command shows you a list of the jobs set to run, and the second command will let you see detailed information on that job. For more information on creating cron jobs, see '+shelp cronsys'.
+shelp/add +dark=%b%b[ansi(h,Syntax:)] +dark%r%r%b%bThis command is a toggle that sets and removes your dark flag. It also sets an attribute on you with the time you went dark. Players +fingering you or using +staff will see your dark time as if it were your logout time.
+shelp/add +jnotes=%b%b[ansi(h,Syntax:)] +jnotes <name>%r[space(10)]+jnotes <name>/<jnote>%r[space(10)]+jnote <name>/<title>=<data>%r[space(10)]+jnote/hide <name>/<jnote>%r[space(10)]+jnote/unhide <name>/<jnote>%r[space(10)]+jnote/approve <name>/<jnote>%r[space(10)]+jnote/unapprove <name>/<jnote>%r[space(10)]+jnote/delete <name>/<jnote>%r%r%b%bThese commands allow you to manage player jnotes. In all cases '<jnote>' can be a number or the name of the note. The first two commands allow you to see players notes and read them. The third command allows you to set a new note. This note will be set on the player with status "Proposed" and hidden from their view. The fourth and fifth commands allow you to toggle a jnote's visibility, while the last two commands allow you to approve and unapprove a note.%r%r%b%bPlayers may pitch jnotes. This will open a new job for that note. If you approve or complete the job you approve the note. If you unapprove any approved jnote, a new job will be opened for the note, and the same rules apply for approving or denying it.
+shelp/add +verify=%b%b[ansi(h,Syntax:)] +verify <name>%r%r%b%bAny data sent through the TR.JUDGE trigger will be recorded on players. In the core system this is only done by the "+jnote/show" command, but it is useful for other things such as dice rolls or proving stats. A player can review the last 20 Judge outputs they have seen. This command allows you to check a player's judge data and see what they've seen.
+shelp/add +bg=%b%b[ansi(h,Syntax:)] +bg <name>/<number%r[space(10)]+bglist <name>%r%r%b%bThese commands allow you to review player background sections. The first command reads them, and the second command lists the sections. The default behavior for backgrounds is that when a player uses the +bgsubmit command, their background sections are locked, and a new job is opened for their background. Approving or completing that job will approve the player. Denying or deleting the job will unlock their background sections so that they can revise them.
+shelp/add +staff=%b%b[ansi(h,Syntax:)] +staff/update%r%r%b%bThis command refreshes the +staff data list, which is normally set @daily. While only Wizards can set the ROYALTY flag, any staffer can use this command, which does not set any flags.
+shelp/add +tags=%b%b[ansi(h,Syntax:)] +tag <object>=<tag>%r[space(10)]+untag <object>=<tag>%r[space(10)]+tag/add <type>=<name>%r[space(10)]+tag/del <type>=<name>%r[space(10)]+tags%r%r%b%bThe tags system is a essentially a way to add additional flags to things, and to easily store data that can be irritating to quantify in other ways without having an object somewhere full of lists. The first command tags an object (which is a player, thing, room, or exit) with the named tag. The second command removes tags. The third and fourth commands create or destroy tags. There is a different list for each object type, but you may specify "all" to create a tag in all categories. The final command gives a quick list of the available tags. Players can see the tags of objects they control using the tags() function (see '+shelp functions').%r%r%b%bOnly one tag is included in the base system-- a room flag called 'hangouts'. This is used to denote rooms that should be shown by the +hangouts command. For more details, see '+shelp hangouts'.
+shelp/add +hangouts=%b%b[ansi(h,Syntax:)] +hangouts/update%r%r%b%bThis command must be used to update the mast list of hangouts for the '+hangouts' command. To designate a room as a hangout, please use +tag <room>=hangout
+shelp/add +help=%b%b[ansi(h,Syntax:)] +help/staffhelp%r[space(10)]+help/wizhelp%r%r%b%bThese commands show a list of the staff commands available to both royalty and wizards; a full accounting of which could fill multiple help files. These commands also hold true for the +shelp system.
+shelp/add building=%b%b[ansi(h,Syntax:)] +build%r[space(10)]+build <project>%r[space(10)]+build/create <project name>=<player>%r[space(10)]+build/set <project>/<option>=<data>%r[space(10)]+build/approve <project>%r[space(10)]+build/advance <project>%r[space(10)]+build/check <project>%r[space(10)]+build/unapprove <project>%r[space(10)]+build/destroy <project>%r[space(10)]+build/addtype <letter>/<name>=<dbref>%r[space(10)]+build/types%r%r%b%bThese commands allow for the management of building projects. In all cases '<project>' can be a number or the name of the build. The first and second commands will show a list, and specific detail about projects. The third command allows the creation of new building projects. The name must be unique, and player should be the player associated with the build. +build/set uses the arguments listed in the second command. The approve command notes that a project is ready to be advanced, and the /advance command will allow you to do so manually.%r%r%b%bOnce a project is advanced to the 'In Progress' stage, you may use the /check command to see its completion status. The /unapprove command allows you to send a Live project on the grid back to the building nexus. The destroy command completely destroys a project and its builder, and may only be used by staff flagged WIZARD. The addtype command allows you to add a new project parent, and the final command lists those parents.%r%r%b%bThis is a command reference. For a discussion of the building system, see '+shelp building/explained'
+shelp/addsub building/explained=%r%b%bThe included building system is complex, but greatly simplifies the job of building staff. The most common work flow will start with players making a building request with the +brequest command. This creates a new job for that build and creates a stub project with the "Approval" status. You can then review the application, and if you want to approve it, some setup is necessary. Using the +build/set command, set a type parent, a builder name (should be a new character), and an amount of quota (at least 3 is required). Then +build/approve their project and then +job/approve their request. Denying or deleting the request will destroy the stub project.%r%r%b%bThis will automatically create the project in the Building Nexus, set up their builder, and notify them their project has been approved. This advances the status of the project to "In Progress," and the player can build their project as usual. At any time you can use the +build/check command to check the status of the build. When they are finished they will submit their build for approval, which will create a new job. From there you can set the build's IC Owner (a full name, or company name), along with an IC Location for the build, which should be a dbref. Use the +build/approve command to set the project as having been inspected, and then +job/approve or complete their job. This will automatically link the build to the specified location. Denying or deleting the job will leave the build as In Progress so that the builder can continue working.%r%r%b%bOne final option is the ability to unapprove a project on the Grid and send it back to the Building Nexus for more work. This makes it easy for players to take over existing builds from others, and since the project is linked to a separate builder character, projects are not lost when players leave. This requires a bit more work from staff during the initial creation of a game, but pays off in spades down the line!
+shelp/addsub building/parents=%r%b%bThere are two included parents for use with the building system. One is for residential builds, and the other is for businesses. Both have the same commands initially, but can be customized as needed. The most basic function of these parents is to control locks within the project. A lock may be set as 'Owners', 'Tenants', 'Keys', or 'None'. The last type cannot be locked or unlocked. Locks set 'Keys' are only opened by people who have been given keys via the code. Tenants can unlock both Tenants and Keys locks, and Owners can unlock all locks in a project.
+shelp/add configure=%r%b%bThe basic configuration of this softcode package is pretty simple. All functions are stored on #5. By default the isstaff function does not look for the Staff flag, since Royalty and Wizard are the only flags that actually convey powers in the code. Globals objects are stored in the Master Room (#2), and other objects that are for storage or functions are kept in the Auxiliary Room (#58). In certain cases, objects are stored in their global object. The Building Tracker is stored in the Building Globals Object, and the +Help and +Shelp DBs are stored in the Player Help Globals object.%r%r%b%bAll players default to ANSI and UNINSPECTED. The room parent is #45, and is set up with a basic set of formatting attributes to show what's possible (ie: views, places, and jnotes are automatically reflected as appropriate in a room's footer if they are present). The header, subheader, and footer functions are all located on #5 and are @function'd. Public, Guest, and Scan (to monitor code) channels are set up and associated with channel objects as appropriate. Logging is enabled on all three channels.
+shelp/add functions=%r%b%bThere are several included softcode functions located on #5:%r%r%b%b[ljust(ISSTAFF,15,.)] Takes \%0. Checks for the ROYALTY or WIZARD flags.%r%b%b[ljust(ISMEMBER,15,.)] [wrap(Takes \%0\, \%1\, and \%2. Checks to see if \%1 is a member of list \%0 with optional delimiter \%2. Case insensitive.,60,,,,18)]%r%b%b[ljust(PARTIAL,15,.)] [wrap(Takes \%0\, \%1\, and \%2. Partial matches \%1 in list \%0 with the optional delimiter 2.,60,,,,18)]%r%b%b[ljust(ISPOSINT,15,.)] Takes \%0. Checks for a positive integer.%r%b%b[ljust(ROLLXDY,15,.)] Rolls \%0d\%1.%r%b%b[ljust(HEADER,15,.)] Displays the game header with optional text \%0.%r%b%b[ljust(SUBHEADER,15,.)] As above, but a subheader.%r%b%b[ljust(FOOTER,15,.)] As above, but for a footer.%r%b%b[ljust(CAPALL,15,.)] [wrap(Returns a string with all words capitalized. Omits certain conjunctions.,60,,,,18)]%r%b%b[ljust(ALERT,15,.)] [wrap(A simple function to display something in an eyecatching way. \%0 is the text and \%1 is a character.,60,,,,18)]%r%b%b[ljust(TAGS,15,.)] Displays a list of tags on \%0. You must control \%0.%r%b%b[ljust(HASTAG,15,.)] Checks \%0 for tag \%1. You must control \%0.%r%b%b[ljust(ANDTAGS,15,.)] Checks \%0 for all tags in list \%1. You must control \%0.%r%b%b[ljust(ORTAGS,15,.)] As above, but with a logical 'or' instead of 'and'.
+shelp/add cronsys=%r%b%bThis softcode system includes a coded Cron system. Cron is a way of setting up a list of commands to occur at a certain time. This is useful for a variety of reasons. All cron attributes should go on the Cron System (#18 in the default install). The attributes are as follows:%r%r%b%bTime to run:%b%b&CRON.TIME-<NAME> #18=month|date|day|hour|minute|flags|args%r%r%b%bThe list of commands to run:%r%b%b&CRON.JOB-<NAME> #18=list;of;commands%r%r%b%bComments for the job (optional):%r%b%b&CRON.COMMENT-<NAME> #18=This is a job!%r%r%b%bThe <name> should match on all three. You should use input for each section of the time as they appear in the time function. ie: Thu for Thursday, Nov for November, 17 for 5pm, and so forth. Valid flags are 'runonce' which runs the job once and then removes it, and 'catchup' for jobs that should be caught up if they're missed. Args are passed to the command list as \%0. Times are 'greedy' to run as often as possible. ie: If a job is set to run at |||17|||, it will run once a minute during the 5pm hour of every day.%r%r%b%bThe cron system is configured to run around the 30 second mark of each minute to prevent drifting. The system remembers the last time it ran, and in the event of server downtime it will try to catch up on missed jobs at startup, but only if they are flagged 'catchup'. If the server is down for more than about 12 hours, missed jobs past that mark cannot be caught up.
+shelp/add bboard=[space(5)]+bbnewgroup <title>[space(13)]Creates a new group.%r[space(5)]+bbcleargroup <#>[space(15)]Clears group <#> and all it's messages.%r[space(5)]+bblock <#>=<lock>/<key>[space(8)]Locks group <#>. Lock can be 'flag' or%r[space(39)]an attribute name.%r[space(39)]Examples: +bblock 4=flag/wizard%r[space(49)]+bblock 5=race/were%r[space(5)]+bbwritelock <#>=<lock>/<key>[space(3)]Same as above, but controls who may write%r[space(39)]to the group.%r[space(5)]+bbconfig[space(23)]Shows values of all config parameters.%r[space(39)]See '+shelp bbconfig' for help on%r[space(39)]config parameters and how to set them.
+shelp/addsub bboard/bblock=A few notes about locking BB Groups.%r%rThe +bblock/+bbwritelock commands are only meant to take care of the simplest%rof locks.[space(2)]There is simply no way to write one bblock'ing command that can%rdeal with all the different ways people want to lock their BB Groups, and it%rcertainly isn't practical to keep adding different locking commands for each%rlocking method I come across.%r%rCoders can set up locks on Groups that are as customized or exotic as you like%rquite easily, however.[space(2)]Each Group has its own object.[space(2)]If you look inside%rthe global BBS object, you'll see them.[space(2)]Each Group object has a pair of%rattributes that control who may read and who may write to that Group.[space(2)]The%rattributes are named CANREAD and CANWRITE, respectively.[space(2)]The dbref of the%rplayer attempting to read/write is passed to the appropriate attribute as \%0.%rAs long as the attribute returns a non-zero result, the player can read/write.%r%rCANREAD Examples:%r[space(3)]CANREAD: 1[space(31)]Anyone can read%r[space(3)]CANREAD: hasflag(\%0,wizard)[space(14)]Only wizards can read%r[space(3)]CANREAD: strmatch(name(\%0),*z*)[space(10)]Only characters with a 'z' in%r[space(46)]their name can read
+shelp/addsub bboard/bbconfig=There are two types of configuration parameters: global and group.[space(2)]Global%rconfiguration parameters affect the BB system as a whole, while group %rconfiguration parameters affect a single Group.%rTo set a global parameter:%r%r[space(5)]+bbconfig <param>=<value>[space(7)]Sets global config parameter.%r%rGlobal Parameters:%r%r[space(5)]timeout[space(12)]This sets the default timeout (in days) for any new%r[space(26)]groups created. A timeout of '0' means messages%r[space(26)]won't timeout. (ex. +bbconfig timeout=30)%r[space(5)]autotimeout[space(8)]If you don't have a way to trigger the TR_TIMEOUT%r[space(26)]attribute on the bbpocket (daily) to clean out%r[space(26)]expired messages, you can use the autotimeout param%r[space(26)]instead. Setting this param 'on' enables the BB's%r[space(26)]built in timer. Set this param to 'off' to disable.%r%rTo set a Group parameter:%r%r[space(5)]+bbconfig <#>/<param>=<value>[space(3)]Sets config parameter for board <#>.%r%rGroup Parameters:%r%r[space(5)]anonymous[space(10)]Setting this value turns the Group 'anonymous'.[space(2)]This%r[space(26)]means that any future posting's 'Author' field will%r[space(26)]have the value of this param instead of the name of%r[space(26)]the author. Wizards will also see the actual name of%r[space(26)]author.[space(2)](examples:%r[space(26)]+bbconfig newspaper/anonymous=NewsPaper Staff,%r[space(26)]+bbconfig house rules/anonymous=The Staff)%r[space(5)]timeout[space(12)]Sets the default timeout value for the Group.[space(2)]Any new%r[space(26)]messages will have this new value.[space(2)]A value of '0'%r[space(26)]means messages won't timeout.
+shelp/cat +contents=Commands
+shelp/addkey +contents=contents
+shelp/cat +duty=Commands
+shelp/addkey +duty=duty
+shelp/cat +join=Commands
+shelp/addkey +join=join
+shelp/cat +summon=Commands
+shelp/addkey +summon=summon
+shelp/cat +return=Commands
+shelp/addkey +return=return
+shelp/cat +commands=Commands
+shelp/addkey +commands=commands
+shelp/cat +cron=Commands
+shelp/addkey +cron=cron
+shelp/cat +dark=Commands
+shelp/addkey +dark=dark
+shelp/cat +jnotes=Commands
+shelp/addkey +jnotes=+jnote jnote jnotes
+shelp/cat +verify=Commands
+shelp/addkey +verify=verify
+shelp/cat +bg=Commands
+shelp/addkey +bg=bg +backgrounds backgrounds
+shelp/cat +staff=Commands
+shelp/addkey +staff=staff
+shelp/cat +tags=Commands
+shelp/addkey +tags=+tag tags tag
+shelp/cat +hangouts=Commands
+shelp/addkey +hangouts=hangouts +hangout hangout
+shelp/cat +help=Systems
+shelp/addkey +help=help
+shelp/cat building=Systems
+shelp/addkey building=+build build projects
+shelp/cat configure=Systems
+shelp/cat functions=Systems
+shelp/cat cronsys=Systems
+shelp/cat bboard=Systems
@tel #16=#13
@tel #17=#13
@@
@@ #18: <CS> Cron System
@@
think [ansi(hc,MUX Core:)] Setting up the Cron System.
@create <CS> Cron System=10
@Startup <CS> Cron System=@cemit Scan=Initializing Cron system. Checking for missed jobs...;@tr me/TR.CATCHUP;@wait/until [u(FN.NEXTRUN,secs())]={@trigger me/cron}
&FN.NEXTRUN <CS> Cron System=[setq(1,mul(div(%0,60),60))][setr(2,ifelse(lt(mod(%0,60),30),add(%q1,30),add(%q1,90)))]
&FN.PREVRUN <CS> Cron System=[setq(1,mul(div(%0,60),60))][setr(2,ifelse(lt(mod(%0,60),30),sub(%q1,30),add(%q1,30)))]
&FN.GETJOBS <CS> Cron System=localize([setq(t,convsecs(%0))][setq(0,extract(%qt,2,1,))][setq(1,extract(%qt,3,1))][setq(2,extract(%qt,1,1))][setq(3,first(extract(%qt,4,1),:))][setq(4,extract(%qt,2,1,:))][regraball(iter(lattr(me/CRON_TIME-*),[setq(i,v(%i0))][setq(5,extract(%qi,1,1,|))][setq(6,extract(%qi,2,1,|))][setq(7,extract(%qi,3,1,|))][setq(8,extract(%qi,4,1,|))][setq(9,extract(%qi,5,1,|))][if(and(and(or(member(%q5,%q0),not(strlen(%q5))),or(member(%q6,%q1),not(strlen(%q6))),or(member(%q7,%q2),not(strlen(%q7))),or(member(%q8,%q3),not(strlen(%q8))),or(member(%q9,%q4),not(strlen(%q9)))),ifelse(strlen(%1),member(extract(%qi,6,1,|),%1),1)),[if(%0,%0,secs())]:%i0)],,|),.+,|)])
&FN.CATCHUP <CS> Cron System=iter(lnum(add(1,div(sub(setr(0,u(FN.prevrun,%1)),setr(1,u(FN.nextrun,%0))),60))),add(%q1,mul(%i0,60)),,|)
&CRON <CS> Cron System=@tr me/TR.CRON=[setr(0,secs())];&D.LASTRUN me=%q0;@wait/until [ulocal(FN.NEXTRUN,%q0)]=@tr me/cron
&TR.CRON <CS> Cron System=@dolist/delimit | [u(FN.GETJOBS,%0)]={@cemit [setq(2,member(extract(v(rest(##,:)),6,1,|),runonce))]Scan=Cron[if(%q2,%b(One-Timer))]: ([elements(convsecs(first(##,:)),2 3 4)]) Running [rest(##,-)].[setq(1,default(me/CRON_COMMENT-[rest(##,-)],))][if(t(%q1),%b(%q1))];@tr me/CRON_JOB-[first(rest(##,-),^)]=[last(v(rest(##,:)),|)];@if %q2={&[rest(##,:)] me;&CRON_JOB-[rest(##,-)] me;&CRON_COMMENT-[rest(##,-)] me}}
&TR.CATCHUP <CS> Cron System=@if [strlen(setr(0,regraball(iter(u(FN.CATCHUP,v(D.LASTRUN),secs()),u(FN.GETJOBS,%i0,catchup),|,|),.+,|)))]={@cemit Scan=[words(%q0,|)] missed job[if(gt(words(%q0,|),1),s)] found. Catching up...;@dolist/delimit | %q0={@cemit [setq(2,member(extract(v(rest(##,:)),6,1,|),runonce))]Scan=Cron (Catchup)[if(%q2,%b(One-Timer))]: ([elements(convsecs(first(##,:)),2 3 4)]) Running [rest(##,-)].[setq(1,default(me/CRON_COMMENT-[rest(##,-)],))][if(t(%q1),%b(%q1))];@tr me/CRON_JOB-[first(rest(##,-),^)]=[last(v(rest(##,:)),|)];@if %q2={&[rest(##,:)] me;&CRON_JOB-[rest(##,-)] me;&CRON_COMMENT-[rest(##,-)] me}}},{@cemit Scan=No missed jobs found.}
&D.LASTRUN <CS> Cron System=9999999999
@chown <CS> Cron System=#3
@set <CS> Cron System=!HALTED INHERIT SAFE
drop #18
@@
@@ #19: bbpocket
@@
think [ansi(hc,MUX Core:)] Installing Myrddin's Bboards.
@create bbpocket=10
@lock bbpocket=*Wizard
@Desc bbpocket=[iter(setdiff(lattr(me),Desc),ljust(##,18))]
&BBTIME bbpocket=[extract(time(),2,2)], [last(time())]
&GET_GROUP bbpocket=switch(isnum(%0),1,extract(v(groups),%0,1),locate(#15,%0,ni))
&NXT_MESS bbpocket=3
&VALID_GROUPS bbpocket=iter(v(groups),switch(and(u(##/can%1,%0),not(member(get(%0/bb_omit),##))),1,##))
&ISGROUPREAD bbpocket=switch(setdiff(%1,get(%0/bb_read)),,,U)
&UNREADNUMS bbpocket=sort(iter(setdiff(get(%1/mess_lst),get(%0/bb_read)),member(get(%1/mess_lst),##)))
&FN_MAKELIST bbpocket=map(me/fn_maplist,secure(%0))
&FN_MAPLIST bbpocket=switch(strmatch(%0,?*-*),1,lnum(before(%0,-),after(%0,-)),%0)
&FN_UNREAD_LIST bbpocket=edit(sort(iter(%0,member(%1,##))),%b,\,%b)
&VALID_CONFIGS bbpocket=anonymous timeout
&VALID_GLOBAL_CONFIGS bbpocket=timeout autotimeout
&CONFIG_TIMEOUT bbpocket=2592000
&TR_TIMEOUT bbpocket=@dolist v(groups)={@trigger me/tr_timeout_group=##}
&TR_TIMEOUT_GROUP bbpocket=@dolist get(%0/mess_lst)={@switch and(extract(get(%0/hdr_##),5,1,|),gt(secs(),extract(get(%0/hdr_##),5,1,|)))=1,{&hdr_## %0; &bdy_## %0; &mess_lst %0=[remove(get(%0/mess_lst),##)]; &master_lst #15=[remove(get(#15/master_lst),##)]}}
&DO_TIMEOUTS bbpocket=@trigger me/tr_timeout; @wait 86400={@trigger me/do_timeouts}
&TR_CONFIG_ANONYMOUS bbpocket=&anonymous %0=[ifelse([%1],[%1],)]; @pemit %2=Posters on the [name(%0)] group will show up as [ifelse([%1],['%1'],themselves)].
&TR_CONFIG_TIMEOUT bbpocket=&config_timeout %0=[mul(%1,86400)]; @pemit %2=New messages for group '[name(%0)]' have [ifelse(%1,a %1 day,no)] timeout.
&TR_GCONFIG_TIMEOUT bbpocket=&config_timeout me=[mul(%0,86400)]; @pemit %1=BB global config parameter 'timeout': [ifelse(%0,%0 days,none)].%rAny new groups will have this value set as their default timeout.
&TR_GCONFIG_AUTOTIMEOUT bbpocket=@switch [eq(hasattr(me,startup),setr(0,switch(%0,on,1,0)))]:%0=1:*,{@pemit %1=BB autotimeout is already [ifelse(%q0,on,off)].},0:on,{@startup me=@trigger me/do_timeouts; @trigger me/do_timeouts; @pemit %1=BB autotimeout turned on.},{@startup me; @pemit %1=BB autotimeout turned off.; @halt me}
&FN_MSG_FLAGS bbpocket=switch([member(get(%0/bb_read),%2)]:[u(fn_timeout_close,index(get(%1/hdr_%2),|,5,1))],0:*,U,*:1,T)
&TR_POST_NOTIFY bbpocket=@switch hasflag(%0,DARK)=0,{@pemit/list iter(remove(lwho(),%0),switch(or(member([get(##/bb_omit)] [get(##/bb_silent)],%1),not(u(%1/canread,##))),0,##))=(New BB message ([member(v(groups),%1)]/%2) posted to '[name(%1)]' by [ifelse(hasattr(%1,anonymous),get(%1/anonymous),name(%0))]: %3)}
&FN_TIMEOUT_CLOSE bbpocket=switch(%0:[lte(sub(%0,secs()),259200)],0:*,0,*:1,1,0)
&FN_HASCONFIG bbpocket=or(hasattr(%0,anonymous),neq(get(%0/config_timeout),get(#15/config_timeout)))
&VERSION bbpocket=4.0.6
&BUFFER_SIZE bbpocket=8000
@chown bbpocket=#3
@set bbpocket=!HALTED INHERIT SAFE
@edit #19/*=#15,#19
@@
@@ #20: <BB> Myrddin's Bulletin Board
@@
@create <BB> Myrddin's Bulletin Board=10
@lock <BB> Myrddin's Bulletin Board=*Wizard
&CREDITS <BB> Myrddin's Bulletin Board=Myrddin's BBS was written by Myrddin@Witchcraft/Dreaming/Elysium (email: merlin@firstmagic.com). The most recent version of this code can be found at http://www.firstmagic.com/~merlin/mushcode, or via anonymous ftp from ftp.firstmagic.com in the /pub/merlin directory. Please refer interested parties to myself or those addresses, thank you. :)
@set <BB> Myrddin's Bulletin Board/CREDITS = no_command
@Desc <BB> Myrddin's Bulletin Board=[iter(setdiff(lattr(me),Desc),ljust(##,18))]
@Fail <BB> Myrddin's Bulletin Board=It's bolted down... you aint budgin' it.
&CMD_+BBNEWGROUP <BB> Myrddin's Bulletin Board=$+bbnewgroup *:@switch hasflag(%#,wizard)=1, {@create %0; @wait 1={@switch [setr(0,num(%0))]=#-1,{@pemit %#=That's not a good name for a group.},{&groups #15=[switch(words(get(#15/groups)),0,,[get(#15/groups)]%b)]%q0; &own %q0=%#; @set %q0=safe; @set %q0=inherit; &last_mod %q0=[u(#15/bbtime)]; &CANREAD %q0=1; &CANWRITE %q0=1; &config_timeout %q0=[get(#15/config_timeout)]; @pemit %#=Group number [member(get(#15/groups),%q0)] added as '%0'. Messages will have [ifelse(get(%q0/config_timeout),a [div(get(%q0/config_timeout),86400)] day,no)] timeout.}}}, {@pemit %#=You can't add groups to the message base.}
&CMD_+BBLOCK <BB> Myrddin's Bulletin Board=$+bblock *=*/*:@switch hasflag(%#,wizard)=1,{@switch member(get(#15/groups),setr(0,u(#15/get_group,%0)))=0,{@pemit %#=No such group as '%0'.},{@switch %1=flag,{&CANREAD %q0=\[or(hasflag(\%0,%2),hasflag(\%0,wizard))]},{&CANREAD %q0=\[or(match(get(\%0/%1),%2),hasflag(\%0,wizard))]}; @wait 1={&CANWRITE %q0=[get(%q0/CANREAD)]}; @pemit %#=Group '%0' locked. Only people with %1=%2 can access.}},{@pemit %#=You cannot lock message groups.}
&CMD_+BBCLEARGROUP <BB> Myrddin's Bulletin Board=$+bbcleargroup *:@switch and(hasflag(%#, wizard),member(get(#15/groups),setr(0,u(#15/get_group,%0))))=1, {&delete_grp #15=%q0; @pemit %#=%r[space(15)]******** Warning ********%r%rDeleting Group #%0 will also delete the [words(get(%q0/mess_lst))] messages in that group.%rIf you still wish to proceed, type '+bbconfirm %0'%r%r[space(15)][repeat(*,25)]%r}, {&delete_grp #15; @pemit %#=You can't remove that group (either that group does not exist, or you are not the owner).}
&DO_CLEARGROUP <BB> Myrddin's Bulletin Board=$+bbconfirm *:@switch get(#15/DELETE_GRP)=[setr(0,u(#15/get_group,%0))], {&groups #15=[remove(get(#15/groups),%q0)]; &master_lst #15=[setdiff(get(#15/master_lst),get(%q0/mess_lst))]; @nuke %q0; &delete_grp #15; @pemit %#=Group number %0 removed.}, {&delete_grp #15; @pemit %#=That group has not been marked for deletion. Use '+bbcleargroup <#>' to mark a group for deletion.}
&CMD_+BBPOST <BB> Myrddin's Bulletin Board=$+bbpost */*=*:@switch member(u(#15/valid_groups,%#,write),setr(0,u(#15/get_group,%0)))=0, {@pemit %#=Either you do not subscribe to Group #%0, or are unable to post to it.},{&mess_lst %q0=[cat(get(%q0/mess_lst),setr(1,get(#15/nxt_mess)))]; &nxt_mess #15=[pack(inc(unpack(get(#15/NXT_MESS),36)),36)]; &master_lst #15=[cat(get(#15/master_lst),%q1)]; &hdr_%q1 %q0=[mid(%1, 0, 34)]|[u(#15/bbtime)]|[edefault(%q0/anonymous,mid(name(%#),0,24))]|[owner(%#)]|[ifelse(get(%q0/config_timeout),add(get(%q0/config_timeout),secs()),0)]; &last_mod %q0=[u(#15/bbtime)]; &bdy_%q1 %q0=[%2][ifelse(and(hasattr(%#,bb_sig),not(hasattr(%q0,anonymous))),{%r[ulocal(%#/bb_sig)]},)]; @pemit %#=You post your note about '%1' in group [member(get(#15/groups),%q0)] ([name(%q0)]) as message #[member(get(%q0/mess_lst),%q1)][ifelse(and(hasattr(%#,bb_sig),hasattr(%q0,anonymous)),{%b%bThis is an anonymous group, your BB_SIG was -not- appended.},)]; &bb_read %#=[setunion(get(%#/bb_read),%q1)]; @trigger #15/tr_post_notify=%#,%q0,[member(get(%q0/mess_lst),%q1)],[mid(%1, 0, 34)]}
&CMD_+BBPOST2 <BB> Myrddin's Bulletin Board=$+bbpost */*:@switch hasattr(#15,bb_post_hdr_%#)=1,{@pemit %#=You are already in the middle of writing a bbpost.},{@switch strmatch(%1,*=*)=0,{@switch member(u(#15/valid_groups,%#,write),[setq(0,u(#15/get_group,%0))]%q0)=0,{@pemit %#=Either you do not subscribe to Group #%0 or are unable to post to it.},{&bb_post_hdr_%# #15=%q0|[mid(%1,0,34)]; @pemit %#=%rYou start your posting to Group #[member(get(#15/groups),%q0)] ([name(%q0)]).%rYou can now compose the body of the post by using '+bbwrite <text>'%ror '+bb <text>'. When you are finished, type '+bbpost' by itself.[ifelse(and(hasattr(%#,bb_sig),hasattr(%q0,anonymous)),{%b%bThis is an anonymous group. Your BB_SIG will -not- be appended.},)]}}}
&CMD_+BBWRITE <BB> Myrddin's Bulletin Board=$+bbwrite *:@switch hasattr(#15,bb_post_hdr_%#)=0,{@pemit %#=You do not have a bbpost in progress.},{&bb_post_bdy_%# #15=[get(#15/bb_post_bdy_%#)]%0; @pemit %#=Text added to bbpost.}
&CMD_+BB <BB> Myrddin's Bulletin Board=$+bb *:@switch hasattr(#15,bb_post_hdr_%#)=0,{@pemit %#=You do not have a bbpost in progress.},{&bb_post_bdy_%# #15=[get(#15/bb_post_bdy_%#)]%b%0; @pemit %#=Text added to bbpost.}
&CMD_+BBPOST-POST <BB> Myrddin's Bulletin Board=$+bbpost:@switch [hasattr(#15,bb_post_hdr_%#)]:[hasattr(#15,bb_post_bdy_%#)]=0:0,{@pemit %#=You do not have a bbpost in progress.},1:0,{@pemit %#=Your post is empty. Please add text with the '+bbwrite <text>' command or discard the posting with the '+bbtoss' command.},{&mess_lst [setr(0,index(get(#15/bb_post_hdr_%#),|,1,1))]=[cat(get(%q0/mess_lst),setr(1,get(#15/nxt_mess)))]; &nxt_mess #15=[pack(inc(unpack(get(#15/NXT_MESS),36)),36)]; &master_lst #15=[cat(get(#15/master_lst),%q1)]; &hdr_%q1 %q0=[index(get(#15/bb_post_hdr_%#),|,2,1)]|[u(#15/bbtime)]|[edefault(%q0/anonymous,mid(name(%#),0,24))]|[owner(%#)]|[ifelse(get(%q0/config_timeout),add(get(%q0/config_timeout),secs()),0)]; &last_mod %q0=[u(#15/bbtime)]; &bdy_%q1 %q0={[trim(get(#15/bb_post_bdy_%#))][ifelse(and(hasattr(%#,bb_sig),not(hasattr(%q0,anonymous))),{%r[ulocal(%#/bb_sig)]},)]}; @pemit %#=You post your note about '[index(get(#15/bb_post_hdr_%#),|,2,1)]' in group '[name(%q0)]' as message #[member(get(%q0/mess_lst),%q1)]; &bb_read %#=[setunion(get(%#/bb_read),%q1)]; @trigger #15/tr_post_notify=%#,%q0,[member(get(%q0/mess_lst),%q1)],[index(get(#15/bb_post_hdr_%#),|,2,1)]; &bb_post_bdy_%# #15; &bb_post_hdr_%# #15}
&CMD_+BBPROOF <BB> Myrddin's Bulletin Board=$+bbproof:@switch hasattr(#15,bb_post_hdr_%#)=0,{@pemit %#=You do not have a bbpost in progress.},{@pemit %#=[header(BB Post in Progress)]%rGroup: %b[name(index(get(#15/bb_post_hdr_%#),|,1,1))]%rTitle: %b[index(get(#15/bb_post_hdr_%#),|,2,1)]%r[subheader()]%r[trim(get(#15/bb_post_bdy_%#))]%r[footer()]}
&CMD_+BBTOSS <BB> Myrddin's Bulletin Board=$+bbtoss:@switch hasattr(#15,bb_post_hdr_%#)=0,{@pemit %#=You do not have bbpost in progress.},{&bb_post_hdr_%# #15; &bb_post_bdy_%# #15; @pemit %#=Your bbpost has been discarded.}
&CMD_+BBREMOVE <BB> Myrddin's Bulletin Board=$+bbremove */*:@dolist [setq(0,u(#15/get_group,%0))][revwords(sort(u(#15/fn_makelist,%1)))]={@switch or(strmatch(index(get(%q0/HDR_[setr(1,extract(get(%q0/MESS_LST),##,1))]),|,4, 1),%#), hasflag(%#,wizard))=1, {&HDR_%q1 %q0; &BDY_%q1 %q0; &MESS_LST %q0=[remove(get(%q0/MESS_LST),%q1)]; &MASTER_LST #15=[remove(get(#15/MASTER_LST),%q1)]; @pemit %#=Message ## removed from group #[member(get(#15/groups),%q0)] ([name(%q0)]).}, {@pemit %#=Either message ## does not exist, or you were not the original poster.}}
&CMD_+BBREAD <BB> Myrddin's Bulletin Board=$+bbread:@pemit %#=[header([mudname()] BBS)]%r[space(7)]Group Name[space(20)]Last Post[space(6)]# of messages%r[subheader()][iter(u(#15/valid_groups,%#,read),%r[rjust(member(get(#15/groups),##),2)][center([switch([get(##/CANREAD)]:[get(##/CANWRITE)]:[u(##/CANWRITE,%#)],1:1:1,,1:*:1,{(-)},1:*:0,-,*)],5)][ljust(name(##),30)][ljust(get(##/LAST_MOD),20)][rjust(words([setq(0,get(##/MESS_LST))]%q0),3)]%b[ljust(u(#15/isgroupread,%#,%q0),2)])]%r[subheader()]%r[center('*' = restricted[space(5)]'-' = read only[space(5)]'\(-\)' = read only\, but you can write,78)]%r[footer(switch(hasflag(%#,WIZARD),1,BBS at [round(mul(fdiv(strlen(get(#15/master_lst)),get(#15/buffer_size)),100),1)]%% capacity.,))]
&CMD_+BBREAD2 <BB> Myrddin's Bulletin Board=$+bbread *:@switch strmatch([%0],*/*)=0,{@switch member(u(#15/valid_groups,%#,read),setr(0,u(#15/get_group,%0)))=0,{@pemit %#=[switch(%q0,#-2,That Group name is not specific enough.,You do not subscribe to that Group.)]},{@pemit %#=[header(name(%q0))]%r[space(8)]Message[space(28)]Posted[space(8)]By%r[subheader()]; @dolist get(%q0/MESS_LST)={@pemit %#=[ljust([member(get(#15/groups),%q0)]/[member(get(%q0/MESS_LST),##)],6)][ljust(u(#15/fn_msg_flags,%#,%q0,##),2)][ljust(index(setr(1,get(%q0/HDR_##)),|,1,1),35)][ljust(index(%q1,|,2,1),14)][mid([index(%q1,|,3,1)][ifelse(and(hasattr(%q0,anonymous),hasflag(%#,wizard)),%b\([name(index(%q1,|,4,1))]\),)],0,21)][switch(member(get(%q0/MESS_LST),##),words(get(%q0/MESS_LST)),%r[footer()])]}}},{@switch member(u(#15/valid_groups,%#,read),setr(0,u(#15/get_group,setr(2,first(%0,/)))))=0,{@pemit %#=[switch(%q0,#-2,That Group name is not specific enough.,You do not subscribe to that Group.)]},{@dolist [setq(4,member(get(#15/groups),%q0))][switch(rest(%0,/),u,u(#15/unreadnums,%#,%q0),u(#15/fn_makelist,rest(%0,/)))]={@switch [and(lte(##,words(get(%q0/MESS_LST))),isnum(##),gt(##,0))]=0,{@pemit %#=Message %q4/## ([name(%q0)]/##) does not exist.},{@pemit %#=[header(name(%q0))]%r[ljust(Message: %q4/##[switch(u(#15/fn_timeout_close,index(setr(3,get(%q0/HDR_[extract(get(%q0/MESS_LST),##,1)])),|,5,1)),1,{%b(timeout warning)})],35)]Posted[space(8)]Author%r[ljust(index(%q3,|,1,1),35)][ljust(index(%q3,|,2,1),14)][mid([index(%q3,|,3,1)][ifelse(and(hasattr(%q0,anonymous),hasflag(%#,wizard)),%b\([name(index(%q3,|,4,1))]\),)],0,29)]%r[subheader()]%r[get(%q0/BDY_[extract(get(%q0/MESS_LST),##,1)])]%r[footer()]; &bb_read %#=[setunion(get(%#/bb_read),[extract(get(%q0/MESS_LST),##,1)])]}};  2={&bb_read %#=[setinter(get(%#/bb_read),get(#15/master_lst))]}}}
&CMD_+BBEDIT <BB> Myrddin's Bulletin Board=$+bbedit */*=*/*:@switch strmatch(index(get([setq(0,u(#15/get_group,%0))]%q0/HDR_[setq(1,extract(get(%q0/MESS_LST),%1,1))]%q1),|,4, 1),%#)=1,{&BDY_%q1 %q0=[edit(get(%q0/BDY_%q1),{%2},{%3})]; @pemit %#=[repeat(=,78)]%rMessage [member(get(#15/groups),%q0)]/%1 ([name(%q0)]/%1) now reads:%r[repeat(-,78)]%r[get(%q0/BDY_%q1)]%r[repeat(=,78)]}, {@pemit %#=Either that message does not exist, or you were not the original poster.}
&CMD_+BBLEAVE <BB> Myrddin's Bulletin Board=$+bbleave *:@switch member(u(#15/valid_groups,%#,read),[setq(0,u(#15/get_group,%0))]%q0)=0,{@pemit %#=You aren't currently subscribing to Board #%0. No ommission necessary.},{&bb_omit %#=[setunion(get(%#/bb_omit),%q0)]; @pemit %#=You have removed yourself from the [name(%q0)] board.}
&CMD_+BBJOIN <BB> Myrddin's Bulletin Board=$+bbjoin *:@switch member(NULL [get(%#/bb_omit)],[setq(0,u(#15/get_group,%0))]%q0)=0,{@pemit %#=[switch(member(u(#15/valid_groups,%#,read),%q0),0,{Sorry, you don't have access to that board.},{You are already a member of the [name(%q0)] board.})]},{&bb_omit %#=[setdiff(get(%#/bb_omit),%q0)]; @pemit %#=You have joined the [name(%q0)] board.}
&CMD_+BBSCAN <BB> Myrddin's Bulletin Board=$+bbscan: @pemit %#=[switch(hasattr(#15,BB_POST_HDR_%#),1,** BB Warning: You are in the middle of writing a bbpost. **%r)][switch(setdiff(iter(setr(0,u(#15/VALID_GROUPS,%#,read)),get(##/MESS_LST)),setr(1,get(%#/BB_READ))),,There are no unread postings on the Global Bulletin Board.,[header(Unread Postings on the Global Bulletin Board)][setq(9,get(#15/GROUPS))][trim(iter(%q0,switch(setr(2,setdiff(setr(3,get(##/MESS_LST)),%q1)),,,%r[name(##)] \(#[member(%q9,##)]\): [words(%q2)] unread \([u(#15/FN_UNREAD_LIST,%q2,%q3)]\))),b)]%r[footer(switch(hasflag(%#,WIZARD),1,BBS at [round(mul(fdiv(strlen(get(#15/master_lst)),get(#15/buffer_size)),100),1)]%% capacity.,))])]
&CMD_+BBLIST <BB> Myrddin's Bulletin Board=$+bblist:@pemit %#=[header(BBoard List)]%r[ljust(Group Name,37)]Member?[space(8)]Timeout (in days)%r[subheader()]%r%b[iter(get(#15/groups),switch(u(##/canread,%#),1,[trim([ljust(member(get(#15/groups),##),5)][ljust(name(##),32)][ljust(switch(member(get(%#/bb_omit),##),0,Yes,No),19)][rjust(ifelse(get(##/config_timeout),div(get(##/config_timeout),86400),none),4)])]),%r%b)]%r[subheader()]%rTo join groups, type '+bbjoin <group number or name>'%r[footer()]
&CMD_+BBCATCHUP <BB> Myrddin's Bulletin Board=$+bbcatchup *:@switch lcstr(%0)=all,{&bb_read %#=[get(#15/master_lst)]; @pemit %#=All postings on all boards marked as read.},{@dolist [setq(1,u(#15/valid_groups,%#,read))][u(#15/fn_makelist,%0)]={@switch member(%q1,[setq(0,u(#15/get_group,##))]%q0)=0,{@pemit %#=You do not subscribe to Group ##.},{ &bb_read %#=[setunion(get(%#/bb_read),get(%q0/MESS_LST))]; @pemit %#=All postings on Group #[member(get(#15/groups),%q0)] ([name(%q0)]) marked as read.}}}
&CMD_+BBMOVE <BB> Myrddin's Bulletin Board=$+bbmove */* to *:@switch and(member(u(#15/valid_groups,%#,read),[setq(0,u(#15/get_group,%0))]%q0),member(u(#15/valid_groups,%#,write),[setq(2,u(#15/get_group,%2))]%q2),not(strmatch(%q0,%q2)))=0,{@pemit %#=One of the selected groups is not valid (either it doesn't exist, you can't write to it, or you tried to 'move' to the same group).},{@switch or(strmatch(index(get(%q0/HDR_[setq(1,extract(get(%q0/MESS_LST),%1,1))]%q1),|,4, 1),%#), and(hasflag(%#,wizard),member(get(%q0/MESS_LST),%q1)))=1,{&HDR_%q1 %q2=[get(%q0/HDR_%q1)]; &BDY_%q1 %q2=[get(%q0/BDY_%q1)]; &MESS_LST %q2=[cat(get(%q2/mess_lst),%q1)]; &MESS_LST %q0=[remove(get(%q0/MESS_LST),%q1)]; &HDR_%q1 %q0; &BDY_%q1 %q0; @pemit %#=Message '%1' removed from group '%0' and added to group '%2' as message #[member(get(%q2/mess_lst),%q1)]},{@pemit %#=Not a valid message number for that group.}}
&CMD_+BBWRITELOCK <BB> Myrddin's Bulletin Board=$+bbwritelock *=*/*:@switch hasflag(%#,wizard)=1,{@switch member(get(#15/groups),[setq(0,u(#15/get_group,%0))]%q0)=0,{@pemit %#=No such group as '%0'.},{@switch %1=flag,{&CANWRITE %q0=\[or(hasflag(\%0,%2),hasflag(\%0,wizard))]},{&CANWRITE %q0=\[or(match(get(\%0/%1),%2),hasflag(\%0,wizard))]}; @pemit %#=Group '%0' locked. Only people with %1=%2 can write.}},{@pemit %#=You cannot lock message groups.}
&CMD_+BBEDIT2 <BB> Myrddin's Bulletin Board=$+bbedit *=*/*:@switch strmatch([setq(0,ucstr(%0))]%q0,*/*)=0,{@switch %q0=TEXT,{@edit #15/bb_post_bdy_%#={%1},{%2}},TITLE,{&bb_post_hdr_%# #15=[index(get(#15/bb_post_hdr_%#),|,1,1)]|[edit(index(get(#15/bb_post_hdr_%#),|,2,1),{%1},{%2})]}; @wait 0={@pemit %#=[center(= BB Post in Progress =,78,=)]%rGroup: %b[name(index(get(#15/bb_post_hdr_%#),|,1,1))]%rTitle: %b[index(get(#15/bb_post_hdr_%#),|,2,1)]%r[repeat(-,78)]%r[trim(get(#15/bb_post_bdy_%#))]%r[repeat(=,78)]}}
&CMD_+BBHELP <BB> Myrddin's Bulletin Board=$+bbhelp:@pemit %#=Please use '+help bb'.
&CMD_+BBCONFIG <BB> Myrddin's Bulletin Board=$+bbconfig:@pemit %#=[header(Myrddin's Global BBS v[get(#15/version)])]%rGlobal Config Parameters:%r%r[rjust(timeout:,15)] [div(get(#15/config_timeout),86400)] days%r[rjust(autotimeout:,15)] [ifelse(hasattr(#15,startup),on,off)]%r[subheader()]%rBoard Config Parameters:%r%r%b[iter(filter(#15/fn_hasconfig,get(#15/groups)),[name(##)]%r[ifelse(hasattr(##,anonymous),[space(5)]anonymous: [get(##/anonymous)]%r,)][ifelse(neq(get(##/config_timeout),get(#15/config_timeout)),[space(5)]timeout: [div(get(##/config_timeout),86400)] days%r,)],%r%b%b)]%r[footer()]
&CMD_+BBCONFIG2 <BB> Myrddin's Bulletin Board=$+bbconfig *=*:@switch [strmatch(%0,*/*)]:[hasflag(%#,wizard)]=1:*,{},0:0,{@pemit %#=Huh?%b%b(Type "help" for help.)},{@switch [member(get(#15/valid_global_configs),lcstr(%0))]=0,{@pemit %#=Valid global config parameters are: [get(#15/valid_global_configs)]},{@trigger #15/tr_gconfig_%0=%1,%#}}
&CMD_+BBCONFIG3 <BB> Myrddin's Bulletin Board=$+bbconfig */*=*:@switch/first hasflag(%#,wizard)=0,{@pemit %#=Huh?%b%b(Type "help" for help.)},{@switch [setr(0,u(#15/get_group,%0))]:[member(get(#15/valid_configs),lcstr(%1))]=#-1:*,{@pemit %#='%0' is not a valid group name.},#-2:*,{@pemit %#='%0' is not specific enough.},*:0,{@pemit %#=Valid config parameters are: [get(#15/valid_configs)]},{@trigger #15/tr_config_%1=%q0,%2,%#}}
&CMD_+BBTIMEOUT <BB> Myrddin's Bulletin Board=$+bbtimeout */*=*:@dolist [sort(u(#15/fn_makelist,%1))][setq(0,u(#15/get_group,%0))]={@switch [or(strmatch(index(get(%q0/HDR_[setq(1,extract(get(%q0/MESS_LST),##,1))]%q1),|,4, 1),%#), hasflag(%#,wizard))]:[and(isnum(%2),or(and(gt(%2,0),lte(mul(%2,86400),get(%q0/config_timeout))),and(not(get(%q0/config_timeout)),gte(%2,0)),hasflag(%#,wizard)))]=1:1, {&hdr_%q1 %q0=[replace(get(%q0/hdr_%q1),5,ifelse(%2,add(secs(),mul(%2,86400)),0),|)]; @pemit %#=Message ## in group '[name(%q0)]' has [ifelse(%2,a %2 day,no)] timeout.}, 0:*,{@pemit %#=Either message ## does not exist, or you were not the original poster.},*:0,{@pemit %#=Sorry, '%2' is not a valid number of days for a timeout on the '[name(%q0)]' board. [ifelse(get(%q0/config_timeout),Maximum timeout is [div(get(%q0/config_timeout),86400)] days.,)]}}
&CMD_+BBSEARCH <BB> Myrddin's Bulletin Board=$+bbsearch */*:@switch [member(u(#15/valid_groups,%#,write),setr(0,u(#15/get_group,%0)))]:[hasattr(%q0,anonymous)]:[isdbref(setr(1,pmatch(%1)))]=0:*:*,{@pemit %#=BB Group '%0' is either an invalid Group, an unreadable Group, or a Group you do not subscribe to.},1:1:*,{@pemit %#=BB Group '[name(%q0)]' is an anonymous group.},1:0:0,{@pemit %#=No such player '%1'.},{@switch words(setr(2,grep(%q0,hdr_*,|%q1|)))=0,{@pemit %#=[name(%q1)] hasn't posted any messages to the '[name(%q0)]' Group.},{@pemit %#=%r[header(name(%q0))]%r[space(8)]Message[space(28)]Posted[space(8)]By%r[subheader()]; @dolist %q2={@pemit %#=[ljust([member(get(#15/groups),%q0)]/[member(get(%q0/mess_lst),last(##,_))],6)][ljust(u(#15/fn_msg_flags,%#,%q0,last(##,_)),2)][ljust(index([setr(3,get(%q0/##))],|,1,1),35)][ljust(index(%q3,|,2,1),14)][mid([index(%q3,|,3,1)],0,21)][switch(member(%q2,##),words(%q2),%r[footer()])]}}}
&CMD_+BBNOTIFY <BB> Myrddin's Bulletin Board=$+bbnotify *=*:@switch/first [member(u(#15/valid_groups,%#,read),setr(0,u(#15/get_group,%0)))]:[member(on off,lcstr(%1))]:[lcstr(%1)]=0:*:*,{@pemit %#=[switch(%q0,#-2,That Group name is not specific enough.,You do not subscribe to that Group.)]},*:0:*,{@pemit %#=Invalid choice '%1'. Choices are 'on' or 'off'.},*:*:off,{&bb_silent %#=[setunion(get(%#/bb_silent),%q0)]; @pemit %#=Post notification for BB Group '[name(%q0)]' turned off. You will no longer be notified of new postings to that Group.},{&bb_silent %#=[setdiff(get(%#/bb_silent),%q0)]; @pemit %#=Post notification for BB Group '[name(%q0)]' turned on. You will now be notified of new postings to that Group.}
&CMD_BBNEXT <BB> Myrddin's Bulletin Board=$+bbnext:@switch [setq(y,iter(iter(get(#15/groups),if(u(%i0/canread,%#),%i0)),setq(z,setunion(%qz,trim(get(%i0/mess_lst))))))][setr(x,setdiff(%qz,get(%#/bb_read)))]=,{@pemit %#=No unread messages.},{@dolist get(#15/groups)=@switch [hasattr(##,hdr_[setr(1,first(%qx))])][u(##/canread,%#)]=11,{@pemit %#=[setq(0,get(##/hdr_%q1))][header(name(##))]%r[ljust(Message: [member(get(#15/groups),##)]/[member(get(##/MESS_LST),%q1)],35)]Posted[space(8)]Author%r%xh[ljust(extract(%q0,1,1,|),35)]%xn[ljust(extract(%q0,2,1,|),14)][mid([extract(%q0,3,1,|)][ifelse(and(hasattr(##,anonymous),hasflag(%#,wizard)),%b\([name(extract(%q0,4,1,|))]\),)],0,29)]%r[subheader()]%xn%r[get(##/bdy_%q1)]%r[footer()][set(%#,bb_read:[get(%#/bb_read)]%B[first([setdiff([get(#15/master_lst)],[get(%#/bb_read)])])])];&bb_read %#=[setunion(get(%#/bb_read),%q1)]}};wait 2={&bb_read %#=[setinter(get(%#/bb_read),get(#15/master_lst))]
@chown <BB> Myrddin's Bulletin Board=#3
@set <BB> Myrddin's Bulletin Board=!HALTED INHERIT SAFE
@edit #20/*=#15,#19
@tel #19=#20
drop #20
+bbnewgroup Announcements
@wait 3={&CANWRITE #21=isstaff(%0)}
@@
@@ Anomaly Jobs 6.0 Installer
@@ For new installations or upgrades from 5.0+
@@ Quote this file from your client with a 1-second delay
@@
think [repeat(=,77)]%r%r[center(ansi(hc,Setting up Anomaly Jobs v6.0),77)]%r%r[repeat(=,77)]
think [ansi(hc,ANOMALY JOBS:)] Checking current installation.
@switch [ifelse(isdbref(setr(0,switch(first(version()),PennMUSH,lsearch(all,eobjects,\[strmatch(name(##),Job Global Object <JGO>)\]),RhostMUSH,searchng(object=Job Global Object <JGO>),search(object=Job Global Object <JGO>)))),setq(1,get(%q0/VA)),[setq(1,switch(first(version()),PennMUSH,lsearch(all,eobjects,\[strmatch(name(##),Job Database <JD>)\]),RhostMUSH,searchng(object=Job Database <JD>),search(object=Job Database <JD>)))][setq(0,loc(%q1))])][isdbref(%q0)][and(isdbref(%q1),gte(edit(first(default(%q1/version,0),.),v,),5))]=0*,{think [ansi(hc,ANOMALY JOBS:)] No previous jobs installation found.  Creating a new one.;&JOB_GO %#=setr(0,create(Job Global Object <JGO>,10));&JOB_VA %#=setr(1,create(Job Database <JD>,10));&JOB_VB %#=setr(2,create(Job Tracker,10));&JOB_VC %#=setr(3,create(Job Parent Object <JPO>,10));&JOB_PATCH %#=0;@tel %q1=%q0;@tel %q2=%q0;@tel %q3=%q0;},10*,{think [ansi(hc,ANOMALY JOBS:)] [ansi(hr,Not a valid Jobs 5 or later installation.)];think [ansi(hc,ANOMALY JOBS:)] [ansi(hr,Aborting. Cancel this script in your client.)];&JOB_GO %#=#-1;&JOB_VA %#=#-1;&JOB_VB %#=#-1;&JOB_VC %#=#-1;&JOB_PATCH %#=1;},{think [ansi(hc,ANOMALY JOBS:)] Current installation found.  Updating.;&JOB_GO %#=%q0;&JOB_VA %#=%q1;&JOB_VB %#=get(%q0/VB);&JOB_VC %#=get(%q0/VC);&JOB_PATCH %#=1;}
@dolist GO VA VB VC=@switch [first(version())]=RhostMUSH,{@Desc [v(JOB_##)]=lit(%r[columns(sort(lattr(me/*)),18,4)]%r%r[center(Please do not rename this object.,79)])},{@Desc [v(JOB_##)]=lit(%r[table(sort(lattr(me/*)),18)]%r%r[center(Please do not rename this object.,79)])}
think [ansi(hc,ANOMALY JOBS:)] Setting up commands.
@switch [v(JOB_PATCH)][hasattr(v(JOB_GO),STARTUP)]=11,@Startup [v(JOB_GO)]
@adisconnect [v(JOB_GO)]=@pemit me=[ifelse(u(%va/HAS_ACCESS,%#),set(%#,LAST_CONN:[secs()]),)]
@aconnect [v(JOB_GO)]=@switch [u(%va/HAS_ACCESS,%#)]=1,{@fo %#=+jobs/new},{@fo %#=+myjobs}
&CMD_BUCKET/ACCESS [v(JOB_GO)]=$+bucket/access *=*:@switch [u(%va/GIVE_ACCESS,%#)][setq(0,pmatch(%0))][setq(1,u(%va/FN_FIND-BUCKET,%1))][isdbref(%q0)][isdbref(%q1)][u(%va/HAS_ACCESS,%q0)][u(%va/FN_WIZONLY,%q0)][u(%va/FN_ACCESSCHECK,%q1,%q0)]=0*,{@pemit %#=Permission denied.},10*,{@pemit %#=There is no player by that name.},110*,{@pemit %#=There is no bucket by that name.},1110*,{@pemit %#=That player does not have +jobs access.},11111*,{@pemit %#=That player can always access all buckets.},111100*,{@pemit %#=You have given [name(%q0)] access to the [name(%q1)] bucket.;&JOBSB %q0=[ifelse(member(get(%q0/JOBSB),%q1),remove(get(%q0/JOBSB),%q1),setunion(get(%q0/JOBSB),%q1))]},{@pemit %#=You have removed [name(%q0)]'s access to the [name(%q1)] bucket.;&JOBSB %q0=[ifelse(member(get(%q0/JOBSB),%q1),remove(get(%q0/JOBSB),%q1),setunion(get(%q0/JOBSB),%q1))]}
&CMD_BUCKET/CHECK [v(JOB_GO)]=$+bucket/check *:@switch [isdbref(setr(0,pmatch(%0)))]=0,{@pemit %#=There is no such player.},{@pemit %#=[u(%va/FN_HEADER,Bucket Information For [name(%q0)])]%r%r[ansi(h,[ljust(Bucket,15)]%bHas Access?)]%r[iter(lcon(%VC),[ljust(name(itext(0)),15)]%b[ifelse(u(%VA/fn_accesscheck,itext(0),%q0),Yes,No)],%b,%r)];@pemit %#=%r[u(%va/FN_FOOTER)]}
&CMD_BUCKET/CREATE [v(JOB_GO)]=$+bucket/create *=*:@switch [setq(0,u(%va/FN_FIND-BUCKET,%0))][u(%va/FN_WIZONLY,%#)][not(isdbref(%q0))][not(gt(strlen(%0),5))]=0*,{@pemit %#=Permission denied.},10*,{@pemit %#=There is already a bucket by that name.},110*,{@pemit %#=The name of a bucket is limited to five letters.},{@pemit %#=You have created a bucket named [ucstr(%0)].[setq(0,create(ucstr(%0),10))] Be sure to change %q0/ACCESS to establish who can access the bucket. Presently, it is set to 1, which means that anyone who can access +jobs can access the bucket.;@tel %q0=%vc;@parent %q0=%vc;@desc %q0=[secure(%1)];@set %q0=inherit !safe !halted !no_command;&ACCESS %q0=1;@lock/speech %q0=ACCESS/1}
@switch [first(version())]=PennMUSH,{@edit [v(JOB_GO)]/CMD_BUCKET/CREATE=inherit !safe !halted,wizard !safe !halt},TinyMUSH,{@edit [v(JOB_GO)]/CMD_BUCKET/CREATE=!no_command,commands}
&CMD_BUCKET/DELETE [v(JOB_GO)]=$+bucket/delete *:@switch [u(%va/FN_WIZONLY,%#)][setq(0,u(%va/FN_FIND-BUCKET,%0))][isdbref(%q0)][eq(words(remove(children(%q0),#-1)),0)][not(hasflag(%q0,SAFE))]=0*,{@pemit %#=Permission denied.},10*,{@pemit %#=There is no bucket by that name.},110*,{@pemit %#=The bucket is not empty, and cannot be deleted.},1110*,{@pemit %#=That bucket is required for the system to operate properly.},{@pemit %#=You have deleted the bucket named [ucstr(%0)].;@set %q0=DESTROY_OK;@nuke %q0;@dolist [switch(first(version()),PennMUSH,lsearch(all,type,player),RhostMUSH,searchng(type=player),search(type=player))]={&JOBSH ##=[remove(get(##/JOBSH),%q0)];&JOBSB ##=[remove(get(##/JOBSB),%q0)]}}
&CMD_BUCKET/HELP [v(JOB_GO)]=$+bucket/help *:@switch [setq(0,u(%va/FN_FIND-BUCKET,%0))][u(%va/FN_ACCESSCHECK,%q0,%#)][isdbref(%q0)]=0*,{@pemit %#=Permission denied.},10*,{@pemit %#=That is not a valid bucket. Type '[ansi(h,+buckets)]' for a list of valid buckets.},{@pemit %#=[u(%va/FN_HEADER,Bucket Help For [name(%q0)])];@pemit %#=[u(%q0/HELP)][ifelse(u(%va/FN_HASATTRP,%q0,MYHELP),%r[u(%va/FN_BREAK,[ansi(c,Myjob Help)])]%r[u(%q0/MYHELP)],)];@pemit %#=[u(%va/FN_FOOTER)]}
&CMD_BUCKET/INFO [v(JOB_GO)]=$+bucket/info *:@switch [u(%va/FN_STAFFALL,%#)][setq(0,u(%va/FN_FIND-BUCKET,%0))][isdbref(%q0)]=0*,{@pemit %#=Permission denied.},10*,{@pemit %#=There is no bucket by that name.},{@pemit %#=[u(%va/FN_HEADER,Bucket Information For [name(%q0)])]%r[u(%va/DISPLAY_BUCKET)];@pemit %#=[u(%va/DISPLAY_BUCKET2)];@pemit %#=[u(%va/FN_FOOTER)]}
&CMD_BUCKET/MONITOR [v(JOB_GO)]=$+bucket/monitor *:@switch [u(%va/HAS_ACCESS,%#)][setq(0,u(%va/FN_FIND-BUCKET,%0))][isdbref(%q0)][u(%va/FN_ACCESSCHECK,%q0,%#)][u(%va/FN_MONITORCHECK,%q0,%#)]=0*,{@pemit %#=Permission denied.},10*,{@pemit %#=There is no bucket by that name.},110*,{@pemit %#=You do not have access to that bucket.},1110*,{@pemit %#=You have added bucket [name(%q0)] to your monitored list.;&JOBSH %#=[ifelse(u(%va/FN_HASATTR,%q0,HIDDEN),setunion(get(%#/JOBSH),%q0),remove(get(%#/JOBSH),%q0))]},{@pemit %#=You have removed bucket [name(%q0)] from your monitored list.;&JOBSH %#=[ifelse(u(%va/FN_HASATTR,%q0,HIDDEN),remove(get(%#/JOBSH),%q0),setunion(get(%#/JOBSH),%q0))]}
&CMD_BUCKET/SET [v(JOB_GO)]=$+bucket/set */*=*:@switch [setq(0,u(%va/FN_FIND-BUCKET,%0))][and(u(%va/HAS_ACCESS,%#),u(%va/CONFIG_ACCESS,%#),u(%q0/ACCESS_%1,%#))][isdbref(%q0)][u(%va/FN_HASATTRP,%q0,ACCESS_%1)][u(%q0/PROCESS_%1,%2,%q0,%#)]=0*,{@pemit %#=Permission denied.},10*,{@pemit %#=There is no bucket by that name. See '[ansi(h,+buckets)]' for a list of valid buckets.},110*,{@pemit %#='%1' is not a valid parameter. Valid parameters for [name(%q0)] are [u(%va/FN_ITEMIZE,map(%va/MAP_PARAMS,lattr(%vc/PROCESS_*)))].},1110*,{@pemit %#=[u(%q0/ERROR_%1%q2)]},{@pemit %#=[name(%q0)]'s [ucstr(%1)] successfully updated to: '%2'.;&%q3 %q0=%q1}
&CMD_BUCKETS [v(JOB_GO)]=$+buckets:@switch [u(%va/HAS_ACCESS,%#)]=0*,{@pemit %#=Permission denied.},{@pemit %#=[u(%va/FN_BUCKETHEADER)];think [setq(x,sortby(%va/SORTBY_NAME,filter(%va/FIL_ISBUCKET,lcon(%vc))))];@pemit %#=[iter(filter(%va/FIL_ACCESS,%qx),u(%va/FN_BUCKETLIST,##),%B,%R)];@pemit %#=[u(%va/FN_FOOTER,[ifelse(u(%va/FN_STAFFALL,%#),ansi(hy,V=Viewing H=Hidden P=Published M=Myjobs L=Locked S=Summary),)])]}
&CMD_BUG [v(JOB_GO)]=$+bug *=*:@switch [not(haspower(%#,guest))]=0*,{@pemit %#=Permission Denied.},{@pemit %#=You have notified production staff of the [secure(u(%va/FN_STRTRUNC,%0,30))] bug, with the details '[secure(u(%va/FN_STRTRUNC,%1,get(%va/BUFFER)))]';@trigger %va/TRIG_CREATE=%#,locate(%vc,CODE,i),3,BUG: [u(%va/FN_STRTRUNC,%0,30)],[u(%va/FN_STRTRUNC,%1,get(%va/BUFFER))],,,5}
&CMD_JGROUPS [v(JOB_GO)]=$+jgroups:@switch [u(%va/HAS_ACCESS,%#)][words(remove(lcon(%vb),#-1))]=0*,{@pemit %#=Permission denied.},10*,{@pemit %#=No jgroups have been defined.},{@pemit %#=[u(%va/FN_HEADER,JGroup List)]%r[ljust(JGroup,15)]Description;@pemit %#=[iter(sortby(%va/SORTBY_NAME,lcon(%vb)),[ljust(name(##),15)][get(##/Desc)],%B,%R)];@pemit %#=[u(%va/FN_FOOTER)]}
&CMD_JGROUP/CREATE [v(JOB_GO)]=$+jgroup/create *=*:@switch [u(%va/FN_WIZONLY,%#)][setq(0,u(%va/FN_FIND-JGROUP,%0))][not(isdbref(%q0))][strmatch(%0,+*)][eq(words(%0),1)]=0*,{@pemit %#=Permission denied.},10*,{@pemit %#=There is already a jgroup by that name.},110*,{@pemit %#=Jgroup names must begin with +.},1110*,{@pemit %#=Jgroup names may not contain spaces.},{@pemit %#=You have created a jgroup named %0.[setq(0,create(%0,10))] Use %q0/ISMEMBER to define a function indicating membership in the jgroup.;@tel %q0=%vb;@desc %q0=[secure(%1)];&ISMEMBER %q0=lit(t(member(v(MEMBERLIST),%0)));@set %q0=inherit !safe !halted !no_command;}
@switch [first(version())]=PennMUSH,{@edit [v(JOB_GO)]/CMD_JGROUP/CREATE=inherit !safe !halted,wizard !safe !halt},TinyMUSH,{@edit [v(JOB_GO)]/CMD_JGROUP/CREATE=!no_command,commands}
&CMD_JGROUP/DELETE [v(JOB_GO)]=$+jgroup/delete *:@switch [u(%va/FN_WIZONLY,%#)][setq(0,u(%va/FN_FIND-JGROUP,%0))][isdbref(%q0)]=0*,{@pemit %#=Permission denied.},10*,{@pemit %#=There is no jgroup by that name.},{@pemit %#=You have deleted the jgroup named %0.;@set %q0=DESTROY_OK;@nuke %q0;@wait 0=@nuke %q0;}
&CMD_JGROUP/INFO [v(JOB_GO)]=$+jgroup/info *:@switch [u(%va/FN_STAFFALL,%#)][setq(0,u(%va/FN_FIND-JGROUP,%0))][isdbref(%q0)]=0*,{@pemit %#=Permission denied.},10*,{@pemit %#=There is no jgroup by that name.},{@pemit %#=[u(%va/FN_HEADER,JGroup Information For [name(%q0)])]%rDescription: [get(%q0/Desc)]%rMembers: [u(%va/FN_ITEMIZE,map(%va/MAP_NAME,u(%va/FN_JGROUPMEMBERS,%q0),%b,|),|)];@pemit %#=[u(%va/FN_FOOTER)]}
&CMD_JGROUP/MEMBER [v(JOB_GO)]=$+jgroup/member *=*:@switch [u(%va/FN_WIZONLY,%#)][setq(0,pmatch(%0))][setq(1,u(%va/FN_FIND-JGROUP,%1))][isdbref(%q0)][isdbref(%q1)][u(%va/HAS_ACCESS,%q0)][strmatch(get(%q1/ISMEMBER),*MEMBERLIST*)][u(%q1/ISMEMBER,%q0)]=0*,{@pemit %#=Permission denied.},10*,{@pemit %#=There is no player by that name.},110*,{@pemit %#=There is no jgroup by that name.},1110*,{@pemit %#=That player does not have +jobs access.},11110*,{@pemit %#=Membership in that jgroup is unaffected by this command.},111110*,{@pemit %#=You have added [name(%q0)] to membership in the [name(%q1)] jgroup.;&memberlist %q1=setunion(get(%q1/memberlist),%q0);},{@pemit %#=You have removed [name(%q0)] from membership in the [name(%q1)] jgroup.;&memberlist %q1=remove(get(%q1/memberlist),%q0);}
&CMD_JOB/ACT [v(JOB_GO)]=$+job/act *:@switch [u(%va/HAS_ACCESS,%#)][setq(0,u(%va/FN_FIND-JOB,%0))][isdbref(%q0)][or(u(%va/FN_STAFFALL,%#),u(%va/FN_ACCESSCHECK,parent(%q0),%#))]=0*,{@pemit %#=Permission denied.},10*,{@pemit %#=There is no job by that name. Please type '+jobs/all' for all jobs or '+jobs/<type>' to list by type.},110*,{@pemit %#=You do not have access to that job.},{@pemit %#=[u(%va/FN_HEADER,View Job Number %0)]%r[ulocal(%va/FN_BANNER,%q0)]%r[u(%va/FN_BREAK)];@dolist sortby(%va/SORTBY_COMMENTS,lattr(%q0/COMMENT_*))={@pemit %#=[rest(convsecs(extract(get(%q0/##),2,1,|)))]%b[first(get(%q0/##),|)]%b[ljust(u(%va/FN_STRTRUNC,extract(get(%q0/##),4,1,|),15),15)]%b[ljust(u(%va/FN_STRTRUNC,u(%va/fn_trim,edit(edit(edit(last(get(%q0/##),|),@@PIPE@@,|),%r,%b),%t,%b),b),35),35)]};@wait 0={@pemit %#=[u(%va/FN_FOOTER)]};}
&CMD_JOB/ADD [v(JOB_GO)]=$+job/add *=*:@switch [u(%va/HAS_ACCESS,%#)][setq(0,u(%va/FN_FIND-JOB,%0))][isdbref(%q0)][u(%va/FN_ACCESSCHECK,parent(%q0),%#)][not(u(%va/IS_LOCKED,%q0,%#))][udefault(%q0/ADD_ACCESS,1,%#)]=0*,{@pemit %#=Permission denied.},10*,{@pemit %#=That is an invalid job number.},110*,{@pemit %#=You do not have access to that job.},1110*,{@pemit %#=That job is presently [ifelse(u(%va/FN_HASATTRP,%q0,CHECKOUT),checked out to [name(first(get(%q0/CHECKOUT)))],locked)]},11110*,{@pemit %#=That action is not available for that job.},{@pemit %#=Comments to job number %0 added.;&TAGGED_FOR %q0=[remove(get(%q0/TAGGED_FOR),%#)];@trigger %va/TRIG_ADD=%q0,%1,%#,ADD;@trigger %va/TRIG_BROADCAST=%q0,%#,ADD}
&CMD_JOB/ALL [v(JOB_GO)]=$+job/all *:@switch [u(%va/HAS_ACCESS,%#)][setq(0,u(%va/FN_FIND-JOB,%0))][isdbref(%q0)][u(%va/FN_ACCESSCHECK,parent(%q0),%#)]=0*,{@pemit %#=Permission denied.},10*,{@pemit %#=There is no job by that name. Please type '[ansi(h,+jobs/all)]' for all jobs or '[ansi(h,+jobs/list <bucket>)]' to list by bucket.},110*,{@pemit %#=You do not have access to that job.},{@pemit %#=[u(%va/FN_READERS,%q0,%#)][u(%va/FN_HEADER,View [name(%q0)])]%r[ulocal(%va/FN_BANNER,%q0,%#)][ifelse(u(%va/FN_HASATTRP,%q0,SUMMARY),[ulocal(%va/FN_SUMMARY,%q0,%#)],)];@dolist [sortby(%va/SORTBY_COMMENTS,lattr(%q0/COMMENT_*))]={@pemit %#=[u(%va/FN_READJOB,##,%q0)]};@wait 0={@pemit %#=[u(%va/FN_FOOTER,u(%va/FN_FLAGS,%q0))]};}
&CMD_JOB/APPROVE [v(JOB_GO)]=$+job/approve *=*:@switch [u(%va/HAS_ACCESS,%#)][u(%va/APPROVE_ACCESS,%#)][setq(0,u(%va/FN_FIND-JOB,%0))][isdbref(%q0)][u(%va/FN_ACCESSCHECK,parent(%q0),%#)][not(u(%va/IS_LOCKED,%q0,%#))][udefault(%q0/APR_ACCESS,1,%#)]=0*,{@pemit %#=Permission denied.},10*,{@pemit %#=Permission denied.},110*,{@pemit %#=There is no job by that number.},1110*,{@pemit %#=You do not have access to that job.},11110*,{@pemit %#=That job is presently [ifelse(u(%va/FN_HASATTRP,%q0,CHECKOUT),checked out to [name(first(get(%q0/CHECKOUT)))],locked)]},111110*,{@pemit %#=That action is not available for that job.},{@pemit %#=[u(%va/FN_ADDSTAT_ART,parent(%q0),%q0)][u(%va/FN_ADDSTAT_ART,%vc,%q0)]You have approved job #%0, adding the comments: %1;@trigger %va/TRIG_BROADCAST=%q0,%#,APR;@trigger %va/TRIG_ADD=%q0,[u(%va/FN_STRTRUNC,%1,get(%va/BUFFER))],%#,APR;@trigger %va/TRIG_DESTROY=%q0}
&CMD_JOB/ASSIGN [v(JOB_GO)]=$+job/assign *=*:@switch [u(%va/HAS_ACCESS,%#)][setq(1,switch(%1,+*,u(%va/FN_FIND-JGROUP,%1),pmatch(%1)))][setq(2,switch(%1,NONE,1,0))][or(isdbref(%q1),%q2)][setq(0,u(%va/FN_FIND-JOB,%0))][isdbref(%q0)][u(%va/FN_ACCESSCHECK,parent(%q0),%#)][not(u(%va/IS_LOCKED,%q0,%#))][udefault(%q0/ASN_ACCESS,1,%#)][switch(1,%q2,1,strmatch(%1,+*),[setq(3,u(%va/FN_JGROUPMEMBERS,%q1))][setq(4,iter(%q3,u(%va/FN_ACCESSCHECK,parent(%q0),itext(0))))][setq(5,member(%q4,0))][not(gt(%q5,0))],u(%va/FN_ACCESSCHECK,parent(%q0),%q1))]=0*,{@pemit %#=Permission denied.},10*,{@pemit %#=There is no player or jgroup by that name.},110*,{@pemit %#=That is not a valid job number.},1110*,{@pemit %#=You do not have access to that job.},11110*,{@pemit %#=That job is presently [ifelse(u(%va/FN_HASATTRP,%q0,CHECKOUT),checked out to [name(first(get(%q0/CHECKOUT)))],locked)]},111110*,{@pemit %#=That action is not available on that job.},1111110*,{@pemit %#=[ifelse(strmatch(%1,+*),[name(%q1)] member [name(extract(%q3,%q5,1))],name(%q1))] does not have access to that bucket.},{@pemit %#=You have assigned Job number %0 to [ifelse(isdbref(%q1),name(%q1),nobody)].;&ASSIGNED_TO %q0=[ifelse(%q2,,%q1)];@trigger %va/TRIG_ADD=%q0,[ifelse(%q2,Assignment removed.,Assigned to [name(%q1)])].,%#,ASN,%q1;@trigger %va/TRIG_BROADCAST=%q0,%#,ASN,[ifelse(%q2,,%q1)]}
&CMD_JOB/CHECKOUT [v(JOB_GO)]=$+job/checkout *:@switch [u(%va/HAS_ACCESS,%#)][setq(0,u(%va/FN_FIND-JOB,secure(%0)))][isdbref(%q0)][u(%va/FN_ACCESSCHECK,parent(%q0),%#)][not(u(%va/IS_LOCKED,%q0,%#))][not(u(%va/FN_HASATTR,%q0,CHECKOUT))][udefault(%q0/CKO_ACCESS,1,%#)]=0*,{@pemit %#=Permission denied.},10*,{@pemit %#=There is no job by that name. Please type '[ansi(h,+jobs/all)]' for all jobs or '[ansi(h,+jobs/list <bucket>)]' to list by bucket.},110*,{@pemit %#=You do not have access to that job.},1110*,{@pemit %#=That job is presently [ifelse(u(%va/FN_HASATTRP,%q0,CHECKOUT),checked out to [name(first(get(%q0/CHECKOUT)))],locked)].},11110*,{@pemit %#=That job is already checked out.},111110*,{@pemit %#=That action is not available on that job.},1111110*,{@pemit %#=That action is not available for that job.},{@pemit %#=[u(%va/FN_READERS,%q0,%#)]You have checked out [name(%q0)]. Nobody but you will be able to modify it until you check it back in.;&CHECKOUT %q0=%# [secs()];@trigger %va/TRIG_ADD=%q0,Checked out by [name(%#)].,%#,CKO;@trigger %va/TRIG_BROADCAST=%q0,%#,CKO}
&CMD_JOB/CHECKIN [v(JOB_GO)]=$+job/checkin *:@switch [u(%va/HAS_ACCESS,%#)][setq(0,u(%va/FN_FIND-JOB,secure(%0)))][isdbref(%q0)][u(%va/FN_ACCESSCHECK,parent(%q0),%#)][u(%va/FN_HASATTR,%q0,CHECKOUT)][or(u(%va/FN_WIZONLY,%#),switch(first(get(%q0/CHECKOUT)),%#,1,0))][udefault(%q0/CKI_ACCESS,1,%#)]=0*,{@pemit %#=Permission denied.},10*,{@pemit %#=There is no job by that name. Please type '[ansi(h,+jobs/all)]' for all jobs or '[ansi(h,+jobs/list <bucket>)]' to list by bucket.},110*,{@pemit %#=You do not have access to that job.},1110*,{@pemit %#=That job is not checked out.},11110*,{@pemit %#=You cannot check that job back in.},111110*,{@pemit %#=That action is not available for that job.},{@pemit %#=[u(%va/FN_READERS,%q0,%#)]You have checked [name(%q0)] back in.;&CHECKOUT %q0=;@trigger %va/TRIG_ADD=%q0,Checked in by [name(%#)].,%#,CKI;@trigger %va/TRIG_BROADCAST=%q0,%#,CKI}
&CMD_JOB/CLAIM [v(JOB_GO)]=$+job/claim *:@fo %#=+job/assign %0=%#
&CMD_JOB/CLONE [v(JOB_GO)]=$+job/clone *:@switch [u(%va/HAS_ACCESS,%#)][setq(0,u(%va/FN_FIND-JOB,%0))][isdbref(%q0)][u(%va/FN_ACCESSCHECK,parent(%q0),%#)][udefault(%q0/CLN_ACCESS,1,%#)]=0*,{@pemit %#=Permission denied.},10*,{@pemit %#=There is no job by that number.},110*,{@pemit %#=You do not have access to that job.},11110*,{@pemit %#=That action is not available for that job.},{@pemit [setq(1,inc(get(%va/JOBS_NUM)))]%#=Job copied as Job %q1.;&JOBS_NUM %va=%q1;@clone %q0=Job %q1;@pemit me=[setq(2,num(Job %q1))];@tel %q2=%va;@trigger %va/TRIG_ADD=%q2,Cloned job.,%#,CLN,%q0;@trigger %va/TRIG_BROADCAST=%q0,%#,CLN,%q1}
&CMD_JOB/COMPLETE [v(JOB_GO)]=$+job/complete *=*:@switch [u(%va/HAS_ACCESS,%#)][u(%va/COMPLETE_ACCESS,%#)][setq(0,u(%va/FN_FIND-JOB,%0))][isdbref(%q0)][u(%va/FN_ACCESSCHECK,parent(%q0),%#)][not(u(%va/IS_LOCKED,%q0,%#))][udefault(%q0/COM_ACCESS,1,%#)]=0*,{@pemit %#=Permission denied.},10*,{@pemit %#=Permission denied.},110*,{@pemit %#=That is not a valid job #. See '+jobs/all' for valid jobs.},1110*,{@pemit %#=Permission denied.},11110*,{@pemit %#=That job is presently [ifelse(u(%va/FN_HASATTRP,%q0,CHECKOUT),checked out to [name(first(get(%q0/CHECKOUT)))],locked)]},111110*,{@pemit %#=That action is not available for that job.},{@pemit %#=[u(%va/FN_ADDSTAT_ART,parent(%q0),%q0)][u(%va/FN_ADDSTAT_ART,%vc,%q0)]You have completed job # %0.;@trigger %va/TRIG_ADD=%q0,[u(%va/FN_STRTRUNC,%1,get(%va/BUFFER))],%#,COM;@trigger %va/TRIG_BROADCAST=%q0,%#,COM,%q1;@trigger %va/TRIG_DESTROY=%q0}
&CMD_JOB/CREATE [v(JOB_GO)]=$+job/create */*=*:@switch [u(%va/HAS_ACCESS,%#)][u(%va/CREATE_ACCESS,%#)][setq(0,u(%va/FN_FIND-BUCKET,%0))][isdbref(%q0)][u(%va/FN_ACCESSCHECK,%q0,%#)][udefault(%q0/CRE_ACCESS,1,%#)]=0*,{@pemit %#=Permission denied.},10*,{@pemit %#=Permission denied.},110*,{@pemit %#=There is no bucket by that name. Type '[ansi(h,+buckets)]' to get a list of buckets.},1110*,{@pemit %#=You cannot access that bucket.},11110*,{@pemit %#=That action is not available for that bucket.},{@pemit [setq(1,inc(get(%va/JOBS_NUM)))]%#=You have created job number %q1 entitled '[u(%va/FN_STRTRUNC,%1,30)]'.;@trigger %va/TRIG_CREATE=%#,%q0,1,[u(%va/FN_STRTRUNC,%1,30)],[u(%va/FN_STRTRUNC,%2,u(%va/BUFFER))],,,1}
&CMD_JOB/DELETE [v(JOB_GO)]=$+job/delete *:@switch [u(%va/HAS_ACCESS,%#)][or(u(%va/DELETE_ACCESS,%#),u(%va/FN_WIZONLY,%#),switch(%#,%va,1,0))][setq(0,u(%va/FN_FIND-JOB,%0))][isdbref(%q0)][u(%va/FN_ACCESSCHECK,parent(%q0),%#)][not(u(%va/IS_LOCKED,%q0,%#))][udefault(%q0/DEL_ACCESS,1,%#)]=0*,{@pemit %#=Permission denied.},10*,{@pemit %#=Permission denied.},110*,{@pemit %#=That is not a valid job number.},1110*,{@pemit %#=You do not have access to that job.},11110*,{@pemit %#=That job is presently [ifelse(u(%va/FN_HASATTRP,%q0,CHECKOUT),checked out to [name(first(get(%q0/CHECKOUT)))],locked)]},111110*,{@pemit %#=That action is not available for that job.},{@pemit %#=[u(%va/FN_ADDSTAT_ART,parent(%q0),%q0)][u(%va/FN_ADDSTAT_ART,%vc,%q0)]You have deleted job # %0.;@trigger %va/TRIG_ADD=%q0,Job %0 Deleted,%#,DEL;@trigger %va/TRIG_DESTROY=%q0}
&CMD_JOB/DENY [v(JOB_GO)]=$+job/deny *=*:@switch [u(%va/HAS_ACCESS,%#)][or(u(%va/DENY_ACCESS,%#),u(%va/FN_STAFFALL,%#))][setq(0,u(%va/FN_FIND-JOB,%0))][isdbref(%q0)][u(%va/FN_ACCESSCHECK,parent(%q0),%#)][not(u(%va/IS_LOCKED,%q0,%#))][udefault(%q0/DNY_ACCESS,1,%#)]=0*,{@pemit %#=Permission denied.},10*,{@pemit %#=Permission denied.},110*,{@pemit %#=There is no job by that number.},1110*,{@pemit %#=You cannot access that job.},11110*,{@pemit %#=That job is presently [ifelse(u(%va/FN_HASATTRP,%q0,CHECKOUT),checked out to [name(first(get(%q0/CHECKOUT)))],locked)]},111110*,{@pemit %#=That action is not available for that job.},{@pemit %#=[u(%va/FN_ADDSTAT_ART,parent(%q0),%q0)][u(%va/FN_ADDSTAT_ART,%vc,%q0)]You have denied job #%0.;@trigger %va/TRIG_BROADCAST=%q0,%#,DNY;@trigger %va/TRIG_ADD=%q0,[u(%va/FN_STRTRUNC,%1,get(%va/BUFFER))],%#,DNY;@trigger %vb/TRIG_DENY=%0,%#,%1,[get(%q0/TITLE)];@trigger %va/TRIG_DESTROY=%q0}
&CMD_JOB/DUE [v(JOB_GO)]=$+job/due *=*:@switch [not(eq(words(%1,/),3))][u(%va/HAS_ACCESS,%#)][setq(0,u(%va/FN_FIND-JOB,%0))][isdbref(%q0)][u(%va/FN_ACCESSCHECK,parent(%q0),%#)][udefault(%q0/DUE_ACCESS,1,%#)][switch(lcstr(%1),none,2,switch(ifelse(eq(words(%1),4),convtime(XXX %1),convtime(%1)),-1,0,1))]=0*,{@@},10*,{@pemit %#=Permission denied.},110*,{@pemit %#=That is not a valid job number.},1110*,{@pemit %#=You do not have access to that job.},11110*,{@pemit %#=That action is not available for that job.},111110*,{@pemit %#=Invalid date. Use date formatting as '[rest(time())]'.},111112*,{@pemit %#=You have cleared Job Number %0's date.;&DUE_ON %q0=;@trigger %va/TRIG_ADD=%q0,Due date cleared.,%#,DUE;@trigger %va/TRIG_BROADCAST=%q0,%#,DUE,%q1},{@pemit %#=You have set Job Number %0's date to %1.;&DUE_ON %q0=[ifelse(eq(words(%1),4),convtime(XXX %1),convtime(%1))];@trigger %va/TRIG_ADD=%q0,Due on [secure(%1)].,%#,DUE,[secure(%1)];@trigger %va/TRIG_BROADCAST=%q0,%#,DUE}
&CMD_JOB/DUE2 [v(JOB_GO)]=$+job/due *=*/*/*:@switch [u(%va/HAS_ACCESS,%#)][isdbref(setr(0,u(%va/FN_FIND-JOB,%0)))][setq(1,convtime(XXX [switch([rjust(%1,2,0)],01,Jan,02,Feb,03,Mar,04,Apr,05,May,06,Jun,07,Jul,08,Aug,09,Sep,10,Oct,11,Nov,12,Dec)] [rjust(%2,2,0)] 23:59:00 [switch(strlen(%3),2,20[rjust(%3,2,0)],%3)]))][gt(%q1,0)][u(%va/FN_ACCESSCHECK,parent(%q0),%#)][udefault(%q0/DUE_ACCESS,1,%#)]=0*,{@pemit %#=Permission denied.},10*,{@pemit %#=That is not a valid job number.},110*,{@pemit %#=Invalid date. Use date formatting as 'MM/DD/YY', '[rest(time())]', 'none' to clear.},1110*,{@pemit %#=You do not have access to that job.},11110*,{@pemit %#=That action is not available for that job.},{@pemit %#=You have set Job Number %0's date to [convsecs(%q1)].;&DUE_ON %q0=%q1;@trigger %va/TRIG_ADD=%q0,Due on [convsecs(%q1)].,%#,DUE;@trigger %va/TRIG_BROADCAST=%q0,%#,DUE,%q1}
&CMD_JOB/EDIT [v(JOB_GO)]=$+job/edit */*=*/*:@switch [u(%va/HAS_ACCESS,%#)][u(%va/EDIT_ACCESS,%#)][setq(0,u(%va/FN_FIND-JOB,%0))][isdbref(%q0)][u(%va/FN_ACCESSCHECK,parent(%q0),%#)][setq(1,get(%q0/COMMENT_%1))][switch(first(%q1,|),ADD,1,CRE,1,0)][not(u(%va/IS_LOCKED,%q0,%#))][switch(extract(%q1,3,1,|),%#,1,u(%va/FN_WIZONLY,%#))][udefault(%q0/EDT_ACCESS,1,%#)]=0*,{@pemit %#=Permission denied.},10*,{@pemit %#=Permission denied.},110*,{@pemit %#=That is an invalid job number.},1110*,{@pemit %#=You do not have access to that job.},11110*,{@pemit %#=You cannot modify that entry.},111110*,{@pemit %#=That job is presently [ifelse(u(%va/FN_HASATTRP,%q0,CHECKOUT),checked out to [name(first(get(%q0/CHECKOUT)))],locked)]},1111110*,{@pemit %#=You can only edit entries that belong to you.},11111110*,{@pemit %#=That action is not available for that job.},{&COMMENT_%1 %q0=[extract(%q1,1,4,|)]|[edit(last(%q1,|),edit(%2,|,@@PIPE@@),edit(%3,|,@@PIPE@@))];@pemit %#=Edited: [last(u(%q0/COMMENT_%1),|)];@trigger %va/TRIG_ADD=%q0,Comment %1 edited by %n.,%#,EDT,[objeval(%#,secure(%1))];@trigger %va/TRIG_BROADCAST=%q0,%#,EDT,[objeval(%#,secure(%1))]}
&CMD_JOB/ERROR [v(JOB_GO)]=$+job:@switch [u(%va/HAS_ACCESS,%#)]=0*,{@pemit %#=Use +myjobs to access your jobs.},{@pemit %#=Type '+jobs' for a list of jobs, or '+job <#>' to view a specific job.}
&CMD_JOB/ESC [v(JOB_GO)]=$+job/esc *=*:@switch [u(%va/HAS_ACCESS,%#)][setq(0,u(%va/FN_FIND-JOB,%0))][isdbref(%q0)][u(%va/FN_ACCESSCHECK,parent(%q0),%#)][setq(1,match(green yellow red,%1*))][setq(2,extract(GREEN YELLOW RED,%q1,1))][gt(%q1,0)][not(u(%va/IS_LOCKED,%q0,%#))][udefault(%q0/ESC_ACCESS,1,%#)]=0*,{@pemit %#=Permission denied.},10*,{@pemit %#=That is not a valid job number.},110*,{@pemit %#=You do not have access to that job.},1110*,{@pemit %#=That is not a valid escalation code. Valid codes are red, yellow, and green.},11110*,{@pemit %#=That job is presently [ifelse(u(%va/FN_HASATTRP,%q0,CHECKOUT),checked out to [name(first(get(%q0/CHECKOUT)))],locked)]},111110*,{@pemit %#=That action is not available for that job.},{@pemit %#=You have escalated job # %0 to %q2 status.;&PRIORITY %q0=%q1;@trigger %va/TRIG_ADD=%q0,Priority To %q2.,%#,ESC,ucstr(secure(%1));@trigger %va/TRIG_BROADCAST=%q0,%#,ESC,%q2}
&CMD_JOB/HELP [v(JOB_GO)]=$+job/help *:@switch [u(%va/HAS_ACCESS,%#)][setq(0,parent(u(%va/FN_FIND-JOB,%0)))][isdbref(%q0)][u(%va/FN_ACCESSCHECK,%q0,%#)]=0*,{@pemit %#=Permission denied.},10*,{@pemit %#=That is not a valid job. Type '[ansi(h,+jobs)]' for a list of valid jobs.},110*,{@pemit %#=You do not have access to that job.},{@pemit %#=[u(%va/FN_HEADER,Job Help For Bucket [name(%q0)])];@pemit %#=[u(%q0/HELP)][ifelse(u(%va/FN_HASATTRP,%q0,MYHELP),%r[u(%va/FN_BREAK,[ansi(c,Myjob Help)])]%r[u(%q0/MYHELP)],)];@pemit %#=[u(%va/FN_FOOTER)]}
&CMD_JOB/LAST [v(JOB_GO)]=$+job/last *=*:@switch [u(%va/HAS_ACCESS,%#)][setq(0,u(%va/FN_FIND-JOB,%0))][isdbref(%q0)][u(%va/FN_ACCESSCHECK,parent(%q0),%#)]=0*,{@pemit %#=Permission denied.},10*,{@pemit %#=There is no job by that name. Please type '+jobs/all' for all jobs or '+jobs/<type>' to list by type.},110*,{@pemit %#=You do not have access to that job.},{@pemit %#=[u(%va/FN_HEADER,View [name(%q0)])]%r[ulocal(%va/FN_BANNER,%q0)];@dolist [extract(setr(1,filter(%va/FIL_COMMENTS,sortby(%va/SORTBY_COMMENTS,lattr(%q0/COMMENT_*)))),ifelse(lt(sub(words(%q1),%1),1),1,inc(sub(words(%q1),%1))),inc(%1))]={@pemit %#=[u(%va/FN_READJOB,##,%q0)]};@wait 0={@pemit %#=[u(%va/FN_FOOTER,u(%va/FN_FLAGS,%q0))]};}
&CMD_JOB/LOCK [v(JOB_GO)]=$+job/lock *:@switch [u(%va/HAS_ACCESS,%#)][setq(0,u(%va/FN_FIND-JOB,%0))][isdbref(%q0)][u(%va/FN_ACCESSCHECK,parent(%q0),%#)][not(u(%va/FN_HASATTR,%q0,LOCKED))][udefault(%q0/LOK_ACCESS,1,%#)]=0*,{@pemit %#=Permission denied.},10*,{@pemit %#=That is an invalid job number.},110*,{@pemit %#=You do not have access to that job.},1110*,{@pemit %#=That job is already locked.},11110*,{@pemit %#=That action is not available for that job.},{@pemit %#=You have locked job %0. No further modifications can be made to this job until it is unlocked.;&LOCKED_BY %q0=%#;&LOCKED %q0=1;@trigger %va/TRIG_ADD=%q0,Locked by %n.,%#,LOK;@trigger %va/TRIG_BROADCAST=%q0,%#,LOK}
&CMD_JOB/LOG [v(JOB_GO)]=$+job/log *:@switch [u(%va/HAS_ACCESS,%#)][u(%va/LOG_ACCESS,%#)][setq(0,u(%va/FN_FIND-JOB,%0))][isdbref(%q0)][u(%va/FN_ACCESSCHECK,parent(%q0),%#)][u(%va/FN_HASATTRP,%q0,LOGFILE)]=0*,{@pemit %#=Permission denied.},10*,{@pemit %#=Permission denied.},110*,{@pemit %#=There is no job by that name. Please type '+jobs/all' for all jobs or '+jobs/<type>' to list by type.},1110*,{@pemit %#=You do not have access to that job.},11110*,{@pemit %#=There is no logfile for that bucket.},{@pemit %#=Logging Job %0 to game/[switch(first(version()),PennMUSH,log/command.log,TinyMUSH,netmush.log,RhostMUSH,[get(%q0/LOGFILE)]_manual.log,logs/M-[get(%q0/LOGFILE)].log%rNote that if the log file does not exist, then it did not get logged.)];@trigger %va/TRIG_LOG=%q0,%#}
&CMD_JOB/MAIL [v(JOB_GO)]=$+job/mail *=*:@switch [u(%va/HAS_ACCESS,%#)][u(%va/MAIL_ACCESS,%#)][setq(0,u(%va/FN_FIND-JOB,%0))][isdbref(%q0)][u(%va/FN_ACCESSCHECK,parent(%q0),%#)][u(%va/IS_PUBLIC,%q0)][not(u(%va/IS_LOCKED,%q0,%#))][udefault(%q0/MAI_ACCESS,1,%#)]=0*,{@pemit %#=Permission denied.},10*,{@pemit %#=Permission denied.},110*,{@pemit %#=There is no job by that number.},1110*,{@pemit %#=You do not have access to that job.},11110*,{@pemit %#=+job/mail cannot be used on the job because the bucket in which it is stored is not set PUBLIC %(+myjobs-accessible%).},111110*,{@pemit %#=That job is presently [ifelse(u(%va/FN_HASATTRP,%q0,CHECKOUT),checked out to [name(first(get(%q0/CHECKOUT)))],locked)]},1111110*,{@pemit %#=That action is not available for that job.},{@pemit %#=You have mailed [u(%va/FN_PLAYERLIST,%q0)] about job #%0, with the comments: %1;@trigger %va/TRIG_ADD=%q0,[u(%va/FN_STRTRUNC,ansi(h,Mail sent to [u(%va/FN_PLAYERLIST,%q0)]:)%r%r%1,get(%va/BUFFER))],%#,MAI;@trigger %va/TRIG_BROADCAST=%q0,%#,MAI,%q1}
&CMD_JOB/MERGE [v(JOB_GO)]=$+job/merge *=*:@switch [u(%va/HAS_ACCESS,%#)][setq(0,u(%va/FN_FIND-JOB,%1))][setq(1,u(%va/FN_FIND-JOB,%0))][isdbref(%q1)][isdbref(%q0)][u(%va/FN_ACCESSCHECK,parent(%q0),%#)][u(%va/FN_ACCESSCHECK,parent(%q1),%#)][setq(2,u(%q0/NUM_COMMENT))][setq(3,u(%q1/NUM_COMMENT))][and(not(u(%va/IS_LOCKED,%q0,%#)),not(u(%va/IS_LOCKED,%q1,%#)))][not(eq(%0,%1))][udefault(%q0/MRG_ACCESS,1,%#)][udefault(%q1/MRG_ACCESS,1,%#)]=0*,{@pemit %#=Permission denied.},10*,{@pemit %#=There is no job number %0.},110*,{@pemit %#=There is no job number %1.},1110*,{@pemit %#=You do not have access to [name(%q0)].},11110*,{@pemit %#=You do not have access to [name(%q1)].},111110*,{@pemit %#=One of those jobs is locked or checked out.},1111110*,{@pemit %#=Sort of like a Klein bottle, eh?},11111110*,{@pemit %#=That action is not available for [name(%q0)].},111111110*,{@pemit %#=That action is not available for [name(%q1)].},{@trigger %va/TRIG_ADD=%q0,Job [secure(%0)] merged into this one.,%#,MRG;@trigger %va/TRIG_BROADCAST=%q0,%#,MRG,%q1;@wait 0={@dolist [sortby(%va/SORTBY_COMMENTS,lattr(%q1/COMMENT_*))]={@cpattr %q1/##=%q0/COMMENT_[get(%q0/NUM_COMMENT)];&NUM_COMMENT %q0=[inc(get(%q0/NUM_COMMENT))]};@trigger %va/TRIG_DESTROY=%q1}};
&CMD_JOB/NAME [v(JOB_GO)]=$+job/name *=*:@switch [u(%va/HAS_ACCESS,%#)][setq(0,u(%va/FN_FIND-JOB,%0))][isdbref(%q0)][u(%va/FN_ACCESSCHECK,parent(%q0),%#)][not(u(%va/IS_LOCKED,%q0,%#))][udefault(%q0/NAM_ACCESS,1,%#)]=0*,{@pemit %#=Permission denied.},10*,{@pemit %#=There is no job by that name.},110*,{@pemit %#=You do not have access to that job.},1110*,{@pemit %#=That job is presently [ifelse(u(%va/FN_HASATTRP,%q0,CHECKOUT),checked out to [name(first(get(%q0/CHECKOUT)))],locked)]},11110*,{@pemit %#=That action is not available for that job.},{@pemit %#=You have changed the name of Job %0 to %1.;&TITLE %q0=[secure(%1)];@trigger %va/TRIG_ADD=%q0,Renamed to '[secure(%1)]'.,%#,NAM;@trigger %va/TRIG_BROADCAST=%q0,%#,NAM,[secure(%1)]}
&CMD_JOB/NEW [v(JOB_GO)]=$+job/new *:@switch [u(%va/HAS_ACCESS,%#)][setq(0,u(%va/FN_FIND-JOB,%0))][setq(1,default(%#/LAST_CONN,0))][isdbref(%q0)][u(%va/FN_ACCESSCHECK,parent(%q0),%#)]=0*,{@pemit %#=Permission denied.},10*,{@pemit %#=There is no job by that name. Please type '+jobs/all' for all jobs or '+jobs/<type>' to list jobs by type.},110*,{@pemit %#=You do not have access to that job.},{@pemit %#=[u(%va/FN_HEADER,View Job Number %0)]%r[ulocal(%va/FN_BANNER,%q0)][ifelse(u(%va/FN_HASATTRP,%q0,SUMMARY),[ulocal(%va/FN_SUMMARY,%q0)],)];@dolist [filter(%va/FIL_NEWCOMMENTS[default(%#/JOBSN,0)],sortby(%va/SORTBY_COMMENTS,lattr(%q0/COMMENT_*)))]={@pemit %#=[u(%va/FN_READJOB,##,%q0)]};@wait 0={@pemit %#=[ifelse(u(%va/IS_LOCKED,%q0,%#),u(%va/FN_FOOTER,u(%va/FN_FLAGS,%q0)),[u(%va/FN_FOOTER,New Activity on Job %0 since [convsecs(%q1)])])][u(%va/FN_READERS,%q0,%#)]};}
&CMD_JOB/PUBLISH [v(JOB_GO)]=$+job/publish *:@switch [eq(words(%0,=),1)][u(%va/HAS_ACCESS,%#)][u(%va/EDIT_ACCESS,%#)][setq(0,u(%va/FN_FIND-JOB,%0))][isdbref(%q0)][u(%va/FN_ACCESSCHECK,parent(%q0),%#)][u(%va/FN_HASATTRP,%q0,PUBLIC)][not(u(%va/IS_LOCKED,%q0,%#))][udefault(%q0/PUB_ACCESS,1,%#)][eq(u(%q0/PUBLISH),1)]=0*,@@,10*,{@pemit %#=Permission denied.},110*,{@pemit %#=Permission denied.},1110*,{@pemit %#=There is no job by that number.},11110*,{@pemit %#=You do not have access to that job.},111110*,{@pemit %#=That job is not in a bucket that is accessible to +myjobs, so publication is moot.},1111110*,{@pemit %#=That job is presently [ifelse(u(%va/FN_HASATTRP,%q0,CHECKOUT),checked out to [name(first(get(%q0/CHECKOUT)))],locked)]},11111110*,{@pemit %#=That action is not available for that job.},111111110*,{@pemit %#=You have published Job %0.;&PUBLISH %q0=1;@trigger %va/TRIG_ADD=%q0,Published by %n.,%#,PUB;@trigger %va/TRIG_BROADCAST=%q0,%#,PUB},{@pemit %#=Job %0 will now no longer be published.;&PUBLISH %q0=0;@trigger %va/TRIG_ADD=%q0,Unpublished by %n.,%#,UNP;@trigger %va/TRIG_BROADCAST=%q0,%#,UNP}
&CMD_JOB/PUBLISH2 [v(JOB_GO)]=$+job/publish *=*:@switch [u(%va/HAS_ACCESS,%#)][u(%va/EDIT_ACCESS,%#)][setq(0,u(%va/FN_FIND-JOB,%0))][isdbref(%q0)][u(%va/FN_ACCESSCHECK,parent(%q0),%#)][not(u(%va/IS_LOCKED,%q0,%#))][u(%va/IS_PUBLIC,%q0)][u(%va/FN_HASATTRP,%q0,COMMENT_%1)][udefault(%q0/PUB_ACCESS,1,%#)][neq(u(%q0/PUBLISH),1)][hasflag(%q0/COMMENT_%1,no_inherit)]=0*,{@pemit %#=Permission denied.},10*,{@pemit %#=Permission denied.},110*,{@pemit %#=There is no job by that number.},1110*,{@pemit %#=You do not have access to that job.},11110*,{@pemit %#=That job is presently [ifelse(u(%va/FN_HASATTRP,%q0,CHECKOUT),checked out to [name(first(get(%q0/CHECKOUT)))],locked)]},111110*,{@pemit %#=That job is not in a bucket that is accessible to +myjobs, so publication is moot.},1111110*,{@pemit %#=That is not a valid comment number.},11111110*,{@pemit %#=That action is not available for that job.},111111110*,{@pemit %#=That job is published. Comment publication has no effect.},1111111110*,{@pemit %#=You have published Comment %1 on Job %0.;@set %q0/COMMENT_%1=no_inherit;@trigger %va/TRIG_ADD=%q0,Comment [secure(%1)] published by %n.,%#,PUB;@trigger %va/TRIG_BROADCAST=%q0,%#,PUB,%1},{@pemit %#=Job %0/Comment %1 will no longer be published.;@set %q0/COMMENT_%1=!no_inherit;@trigger %va/TRIG_ADD=%q0,Comment [secure(%1)] Unpublished by %n.,%#,UNP;@trigger %va/TRIG_BROADCAST=%q0,%#,UNP,%1}
&CMD_JOB/QUERY [v(JOB_GO)]=$+job/query */*=*:@switch [and(u(%va/HAS_ACCESS,%#),u(%va/MAIL_ACCESS,%#))]=0*,{@pemit %#=Permission denied.},{@switch [setq(1,map(%va/MAP_SOURCE,secure(%0)))][setq(2,member(%q1,#-1))][not(gt(%q2,0))]=0,{@pemit %#='[extract(secure(%0),%q2,1)]' is not a valid player or jgroup.},{@pemit %#=You have sent a query to '%0' regarding '%1'.;@trigger %va/TRIG_CREATE=%#,locate(%vc,QUERY,i),2,[u(%va/FN_STRTRUNC,secure(%1),30)],Queried [u(%va/FN_ITEMIZE,map(%va/MAP_NAME,%q1,%b,|),|)]:%r%r[u(%va/FN_STRTRUNC,%2,get(%va/BUFFER))],%q1,,0}}
&CMD_JOB/SET [v(JOB_GO)]=$+job/set *=*:@switch [u(%va/HAS_ACCESS,%#)][setq(0,u(%va/FN_FIND-JOB,%0))][setq(2,dec(member(setr(a,HOLD NEW UNDERWAY 25 50 75 100),ucstr(%1))))][isdbref(%q0)][u(%va/FN_ACCESSCHECK,parent(%q0),%#)][and(isnum(%q2),gt(%q2,-1),lt(%q2,7))][not(u(%va/IS_LOCKED,%q0,%#))][udefault(%q0/STA_ACCESS,1,%#)]=0*,{@pemit %#=Permission denied.},10*,{@pemit %#=That is not a valid job.},110*,{@pemit %#=You do not have access to that job.},1110*,{@pemit %#=That is an invalid setting. Valid job settings are:%r[u(%va/FN_ITEMIZE,lcstr(%qa))].},11110*,{@pemit %#=That job is presently [ifelse(u(%va/FN_HASATTRP,%q0,CHECKOUT),checked out to [name(first(get(%q0/CHECKOUT)))],locked)]},111110*,{@pemit %#=That action is not available for that job.},{@pemit %#=You set Job Number [secure(%0)] to [setq(1,switch(%q2,0,ON HOLD,1,NEW,2,UNDERWAY,3,1/4 COMPLETE,4,1/2 COMPLETE,5,3/4 COMPLETE,COMPLETE))]%q1 status.;&STATUS %q0=%q2;@trigger %va/TRIG_ADD=%q0,Set to %q1.,%#,STA;@trigger %va/TRIG_BROADCAST=%q0,%#,STA,%q1}
&CMD_JOB/SOURCE [v(JOB_GO)]=$+job/source *=*:@switch [u(%va/HAS_ACCESS,%#)][setq(0,u(%va/FN_FIND-JOB,%0))][isdbref(%q0)][u(%va/FN_ACCESSCHECK,parent(%q0),%#)][not(u(%va/IS_LOCKED,%q0,%#))][setq(1,map(%va/MAP_SOURCE,secure(%1)))][setq(2,member(%q1,#-1))][not(gt(%q2,0))][udefault(%q0/SRC_ACCESS,1,%#)]=0*,{@pemit %#=Permission denied.},10*,{@pemit %#=There is no job by that number.},110*,{@pemit %#=You do not have access to that job.},1110*,{@pemit %#=That job is presently [ifelse(u(%va/FN_HASATTRP,%q0,CHECKOUT),checked out to [name(first(get(%q0/CHECKOUT)))],locked)]},11110*,{@pemit %#='[extract(secure(%1),%q2,1)]' is not a valid player or jgroup.},111110*,{@pemit %#=That action is not available for that job.},{&opened_by %q0=%q1;@pemit %#=You have set job #%0 to have a source of [u(%va/FN_PLAYERLIST,%q0)].;@trigger %va/TRIG_ADD=%q0,Source changed to [u(%va/FN_PLAYERLIST,%q0)].,%#,SRC;@trigger %va/TRIG_BROADCAST=%q0,%#,SRC,%q1}
&CMD_JOB/SUMMARY [v(JOB_GO)]=$+job/summary *:@switch [u(%va/HAS_ACCESS,%#)][setq(0,u(%va/FN_FIND-JOB,%0))][isdbref(%q0)][u(%va/FN_ACCESSCHECK,parent(%q0),%#)]=0*,{@pemit %#=Permission denied.},10*,{@pemit %#=There is no job by that name. Please type '[ansi(h,+jobs/all)]' for all jobs or '[ansi(h,+jobs/list <bucket>)]' to list by bucket.},110*,{@pemit %#=You do not have access to that job.},{@pemit %#=[u(%va/FN_HEADER,View [name(%q0)])]%r[ulocal(%va/FN_BANNER,%q0)][ifelse(u(%va/FN_HASATTRP,%q0,SUMMARY),[ulocal(%va/FN_SUMMARY,%q0)],)][ifelse(u(%va/FN_WIZONLY,%#),[ulocal(%va/FN_STAFFSUM,%q0)],)];@wait 0={@pemit %#=[u(%va/FN_FOOTER,u(%va/FN_FLAGS,%q0))]};}
&CMD_JOB/SUMSET [v(JOB_GO)]=$+job/sumset */*=*:@switch [u(%va/HAS_ACCESS,%#)][setq(0,u(%va/FN_FIND-JOB,%0))][isdbref(%q0)][u(%va/FN_HASATTRP,%q0,ACCESS_%1)][and(u(%va/CONFIG_ACCESS,%#),u(%q0/ACCESS_%1,%#))][not(u(%va/IS_LOCKED,%q0,%#))][u(%q0/PROCESS_%1,%2,%q0,%#)][udefault(%q0/SUM_ACCESS,1,%#)]=0*,{@pemit %#=Permission denied.},10*,{@pemit %#=There is no such job. See '[ansi(h,+jobs)]' for a list of valid jobs.},110*,{@pemit %#='%1' is not a valid parameter. Valid parameters for [name(%q0)] are [u(%va/FN_ITEMIZE,map(%va/MAP_PARAMS,lattr(parent(%q0)/PROCESS_*)))].},1110*,{@pemit %#=You either can not use the +job/sumset command, or set that parameter.},11110*,{@pemit %#=That job is presently [ifelse(u(%va/FN_HASATTRP,%q0,CHECKOUT),checked out to [name(first(get(%q0/CHECKOUT)))],locked)]},111110*,{@pemit %#=[u(%q0/ERROR_%1%q2)]},1111110*,{@pemit %#=That action is not available for that job.},{@trigger %va/TRIG_BROADCAST=%q0,%#,SUM,[ucstr(%1)];&%q3 %q0=%q1;@trigger %va/TRIG_ADD=%q0,[ucstr(%1)] parameter updated to '%2',%#,SUM}
&CMD_JOB/TAG [v(JOB_GO)]=$+job/tag *:@switch [u(%va/HAS_ACCESS,%#)][switch(strmatch(%0,*=*),1,[setq(8,secure(first(%0,=)))][setq(9,secure(rest(%0,=)))],[setq(8,secure(%0))][setq(9,%#)])][setq(7,map(%va/MAP_JGROUP,%q9))][setq(6,u(%va/fn_trim,squish(map(%va/MAP_JGROUPERROR,%q9))))][setq(0,u(%va/FN_FIND-JOB,%q8))][isdbref(%q0)][u(%va/FN_ACCESSCHECK,parent(%q0),%#)][not(u(%va/IS_LOCKED,%q0,%#))][udefault(%q0/TAG_ACCESS,1,%#)]=0*,{@pemit %#=Permission denied.},10*,{@pemit %#=That is an invalid job number.},110*,{@pemit %#=You do not have access to that job.},1110*,{@pemit %#=That job is presently [ifelse(u(%va/FN_HASATTRP,%q0,CHECKOUT),checked out to [name(first(get(%q0/CHECKOUT)))],locked)]},11110*,{@pemit %#=That action is not available for that job.},{@switch [t(strlen(%q6))]=1,{@pemit %#=%q6},{@switch [strlen(setdiff(%q7,get(%q0/tagged_for)))]=0,{@pemit %#={[name(%q0)] is already tagged for the named player(s): [u(%va/FN_ITEMIZE,map(%va/MAP_NAME,%q7,%b,|),|)]}},{&tagged_for %q0=[setunion(get(%q0/tagged_for),%q7)];@trigger %va/TRIG_ADD=%q0,Added tags for [setr(5,u(%va/FN_ITEMIZE,map(%va/MAP_NAME,%q7,%b,|),|))],%#,TAG,%q7;@trigger %va/TRIG_BROADCAST=%q0,%#,TAG,%q5;@pemit %#={Job %q8 updated - tags added. Now tagged for: [u(%va/FN_ITEMIZE,map(%va/MAP_NAME,get(%q0/tagged_for),%b,|),|)]}}}}
&CMD_JOB/TRANS [v(JOB_GO)]=$+job/trans *=*:@switch [u(%va/HAS_ACCESS,%#)][setq(0,u(%va/FN_FIND-JOB,%0))][isdbref(%q0)][u(%va/FN_ACCESSCHECK,parent(%q0),%#)][isdbref(setr(1,u(%va/FN_FIND-BUCKET,%1)))][udefault(%q0/TRN_ACCESS,1,%#)][udefault(%q1/TRN_ACCESS,1,%#)][not(u(%va/IS_LOCKED,%q0,%#))]=0*,{@pemit %#=Permission denied.},10*,{@pemit %#=There is no job by that number.},110*,{@pemit %#=You do not have access to that job.},1110*,{@pemit %#=There is no bucket by that name. Type '[ansi(h,+buckets)]' for a list of valid buckets.},11110*,{@pemit %#=You cannot move that job from there.},111110*,{@pemit %#=You cannot move that job to there.},1111110*,{@pemit %#=That job is presently [ifelse(u(%va/FN_HASATTRP,%q0,CHECKOUT),checked out to [name(first(get(%q0/CHECKOUT)))],locked)]},{@pemit %#=You have transferred the job from [u(%va/FN_BUCKETNAME,%q0)] to [name(%q1)].;@set %q0=!going;&going %q0;@parent %q0=%q1;@trigger %va/TRIG_ADD=%q0,Transferred to [name(%q1)].,%#,TRN;@trigger %va/TRIG_BROADCAST=%q0,%#,TRN,%q1}
&CMD_JOB/UNLOCK [v(JOB_GO)]=$+job/unlock *:@switch [u(%va/HAS_ACCESS,%#)][setq(0,u(%va/FN_FIND-JOB,%0))][isdbref(%q0)][u(%va/FN_ACCESSCHECK,parent(%q0),%#)][u(%va/FN_HASATTRP,%q0,LOCKED)][udefault(%q0/UNL_ACCESS,1,%#)]=0*,{@pemit %#=Permission denied.},10*,{@pemit %#=That is an invalid job number.},110*,{@pemit %#=You do not have access to that job.},1110*,{@pemit %#=That job is not locked.},11110*,{@pemit %#=That action is not available for that job.},{@pemit %#=You have unlocked job %0.;&LOCKED %q0=;&LOCKED_BY %q0=;@trigger %va/TRIG_ADD=%q0,Unlocked by %n.,%#,UNL;@trigger %va/TRIG_BROADCAST=%q0,%#,UNL}
&CMD_JOB/UNTAG [v(JOB_GO)]=$+job/untag *:@switch [u(%va/HAS_ACCESS,%#)][switch(strmatch(%0,*=*),1,[setq(8,secure(first(%0,=)))][setq(9,secure(rest(%0,=)))],[setq(8,secure(%0))][setq(9,%#)])][setq(7,map(%va/MAP_JGROUP,%q9))][setq(6,u(%va/fn_trim,squish(map(%va/MAP_JGROUPERROR,%q9))))][setq(0,u(%va/FN_FIND-JOB,%q8))][isdbref(%q0)][u(%va/FN_ACCESSCHECK,parent(%q0),%#)][not(u(%va/IS_LOCKED,%q0,%#))][udefault(%q0/TAG_ACCESS,1,%#)]=0*,{@pemit %#=Permission denied.},10*,{@pemit %#=That is an invalid job number.},110*,{@pemit %#=You do not have access to that job.},1110*,{@pemit %#=That job is presently [ifelse(u(%va/FN_HASATTRP,%q0,CHECKOUT),checked out to [name(first(get(%q0/CHECKOUT)))],locked)]},11110*,{@pemit %#=That action is not available for that job.},{@switch [t(strlen(%q6))]=1,{@pemit %#=%q6},{@switch [strlen(setinter(%q7,get(%q0/tagged_for)))]=0,{@pemit %#={[name(%q0)] is not tagged for any of the named player(s): [u(%va/FN_ITEMIZE,map(%va/MAP_NAME,%q7,%b,|),|)]}},{&tagged_for %q0=[setdiff(get(%q0/tagged_for),%q7)];@trigger %va/TRIG_ADD=%q0,Removed tags for [setr(5,u(%va/FN_ITEMIZE,map(%va/MAP_NAME,%q7,%b,|),|))],%#,TAG;@trigger %va/TRIG_BROADCAST=%q0,%#,TAG,%q5;@pemit %#={Job %q8 updated - tags removed. Now tagged for: [u(%va/FN_ITEMIZE,map(%va/MAP_NAME,get(%q0/tagged_for),%b,|),|)]}}}}
&CMD_JOB/VIEW [v(JOB_GO)]=$+job *:@switch [u(%va/HAS_ACCESS,%#)][setq(0,u(%va/FN_FIND-JOB,%0))][isdbref(%q0)][u(%va/FN_ACCESSCHECK,parent(%q0),%#)]=0*,{@pemit %#=Permission denied.},10*,{@pemit %#=There is no job by that name. Please type '[ansi(h,+jobs/all)]' for all jobs or '[ansi(h,+jobs/list <bucket>)]' to list by bucket.},110*,{@pemit %#=You do not have access to that job.},{@pemit %#=[u(%va/FN_READERS,%q0,%#)][u(%va/FN_HEADER,View [name(%q0)])]%r[ulocal(%va/FN_BANNER,%q0,%#)][ifelse(u(%va/FN_HASATTRP,%q0,SUMMARY),[ulocal(%va/FN_SUMMARY,%q0,%#)],)];@dolist [filter(%va/FIL_COMMENTS,sortby(%va/SORTBY_COMMENTS,lattr(%q0/COMMENT_*)))]={@pemit %#=[u(%va/FN_READJOB,##,%q0)]};@wait 0={@pemit %#=[u(%va/FN_FOOTER,u(%va/FN_FLAGS,%q0))]};}
&CMD_JOBS [v(JOB_GO)]=$+jobs:@fo %#=+jobs/select [switch(u(%va/FN_HASATTR,%#,JOBSELECT),1,get(%#/JOBSELECT),monitor)]
&CMD_JOBS/ALL [v(JOB_GO)]=$+jobs/all:@fo %#=+jobs/select all
&CMD_JOBS/CATCHUP [v(JOB_GO)]=$+jobs/catchup:@switch [u(%va/HAS_ACCESS,%#)]=0*,{@pemit %#=Permission denied.},{@pemit %#=You are now caught up on jobs.;&LAST_CONN %#=[secs()];@dolist lcon(%va)={think [u(%va/FN_READERS,##,%#)]}}
&CMD_JOBS/CLEAN [v(JOB_GO)]=$+jobs/clean:@switch [u(%va/HAS_ACCESS,%#)]=0*,{@pemit %#=Permission denied.},{@trigger %va/TRIG_CLEAN;@pemit %#=Removing all non-player entries from Job Data.}
&CMD_JOBS/COMPRESS [v(JOB_GO)]=$+jobs/compress:@switch [u(%va/FN_WIZONLY,%#)][words(remove(lcon(%va),#-1))]=0*,{@pemit %#=Permission denied.},10*,{&JOBS_NUM %va=0;@pemit %#=Compressed. The next job number will be [inc(get(%va/JOBS_NUM))].},{@dolist [lnum(1,words(lcon(%va)))]={@name [extract(revwords(lcon(%va)),##,1)]=Job ##};&JOBS_NUM %va=[words(lcon(%va))];@pemit %#=Compressed. The next job number will be [inc(get(%va/JOBS_NUM))].}
&CMD_JOBS/CREDITS [v(JOB_GO)]=$+jobs/credits:@pemit %#=[u(%va/FN_HEADER,Anomaly Jobs)]%r%rVersion: [u(%va/VERSION)][space(5)]Release: [u(%va/RELEASE)]%r%rAuthor: [u(%va/CREDITS)]%r%rMaintainer: [u(%va/MAINTAINER)]%r%rContributors: [u(%va/CONTRIBUTORS)]%r%r[u(%va/LICENSE)]%r%r[u(%va/FN_FOOTER)]
&CMD_JOBS/DATE [v(JOB_GO)]=$+jobs/date:@switch [u(%va/HAS_ACCESS,%#)]=0*,{@pemit %#=Permission denied.;},{@pemit %#=[u(%va/FN_JOBSHEADER,%#)];@dolist [sortby(%va/SORTBY_DATE,lcon(%va))]={@pemit %#=[ifelse(u(%va/FN_MONITORCHECK,parent(##),%#),[u(%va/FN_JOBLIST,##,%#)],)]};@wait 0=@pemit %#=[u(%va/FN_FOOTER,* Denotes New Activity)];}
&CMD_JOBS/LIST [v(JOB_GO)]=$+jobs/list *:@switch [u(%va/HAS_ACCESS,%#)][setq(0,u(%va/FN_FIND-BUCKET,%0))][isdbref(%q0)][u(%va/FN_ACCESSCHECK,%q0,%#)]=0*,{@pemit %#=Permission denied.},10*,{@pemit %#=That is not a valid bucket. Type '[ansi(h,+buckets)]' for a list of valid buckets.},110*,{@pemit %#=You do not have access to that bucket.},{@pemit %#=[u(%va/FN_JOBSHEADER,%#)];@dolist [munge(%va/SORTBY_JOB,iter(remove(children(%q0),#-1),rest(name(##))),remove(children(%q0),#-1))]={@pemit %#=[u(%va/FN_JOBLIST,##,%#)]};@wait 0=@pemit %#=[u(%va/FN_FOOTER,* Denotes New Activity)];}
&CMD_JOBS/MINE [v(JOB_GO)]=$+jobs/mine:@fo %#=+jobs/select mine
&CMD_JOBS/NEW [v(JOB_GO)]=$+jobs/new:@fo %#=+jobs/select new
&CMD_JOBS/OVERDUE [v(JOB_GO)]=$+jobs/overdue:@fo %#=+jobs/select overdue
&CMD_JOBS/PRI [v(JOB_GO)]=$+jobs/pri:@switch [u(%va/HAS_ACCESS,%#)]=0*,{@pemit %#=Permission denied.},{&JOBS_PRI %va=[sortby(%va/SORTBY_PRI,lcon(%va))];@pemit %#=[u(%va/FN_JOBSHEADER,%#)];@dolist [revwords(get(%va/JOBS_PRI))]={@pemit %#=[ifelse(and(u(%va/FN_ACCESSCHECK,[parent(##)],%#),u(%va/FN_MONITORCHECK,parent(##),%#)),u(%va/FN_JOBLIST,##,%#),)]};@wait 0=@pemit %#=[u(%va/FN_FOOTER,* Denotes New Activity)];}
&CMD_JOBS/REPORTS [v(JOB_GO)]=$+jobs/reports *:@switch [and(u(%va/HAS_ACCESS,%#),u(%va/STATS_ACCESS,%#))][u(%va/FN_HASATTR,%va,REPORT_[first(%0,=)])][gt(words(%0,=),1)]=0*,{@pemit %#=Permission denied.},10*,{@pemit %#=There is no report by that name. See '[ansi(h,+jobs/reports)]' for a list of valid reports.},110*,{@pemit %#=[u(%va/FN_HEADER,[secure(ucstr(%0))] Report)]%r;@pemit %#=[u(%va/REPORT_[secure(%0)])];@pemit %#=[u(%va/FN_FOOTER)]},{@pemit %#=[u(%va/FN_HEADER,[secure(first(ucstr(%0),=))] Report)]%r;@pemit %#=[u(%va/REPORT_[first(secure(%0),=)],rest(secure(%0),=))];@pemit %#=[u(%va/FN_FOOTER)]}
&CMD_JOBS/REPORTS2 [v(JOB_GO)]=$+jobs/reports:@switch [and(u(%va/HAS_ACCESS,%#),u(%va/STATS_ACCESS,%#))]=0,{@pemit %#=Permission denied.},{@pemit %#=[u(%va/FN_HEADER,Available Reports)]%r[ansi(hc,[ljust(Name,10)][ljust(Description,u(%va/FN_FLEXWIDTH,59))][rjust(Type,10)])]%r[u(%va/FN_BREAK)];@pemit %#=[iter(sort(ucstr(map(%va/MAP_REPORTS,lattr(%va/REPORT_*)))),[ljust(##,10)][u(%va/FN_STREXACT,rest(get(%va/RTITLE_##),|),u(%va/FN_FLEXWIDTH,59))][rjust(first(get(%va/RTITLE_##),|),10)],%B,%R)];@pemit %#=[u(%va/FN_FOOTER,[ansi(h,+jobs/reports <report>)])]}
&CMD_JOBS/SEARCH [v(JOB_GO)]=$+jobs/search *:@switch [u(%va/HAS_ACCESS,%#)]=0*,{@pemit %#=Permission denied.},{@pemit %#=[u(%va/FN_JOBSHEADER,%#)];@dolist revwords(lcon(%va))={@pemit [setq(0,%b)]%#=ifelse(and(u(%va/FN_ACCESSCHECK,parent(##),%#),gt(words(grepi(##,*,%0)),0)),[u(%va/FN_JOBLIST,##,%#)],)};@wait 0=@pemit %#=[u(%va/FN_FOOTER,* Denotes New Activity)];}
&CMD_JOBS/SELECT [v(JOB_GO)]=$+jobs/select *:@switch [u(%va/HAS_ACCESS,%#)][setq(0,switch(u(%va/FN_HASATTR,%#,JOBSELECT_%0),1,get(%#/JOBSELECT_%0),%0))][setq(0,u(%va/FN_INFIX2POSTFIX,%q0))][not(strmatch(%q0,*#-1 MISMATCHED PARENS*))][not(strmatch(%q0,*#-1 SYNTAX ERROR*))]=0*,@pemit %#=Permission denied.,10*,@pemit %#=Mismatched parentheses.,110,@pemit %#=Syntax error.,{@pemit %#=[u(%va/FN_JOBSHEADER,%#)];@dolist [setq(1,filter(%va/FIL_GOING,revwords(lcon(%va))))][u(%va/FN_S-INIT)][map(%va/MAP_PARSESTACK,%q0)][sortby(%va/SORTBY_JOBNUM,u(%va/FN_S-PEEK))]={@pemit %#=[ifelse(or(u(%va/FN_ACCESSCHECK,[parent(##)],%#),u(%va/FIL_MINE,##)),u(%va/FN_JOBLIST,##,%#),)];};@wait 0=@pemit %#=[u(%va/FN_FOOTER,* Denotes New Activity)];}
&CMD_JOBS/SORT [v(JOB_GO)]=$+jobs/sort:@switch [u(%va/HAS_ACCESS,%#)]=0*,{@pemit %#=Permission denied.;},{@pemit %#=[u(%va/FN_JOBSHEADER,%#)];@dolist sortby(%va/SORTBY_SORT,lcon(%va))={@pemit %#=[ifelse(u(%va/FN_MONITORCHECK,parent(##),%#),[u(%va/FN_JOBLIST,##,%#)],)]};@wait 0=@pemit %#=[u(%va/FN_FOOTER,* Denotes New Activity)];}
&CMD_JOBS/WHO [v(JOB_GO)]=$+jobs/who *:@switch [u(%va/HAS_ACCESS,%#)][setq(0,pmatch(%0))][or(match(%0,none),isdbref(%q0))]=0*,{@pemit %#=Permission denied.},10*,{@pemit %#={There is no player by that name. Request must be by player or 'none'.}},{@pemit %#=[u(%va/FN_JOBSHEADER,%#)];@dolist [setq(1,switch(match(%0,none),0,%q0,))][u(%va/fn_trim,squish(iter(revwords(lcon(%va)),switch(u(%va/FIL_WHO,##,%q1),1,##))))]={@pemit %#=[ifelse(u(%va/FN_ACCESSCHECK,parent(##),%#),[u(%va/FN_JOBLIST,##,%#)],)]};@wait 0=@pemit %#=[u(%va/FN_FOOTER,* Denotes New Activity)];}
&CMD_JOBS/WHO2 [v(JOB_GO)]=$+jobs/who:@switch [u(%va/HAS_ACCESS,%#)]=0*,{@pemit %#=Permission denied.},{@pemit %#=You must identify a player.}
&CMD_MYJOB/ADD [v(JOB_GO)]=$+myjob/add *=*:@switch [not(haspower(%#,guest))][setq(0,u(%va/FN_FIND-JOB,%0))][isdbref(%q0)][and(u(%va/IS_PUBLIC,%q0),match(get(%q0/opened_by),%#))][not(u(%va/FN_HASATTR,%q0,LOCKED))]=0*,{@pemit %#=This command is not available to guests.},10*,@pemit %#={That is an invalid job number.},110*,{@pemit %#=Job %0 is not yours. You can only modify your own jobs.},1110*,{@pemit %#=That job is locked and cannot be changed at this time.},{@pemit %#=Comments to job number %0 added.;@trigger %va/TRIG_ADD=%q0,%1,%#,ADD;@trigger %va/TRIG_BROADCAST=%q0,%#,ADD}
&CMD_MYJOB/HELP [v(JOB_GO)]=$+myjob/help *:@switch [setq(0,u(%va/FN_FIND-JOB,%0))][isdbref(%q0)]=0*,{@pemit %#=That is not a valid job. Type '[ansi(h,+jobs)]' for a list of valid jobs.},{@pemit %#=[u(%va/FN_HEADER,MyJob Help)];@pemit %#=[ifelse(u(%va/FN_HASATTR,parent(%q0),MYHELP),u(%q0/MYHELP),No +myjob help has been defined for that bucket.)];@pemit %#=[u(%va/FN_FOOTER)]}
&CMD_MYJOB/SUMSET [v(JOB_GO)]=$+myjob/sumset */*=*:@switch [not(haspower(%#,guest))][isdbref(setr(0,u(%va/FN_FIND-JOB,%0)))][u(%va/FN_HASATTRP,%q0,MYACCESS_[objeval(%#,%1)])][and(u(%va/CONFIG_ACCESS,%#),u(%q0/MYACCESS_[objeval(%#,%1)],%#))][not(u(%va/IS_LOCKED,%q0,%#))][u(%q0/MYPROCESS_[objeval(%#,%1)],objeval(%#,%2),%q0,%#)]=0*,{@pemit %#=Permission denied.},10*,{@pemit %#=There is no such job. See '[ansi(h,+jobs)]' for a list of valid jobs.},110*,{@pemit %#='%1' is not a valid parameter. Valid parameters for [name(%q0)] are [u(%va/FN_ITEMIZE,map(%va/MAP_PARAMS,lattr(parent(%q0)/MYPROCESS_*)))].},1110*,{@pemit %#=You either can not use the +myjob/sumset command, or set that parameter.},11110*,{@pemit %#=That job is presently [ifelse(u(%va/FN_HASATTRP,%q0,CHECKOUT),checked out to%b[name(first(get(%q0/CHECKOUT)))],locked)]},111110*,{@pemit %#=[u(%q0/MYERROR_[objeval(%#,%1)]%q2)]},{@trigger %va/TRIG_BROADCAST=%q0,%#,MYS,[ucstr([objeval(%#,%1)])];&%q3 %q0=%q1;@trigger %va/TRIG_ADD=%q0,[ucstr([objeval(%#,%1)])] parameter updated to '[objeval(%#,%2)]',%#,MYS}
&CMD_MYJOB/VIEW [v(JOB_GO)]=$+myjob *:@switch [not(haspower(%#,guest))][setq(0,u(%va/FN_FIND-JOB,%0))][isdbref(%q0)][or(gt(member(get(%q0/TAGGED_FOR),%#),0),u(%va/IS_TRANSPARENT,%q0),and(get(%q0/PUBLIC),match(get(%q0/OPENED_BY),%#)))]=0*,{@pemit %#=Permission denied.},10*,{@pemit %#=That is not a valid job number.},110*,{@pemit %#=Job %0 is not yours. You can only view your own jobs.},{@pemit %#=[u(%va/FN_READERS,%q0,%#)][u(%va/FN_HEADER,View [name(%q0)])]%r[u(%va/FN_MYBANNER,%q0)][ifelse(u(%va/FN_HASATTRP,%q0,MYSUMMARY),[ulocal(%va/FN_MYSUMMARY,%q0,%#)],)];@dolist [u(%va/FN_TRIM,squish(iter(filter(%va/FIL_COMMENTS,lattr(%q0/COMMENT_*)),switch(or(u(%q0/PUBLISH),hasflag(%q0/##,no_inherit),gt(member(get(%q0/TAGGED_FOR),%#),0),strmatch(extract(get(%q0/##),3,1,|),%#)),1,##))))]={@pemit %#=[u(%va/FN_READJOB,##,%q0)]};@wait 0=@pemit %#=[u(%va/FN_FOOTER)]}
&CMD_MYJOBS [v(JOB_GO)]=$+myjobs:@switch [haspower(%#,guest)]=1,@pemit %#={Sorry, this command is not available to guests.},{@pemit %#=[u(%va/FN_MYJOBSHEADER,%#)];@dolist revwords(lcon(%va))={@pemit %#=[ifelse(or(gt(member(get(##/TAGGED_FOR),%#),0),[or(and(get([parent(##)]/PUBLIC),match(get(##/OPENED_BY),%#)),u(%va/IS_TRANSPARENT,##))]),[u(%va/FN_MYJOBLIST,##,%#)],)]};@wait 0=@pemit %#=[u(%va/FN_FOOTER,[ansi(hr,*)] [ansi(hy,Denotes New Activity)])]}
&CMD_PITCH [v(JOB_GO)]=$+pitch *=*:@switch [not(haspower(%#,guest))]=0*,{@pemit %#=Permission Denied.},{@pemit %#=You have pitched your idea to staff about '[secure(%0)]'. Please remember that this is merely an idea [ansi(hu,pitch)], and not a request. Staff, for one reason or many, may decide not to go with the idea.;@trigger %va/TRIG_CREATE=%#,locate(%vc,PITCH,i),1,[u(%va/FN_STRTRUNC,secure(%0),30)],%1,,,3}
&CMD_REQUEST [v(JOB_GO)]=$+request *=*:@switch [not(haspower(%#,guest))]=0*,{@pemit %#=Permission denied.},{@pemit %#=You have requested [secure(u(%va/FN_STRTRUNC,%0,30))] from staff. Please allow for some time to process it. Do not page staff about it - you will hear back soon.;@trigger %va/TRIG_CREATE=%#,[locate(%vc,REQ,i)],2,[u(%va/FN_STRTRUNC,secure(%0),30)],[u(%va/FN_STRTRUNC,%1,get(%va/BUFFER))],,,2}
&CMD_TYPO [v(JOB_GO)]=$+typo *:@switch [not(haspower(%#,guest))]=0*,{@pemit %#=Permission denied.},{@pemit %#=You have notified production staff of the typo, with the details '[u(%va/FN_STRTRUNC,%0,get(%va/BUFFER))]';@trigger %va/TRIG_CREATE=%#,locate(%vc,BUILD,i),2,Typo Reported,[u(%va/FN_STRTRUNC,%0,get(%va/BUFFER))],,,4}
@dolist VA VB VC={@cpattr %#/JOB_##=[v(JOB_GO)]/##}
think [ansi(hc,ANOMALY JOBS:)] Setting controlling attributes.
@switch [v(JOB_PATCH)]=1,{@dolist STARTUP DATA_CHARS2 DISPLAY_MYHEADERS DISPLAY_MYJOB MYJOBS_HEADER FIL_DELETE FN_ANSIFY FN_EASYPIE_PENN FN_EASYPIE_TINY PENN_PIE PENN10_PIE PENN12_PIE FN_NEW_JOBS FN_PACK IS_PLAYER JOBS_HEADER JOBS_HEADER2 MAP_ANSIFY MAP_ARTSGRAPH MAP_NAME2 MAP_NEW={@switch [hasattr(v(JOB_VA),##)]=1,&## [v(JOB_VA)]}}
&CHARGRAPH [v(JOB_VA)]=@+-/!*ox#.X$^`~O>
&COLORGRAPH_1 [v(JOB_VA)]=gG
&COLORGRAPH_2 [v(JOB_VA)]=yY
&COLORGRAPH_3 [v(JOB_VA)]=rR
&COLORGRAPH_4 [v(JOB_VA)]=cC
&COLORGRAPH_5 [v(JOB_VA)]=bB
&COLORGRAPH_6 [v(JOB_VA)]=mM
&COLORGRAPH_7 [v(JOB_VA)]=wW
&COLORGRAPH_8 [v(JOB_VA)]=hX
&COLORGRAPH_9 [v(JOB_VA)]=hC
&COLORGRAPH_10 [v(JOB_VA)]=hB
&COLORGRAPH_11 [v(JOB_VA)]=hR
&COLORGRAPH_12 [v(JOB_VA)]=hY
&COLORGRAPH_13 [v(JOB_VA)]=hG
&COLORGRAPH_14 [v(JOB_VA)]=hM
&COLORGRAPH_15 [v(JOB_VA)]=hW
&COLORGRAPH_16 [v(JOB_VA)]=hX
&COLORGRAPH_17 [v(JOB_VA)]=hC
&DATA_31-15 [v(JOB_VA)]=@@@@####$$$^^^&&&**((())__+++{{}}//;;'':::""<<<>>>???,,,....aaa !!@@@@###$$$^^^&&&**(()))__++{{}}//;;''::""<<<>>???,,,....aaaab !!!!@@@@###$$$^^&&&**(())__++{{}}//;''::"""<<>>???,,,...aaaabbb ~~!!!!@@@@###$$^^^&&**(())_++{{}}/;;''::""<<>>???,,...aaaabbbbc =~~~~!!!@@@###$$^^^&&**())__+{{}//;;'::""<<>>??,,,..aaabbbbcccc ===~~~~!!!@@@###$$^^&&*(())_++{}//;'':""<<>>??,,..aaabbbbccccdd --====~~~~!!!@@##$$^^&&*(()_++{}//;'::"<<>??,,...aabbbccccdddde 0----====~~~!!!@@##$$^&&*())_+{}/;;':"<<>??,,..aabbbcccddddeeee 00000----===~~~!!@@#$$^&&*()_+{}/;':"<<>?,,..aabbcccdddeeeeefff 99990000----===~~!!@@#$^^&*()+{}/;':"<>?,..aabbccdddeeeefffffgg 888999990000---==~~!!@##$^&()_+}/':"<>?,.abbccdddeeeffffggggggh 7778888889999000--==~~!@#$^&()+};'"<?,.abbcddeeefffggggghhhhhhh 66777777778888999900--=~!@#^&(+};:<?.abcddeeffgggghhhhhiiiiiiii 566666666666777778889900-=~@$&)}'<,abdeefggghhhiiiiiijjjjjjjjjj 5555555555555555666666778890=@&}<adegghiiijjjjjjjkkkkkkkkkkkkkk 4444444444444444444444444444444llllllllllllllllllllllllllllllll 3333332222222222221111```ZYXVSOHBwusrqppoooonnnnnnnnmmmmmmmmmmm 2222211111111`````ZZZYYXWVUSQOLHEBywvutsrrqqppppoooooooonnnnnnn 1111```````ZZZZYYYXXWWVUTSRQOMKHFDBzywvuutssrrrqqqqppppppoooooo ````ZZZZZZYYYYXXXWWVVUTSRQPOMLJHGECBAyxwwvuuttssrrrrqqqqqpppppp ZZZZZYYYYXXXXWWWVVUUTSSRQPONLKJHGFDCBAzyxwwvvuuttssssrrrrqqqqqq YYYYYXXXXWWWWVVUUTTSSRQQPONMLKJHGFEDCBAzyyxwwvvuuutttssssrrrrrq YXXXXXWWWVVVVUUTTSSRRQPPONMLKJIHGFEDDCBAzzyxxwwvvvuuutttsssssrr XXWWWWVVVVUUUTTSSRRQQPPONMMLKJIHHGFEDCCBAAzyyxxwwwvvuuuuttttsss WWWVVVVUUUTTTSSSRRQQPOONNMLKKJIHHGFEEDCCBAAzzyyxxwwwvvvuuuutttt VVVVUUUUTTTSSSRRQQPPOONNMLLKJJIHHGFFEDDCBBAAzzyyyxxwwwvvvvuuuut VVUUUUTTTSSSRRRQQPPOONNMMLKKJJIHHGFFEEDDCBBAAzzzyyxxxwwwvvvvuuu UUUTTTTSSSRRRQQQPPOONNMMLLKKJJIHHGGFFEDDCCBBAAAzzyyyxxxwwwwvvvv UTTTTSSSSRRRQQPPPOONNNMMLLKKJIIHHGGFFEEDDCCBBAAAzzzyyyxxxwwwwvv TTTSSSSRRRQQQPPPOONNNMMLLKKJJIIHHGGFFEEDDDCCBBBAAzzzyyyxxxxwwww TSSSSRRRRQQQPPPOONNNMMLLLKKJJIIHHGGGFFEEDDCCCBBBAAzzzzyyyxxxxww
&DATA_CHARS [v(JOB_VA)]=abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ`1234567890-=~!@#$^&*()_+{}/;':"<>?,.
&DISPLAY_# [v(JOB_VA)]=[u(%va/FN_STREXACT,%0,default(%#/JOBSWIDTH_#,8))]
&DISPLAY_A [v(JOB_VA)]=[u(%va/FN_STREXACT,ifelse(isdbref(get(%0/ASSIGNED_TO)),name(get(%0/ASSIGNED_TO)),-),default(%#/JOBSWIDTH_A,16))]
&DISPLAY_B [v(JOB_VA)]=[u(%va/FN_STREXACT,u(%va/FN_BUCKETNAME,%0),default(%#/JOBSWIDTH_B,5))]
&DISPLAY_C [v(JOB_VA)]=[u(%va/FN_STREXACT,u(%va/FN_SHORT_DATE,convsecs(get(%0/OPENED_ON))),default(%#/JOBSWIDTH_C,8))]
&DISPLAY_D [v(JOB_VA)]=[u(%va/FN_STREXACT,switch(get(%0/STATUS),0,--HOLD--,ifelse(get(%0/DUE_ON),ifelse(gt(secs(),get(%0/DUE_ON)),OVERDUE!,[u(%va/FN_SHORT_DATE,convsecs(get(%0/DUE_ON)))]),--------)),default(%#/JOBSWIDTH_D,8))]
&DISPLAY_F [v(JOB_VA)]=[u(%va/FN_STREXACT,[ifelse(u(me/IS_LOCKED,%0),ifelse(u(%va/FN_HASATTRP,%0,CHECKOUT),C,L),-)][ifelse(u(me/IS_PUBLIC,%0),M,-)][ifelse(u(me/IS_TAGGED,%0),T,-)][ifelse(u(me/IS_PUBLISHED,%0),P,-)],default(%#/JOBSWIDTH_F,4))]
&DISPLAY_M [v(JOB_VA)]=[u(%va/FN_STREXACT,u(%va/FN_SHORT_DATE,convsecs(get(%0/MODIFIED_ON))),default(%#/JOBSWIDTH_M,8))]
&DISPLAY_O [v(JOB_VA)]=[u(%va/FN_STREXACT,name(first(get(%0/OPENED_BY))),default(%#/JOBSWIDTH_O,16))]
&DISPLAY_S [v(JOB_VA)]=[u(%va/FN_STRTRUNC,center(switch([u(%va/FN_HASATTRP,%0,LOCKED)][u(%va/FN_HASATTRP,%0,CHECKOUT)][get(%0/STATUS)],1*,LOCKED,01*,CHECKED,000,ON HOLD,001,NEW,002,UNDERWAY,003,1/4 DONE,004,1/2 DONE,005,3/4 DONE,006,COMPLETE,NEW),default(%#/JOBSWIDTH_S,8)),default(%#/JOBSWIDTH_S,8))]
&DISPLAY_T [v(JOB_VA)]=[u(%va/FN_STREXACT,get(%0/TITLE),default(%#/JOBSWIDTH_T,u(%va/FN_LEFTOVER)))]
&DISPLAY_BUCKET [v(JOB_VA)]=[rjust(ansi(h,Name:),20)] [name(%q0)] [ifelse(u(%va/FN_STAFFALL,%#),%(%q0%),)] %([words(remove(children(%q0),#-1))] jobs in bucket%)%r[rjust(ansi(h,Locked To:),20)] [ifelse(u(%va/FN_HASATTRP,%q0,ACCESS),[get(%q0/ACCESS)] [ifelse(u(%va/FN_ACCESSCHECK,%q0,%#),%(You have access%),%(You do not have access%))],*UNLOCKED*)]%r[rjust(ansi(h,Post Data:),20)] %(Job system will post to these boards%)%r[u(%va/fn_columns,Complete: [u(%va/FN_FIND-BBNUM,get(%q0/POST_COMPLETE))]|Approve: [u(%va/FN_FIND-BBNUM,get(%q0/POST_APPROVE))]|Deny: [u(%va/FN_FIND-BBNUM,get(%q0/POST_DENY))],16,|,21)][ifelse(u(%va/FN_HASATTRP,%q0,TURNAROUND),%r[rjust(ansi(h,Turnaround:),20)] [get(%q0/TURNAROUND)] hours %([div(get(%q0/TURNAROUND),24)] days%),)]%r[rjust(ansi(h,Logfile:),20)] [switch([first(version())]-[u(%va/FN_HASATTRP,%q0,LOGFILE)],PennMUSH-1,command.log,TinyMUSH-1,netmush.log,RhostMUSH-1,[get(%q0/LOGFILE)]_manual.log,*-1,M-[u(%q0/LOGFILE)].log,None)]%r[rjust(ansi(h,Hidden Status:),20)] [switch([u(%va/FN_HASATTRP,%q0,HIDDEN)][gt(member(u(%#/JOBSH),%q0),0)],00,Unhidden,01,Locally,11,Globally Hidden & Locally Watched,10,Globally,UNKNOWN CASE)]%r[rjust(ansi(h,+Myjobs Status:),20)] [ifelse(u(%va/FN_HASATTRP,%q0,PUBLIC),Accessible,Inaccessible)]%r[rjust(ansi(h,Avg Resolve Time:),20)] [u(%va/fn_trim,u(%va/FN_ART,%q0))]%r[rjust(ansi(h,Closure Stats:),20)]%b[ljust(Completed: [after(grab(get(%q0/LIST_STATS),COM|*),|)],16)][ljust(Deleted: [after(grab(get(%q0/LIST_STATS),DEL|*),|)],16)][ljust(Approved: [after(grab(get(%q0/LIST_STATS),APR|*),|)],16)]Denied: [after(grab(get(%q0/LIST_STATS),DNY|*),|)]%r[rjust(ansi(h,Desc:),20)] [get(%q0/DESC)][ifelse(gt(words(setr(x,setdiff(lattr(%q0),u(%va/LIST_BADATTR,%q0)))),0),%r[rjust(ansi(h,Provides:),20)] %(Attributes provided to jobs in the bucket%)%r[u(%va/fn_columns,%qx,16,,21)],)][ifelse(gt(words(lattr(%q0/PROCESS_*)),0),%r[rjust(ansi(h,Settings:),20)] %(+job/sumset settings%)%r[u(%va/fn_columns,map(MAP_SETTINGS,lattr(%q0/PROCESS_*)),16,,21)],)]
&DISPLAY_BUCKET2 [v(JOB_VA)]=[rjust(ansi(h,Players:),20)] %(Connected players with access to this bucket%)%r[u(%va/fn_columns,[u(%va/fn_trim,squish(iter(edit(objeval(%#,lwho()),%b,|),ifelse(and(u(%va/HAS_ACCESS,##),u(%va/FN_ACCESSCHECK,%q0,##)),name(##),),|,|),|),b,|)],16,|,21)]
&FIL_ACCESS [v(JOB_VA)]=u(%va/FN_ACCESSCHECK,%0,%#)
&FIL_BROADCAST [v(JOB_VA)]=ifelse(u(%va/FN_HASATTRP,%0,JOBS_SILENCE),0,u(%va/FN_ACCESSCHECK,%q0,%0))
&FIL_BUCKET [v(JOB_VA)]=t(member(children(%1),%0))
&FIL_COMMENTS [v(JOB_VA)]=t(member(get(%va/LIST_VISCOMMENTS),first(get(%q0/%0),|)))
&FIL_DUEAFTER [v(JOB_VA)]=or(eq(default(%0/DUE_ON,0),0),gt(get(%0/DUE_ON),%1))
&FIL_ESC [v(JOB_VA)]=eq(get(%0/PRIORITY),%1)
&FIL_GOING [v(JOB_VA)]=not(default(%0/GOING,0))
&FIL_ISBUCKET [v(JOB_VA)]=member(%vc,parent(%0))
&FIL_ISPLAYER [v(JOB_VA)]=or(hastype(%0,player),member(lcon(%vb),%0))
&FIL_MINE [v(JOB_VA)]=gt(member([switch(loc(get(%0/assigned_to)),%vb,u(%va/FN_JGROUPMEMBERS,get(%0/assigned_to)),get(%0/assigned_to))] [get(%0/tagged_for)],%#),0)
&FIL_NEW [v(JOB_VA)]=u(%va/FIL_NEW0,%0)
&FIL_NEW0 [v(JOB_VA)]=gt(get(%0/MODIFIED_ON),get(%#/LAST_CONN))
&FIL_NEW1 [v(JOB_VA)]=gt(dec(get(%0/NUM_COMMENT)),last(grab(get(%0/LIST_READERS),%#|*),|))
&FIL_NEWCOMMENTS0 [v(JOB_VA)]=and(gt(extract(get(%q0/%0),2,1,|),%q1),gt(member(get(%va/LIST_VISCOMMENTS),first(get(%q0/%0),|)),0))
&FIL_NEWCOMMENTS1 [v(JOB_VA)]=gt(last(%0,_),last(grab(get(%q0/LIST_READERS),%#|*),|))
&FIL_NOSPAM [v(JOB_VA)]=not(u(%va/FN_HASATTR,%0,JOBS_NOSPAM))
&FIL_NOTPLAYER [v(JOB_VA)]=not(or(hastype(%0,player),member(lcon(%vb),%0)))
&FIL_OVERDUE [v(JOB_VA)]=ifelse(get(%0/DUE_ON),gt(secs(),get(%0/DUE_ON)),0)
&FIL_SOURCE [v(JOB_VA)]=t(member(get(%0/OPENED_BY),%1))
&FIL_STATUS [v(JOB_VA)]=eq(get(%0/STATUS),%1)
&FIL_SEARCH [v(JOB_VA)]=t(words(grepi(%0,*,%1)))
&FIL_WHO [v(JOB_VA)]=strmatch(get(%0/ASSIGNED_TO),%1)
&FN_ACCESSCHECK [v(JOB_VA)]=and(or(u(%va/FN_WIZONLY,%1),switch([elock(%0/speech,%1)][gt(member(get(%1/JOBSB),%0),0)],01,1,10,1,11,0,0)),u(%va/HAS_ACCESS,%1))
&FN_ADDSTAT [v(JOB_VA)]=[setq(x,ifelse(u(%va/FN_HASATTR,%1,LIST_STATS),get(%1/LIST_STATS),))][setq(0,match(%qx,%0|*))][setq(1,grab(%qx,%0|*))][ifelse(gt(%q0,0),[set(%1,LIST_STATS:[setunion(ldelete(%qx,%q0),[first(%q1,|)]|[inc(rest(%q1,|))])])],[set(%1,LIST_STATS:[setunion(%qx,%0|1)])])]
&FN_ADDSTAT_ART [v(JOB_VA)]=null(set(%0,STAT_ART:[add(first(default(%0/STAT_ART,0 0)),sub(secs(),get(%1/OPENED_ON)))] [inc(last(default(%0/STAT_ART,0 0)))]))
&FN_ART [v(JOB_VA)]=u(%va/FN_TIME,round(fdiv(first(default(%0/STAT_ART,0 0)),rest(default(%0/STAT_ART,0 1))),0))
&FN_ASSEMBLEPIE [v(JOB_VA)]=[setq(1,%1)][setq(0,0)][map(%va/MAP_PIEDATA,%0,switch(%2,,%b,%2),|)]
&FN_BANNER [v(JOB_VA)]=u(%va/FN_SKIN,BANNER,%0,%1,%2,%3)
&FN_BARGRAPH [v(JOB_VA)]=[setq(4,ifelse(%5,%5,%B))][setq(5,ifelse(%2,%2,2))][setq(6,ifelse(%3,ifelse(gt(%3,16),16,%3),1))][setq(7,switch(%4,,#,%4))][setq(1,ifelse(%1,%1,18))][setq(2,%q1)][setq(0,last(sort(%0,n,%q4,%q4),%q4))][setq(3,fdiv(%q1,%q0))][setq(x,iter(lnum(%q1),[setq(9,0)][switch(%q2,%q1,rjust(%q0,3),ifelse(mod(%q1,2),inc(div(%q1,2)),div(%q1,2)),[rjust(div(%q0,2),3)],[space(3)])]|[map(MAP_GRAPH,%0,%q4,%b)][setq(2,sub(%q2,1))],%B,%R))]%qx%R[space(2)]0+[repeat(-,dec(add(mul(words(%0,%q4),%q5),words(%0,%q4))))]
&FN_BREAK [v(JOB_VA)]=u(%va/FN_SKIN,BREAK,%0,%1,%2,%3)
&FN_BUCKETHEADER [v(JOB_VA)]=u(%va/FN_SKIN,BUCKETHEADER,%0,%1,%2,%3)
&FN_BUCKETLIST [v(JOB_VA)]=u(%va/FN_SKIN,BUCKETLIST,%0,%1,%2,%3)
&FN_BUCKETNAME [v(JOB_VA)]=ifelse(get(%0/GOING),GOING,ifelse(isdbref(parent(%0)),name(parent(%0)),ERROR))
&FN_CLEANFIND [v(JOB_VA)]=t(words(filter(%va/FIL_NOTPLAYER,get(%0/%1))))
&FN_CLEANFIX [v(JOB_VA)]=[setq(0,filter(%va/FIL_ISPLAYER,get(%0/%1)))][ifelse(words(%q0),%q0,owner(me))]
&FN_COLORPIE [v(JOB_VA)]=setq(0,u(fn_equalizepie,%1,%2))[setq(p,%0)][setq(1,u(%va/fn_rotatestr,setr(1,v(data_chars)),mod(round(fdiv(mul(%3,strlen(%q1)),360),0),360)))][setq(a,%]%])][setq(b,%qa%qa)][setq(c,%qb%qb)][null(map(map_colorpie,%q0,%2))][setq(p,edit(%qp,|,ansi(n,|)))]%qP
&FN_COORD2ANG [v(JOB_VA)]=switch(%0:%1,-*:-*,add(180,atan(fdiv(%1,%0),deg)),-*:*,add(180,atan(fdiv(%1,%0),deg)),*:-*,add(360,atan(fdiv(%1,%0),deg)),0:0,0,atan(fdiv(%1,%0),deg))
&FN_COLUMNS [v(JOB_VA)]=switch(first(version()),RhostMUSH,[columns(%0,min(sub(79,ifelse(gt(%3,78),1,%3)),%1),div(sub(79,ifelse(gt(%3,78),1,%3)),%1),l,,,ifelse(gt(words(%3),0),space(%3)),,,1,%2)],PennMUSH,[align([ifelse(%3,dec(%3),0)] [sub(78,ifelse(%3,dec(%3),0))],%B,[table(%0,%1,sub(78,ifelse(%3,dec(%3),0)),%2)])],columns(%0,%1,%2,%3))
&FN_CUTPIE [v(JOB_VA)]=setq(0,inc(%2))[setq(1,fdiv(%1,%2))][setq(2,power(%3,2))][setq(5,iter(lnum(0,dec(%3)),round(mul(sqrt(sub(%q2,power(add(##,.7),2))),%q1),0)))][setq(5,revwords(%q5) [setr(8,inc(ceil(mul(%3,2))))] %q5)][iter(lnum(-%3,%3),space(sub(%q8,setr(9,extract(%q5,#@,1))))[mid(extract(%0,add(##,%q0),1),shl(sub(%1,%q9),1),shl(%q9,2))],,|)]
&FN_DATECONV [v(JOB_VA)]=switch(words(%0,/),3,convtime(XXX [switch([rjust(first(%0,/),2,0)],01,Jan,02,Feb,03,Mar,04,Apr,05,May,06,Jun,07,Jul,08,Aug,09,Sep,10,Oct,11,Nov,12,Dec)] [rjust(extract(%0,2,1,/),2,0)] 23:59:00 [switch(strlen(setr(0,last(%0,/))),2,20[rjust(%q0,2,0)],%q0)]),switch(convtime(%0),*-*,fold(FOLD_DATECONV,%0,secs()),convtime(%0)))
&FOLD_DATECONV [v(JOB_VA)]=add(%0,switch(%1,*d*,mul(86400,before(%1,d)),*h*,mul(3600,before(%1,h)),*m*,mul(60,before(%1,m)),*s*,before(%1,s),0))
&FN_EASYPIE [v(JOB_VA)]=edit(u(%va/FN_PIELEGEND,u(%va/FN_COLORPIE,u(%va/FN_CUTPIE,foreach(%va/FOREACH_BRACKET,v(DATA_31-15)),31,15,%0),map(%va/MAP_EASYPIE,%1,%2),%2,%4),map(%va/MAP_EASYPIE2,%1,%2),%2,%3),|,%r)
&FN_EQUALIZEPIE [v(JOB_VA)]=setq(0,u(FN_LADD,map(%va/MAP_EQUALIZEPIE,%0,%1),%1))[setq(1,strlen(v(DATA_CHARS)))][map(MAP_EQUALIZEPIE2,%0,%1)]
&FN_FIND-BBDBREF [v(JOB_VA)]=extract(u([get(%vc/BBPOCKET)]/GROUPS),%0,1)
&FN_FIND-BBNUM [v(JOB_VA)]=member(u([get(%vc/BBPOCKET)]/GROUPS),%0)
&FN_FIND-BUCKET [v(JOB_VA)]=localize(ifelse(strmatch(name(setr(0,locate(%vc,%0,i))),%0),%q0,#-1))
&FN_FIND-JGROUP [v(JOB_VA)]=localize(ifelse(strmatch(name(setr(0,locate(%vb,%0,i))),%0),%q0,#-1))
&FN_FIND-JOB [v(JOB_VA)]=localize(ifelse(strmatch(name(setr(0,locate(%va,Job %0,i))),Job %0),%q0,#-1))
&FN_FLAG [v(JOB_VA)]=[ansi(h,%[)][ansi(switch(%1,,hy,%1),%0)][ansi(h,%])]
&FN_FLAGS [v(JOB_VA)]=u(%va/FN_SKIN,FLAGS,%0,%1,%2,%3)
&FN_FLEXWIDTH [v(JOB_VA)]=add(%0,switch(default(%#/JOBSWIDTH,[width(%#)]),#-1*,0,sub(default(%#/JOBSWIDTH,width(%#)),80)))
&FN_FOOTER [v(JOB_VA)]=u(%va/FN_SKIN,FOOTER,%0,%1,%2,%3)
&FN_GENDATA [v(JOB_VA)]=setq(0,%0)[setq(z,fdiv(inc(shl(%1,1)),inc(shl(%0,1))))][setq(9,fdiv(dec(setr(m,strlen(setr(8,v(DATA_CHARS))))),360))][setq(s,%2)][map(map_gendata,lnum(-%1,%1))]
&FN_HASATTR [v(JOB_VA)]=switch(first(version()),PennMUSH,hasattrval(%0,%1),hasattr(%0,%1))
&FN_HASATTRP [v(JOB_VA)]=switch(first(version()),PennMUSH,hasattrpval(%0,%1),hasattrp(%0,%1))
&FN_HEADER [v(JOB_VA)]=u(%va/FN_SKIN,HEADER,%0,%1,%2,%3)
&FN_INFIX2POSTFIX [v(JOB_VA)]=[u(%va/FN_S-INIT)][setq(v,map(%va/MAP_PARAMS,lattr(%va/SEL_*)))][u(%va/FN_TRIM,squish([map(%va/MAP_INFIX2POSTFIX,u(%va/FN_TOKENLIST,%0))]%B[u(%va/FN_S-POP-BINARY)][switch(1,t(member(%( %),u(%va/FN_S-PEEK))),#-1 MISMATCHED PARENS)]))]
&FN_ISNEW [v(JOB_VA)]=u(FIL_NEW[default(%1/JOBSN,0)],%0)
&FN_ITEMIZE [v(JOB_VA)]=localize(switch([setr(0,[itemize(%0,%1)])],#-1*,switch([setr(1,[elist(%0,and,%1)])],#-1*,u(fn_pretty,%0,%1),%q1),%q0))
&FN_JGROUPMEMBERS [v(JOB_VA)]=switch(first(version()),PennMUSH,lsearch(all,eplayers,\[u(%0/ISMEMBER,##)\]),RhostMUSH,searchng(eplayer=u(%0/ISMEMBER,##))search(eplayer=u(%0/ISMEMBER,##)))
&FN_JOBLIST [v(JOB_VA)]=ifelse(t(%0),u(%va/FN_SKIN,JOBLIST,%0,%1,%2,%3),)
&FN_JOBSHEADER [v(JOB_VA)]=u(%va/FN_SKIN,JOBSHEADER,%0,%1,%2,%3)
&FN_LADD [v(JOB_VA)]=switch([ladd(%0,%1)],#-1*,lmath(add,%0,%1),ladd(%0,%1))
&FN_LEFTOVER [v(JOB_VA)]=max(5,sub(u(%va/FN_FLEXWIDTH,79),fold(%va/FOLD_ADD,7[foreach(%va/FOREACH_LEFTOVER,%qj)])))
&FN_MAXWIDTH [v(JOB_VA)]=last(sort(map(map_maxwidth,%0,|,%b),n))
&FN_MONITORCHECK [v(JOB_VA)]=and(or(u(%va/FN_ACCESSCHECK,%0,%1),u(%va/FN_WIZONLY,%1)),switch([u(%va/FN_HASATTRP,%0,HIDDEN)][gt(member(get(%1/JOBSH),%0),0)],01,0,10,0,11,1,1),isdbref(parent(%0)))
&FN_MYBANNER [v(JOB_VA)]=u(%va/FN_SKIN,MYBANNER,%0,%1,%2,%3)
&FN_MYJOBLIST [v(JOB_VA)]=ifelse(t(%0),u(%va/FN_SKIN,MYJOBLIST,%0,%1,%2,%3),)
&FN_MYJOBSHEADER [v(JOB_VA)]=u(%va/FN_SKIN,MYJOBSHEADER,%0,%1,%2,%3)
&FN_MYSUMMARY [v(JOB_VA)]=u(%va/FN_SKIN,MYSUMMARY,%0,%1,%2,%3)
&FN_PCT [v(JOB_VA)]=%([mul(round(fdiv(%0,words(remove(lcon(%va),#-1))),2),100)]%%%)
&FN_PIEESCAPE [v(JOB_VA)]=case(ord(%0),92,%%%\,91,%%%[,93,%%%],37,%%%%,%0)
&FN_PIELEGEND [v(JOB_VA)]=[setq(d,inc(u(fn_maxwidth,%0)))][setq(n,%0[repeat(|,max(0,sub(setr(a,add(words(%1,%2),%3)),setr(b,words(%0,|)))))])][setq(m,repeat(|,%3)[edit(%1,ifelse(%2,%2,%b),|)][repeat(|,max(0,sub(%qb,%qa)))])][map(map_pielegend,lnum(1,words(%qm,|)),%b,|)]
&FN_PLAYERLIST [v(JOB_VA)]=u(%va/FN_ITEMIZE,map(MAP_NAME,get(%0/OPENED_BY),%b,|),|)
&FN_PRETTY [v(JOB_VA)]=switch(words(%0,switch(%1,,%b,%1)),0,%0,1,%0,[ldelete(edit(%0,switch(%1,,%b,%1),%,%b),words(%0,switch(%1,,%b,%1)),%,)]%band%b[last(%0,switch(%1,,%b,%1))])
&FN_READERS [v(JOB_VA)]=[set(%0,LIST_READERS:[setunion(setdiff(get(%0/LIST_READERS),grab(get(%0/LIST_READERS),%1|*)),%1|[dec(get(%0/NUM_COMMENT))])])]
&FN_READJOB [v(JOB_VA)]=u(%va/FN_SKIN,READ,%0,%1,%2,%3)
&FN_ROTATESTR [v(JOB_VA)]=mid(%0,%1,3999)[mid(%0,0,%1)]
&FN_S-INIT [v(JOB_VA)]=setq(S,)
&FN_S-PUSH [v(JOB_VA)]=setq(S,%0`%qS)
&FN_S-POP [v(JOB_VA)]=[first(%qS,`)][setq(S,rest(%qS,`))]
&FN_S-PEEK [v(JOB_VA)]=first(%qS,`)
&FN_S-POP-BINARY [v(JOB_VA)]=switch(1,t(match(OR AND,u(fn_s-peek))),[u(fn_s-pop)]%B[u(fn_s-pop-binary)])
&FN_S-POP-UNARY [v(JOB_VA)]=switch(1,t(match(NOT,u(fn_s-peek))),[u(fn_s-pop)]%B[u(fn_s-pop-unary)])
&FN_SHORT_DATE [v(JOB_VA)]=[switch(extract(%0,2,1),Jan,01,Feb,02,Mar,03,Apr,04,May,05,Jun,06,Jul,07,Aug,08,Sep,09,Oct,10,Nov,11,Dec,12,??)]/[extract(%0,3,1)]/[mid(last(%0),2,2)]
&FN_SKIN [v(JOB_VA)]=[setq(z,default(%#/JOBSKIN,DEFAULT))][ifelse(and(u(FN_HASATTR,me,%qz_SKIN),u(FN_HASATTR,me,%qz_%0)),u(%qz_%0,%1,%2,%3,%4),u(DEFAULT_%0,%1,%2,%3,%4))]
&FN_STAFFSUM [v(JOB_VA)]=u(FN_SKIN,STAFFSUM,%0,%1,%2,%3)
&FN_STREXACT [v(JOB_VA)]=ljust(u(FN_STRTRUNC,%0,%1),%1)
&FN_STRTRUNC [v(JOB_VA)]=localize(switch([setr(0,[strtrunc(%0,%1)])],#-1*,left(%0,%1),%q0))
&FN_SUMMARY [v(JOB_VA)]=u(FN_SKIN,SUMMARY,%0,%1,%2,%3)
&FN_TIME [v(JOB_VA)]=localize([setq(2,mod(%0,86400))][rjust([div(%0,86400)],2,0)]:[rjust(div(%q2,3600),2,0)]:[rjust(div(mod(%q2,3600),60),2,0)]:[rjust(mod(%q2,60),2,0)])
&FN_TOKENLIST [v(JOB_VA)]=u(fn_trim,squish(foreach(FN_TOKENPARSE,%0)))
&FN_TOKENPARSE [v(JOB_VA)]=switch(%0,",setq(Q,switch(%qQ,1,0,1)),%B,switch(%qQ,1,~,%B),|,%BOR%B,&,%BAND%B,!,%BNOT%B,%(,%B%(%B,%),%B%)%B,%0)
&FN_TRIM [v(JOB_VA)]=switch(first(version()),PennMUSH,trimtiny(%0,%1,%2),trim(%0,%1,%2))
&FOLD_ADD [v(JOB_VA)]=add(%0,%1)
&FOREACH_BRACKET [v(JOB_VA)]=\[%0
&FOREACH_COLORPIE [v(JOB_VA)]=setq(p,edit(%qp,%[%0,%]))
&FOREACH_LEFTOVER [v(JOB_VA)]=%b[inc(switch(%0,#,default(%#/JOBSWIDTH_#,8),A,default(%#/JOBSWIDTH_A,16),B,default(%#/JOBSWIDTH_B,5),C,default(%#/JOBSWIDTH_C,8),D,default(%#/JOBSWIDTH_D,8),F,default(%#/JOBSWIDTH_F,4),M,default(%#/JOBSWIDTH_M,8),O,default(%#/JOBSWIDTH_O,16),S,default(%#/JOBSWIDTH_S,8),0))]
&HEADER_# [v(JOB_VA)]=u(FN_STREXACT,DB#,default(%#/JOBSWIDTH_#,8))
&HEADER_A [v(JOB_VA)]=u(FN_STREXACT,Assigned To,default(%#/JOBSWIDTH_A,16))
&HEADER_B [v(JOB_VA)]=u(FN_STREXACT,Type,default(%#/JOBSWIDTH_B,5))
&HEADER_C [v(JOB_VA)]=u(FN_STREXACT,Opened,default(%#/JOBSWIDTH_C,8))
&HEADER_D [v(JOB_VA)]=u(FN_STREXACT,Due On,default(%#/JOBSWIDTH_D,8))
&HEADER_F [v(JOB_VA)]=u(FN_STREXACT,Flag,default(%#/JOBSWIDTH_F,4))
&HEADER_M [v(JOB_VA)]=u(FN_STREXACT,Modified,default(%#/JOBSWIDTH_M,8))
&HEADER_O [v(JOB_VA)]=u(FN_STREXACT,Opened By,default(%#/JOBSWIDTH_O,16))
&HEADER_S [v(JOB_VA)]=u(FN_STREXACT,Status,default(%#/JOBSWIDTH_S,8))
&HEADER_T [v(JOB_VA)]=u(%va/FN_STREXACT,Title,default(%#/JOBSWIDTH_T,u(%va/FN_LEFTOVER)))
&IS_HIDDEN [v(JOB_VA)]=udefault(%0/HIDDEN,0)
&IS_LOCKED [v(JOB_VA)]=ifelse(u(%va/FN_HASATTRP,%0,CHECKOUT),switch(first(get(%0/CHECKOUT)),%1,0,1),udefault(%0/LOCKED,0))
&IS_PUBLIC [v(JOB_VA)]=udefault(%0/PUBLIC,0)
&IS_PUBLISHED [v(JOB_VA)]=udefault(%0/PUBLISH,0)
&IS_SUMMARY [v(JOB_VA)]=u(%va/FN_HASATTRP,%0,SUMMARY)
&IS_TAGGED [v(JOB_VA)]=t(words(get(%0/TAGGED_FOR)))
&IS_TRANSPARENT [v(JOB_VA)]=u(%va/FN_HASATTRP,%0,TRANSPARENT)
&JOBS_DEFAULT [v(JOB_VA)]=BTDAS
&LIST_ACTIONS [v(JOB_VA)]=ADD Player input|ASN Assignment|CKI Check In|CKO Check Out|CLN Clone|CRE Create|DUE Due date|EDT Edited job|LOK Locked Job|MRG Merged job|NAM Re-name job|PUB Publication|SRC Source change|STA Status change|SUM Sumset change|TAG Job tag|TRN Transfer|UNL Unlock job|UNP Unpublish|COM +job/complete|DNY +job/deny|APR +job/approve|DEL +job/delete
&LIST_BADATTR [v(JOB_VA)]=Created Modified ACCESS Desc [lattr(%0/ACCESS_*)] [lattr(%0/ERROR_*)] [lattr(%0/PROCESS_*)] LIST_STATS STAT_ART TURNAROUND
&LIST_VISCOMMENTS [v(JOB_VA)]=ADD CRE COM MAI APR DEL DNY
&MAP_ACTIONS [v(JOB_VA)]=rest(%0,|)
&MAP_ACTIONS2 [v(JOB_VA)]=first(%0,|)
&MAP_COLORPIE [v(JOB_VA)]=foreach(foreach_colorpie,mid(%q1,0,setr(9,last(%0,:))))[setq(x,before(mid(%0,1,100),:))][setq(h,u(%va/fn_pieescape,mid(%0,0,1)))][setq(i,%qh%qh)][setq(j,%qi%qi)][setq(k,%qj%qj)][setq(p,edit(edit(edit(edit(%qp,%qc,ansi(%qx,%qk)),%qb,ansi(%qx,%qj)),%qa,ansi(%qx,%qi)),%],ansi(%qx,%qh)))][setq(1,mid(%q1,%q9,256))]
&MAP_EASYPIE [v(JOB_VA)]=extract(%0,1,switch(%0,:*,3,2),:)
&MAP_EASYPIE2 [v(JOB_VA)]=ldelete(%0,switch(%0,:*,3,2),:)
&MAP_EQUALIZEPIE [v(JOB_VA)]=last(%0,:)
&MAP_EQUALIZEPIE2 [v(JOB_VA)]=revwords(setr(8,round(fdiv(mul(%q1,setr(7,last(%0,:))),%q0),0))[setq(1,sub(%q1,%q8))][setq(0,sub(%q0,%q7))]:[rest(revwords(%0,:),:)],:)
&MAP_GENDATA [v(JOB_VA)]=setq(1,%0)%[[map(%va/map_gendata2,lnum(-%q0,%q0),,%[)]
&MAP_GENDATA2 [v(JOB_VA)]=mid(%q8,mod(round(mul(add(u(%va/fn_coord2ang,%0,%q1),%qs),%q9),0),%qm),1)
&MAP_GRAPH [v(JOB_VA)]=[setq(9,ifelse(gt(inc(%q9),%q6),1,inc(%q9)))][ifelse(lte(%q2,mul(%0,%q3)),[ansi(v(COLORGRAPH_%q9),[repeat(%q7,%q5)])],[repeat(%b,%q5)])]
&MAP_INDENT2 [v(JOB_VA)]=%b%b%0
&MAP_INFIX2POSTFIX [v(JOB_VA)]=switch(1,t(match(%qv,first(%0,=))),[%0]%B[u(%va/FN_S-POP-UNARY)],t(match(OR AND,%0)),[u(%va/FN_S-POP-BINARY)][u(%va/FN_S-PUSH,%0)],strmatch(NOT,%0),[u(%va/FN_S-PUSH,%0)],strmatch(%(,%0),[u(%va/FN_S-PUSH,%0)],strmatch(%),%0),[u(%va/FN_S-POP-BINARY)][switch(u(%va/FN_S-PEEK),%(,null(u(%va/FN_S-POP)),#-1 MISMATCHED PARENS)]%B[u(%va/FN_S-POP-UNARY)],#-1 SYNTAX ERROR)
&MAP_ISPLAYER [v(JOB_VA)]=isdbref(pmatch(%0))
&MAP_JGROUP [v(JOB_VA)]=switch(%0,+*,u(%va/FN_JGROUPMEMBERS,u(%va/FN_FIND-JGROUP,%0)),pmatch(%0))
&MAP_JGROUPERROR [v(JOB_VA)]=ifelse(or(isdbref(pmatch(%0)),isdbref(u(%va/FN_FIND-JGROUP,%0))),,I don't recognize '%0' as a player or jgroup.)
&MAP_MAXWIDTH [v(JOB_VA)]=strlen(%0)
&MAP_NAME [v(JOB_VA)]=name(%0)
&MAP_PARAMS [v(JOB_VA)]=lcstr(rest(%0,_))
&MAP_PARSESTACK [v(JOB_VA)]=switch([setr(2,first(%0,=))][setq(a,edit(rest(%0,=),~,%B))],OR,u(%va/FN_S-PUSH,setunion(u(%va/FN_S-POP),u(%va/FN_S-POP))),AND,u(%va/FN_S-PUSH,setinter(u(%va/FN_S-POP),u(%va/FN_S-POP))),NOT,u(%va/FN_S-PUSH,setdiff(%q1,u(%va/FN_S-POP))),u(%va/FN_S-PUSH,filter(%va/SEL_%q2,%q1)))
&MAP_PIEDATA [v(JOB_VA)]=[mid(get(%va/CHARGRAPH),%q0,1)][setq(0,inc(%q0))][get(me/COLORGRAPH_%q0)]:%0:[extract(%q1,%q0,1)]
&MAP_PIELEGEND [v(JOB_VA)]=ljust(extract(%qn,%0,1,|),%qd) [ansi(before(mid(setr(q,extract(%qm,%0,1,|)),1,10),:),mid(%qq,0,1))] [switch(%qq,:*,extract(%qq,3,100,:),after(%qq,:))]
&MAP_PMATCH [v(JOB_VA)]=pmatch(%0)
&MAP_READERS [v(JOB_VA)]=first(%0,|)
&MAP_REPORTS [v(JOB_VA)]=after(lcstr(%0),_)
&MAP_SETTINGS [v(JOB_VA)]=rest(%0,_)
&MAP_SOURCE [v(JOB_VA)]=switch(%0,+*,u(FN_JGROUPMEMBERS,u(%va/FN_FIND-JGROUP,%0)),pmatch(%0))
&MAP_STAT_ESC [v(JOB_VA)]=ifelse(and(u(%va/FN_HASATTRP,%0,DUE_ON),gt(secs(),get(%0/DUE_ON))),setq(3,inc(%q3)),switch(default(%0/PRIORITY,1),1,setq(1,inc(%q1)),2,setq(2,inc(%q2)),3,setq(3,inc(%q3)),setq(0,inc(%q0))))
&MAP_STAT_STATUS [v(JOB_VA)]=ifelse(u(%va/FIL_OVERDUE,%0),setq(7,inc(%q7)),switch(default(%0/STATUS,1),1,setq(1,inc(%q1)),2,setq(2,inc(%q2)),3,setq(3,inc(%q3)),4,setq(4,inc(%q4)),5,setq(5,inc(%q5)),6,setq(6,inc(%q6)),setq(0,inc(%q0))))
think [ansi(hc,ANOMALY JOBS:)] Installing reports.
&REPORT_ACTBY [v(JOB_VA)]=[switch(%0,,This report requires you to supply an action code.%r%rUse: '+jobs/reports ACTBY=<action code>'.%r,[setq(0,squish(iter(lcon(%vc),ifelse(eq(words(grab(u(##/LIST_STATS),%0|*)),0),,##))))][setq(1,squish(iter(%q0,rest(grab(u(##/LIST_STATS),%0|*),|))))][ifelse(lt(words(%q1),1),There is no action code '[ucstr(%0)]' presently in the system.%r,[ulocal(FN_BARGRAPH,%q1,10,2,16,#)]%r[space(4)][iter(%q0,[u(%va/FN_STREXACT,name(##),2)])]%r%r[center([ucstr(%0)] Actions by Bucket,u(%va/FN_FLEXWIDTH,79))])])]
&REPORT_ACTIONS [v(JOB_VA)]=[ulocal(FN_BARGRAPH,setr(0,map(MAP_ACTIONS,v(LIST_STATS))),15,2,16,#)][setq(0,fold(FOLD_ADD,%q0,0))]%r[space(4)][setq(1,map(MAP_ACTIONS2,sort(v(LIST_STATS))))][iter(%q1,[mid(##,0,1)]%b)]%r[space(4)][iter(%q1,[mid(##,1,1)]%b)]%r[space(4)][iter(%q1,[mid(##,2,1)]%b)]%r%r[center(%q0 Actions Performed Since [v(INSTALL_DATE)],u(%va/FN_FLEXWIDTH,79))]
&REPORT_ARTS [v(JOB_VA)]=[iter(sortby(%va/SORTBY_NAME,lcon(%vc)),[ifelse(u(%va/FN_HASATTR,##,STAT_ART),u(%va/FN_TIME,round(fdiv(first(get(##/STAT_ART)),rest(get(##/STAT_ART))),0)),[rjust(-,11)])]%b[ljust(ansi(hc,[name(##)]),20)],%B,%R)]%R[rjust(u(%va/FN_TIME,round(fdiv(first(default(%vc/STAT_ART,0 0)),rest(default(%vc/STAT_ART,0 1))),0)),11)]%b[ansi(hy,Total ART)]%r[center(Average Resolution Times by Bucket,u(%va/FN_FLEXWIDTH,79))]
&REPORT_ARTSGRAPH [v(JOB_VA)]=[setq(0,iter(setr(1,sortby(%va/SORTBY_NAME,lcon(%vc))),ifelse(u(%va/FN_HASATTR,##,STAT_ART),[div(round(fdiv(first(get(##/STAT_ART)),rest(get(##/STAT_ART))),0),86400)],0)))][ulocal(%va/FN_BARGRAPH,%q0,15,2,16,#)]%r[space(4)][iter(%q1,mid([name(##)]%B,0,2))]%r%r[center(Average Resolution Time by Bucket %(in days%),u(%va/FN_FLEXWIDTH,79))]
&REPORT_BACT [v(JOB_VA)]=[switch(%0,,This report requires you to supply a bucket name.%r%rUse: '+jobs/reports BACT=<bucket name>' to specify a bucket.%r,[setq(0,u(%va/FN_FIND-BUCKET,%0))][ifelse(isdbref(%q0),[ulocal(FN_BARGRAPH,map(MAP_ACTIONS,get(%q0/LIST_STATS)),15,1,16,#)]%r[space(4)][setq(1,map(MAP_ACTIONS2,sort(get(%q0/LIST_STATS))))][iter(%q1,mid(##,0,1))]%r[space(4)][iter(%q1,mid(##,1,1))]%r[space(4)][iter(%q1,mid(##,2,1))]%r%r[center(Number of Actions Performed on Bucket [name(%q0)],u(%va/FN_FLEXWIDTH,79))],That is not a valid bucket name. See '+buckets' for a list of valid buckets.)])]
&REPORT_BUCKETS [v(JOB_VA)]=[u(FN_BARGRAPH,iter(sortby(SORTBY_NAME,lcon(%vc)),words(remove(children(##),#-1))),15,2,16,#)]%r[space(4)][iter(sortby(SORTBY_NAME,lcon(%vc)),mid([name(##)]%b,0,2))]%r%r[center(# of Jobs in Buckets,u(%va/FN_FLEXWIDTH,79))]
&REPORT_CLOSURE [v(JOB_VA)]=[setq(0,iter(APR DNY COM DEL,grab(get(%va/LIST_STATS),##|*)))][u(%va/FN_EASYPIE,10,ulocal(%va/FN_ASSEMBLEPIE,map(MAP_ACTIONS,%q0),iter(map(MAP_ACTIONS2,%q0),case(##,APR,Approved,DNY,Denied,COM,Completed,Deleted))),|,16,45)]
&REPORT_CODES [v(JOB_VA)]=[center(List of Action Codes:,u(%va/FN_FLEXWIDTH,79))]%r%r[setq(0,sort(get(%va/LIST_ACTIONS),b,|,|))][table(map(%va/MAP_INDENT2,%q0,|,|),25,u(%va/FN_FLEXWIDTH,78),|)]%r
&REPORT_ESC [v(JOB_VA)]=[setq(z,[iter(lnum(1,3),setq(##,0))][map(%va/MAP_STAT_ESC,lcon(%va))])][u(FN_EASYPIE,10,@Gg:%q1:Green|#Yy:%q2:Yellow|.Rr:%q3:Red,|,16,45)]%r%r[center(Job Escalation Colors,u(%va/FN_FLEXWIDTH,79))]%r
&REPORT_JACT [v(JOB_VA)]=[switch(%0,,This report requires you to supply a job.%r%rUse: +jobs/reports JACT=<#>%r,[setq(0,u(%va/FN_FIND-JOB,%0))][ifelse(isdbref(%q0),[ifelse(u(%va/FN_HASATTR,%q0,LIST_STATS),[ulocal(FN_BARGRAPH,map(MAP_ACTIONS,get(%q0/LIST_STATS)),15,1,16,#)]%r[space(4)][setq(1,map(MAP_ACTIONS2,sort(get(%q0/LIST_STATS))))][iter(%q1,mid(##,0,1))]%r[space(4)][iter(%q1,mid(##,1,1))]%r[space(4)][iter(%q1,mid(##,2,1))],No actions recorded for this job.)]%r%r[center(Actions Performed on [name(%q0)],u(%va/FN_FLEXWIDTH,79))],That is not a valid job.%r)])]
&REPORT_STATS [v(JOB_VA)]=[rjust(ansi(hc,Install:),20)]%b[get(%va/INSTALL_DATE)]%r[rjust(ansi(hc,Version:),20)]%bAnomaly Jobs [get(%va/VERSION)][space(5)]%r[rjust(ansi(hc,Release:),20)]%b[get(%va/RELEASE)]%r[rjust(ansi(hc,Memory:),20)]%b[setr(a,fold(%va/FOLD_ADD,iter(setr(b,[num(me)] [loc(me)] %vb %vc [lcon(%vc)] [lcon(me)]),objmem(##))))]%b%([round(fdiv(%qa,1024),1)]k in [words(%qb)] objects%)%r[rjust(ansi(hc,Open Jobs:),20)]%b[setr(0,words(remove(lcon(%va),#-1)))]%r[rjust(ansi(hc,Capacity:),20)]%b[setr(1,u(%va/MAX_JOBS))]%b%([mul(round(fdiv(%q0,%q1),2),100)]%% Full%)%r[rjust(ansi(hc,Next Job:),20)]%b[inc(u(%va/JOBS_NUM))]%r[rjust(ansi(hc,Buckets:),20)]%b[words(lcon(%vc))]%r[rjust(ansi(hc,Opened:),20)]%b[last(grab(get(%va/LIST_STATS),CRE|*),|)][setq(x,iter(APR DNY COM DEL,grab(get(%va/LIST_STATS),##|*)))][setq(y,map(%va/MAP_ACTIONS,%qx))]%r[rjust(ansi(hc,Closed:),20)]%b[fold(%va/FOLD_ADD,%qy,0)]%r[rjust(ansi(hc,Actions To Date:),20)]%b[fold(FOLD_ADD,map(MAP_ACTIONS,v(LIST_STATS)),0)]%r[rjust(ansi(hc,ART:),20)]%b[u(%va/FN_ART,%vc)][space(10)] ART=Average Resolution Time%r[rjust(ansi(hc,REQ ART:),20)]%b[u(%va/FN_ART,locate(%vc,REQ,i))][space(18)]DD:HH:MM:SS%r[rjust(ansi(hc,CODE ART:),20)]%b[u(%va/FN_ART,locate(%vc,CODE,i))]%r[rjust(ansi(hc,TPS ART:),20)]%b[u(%va/FN_ART,locate(%vc,TPS,i))]%r[rjust(ansi(hc,BUILD ART:),20)]%b[u(%va/FN_ART,locate(%vc,BUILD,i))]%r
&REPORT_STATUS [v(JOB_VA)]=[setq(x,[iter(lnum(10),setq(##,0))][map(%va/MAP_STAT_STATUS,lcon(%va))])][u(FN_EASYPIE,12,XRr:%q7:Overdue|-Bb:%q0:Hold|xGg:%q1:New|+Cc:%q2:Begun|*Ww:%q3:1/4|oYy:%q4:1/2|@Mm:%q5:3/4|/Xh:%q6:Done,|,10,45)]
&RTITLE_ACTBY [v(JOB_VA)]=BAR|Graph of one action across all buckets
&RTITLE_ACTIONS [v(JOB_VA)]=BAR|System-wide Actions
&RTITLE_ARTS [v(JOB_VA)]=STATS|Average Resolution Times by Bucket
&RTITLE_ARTSGRAPH [v(JOB_VA)]=BAR|Average Resolution Times Graph
&RTITLE_BACT [v(JOB_VA)]=BAR|All actions on a specified bucket
&RTITLE_BUCKETS [v(JOB_VA)]=BAR|Job Dispersal Among Buckets
&RTITLE_CLOSURE [v(JOB_VA)]=PIE|Job Closure Patterns
&RTITLE_CODES [v(JOB_VA)]=STATS|A list of system-generated action codes
&RTITLE_ESC [v(JOB_VA)]=PIE|Job Escalation Status
&RTITLE_JACT [v(JOB_VA)]=BAR|Actions performed on a job
&RTITLE_STATS [v(JOB_VA)]=STATS|General System Stats
&RTITLE_STATUS [v(JOB_VA)]=PIE|Job Status Settings
&SEL_ALL [v(JOB_VA)]=1
&SEL_NEW [v(JOB_VA)]=u(%va/FIL_NEW[default(%#/JOBSN,0)],%0)
&SEL_OVERDUE [v(JOB_VA)]=u(%va/FIL_OVERDUE,%0)
&SEL_MINE [v(JOB_VA)]=u(%va/FIL_MINE,%0)
&SEL_WHO [v(JOB_VA)]=u(%va/FIL_WHO,%0,switch(%qa,none,,pmatch(%qa)))
&SEL_SOURCE [v(JOB_VA)]=u(%va/FIL_SOURCE,%0,switch(%qa,none,,pmatch(%qa)))
&SEL_PRI [v(JOB_VA)]=u(%va/SEL_ESC,%0)
&SEL_ESC [v(JOB_VA)]=u(%va/FIL_ESC,%0,match(green yellow red,%qa*))
&SEL_STATUS [v(JOB_VA)]=u(%va/FIL_STATUS,%0,dec(match(HOLD NEW UNDERWAY 25 50 75 100,%qa*)))
&SEL_BUCKET [v(JOB_VA)]=u(%va/FIL_BUCKET,%0,u(%va/FN_FIND-BUCKET,%qa))
&SEL_SEARCH [v(JOB_VA)]=u(%va/FIL_SEARCH,%0,%qa)
&SEL_VIEWING [v(JOB_VA)]=u(%va/SEL_MONITOR,%0)
&SEL_MONITOR [v(JOB_VA)]=u(%va/FN_MONITORCHECK,parent(%0),%#)
&SEL_HIDDEN [v(JOB_VA)]=u(%va/IS_HIDDEN,parent(%0))
&SEL_LOCKED [v(JOB_VA)]=u(%va/IS_LOCKED,%0)
&SEL_TAGGED [v(JOB_VA)]=u(%va/IS_TAGGED,%0)
&SEL_MYJOBS [v(JOB_VA)]=u(%va/SEL_PUBLIC,%0)
&SEL_PUBLIC [v(JOB_VA)]=u(%va/IS_PUBLIC,parent(%0))
&SEL_PUBLISHED [v(JOB_VA)]=u(%va/IS_PUBLISHED,%0)
&SEL_SUMMARY [v(JOB_VA)]=u(%va/IS_SUMMARY,parent(%0))
&SEL_DUE> [v(JOB_VA)]=u(%va/FIL_DUEAFTER,%0,u(FN_DATECONV,%qa))
&SEL_DUE< [v(JOB_VA)]=not(u(%va/FIL_DUEAFTER,%0,u(FN_DATECONV,%qa)))
&SORTBY_COMMENTS [v(JOB_VA)]=sub(after(%0,_),after(%1,_))
&SORTBY_DATE [v(JOB_VA)]=comp(get(%0/MODIFIED_ON),get(%1/MODIFIED_ON))
&SORTBY_JOB [v(JOB_VA)]=sort(%0,n)
&SORTBY_JOBNUM [v(JOB_VA)]=sub(last(name(%0)),last(name(%1)))
&SORTBY_NAME [v(JOB_VA)]=comp(name(%0),name(%1))
&SORTBY_OLDEST [v(JOB_VA)]=comp(rjust(get(%0/MODIFIED_ON),20,0),rjust(get(%1/MODIFIED_ON),20,0))
&SORTBY_PRI [v(JOB_VA)]=comp(get(%0/PRIORITY),get(%1/PRIORITY))
&SORTBY_SORT [v(JOB_VA)]=comp(name(parent(%0)),name(parent(%1)))
&TRIG_ADD [v(JOB_VA)]=think [setq(0,default(%0/NUM_COMMENT,1))][setq(1,last(grab(get(%0/LIST_READERS),%2|*),|))][ifelse(eq(dec(%q0),%q1),set(%0,LIST_READERS:[setunion(remove(get(%0/LIST_READERS),%2|%q1),%2|%q0)]),)][ulocal(FN_ADDSTAT,%3,%va)][ulocal(FN_ADDSTAT,%3,%0)][ulocal(FN_ADDSTAT,%3,parent(%0))];&COMMENT_%q0 %0=%3|[secs()]|%2|[name(%2)]|[ifelse(u(%va/FN_HASATTRP,%0,ALETTER_%3),u(%va/FN_STRTRUNC,u(%0/ALETTER_%3,%0,%2,edit(%1,|,@@PIPE@@)),get(%va/BUFFER)),u(%va/FN_STRTRUNC,edit(%1,|,@@PIPE@@),get(%va/BUFFER)))];&NUM_COMMENT %0=[inc(%q0)];&MODIFIED_ON %0=[secs()];&MODIFIED_BY %0=%2;@trigger parent(%0)/HOOK_%3=%0,%2,[parent(%0)];@trigger %va/TRIG_POST=%0,%3,%2,%1;@trigger %va/TRIG_MAIL=%0,%3,%2,%1
&TRIG_APPLY [v(JOB_VA)]=@trigger %va/TRIG_CREATE=%0,[locate(%vc,APPS,i)],2,Application by [name(%0)],
&TRIG_BROADCAST [v(JOB_VA)]=@switch isdbref(%1)=1,{@pemit/list [setq(0,parent(%0))][setq(0,ifelse(isdbref(%q0),%q0,%vc))][filter(%va/FIL_BROADCAST,setunion(lwho(),))]=[ansi(hc,JOBS:)]%b[u(%q0/BLETTER_%2,%0,%1,%3,%4)]},{@pemit/list [setq(0,%0)][filter(%va/FIL_BROADCAST,setunion(lwho(),))]=[ansi(hc,JOBS:)]%b%1}
&TRIG_CLEAN [v(JOB_VA)]=@dolist [lcon(%va)] [lcon(%vb)]={@switch [u(FN_CLEANFIND,##,OPENED_BY)][u(FN_CLEANFIND,##,ASSIGNED_TO)][u(FN_CLEANFIND,##,TAGGED_FOR)][u(FN_CLEANFIND,##,PLAYERS)][u(FN_CLEANFIND,##,WRITER)][u(FN_CLEANFIND,##,MEMBERLIST)]=1?????,{&OPENED_BY ##=U(FN_CLEANFIX,##,OPENED_BY)},?1????,{&ASSIGNED_TO ##=U(FN_CLEANFIX,##,ASSIGNED_TO)},??1???,{&TAGGED_FOR ##=U(FN_CLEANFIX,##,TAGGED_FOR)},???1??,{&PLAYERS ##=U(FN_CLEANFIX,##,PLAYERS)},????1?,{&WRITER ##=U(FN_CLEANFIX,##,WRITER)},?????1,{&MEMBERLIST ##=U(FN_CLEANFIX,##,MEMBERLIST)}};
&TRIG_CREATE [v(JOB_VA)]=@switch gt(words(lcon(%va)),u(%va/MAX_JOBS))=1,{@pemit %0=[ansi(hr,JOBS ERROR:)] Creation failed. The +jobs system is full. Contact staff immediately.;@trigger %va/TRIG_BROADCAST=%1,JOBS SYSTEM IS FULL! Please complete jobs or boost your MAX_JOBS configuration.},{think [setq(0,inc(u(%va/JOBS_NUM)))][setq(1,create(Job %q0,10))][setq(y,case(%7,1,CRE,OTH))];@tel %q1=%va;@link %q1=%va;&OPENED_BY %q1=[switch(%5,,%0,%5)];&OPENED_ON %q1=[secs()];&MODIFIED_ON %q1=[secs()];&STATUS %q1=1;&TITLE %q1=%3;@parent %q1=[locate(%vc,%1,i)];&NUM_COMMENT %q1=2;&PRIORITY %q1=%2;&COMMENT_1 %q1=CRE|[secs()]|%0|[name(%0)]|[ifelse(u(%va/FN_HASATTRP,%q0,ALETTER_%qy),u(%va/FN_STRTRUNC,u(%q0/ALETTER_%qy,%q1,%0,edit(%4,|,@@PIPE@@)),get(%va/BUFFER)),u(%va/FN_STRTRUNC,edit(%4,|,@@PIPE@@),get(%va/BUFFER)))];&LIST_READERS %q1=%0|1;&ASSIGNED_TO %q1=%6;&JOBS_NUM %va=%q0;&DUE_ON %q1=[ifelse(u(%va/FN_HASATTRP,%q1,TURNAROUND),add(secs(),mul(60,60,get(%q1/TURNAROUND))),)];@trigger %va/TRIG_BROADCAST=%q1,%0,%qy,%3;@trigger %1/HOOK_%qy=%q1,%0,%1;@trigger %va/TRIG_POST=%q1,%qy,%0,%4;@trigger %va/TRIG_MAIL=%q1,%qy,%0,%4;think [ulocal(FN_ADDSTAT,CRE,%va)][ulocal(FN_ADDSTAT,CRE,parent(%q1))]}
&TRIG_DESTROY [v(JOB_VA)]=&going %0=1;@wait 60={@switch get(%0/GOING)=1,{@switch first(version())=PennMUSH,{@parent %0;@nuke %0;@wait 0=@nuke %0},{@parent %0;@dest/instant %0}}}
&TRIG_LOG [v(JOB_VA)]=@switch [setq(0,%0)][setq(1,parent(%q0))][setq(x,u(%va/FN_ITEMIZE,map(MAP_NAME,get(%q0/OPENED_BY),%b,|),|))][and(u(%va/FN_HASATTRP,%va,JOB_LOGGING),u(%va/FN_HASATTRP,%q1,LOGFILE))]=0,{@@},{@trigger %va/TRIG_LOG_WRITE=[u(%q1/LOGFILE)],[center(| [name(%q0)] |,79,=)];@trigger %va/TRIG_LOG_WRITE=[u(%q1/LOGFILE)],[ljust([rjust(ansi(hc,Bucket:),10)]%b[u(FN_BUCKETNAME,%q0)],40)][rjust(ansi(hc,Due On:),12)]%b[ifelse(get(%q0/DUE_ON),ifelse(gt(secs(),get(%q0/DUE_ON)),OVERDUE!,convsecs(get(%q0/DUE_ON))),-)];@trigger %va/TRIG_LOG_WRITE=[u(%q1/LOGFILE)],[ljust([rjust(ansi(hc,Title:),10)]%b[get(%q0/TITLE)],40)][rjust(ansi(hc,Assigned To:),12)]%b[ifelse(isdbref(get(%q0/ASSIGNED_TO)),name(get(%q0/ASSIGNED_TO)),Nobody)];@trigger %va/TRIG_LOG_WRITE=[u(%q1/LOGFILE)],[ljust([rjust(ansi(hc,Opened On:),10)]%b[convsecs(get(%q0/OPENED_ON))],40)][rjust(ansi(hc,Status:),12)]%b[switch(get(%q0/PRIORITY),1,Green,2,Yellow,3,Red)]%b%([switch(get(%q0/STATUS),0,On Hold,1,New,2,Underway,3,25%%,4,50%%,5,75%%,6,100%%,?)]%);@trigger %va/TRIG_LOG_WRITE=[u(%q1/LOGFILE)],[rjust(ansi(hc,Opened By:),10)] %qx;@dolist sortby(%va/SORTBY_COMMENTS,lattr(%q0/COMMENT_*))={@trigger %va/TRIG_LOG_WRITE=[u(%q1/LOGFILE)],[repeat(-,79)];@trigger %va/TRIG_LOG_WRITE=[u(%q1/LOGFILE)],[extract(get(%q0/##),4,1,|)]%badded on%b[convsecs(extract(get(%q0/##),2,1,|))]:%b[edit(last(get(%q0/##),|),@@PIPE@@,|)]};@wait 1={@trigger %va/TRIG_LOG_WRITE=[u(%q1/LOGFILE)],[repeat(=,79)]}}
&TRIG_LOG_WRITE [v(JOB_VA)]=@switch [first(version())]=RhostMUSH,{@log/file %0=%1},PennMUSH,{@log/cmd %1},{@log %0=%1}
&TRIG_MAIL [v(JOB_VA)]=@switch [u(%va/FN_HASATTRP,%0,MLETTER_%1)]=1,{@wait 1={@trigger %vb/TRIG_MAIL=[switch(%1,MAI,[get(%0/OPENED_BY)],APR,[get(%0/OPENED_BY)],DNY,[get(%0/OPENED_BY)],filter(%va/FIL_NOSPAM,setunion(get(%0/OPENED_BY),)))],[switch(%1,APR,Approved:,DEL,Deleted:,DNY,Denied:,COM,Complete:,[name(%0)]:)]%b[get(%0/TITLE)],[u(parent(%0)/MLETTER_%1,%0,%1,%2,%3)]};}
&TRIG_POST [v(JOB_VA)]=@switch [u(%va/FN_HASATTRP,%0,PLETTER_%1)]=1,{@wait 1={@trigger %vb/TRIG_POST=[get(%0/POST_[case(%1,APR,APPROVE,DEL,DELETE,DNY,DENY,COM,COMPLETE,APPROVE)])],[switch(%1,APR,A:,DNY,D:,COM,C:,[name(%0)]:)]%b[get(%0/TITLE)],[u(parent(%0)/PLETTER_%1,%0,%1,%2,%3)]};}
@dolist VA VB VC={@cpattr %#/JOB_##=[v(JOB_VA)]/##}
think [ansi(hc,ANOMALY JOBS:)] Installing skins.
&DEFAULT_SKIN [v(JOB_VA)]=1
&DEFAULT_BANNER [v(JOB_VA)]=[setq(0,%0)][setq(x,u(%va/FN_ITEMIZE,map(MAP_NAME,get(%q0/OPENED_BY),%b,|),|))][setq(y,u(%va/FN_ITEMIZE,map(MAP_NAME,get(%q0/TAGGED_FOR),%b,|),|))][ljust([rjust(ansi(hc,Bucket:),10)]%b[u(%va/FN_BUCKETNAME,%q0)],div(u(FN_FLEXWIDTH,80),2))][rjust(ansi(hc,Due On:),12)]%b[ifelse(get(%q0/DUE_ON),ifelse(gt(secs(),get(%q0/DUE_ON)),OVERDUE!,convsecs(get(%q0/DUE_ON))),-)]%r[ljust([rjust(ansi(hc,Title:),10)]%b[get(%q0/TITLE)],div(u(FN_FLEXWIDTH,80),2))][rjust(ansi(hc,Status:),12)]%b[switch(get(%q0/PRIORITY),1,Green,2,Yellow,3,Red)]%b%([switch(get(%q0/STATUS),0,On Hold,1,New,2,Underway,3,25%%,4,50%%,5,75%%,6,100%%,?)]%)%r[ljust([rjust(ansi(hc,Opened On:),10)] [convsecs(get(%q0/OPENED_ON))],div(u(FN_FLEXWIDTH,80),2))][rjust(ansi(hc,Assigned To:),12)]%b[ifelse(isdbref(get(%q0/ASSIGNED_TO)),name(get(%q0/ASSIGNED_TO)),Nobody)]%r[rjust(ansi(hc,Opened By:),10)]%b%qx[ifelse(words(%qy),%r[rjust(ansi(hc,Tagged:),10)]%b%qy,)]
&DEFAULT_BREAK [v(JOB_VA)]=switch(%0,,repeat(-,u(FN_FLEXWIDTH,79)),rjust(%[%0%],u(FN_FLEXWIDTH,79),-))
&DEFAULT_BUCKETHEADER [v(JOB_VA)]=[u(FN_HEADER,Bucket List)]%r[ifelse(u(%va/FN_WIZONLY,%#),[ansi(hc,[ljust(Name,9)][ljust(Flags,6)]%b%b[ljust(Description,u(FN_FLEXWIDTH,30))][rjust(#Jobs,5)][rjust(Pct,5)][space(3)]C%b%bA%b%bD%b%bDue[space(3)]ARTS)],[ansi(hc,[ljust(NAME,8)][ljust(Description,u(FN_FLEXWIDTH,50))]%b[rjust(Viewing,20)])])]%r[u(FN_BREAK)]
&DEFAULT_BUCKETLIST [v(JOB_VA)]=[ifelse(u(%va/FN_WIZONLY,%#),[ljust(name(%0),6)]%b%b[ifelse(u(%va/FN_MONITORCHECK,%0,%#),V,-)][ifelse(u(%va/IS_HIDDEN,%0),H,-)][ifelse(u(%va/IS_LOCKED,%0),ifelse(u(%va/FN_HASATTRP,%0,CHECKOUT),C,L),-)][ifelse(u(%va/IS_TAGGED,%0),T,-)][ifelse(u(%va/IS_PUBLIC,%0),M,-)][ifelse(u(%va/IS_PUBLISHED,%0),P,-)][ifelse(u(%va/IS_SUMMARY,%0),S,-)]%b%b[u(%va/FN_STREXACT,get(%0/DESC),u(FN_FLEXWIDTH,30))][rjust(words(remove(children(%0),#-1)),5)][rjust(mul(round(fdiv(words(remove(children(%0),#-1)),max(1,words(lcon(%va)))),2),100)%%,5)]%b%b[rjust(u(%va/FN_FIND-BBNUM,get(%0/POST_COMPLETE)),2)]%b[rjust(u(%va/FN_FIND-BBNUM,get(%0/POST_APPROVE)),2)]%b[rjust(u(%va/FN_FIND-BBNUM,get(%0/POST_DENY)),2)][rjust(default(%0/TURNAROUND,0),5)][rjust([ifelse(u(%va/FN_HASATTR,%0,STAT_ART),[round(fdiv(fdiv(first(get(%0/STAT_ART)),rest(get(%0/STAT_ART))),86400),0)]d,-)],7)],[ljust(name(%0),6)]%b%b[u(%va/FN_STREXACT,get(%0/DESC),u(FN_FLEXWIDTH,50))]%b[rjust(ifelse(u(%va/FN_MONITORCHECK,%0,%#),Yes,-),20)])]
&DEFAULT_FLAGS [v(JOB_VA)]=[ifelse(u(me/IS_LOCKED,%0),u(me/FN_FLAG,ifelse(u(%va/FN_HASATTRP,%0,CHECKOUT),CHECKED OUT,LOCKED),hr),)][ifelse(u(me/IS_PUBLIC,%0),u(me/FN_FLAG,Myjobs),)][ifelse(u(me/IS_PUBLISHED,%0),u(me/FN_FLAG,Published),)]
&DEFAULT_FOOTER [v(JOB_VA)]=[switch(%0,,repeat(=,u(FN_FLEXWIDTH,79)),center(| %0 |,u(FN_FLEXWIDTH,79),=))]
&DEFAULT_HEADER [v(JOB_VA)]=[switch(%0,,[repeat(=,u(FN_FLEXWIDTH,79))],[center(| [ansi(hy,%0)] |,u(FN_FLEXWIDTH,79),=)])]
&DEFAULT_JOBLIST [v(JOB_VA)]=[setq(j,secure(ifelse(u(%va/FN_HASATTRP,%1,JOBS),lcstr(mid(get(%1/JOBS),0,20)),get(%va/JOBS_DEFAULT))))][setq(1,ifelse(get(%0/DUE_ON),ifelse(gt(secs(),get(%0/DUE_ON)),r,switch(get(%0/PRIORITY),1,g,2,y,3,r,g)),switch(get(%0/PRIORITY),1,g,2,y,3,r)))][ifelse(u(%va/FN_ISNEW,%0,%1),[ansi(hr,*)]%b,%b%b)][ansi(h%q1,[rjust([last(name(%0))],5)]%b[iter(lnum(strlen(%qj)),[u(%va/DISPLAY_[mid(%qj,##,1)],%0,%1)])])]
&DEFAULT_JOBSHEADER [v(JOB_VA)]=[u(FN_HEADER,Anomaly Jobs [u(VERSION)])]%r[setq(j,[secure(switch(u(%va/FN_HASATTRP,%0,JOBS),1,lcstr(mid(get(%0/JOBS),0,20)),u(JOBS_DEFAULT)))])][ansi(hc,*%b%b[ljust(Job#,5)][iter(lnum(strlen(%qj)),u(HEADER_[mid(%qj,##,1)]))])]%r[u(FN_BREAK)]
&DEFAULT_MYJOBLIST [v(JOB_VA)]=[ifelse(u(FN_ISNEW,%0,%1),[ansi(hr,*)],%b)]%b[setq(j,TDAS)][ansi(n,[rjust([last(name(%0))],5)]%b[iter(lnum(strlen(%qj)),u(DISPLAY_[mid(%qj,##,1)],%0,%1))])]
&DEFAULT_MYJOBSHEADER [v(JOB_VA)]=[u(FN_HEADER,Anomaly Jobs [u(VERSION)])]%r[setq(j,TDAS)][ansi(ch,ljust(*%b%b[ljust(Job#,5)][iter(lnum(strlen(%qj)),u(HEADER_[mid(%qj,##,1)]))],[u(FN_FLEXWIDTH,79)]))]%r[u(FN_BREAK)]
&DEFAULT_MYBANNER [v(JOB_VA)]=[setq(0,%0)][setq(x,u(%va/FN_ITEMIZE,map(MAP_NAME,get(%q0/OPENED_BY),%b,|),|))][ljust([rjust(ansi(hc,Bucket:),10)]%b[u(%va/FN_BUCKETNAME,%q0)],div(u(FN_FLEXWIDTH,80),2))][rjust(ansi(hc,Due On:),12)]%b[ifelse(get(%q0/DUE_ON),ifelse(gt(secs(),get(%q0/DUE_ON)),OVERDUE!,convsecs(get(%q0/DUE_ON))),-)]%r[ljust([rjust(ansi(hc,Title:),10)]%b[get(%q0/TITLE)],div(u(FN_FLEXWIDTH,80),2))][rjust(ansi(hc,Assigned To:),12)]%b[ifelse(isdbref(get(%q0/ASSIGNED_TO)),name(get(%q0/ASSIGNED_TO)),Nobody)]%r[ljust([rjust(ansi(hc,Opened On:),10)]%b[convsecs(get(%q0/OPENED_ON))],div(u(FN_FLEXWIDTH,80),2))][rjust(ansi(hc,Status:),12)]%b[switch(get(%q0/PRIORITY),1,Green,2,Yellow,3,Red)]%b%r[rjust(ansi(hc,Opened By:),10)]%b%qx
&DEFAULT_MYSUMMARY [v(JOB_VA)]=%r[u(FN_BREAK,MySummary)]%r[u(parent(%0)/MYSUMMARY,%0)]
&DEFAULT_READ [v(JOB_VA)]=[repeat(-,u(FN_FLEXWIDTH,79))]%r[ifelse(u(%va/EDIT_ACCESS,%#),[ansi(h,%[)][ifelse(and(or(u(%va/IS_PUBLISHED,%1),switch(extract(get(%1/%0),3,1,|),u(%1/OPENED_BY),1,0),hasflag(%1/%0,no_inherit)),u(%va/IS_PUBLIC,%1)),ansi(hc,[rest(%0,_)]+),ansi(hc,[rest(%0,_)]-))][ansi(h,%])]%b,)][ansi(h,[extract(get(%1/%0),4,1,|)]%badded on%b[convsecs(extract(get(%1/%0),2,1,|))]:%b )][edit(last(get(%1/%0),|),@@PIPE@@,|)]
&DEFAULT_STAFFSUM [v(JOB_VA)]=%r[repeat(-,u(FN_FLEXWIDTH,79))]%r[rjust(ansi(hc,DB#:),10)] %0[space(10)][rjust(ansi(hc,Comments:),10)] [setr(z,words(lattr(%0/COMMENT_*)))]%r%r[rjust(ansi(hc,Players:),10)] %(Players contributing to this job%)%r[setq(y,setunion(iter(lattr(%0/COMMENT_*),extract(get(%0/##),4,1,|),%b,|),,|))][u(%va/fn_columns,%qy,20,|,11)][ifelse(u(%va/FN_HASATTR,%0,LIST_READERS),%r[rjust(ansi(hc,Readers:),10)]%b%(Players who have read this job in the past%)%r[setq(z,iter(get(%0/LIST_READERS),first(##,|)))][u(%va/fn_columns,map(%va/MAP_NAME,%qz,%b,|),20,|,11)],)]%r[rjust(ansi(hc,Stats:),10)]%r[u(%va/fn_columns,iter(ifelse(u(%va/FN_HASATTR,%0,LIST_STATS),sort(get(%0/LIST_STATS)),),[first(##,|)]%b[last(##,|)],%b,|),20,|,11)]%r
&DEFAULT_SUMMARY [v(JOB_VA)]=%r[repeat(-,u(FN_FLEXWIDTH,79))]%r[u(parent(%0)/SUMMARY,%0)]
&CHROME_SKIN [v(JOB_VA)]=1
&CHROME_BANNER [v(JOB_VA)]=%r[setq(0,%0)][setq(x,u(%va/FN_ITEMIZE,map(MAP_NAME,get(%q0/OPENED_BY),%b,|),|))][setq(y,u(%va/FN_ITEMIZE,map(MAP_NAME,get(%q0/TAGGED_FOR),%b,|),|))][ljust([rjust(ansi(hc,Bucket:),10)]%b[u(%va/FN_BUCKETNAME,%q0)],div(u(FN_FLEXWIDTH,80),2))][rjust(ansi(hc,Due On:),12)]%b[ifelse(get(%q0/DUE_ON),ifelse(gt(secs(),get(%q0/DUE_ON)),OVERDUE!,convsecs(get(%q0/DUE_ON))),-)]%r[ljust([rjust(ansi(hc,Title:),10)]%b[get(%q0/TITLE)],div(u(FN_FLEXWIDTH,80),2))][rjust(ansi(hc,Status:),12)]%b[switch(get(%q0/PRIORITY),1,Green,2,Yellow,3,Red)]%b%([switch(get(%q0/STATUS),0,On Hold,1,New,2,Underway,3,25%%,4,50%%,5,75%%,6,100%%,?)]%)%r[ljust([rjust(ansi(hc,Opened On:),10)]%b[convsecs(get(%q0/OPENED_ON))],div(u(FN_FLEXWIDTH,80),2))][rjust(ansi(hc,Assigned To:),12)]%b[ifelse(isdbref(get(%q0/ASSIGNED_TO)),name(get(%q0/ASSIGNED_TO)),Nobody)]%r[rjust(ansi(hc,Opened By:),10)]%b%qx[ifelse(words(%qy),%r[rjust(ansi(hc,Tagged:),10)]%b%qy,)]
&CHROME_BREAK [v(JOB_VA)]=rjust(ifelse(%0,%[%0%]),u(FN_FLEXWIDTH,79),_)
&CHROME_FLAGS [v(JOB_VA)]=[edit(u(%va/fn_trim,squish([ifelse(u(me/IS_LOCKED,%0),%b[ansi(hr,ifelse(u(%va/FN_HASATTRP,%0,CHECKOUT),CHECKED_OUT,LOCKED))]%b,)][ifelse(u(me/IS_PUBLIC,%0),%bMYJOBS%b,)][ifelse(u(me/IS_PUBLISHED,%0),%bPUBLISHED%b,)])),%b,%b-%b)]
&CHROME_FOOTER [v(JOB_VA)]=%r[switch(%0,,[repeat(~,u(FN_FLEXWIDTH,79))],[repeat(~,sub(u(FN_FLEXWIDTH,73),strlen(%0)))]|[ansi(Chw,%b[stripansi(%0)]%b)]|~~)]
&CHROME_HEADER [v(JOB_VA)]=[switch(%0,,[repeat(_,u(FN_FLEXWIDTH,79))],__|[ansi(Chw,%b%0%b)]|[repeat(_,sub(u(FN_FLEXWIDTH,73),strlen(%0)))])]
&CHROME_JOBLIST [v(JOB_VA)]=[setq(j,secure(ifelse(u(%va/FN_HASATTRP,%1,JOBS),lcstr(mid(get(%1/JOBS),0,20)),get(%va/JOBS_DEFAULT))))][setq(1,ifelse(get(%0/DUE_ON),ifelse(gt(secs(),get(%0/DUE_ON)),h,switch(get(%0/PRIORITY),1,hx,2,n,3,h,hx)),switch(get(%0/PRIORITY),1,hx,2,n,3,h)))][ifelse(u(%va/FN_ISNEW,%0,%1),[ansi(hr,*)]%b,%b%b)][ansi(h%q1,[rjust([last(name(%0))],5)]%b[iter(lnum(strlen(%qj)),[u(%va/DISPLAY_[mid(%qj,##,1)],%0,%1)])])]
&CHROME_JOBSHEADER [v(JOB_VA)]=[u(FN_HEADER,Anomaly Jobs [u(VERSION)])]%r[setq(j,[secure(switch(u(%va/FN_HASATTRP,%0,JOBS),1,lcstr(mid(get(%0/JOBS),0,20)),u(JOBS_DEFAULT)))])][setq(2,*%b%b[ljust(Job#,5)][iter(lnum(strlen(%qj)),u(HEADER_[mid(%qj,##,1)]))])][ansi(Chcu,ljust(%q2,u(FN_FLEXWIDTH,79)))]%r
&CHROME_MYJOBSHEADER [v(JOB_VA)]=[u(FN_HEADER,Anomaly Jobs [u(VERSION)])]%r[setq(j,TDAS)][ansi(Chcu,ljust(*%b%b[ljust(Job#,5)][iter(lnum(strlen(%qj)),u(HEADER_[mid(%qj,##,1)]))],u(FN_FLEXWIDTH,79)))]%r
&CHROME_MYJOBLIST [v(JOB_VA)]=[ifelse(u(FN_ISNEW,%0,%1),[ansi(r,*)]%b,%b%b)]%b[setq(j,TDAS)][ansi(hx,[rjust([last(name(%0))],5)]%b[iter(lnum(strlen(%qj)),u(DISPLAY_[mid(%qj,##,1)],%0,%1))])]
&CHROME_READ [v(JOB_VA)]=%r[setq(0,[ifelse(u(%va/EDIT_ACCESS,%#),[ansi(Xhu,%b[rest(%0,_)]:%b)],[ansi(Xhu,%b)])]|[ansi(Xhc,%b[extract(get(%1/%0),4,1,|)])]%b|)]%q0[ansi(Xhu,repeat(%b,sub(25,strlen(%q0))))][ifelse(and(or(u(%va/IS_PUBLISHED,%1),switch(extract(get(%1/%0),3,1,|),u(%1/OPENED_BY),1,0),hasflag(%1/%0,no_inherit)),u(%va/IS_PUBLIC,%1)),[ansi(Xhu,repeat(%b,div(u(FN_FLEXWIDTH,14),2)))]|[ansi(Xc,%b+Published+%b)]|[ansi(Xhu,repeat(%b,div(u(FN_FLEXWIDTH,14),2)))],[ansi(Xhu,repeat(%b,u(FN_FLEXWIDTH,29)))])][ansi(Xhu,[convsecs(extract(get(%1/%0),2,1,|))]%b)]%r[space(4)][edit(last(get(%1/%0),|),@@PIPE@@,|)]
&CHROME_SUMMARY [v(JOB_VA)]=%r[repeat(_,u(FN_FLEXWIDTH,79))]%r[u(parent(%0)/SUMMARY,%0)]
&WHITEBG_SKIN [v(JOB_VA)]=1
&WHITEBG_JOBLIST [v(JOB_VA)]=[setq(j,secure(ifelse(u(%va/FN_HASATTRP,%1,JOBS),lcstr(mid(get(%1/JOBS),0,20)),get(%va/JOBS_DEFAULT))))][setq(1,ifelse(get(%0/DUE_ON),ifelse(gt(secs(),get(%0/DUE_ON)),r,switch(get(%0/PRIORITY),1,g,2,y,3,r,g)),switch(get(%0/PRIORITY),1,g,2,y,3,r)))][ifelse(u(%va/FN_ISNEW,%0,%1),[ansi(hr,*)]%b,%b%b)][ansi(%q1,[rjust([last(name(%0))],5)]%b[iter(lnum(strlen(%qj)),[u(%va/DISPLAY_[mid(%qj,##,1)],%0,%1)])])]
&WHITEBG_FLAGS [v(JOB_VA)]=[ifelse(u(me/IS_LOCKED,%0),%[[ansi(r,ifelse(u(%va/FN_HASATTRP,%0,CHECKOUT),CHECKED OUT,LOCKED))]%],)][ifelse(u(me/IS_PUBLIC,%0),%[Myjobs%],)][ifelse(u(me/IS_PUBLISHED,%0),%[Published%],)]
&WHITEBG_FOOTER [v(JOB_VA)]=[ansi(x,switch(%0,,repeat(=,u(FN_FLEXWIDTH,79)),center(| [stripansi(%0)] |,u(FN_FLEXWIDTH,79),=)))]
&WHITEBG_JOBSHEADER [v(JOB_VA)]=[u(FN_HEADER,Anomaly Jobs [u(VERSION)])]%r[setq(j,[secure(switch(u(%va/FN_HASATTRP,%0,JOBS),1,lcstr(mid(get(%0/JOBS),0,20)),u(JOBS_DEFAULT)))])][ansi(c,*%b%b[ljust(Job#,5)][iter(lnum(strlen(%qj)),u(HEADER_[mid(%qj,##,1)]))])]%r[u(FN_BREAK)]
&WHITEBG_MYJOBSHEADER [v(JOB_VA)]=[u(FN_HEADER,Anomaly Jobs [u(VERSION)])]%r[setq(j,TDAS)][ansi(c,ljust(%b*%b%b[ljust(Job#,5)][iter(lnum(strlen(%qj)),u(HEADER_[mid(%qj,##,1)]))],u(FN_FLEXWIDTH,79)))]%r[u(FN_BREAK)]
&WHITEBG_MYBANNER [v(JOB_VA)]=[setq(0,%0)][setq(x,u(%va/FN_ITEMIZE,map(MAP_NAME,get(%q0/OPENED_BY),%b,|),|))][ljust([rjust(ansi(c,Bucket:),10)]%b[u(%va/FN_BUCKETNAME,%q0)],div(u(FN_FLEXWIDTH,80),2))][rjust(ansi(c,Due On:),12)]%b[ifelse(get(%q0/DUE_ON),ifelse(gt(secs(),get(%q0/DUE_ON)),OVERDUE!,convsecs(get(%q0/DUE_ON))),-)]%r[ljust([rjust(ansi(c,Title:),10)]%b[get(%q0/TITLE)],div(u(FN_FLEXWIDTH,80),2))][rjust(ansi(c,Assigned To:),12)]%b[ifelse(isdbref(get(%q0/ASSIGNED_TO)),name(get(%q0/ASSIGNED_TO)),Nobody)]%r[ljust([rjust(ansi(c,Opened On:),10)]%b[convsecs(get(%q0/OPENED_ON))],div(u(FN_FLEXWIDTH,80),2))][rjust(ansi(c,Status:),12)]%b[switch(get(%q0/PRIORITY),1,Green,2,Yellow,3,Red)]%b%r[rjust(ansi(c,Opened By:),10)]%b%qx
&WHITEBG_HEADER [v(JOB_VA)]=[ansi(x,switch(%0,,[repeat(=,u(FN_FLEXWIDTH,79))],[center(| [stripansi(%0)] |,u(FN_FLEXWIDTH,79),=)]))]
&WHITEBG_READ [v(JOB_VA)]=[repeat(-,u(FN_FLEXWIDTH,79))]%r[ifelse(u(%va/EDIT_ACCESS,%#),[ansi(x,%[)][ifelse(and(or(u(%va/IS_PUBLISHED,%1),switch(extract(get(%1/%0),3,1,|),u(%1/OPENED_BY),1,0),hasflag(%1/%0,no_inherit)),u(%va/IS_PUBLIC,%1)),ansi(c,[rest(%0,_)]+),ansi(c,[rest(%0,_)]-))][ansi(x,%])]%b,)][ansi(x,[extract(get(%1/%0),4,1,|)] added on [convsecs(extract(get(%1/%0),2,1,|))]: %b)][edit(last(get(%1/%0),|),@@PIPE@@,|)]
&WHITEBG_BUCKETHEADER [v(JOB_VA)]=[u(FN_HEADER,Bucket List)]%r[ifelse(u(%va/FN_WIZONLY,%#),[ansi(c,[ljust(Name,9)][ljust(Flags,6)]%b%b[ljust(Description,u(FN_FLEXWIDTH,30))][rjust(#Jobs,5)][rjust(Pct,5)][space(3)]C%b%bA%b%bD%b%bDue[space(3)]ARTS)],[ansi(c,[ljust(NAME,8)][ljust(Description,u(FN_FLEXWIDTH,50))]%b[rjust(Viewing,20)])])]%r[u(FN_BREAK)]
&WHITEBG_STAFFSUM [v(JOB_VA)]=%r[repeat(-,u(FN_FLEXWIDTH,79))]%r[rjust(ansi(c,DB#:),10)] %0[space(10)][rjust(ansi(c,Comments:),10)] [setr(z,words(lattr(%0/COMMENT_*)))]%r%r[rjust(ansi(c,Players:),10)] %(Players contributing to this job%)%r[setq(y,setunion(iter(lattr(%0/COMMENT_*),extract(get(%0/##),4,1,|),%b,|),,|))][u(%va/fn_columns,%qy,20,|,11)][ifelse(u(%va/FN_HASATTR,%0,LIST_READERS),%r[rjust(ansi(c,Readers:),10)] %(Players who have read this job in the past%)%r[setq(z,iter(get(%0/LIST_READERS),first(##,|)))][u(%va/fn_columns,map(%va/MAP_NAME,%qz,%b,|),20,|,11)],)][rjust(ansi(c,Stats:),10)]%r[u(%va/fn_columns,iter(ifelse(u(%va/FN_HASATTR,%0,LIST_STATS),sort(get(%0/LIST_STATS)),),[first(##,|)] [last(##,|)],%b,|),20,|,11)]%r
&WHITEBG_BANNER [v(JOB_VA)]=[setq(0,%0)][setq(x,u(%va/FN_ITEMIZE,map(MAP_NAME,get(%q0/OPENED_BY),%b,|),|))][setq(y,u(%va/FN_ITEMIZE,map(MAP_NAME,get(%q0/TAGGED_FOR),%b,|),|))][ljust([rjust(ansi(c,Bucket:),10)] [u(%va/FN_BUCKETNAME,%q0)],div(u(FN_FLEXWIDTH,80),2))][rjust(ansi(c,Due On:),12)] [ifelse(get(%q0/DUE_ON),ifelse(gt(secs(),get(%q0/DUE_ON)),OVERDUE!,convsecs(get(%q0/DUE_ON))),-)]%r[ljust([rjust(ansi(c,Title:),10)] [get(%q0/TITLE)],div(u(FN_FLEXWIDTH,80),2))][rjust(ansi(c,Status:),12)] [switch(get(%q0/PRIORITY),1,Green,2,Yellow,3,Red)] %([switch(get(%q0/STATUS),0,On Hold,1,New,2,Underway,3,25%%,4,50%%,5,75%%,6,100%%,?)]%)%r[ljust([rjust(ansi(c,Opened On:),10)] [convsecs(get(%q0/OPENED_ON))],div(u(FN_FLEXWIDTH,80),2))][rjust(ansi(c,Assigned To:),12)] [ifelse(isdbref(get(%q0/ASSIGNED_TO)),name(get(%q0/ASSIGNED_TO)),Nobody)]%r[rjust(ansi(c,Opened By:),10)]%b%qx[ifelse(words(%qy),%r[rjust(ansi(c,Tagged:),10)]%b%qy,)]
&CREDITS [v(JOB_VA)]=Starfleet@Anomaly
&MAINTAINER [v(JOB_VA)]=Minion@Crossroads
&CONTRIBUTORS [v(JOB_VA)]=Firestorm@Ephemera, Grey@Anomaly, Ian@MUX, Minion@Crossroads
&LICENSE [v(JOB_VA)]=You may port this code to any game provided that these credits remain intact. Please report any and all bugs, feedback, etc. to the project's home: http://code.google.com/p/anomalyjobs/
&RELEASE [v(JOB_VA)]=March 1, 2010
&VERSION [v(JOB_VA)]=v6.0
&VERSION [v(JOB_VC)]=v6.0
@switch first(version())=RhostMUSH,{&TRIG_MAIL [v(JOB_VB)]=lit(mail [remove(%0,owner(me))]=%1//%2)},PennMUSH,{&TRIG_MAIL [v(JOB_VB)]=lit(@mail [remove(%0,owner(me))]=%1/%2)},{&TRIG_MAIL [v(JOB_VB)]=lit(@mail/quick [remove(%0,owner(me))]/%1=%2)}
&TRIG_POST [v(JOB_VB)]=+bbpost %0/%1=%2
think [ansi(hc,ANOMALY JOBS:)] Setting up master parent.
&daily [v(JOB_VC)]=@dolist lcon(me)={@switch [u(%va/FN_HASATTR,##,HOOK_AUT)]=1,{@trigger ##/HOOK_AUT=[u(%va/fn_trim,## [remove(children(##),#-1)],b)],[owner(%va)]}}
@switch first(version())=PennMUSH,{think [ansi(hc,ANOMALY JOBS:)] PennMUSH does not have @daily.%BAdd a daily trigger to [v(JOB_VC)]/DAILY to your CRON object.},RhostMUSH,{think [ansi(hc,ANOMALY JOBS:)] RhostMUSH does not have @daily.%BInstall an @daily emulator or add a daily trigger to [v(JOB_VC)]/DAILY to your CRON object.}
@switch [v(JOB_PATCH)]=0,{&ACCESS [v(JOB_VC)]=lit([u(%va/FN_STAFFALL,%#)]);&ACCESS_DESC [v(JOB_VC)]=lit([u(%va/FN_STAFFALL,%0)]);&ACCESS_HELP [v(JOB_VC)]=lit([u(%va/FN_STAFFALL,%0)]);&ACCESS_HIDDEN [v(JOB_VC)]=lit([u(%va/FN_WIZONLY,%0)]);&ACCESS_LOCKED [v(JOB_VC)]=lit([u(%va/FN_WIZONLY,%0)]);&ACCESS_LOGFILE [v(JOB_VC)]=lit([u(%va/FN_WIZONLY,%0)]);&ACCESS_MYJOBS [v(JOB_VC)]=lit([u(%va/FN_WIZONLY,%0)]);&ACCESS_POST_APPROVE [v(JOB_VC)]=lit([u(%va/FN_WIZONLY,%0)]);&ACCESS_POST_COMPLETE [v(JOB_VC)]=lit([u(%va/FN_WIZONLY,%0)]);&ACCESS_POST_DENY [v(JOB_VC)]=lit([u(%va/FN_WIZONLY,%0)]);&ACCESS_TURNAROUND [v(JOB_VC)]=lit([u(%va/FN_WIZONLY,%0)]);}
&BLETTER_ADD [v(JOB_VC)]=Comments added to [name(%0)] by [name(%1)].
&BLETTER_APR [v(JOB_VC)]=[name(%0)] has been approved by [name(%1)].
&BLETTER_ASN [v(JOB_VC)]=[name(%0)] has been assigned to [switch(%2,,nobody,name(%2))] by [name(%1)].
&BLETTER_CKI [v(JOB_VC)]=[name(%0)] has been checked in by [name(%1)].
&BLETTER_CKO [v(JOB_VC)]=[name(%0)] has been checked out by [name(%1)].
&BLETTER_CLN [v(JOB_VC)]=[name(%0)] has been cloned by [name(%1)]. [name(%2)] is the new job.
&BLETTER_COM [v(JOB_VC)]=[name(%0)] has been completed by [name(%1)].
&BLETTER_CRE [v(JOB_VC)]=[name(%0)] has been created by [name(%1)] in [name(parent(%0))]: %2
&BLETTER_DNY [v(JOB_VC)]=[name(%0)] has been denied by [name(%1)].
&BLETTER_DUE [v(JOB_VC)]=[name(%0)]'s due date changed by [name(%1)].
&BLETTER_DEL [v(JOB_VC)]=[name(%0)] has been deleted by [name(%1)].
&BLETTER_EDT [v(JOB_VC)]=[name(%0)] has been edited by [name(%1)].
&BLETTER_ESC [v(JOB_VC)]=[name(%0)] has been escalated to %2 by [name(%1)].
&BLETTER_LOK [v(JOB_VC)]=[name(%0)] has been locked by [name(%1)].
&BLETTER_MAI [v(JOB_VC)]=[name(%1)] has sent mail regarding [name(%0)].
&BLETTER_MRG [v(JOB_VC)]=[name(%2)] has been merged into [name(%0)] by [name(%1)].
&BLETTER_MYS [v(JOB_VC)]=[name(%0)]/%2 mysummary setting has been modified by [name(%1)].
&BLETTER_NAM [v(JOB_VC)]=[name(%0)] has been renamed to '%2' by [name(%1)].
&BLETTER_OTH [v(JOB_VC)]=[name(%0)] has been created by [name(%1)] in [name(parent(%0))]: %2
&BLETTER_PUB [v(JOB_VC)]=[name(%0)][ifelse(t(strlen(%2)),/Comment %2,)] has been published by [name(%1)].
&BLETTER_SRC [v(JOB_VC)]=[name(%0)]'s source has been changed by [name(%1)].
&BLETTER_STA [v(JOB_VC)]=[name(%0)]'s status has been changed by [name(%1)].
&BLETTER_SUM [v(JOB_VC)]=[name(%0)]/%2 summary setting has been modified by [name(%1)].
&BLETTER_TAG [v(JOB_VC)]=[name(%0)]'s tags have been altered by [name(%1)].
&BLETTER_TRN [v(JOB_VC)]=[name(%0)] has been transferred to the [name(%2)] bucket by [name(%1)].
&BLETTER_UNL [v(JOB_VC)]=[name(%0)] has been unlocked by [name(%1)].
&BLETTER_UNP [v(JOB_VC)]=[name(%0)][ifelse(t(strlen(%2)),/Comment %2,)] has been unpublished by [name(%1)].
&ERROR_HIDDEN [v(JOB_VC)]=Valid options for the HIDDEN parameter are 'yes' and 'no'.
&ERROR_LOCKED [v(JOB_VC)]=Valid settings for the LOCKED parameter are 'yes' and 'no'.
&ERROR_MYJOBS [v(JOB_VC)]=Valid settings for the MYJOBS parameter are 'yes' and 'no'.
&ERROR_POST_APPROVE [v(JOB_VC)]=The setting for the POST_APPROVE parameter must be a positive integer.
&ERROR_POST_COMPLETE [v(JOB_VC)]=The setting for the POST_COMPLETE parameter must be a positive integer.
&ERROR_POST_DENY [v(JOB_VC)]=The setting for the POST_DENY parameter must be a positive integer.
&ERROR_TURNAROUND [v(JOB_VC)]=You must provide a turnaround time in hours.
&HELP [v(JOB_VC)]=%rThere is no help available for that bucket. To set help information for the [name(me)] bucket, use:%r%r[space(5)]+bucket/set [lcstr(name(me))]/help=<information>%r
&HOOK_CKO [v(JOB_VC)]=@cpattr %0/ASSIGNED_TO=%0/TEMP_ASN;&ASSIGNED_TO %0=%1
&HOOK_CKI [v(JOB_VC)]=&ASSIGNED_TO %0=[get(%0/TEMP_ASN)];&TEMP_ASN %0=
&HOOK_MAI [v(JOB_VC)]=@set %0/[last(sortby(%va/SORTBY_COMMENTS,lattr(%0/COMMENT_*)))]=no_inherit
&MLETTER_APR [v(JOB_VC)]=[name(%0)] has been approved:%r%r[last(get(%0/COMMENT_1),|)]%r[repeat(-,75)]%r[ansi(h,Comments added by [name(%2)]:)] %3
&MLETTER_DNY [v(JOB_VC)]=[name(%0)] has been denied:%r%r[last(get(%0/COMMENT_1),|)]%r[repeat(-,75)]%r[ansi(h,Comments added by [name(%2)]:)] %3
&MLETTER_MAI [v(JOB_VC)]=[name(%2)] is mailing you regarding [name(%0)]:%r%r%3%r[repeat(-,75)]%rUnless this letter indicates otherwise%, you should respond with the following command:%r%r[space(5)][ansi(h,+myjob/add [last(name(%0))]=<your comments>)]
&PLETTER_APR [v(JOB_VC)]=[space(10)][ansi(h,Job:)] #[last(name(%0))]%r[space(8)][ansi(h,Title:)] [get(%0/TITLE)]%r[space(4)][ansi(h,Opened By:)] [u(%va/FN_PLAYERLIST,%0)]%r[space(4)][ansi(h,Opened On:)] [convsecs(get(%0/OPENED_ON))]%r%b[ansi(h,Completed By:)] [name(%2)]%r%b[ansi(h,Completed On:)] [time()]%r%r[last(get(%0/COMMENT_1),|)]%r[repeat(-,78)]%r[ansi(h,Comments from [name(%2)]:)] %3%r%rThis job was approved.
&PLETTER_COM [v(JOB_VC)]=Job [last(name(%0))] has been completed by [name(%2)]:%r%r[last(get(%0/COMMENT_1),|)]%r[repeat(-,78)]%r[ansi(h,Comments from [name(%2)]:)] %3
&PLETTER_DNY [v(JOB_VC)]=[space(10)][ansi(h,Job:)] #[last(name(%0))]%r[space(8)][ansi(h,Title:)] [get(%0/TITLE)]%r[space(4)][ansi(h,Opened By:)] [u(%va/FN_PLAYERLIST,%0)]%r[space(4)][ansi(h,Opened On:)] [convsecs(get(%0/OPENED_ON))]%r%b[ansi(h,Completed By:)] [name(%2)]%r%b[ansi(h,Completed On:)] [time()]%r%r[last(get(%0/COMMENT_1),|)]%r[repeat(-,78)]%r[ansi(h,Comments from [name(%2)]:)] %3%r%rThis job was denied.
&PROCESS_DESC [v(JOB_VC)]=[setq(3,DESC)][setq(1,%0)]1
&PROCESS_HELP [v(JOB_VC)]=[setq(3,HELP)][setq(1,%0)]1
&PROCESS_HIDDEN [v(JOB_VC)]=[setq(3,HIDDEN)][setq(1,switch(lcstr(%0),yes,1,no,,0))][switch(%q1,,1,%q1)]
&PROCESS_LOCKED [v(JOB_VC)]=[setq(3,LOCKED)][setq(1,switch(lcstr(%0),yes,1,no,,0))][switch(%q1,,1,%q1)]
&PROCESS_LOGFILE [v(JOB_VC)]=[setq(3,LOGFILE)][setq(1,%0)]1
&PROCESS_MYJOBS [v(JOB_VC)]=[setq(3,PUBLIC)][setq(1,switch(lcstr(%0),yes,1,no,,0))][switch(%q1,,1,%q1)]
&PROCESS_POST_APPROVE [v(JOB_VC)]=[setq(3,POST_APPROVE)][setq(1,u(%va/FN_FIND-BBDBREF,%0))][gt(%0,0)]
&PROCESS_POST_COMPLETE [v(JOB_VC)]=[setq(3,POST_COMPLETE)][setq(1,u(%va/FN_FIND-BBDBREF,%0))][gt(%0,0)]
&PROCESS_POST_DENY [v(JOB_VC)]=[setq(3,POST_DENY)][setq(1,u(%va/FN_FIND-BBDBREF,%0))][gt(%0,0)]
&PROCESS_TURNAROUND [v(JOB_VC)]=[setq(3,TURNAROUND)][setq(1,%0)][isnum(%0)]
@switch [hasattr([v(JOB_VC)]/STAT_ART)]=0,{&STAT_ART [v(JOB_VC)]=0 0}
@set [v(JOB_VC)]/STAT_ART=NO_INHERIT
@dolist VA VB VC={@cpattr %#/JOB_##=[v(JOB_VC)]/##}
@switch [v(JOB_PATCH)]=0,{think [ansi(hc,ANOMALY JOBS:)] Setting up buckets.},{think [ansi(hc,ANOMALY JOBS:)] Keeping your current bucket setup.}
@switch [v(JOB_PATCH)]=0,{think [setq(0,create(ADMIN,10))][setq(1,create(Job 1,10))];@Desc %q0=For game administrative issues.;@lock/Speech %q0=ACCESS/1;&ACCESS %q0=lit([u(%va/FN_STAFFALL,%#)]);@parent %q0=[v(JOB_VC)];@tel %q0=[v(JOB_VC)];think [ansi(hc,ANOMALY JOBS:)] Creating initial job.;&OPENED_BY %q1=%#;&OPENED_ON %q1=[secs()];&MODIFIED_ON %q1=[secs()];&STATUS %q1=1;&TITLE %q1=Welcome;@parent %q1=%q0;@tel %q1=[v(JOB_VA)];&NUM_COMMENT %q1=3;&LIST_STATS %q1=ADD|1;&PRIORITY %q1=1;&COMMENT_1 %q1=CRE|[secs()]|#0|Anomaly Jobs|Thank you for choosing Anomaly Jobs. This is fully-featured task tracking code that helps to keep games organized. Please see '+jobs/credits' for information on version, license and other credits.;&COMMENT_2 %q1=ADD|[secs()]|#0|Anomaly Jobs|Remember that /complete posts to the public BBS (unless changed for a bucket - see the help file on buckets). /approve and /deny sends mail to the job-creator, and posts to private BBS.;@set %q1=UNFINDABLE;&JOBS_NUM [v(JOB_VA)]=1;&MAX_JOBS [v(JOB_VA)]=200;@switch [first(version())]=TinyMUSH,{@set %q1=!COMMANDS},{@set %q1=NO_COMMAND}}
@switch [v(JOB_PATCH)]=0,{think [setq(0,create(APPS,10))];@Desc %q0=Character applications submitted for review.;@lock/Speech %q0=ACCESS/1;&ALETTER_OTH %q0=lit(Application for approval submitted by [name(%1)].);&MLETTER_OTH %q0=lit(You have submitted an application for approval. Please give staff some time to process the application. You will hear back soon.);&MLETTER_APR %q0=lit(You have been approved by [name(%2)].);&PLETTER_APR %q0=lit([name(%2)] has approved [name(get(%0/OPENED_BY))] for roleplay.);&ACCESS %q0=lit([u(%va/FN_STAFFALL,%#)]);@parent %q0=[v(JOB_VC)];@tel %q0=[v(JOB_VC)]}
@switch [v(JOB_PATCH)]=0,{think [setq(0,create(BUILD,10))];@Desc %q0=For building issues and typo reports.;@lock/Speech %q0=ACCESS/1;&PUBLIC %q0=1;&ACCESS %q0=lit([or(haspower(%#,builder),u(%va/FN_STAFFALL,%#))]);@set %q0=SAFE;@parent %q0=[v(JOB_VC)];@tel %q0=[v(JOB_VC)]}
@switch [v(JOB_PATCH)]=0,{think [setq(0,create(CGEN,10))];@Desc %q0=For character generation problems and updates.;@lock/Speech %q0=ACCESS/1;&ACCESS %q0=lit([u(%va/FN_STAFFALL,%#)]);@parent %q0=[v(JOB_VC)];@tel %q0=[v(JOB_VC)]}
@switch [v(JOB_PATCH)]=0,{think [setq(0,create(CODE,10))];@Desc %q0=For bugs and code enhancements.;@lock/Speech %q0=ACCESS/1;&PUBLIC %q0=1;&ACCESS %q0=lit([u(%va/FN_STAFFALL,%#)]);@set %q0=SAFE;@parent %q0=[v(JOB_VC)];@tel %q0=[v(JOB_VC)]}
@switch [v(JOB_PATCH)]=0,{think [setq(0,create(FEEP,10))];@Desc %q0=Storage for unimplemented game ideas.;@lock/Speech %q0=ACCESS/1;&HIDDEN %q0=1;&ACCESS %q0=lit([u(%va/FN_STAFFALL,%#)]);@parent %q0=[v(JOB_VC)];@tel %q0=[v(JOB_VC)]}
@switch [v(JOB_PATCH)]=0,{think [setq(0,create(FORUM,10))];@Desc %q0=Tabled discussion jobs. Feedback needed.;@lock/Speech %q0=ACCESS/1;&ACCESS %q0=lit([u(%va/FN_STAFFALL,%#)]);@parent %q0=[v(JOB_VC)];@tel %q0=[v(JOB_VC)]}
@switch [v(JOB_PATCH)]=0,{think [setq(0,create(PITCH,10))];@Desc %q0=Pitched plots and stories.;@lock/Speech %q0=ACCESS/1;&ACCESS %q0=lit([u(%va/FN_STAFFALL,%#)]);&HIDDEN %q0=1;@set %q0=SAFE;@parent %q0=[v(JOB_VC)];@tel %q0=[v(JOB_VC)]}
@switch [v(JOB_PATCH)]=0,{think [setq(0,create(PUB,10))];@Desc %q0=Public jobs. Everyone has +myjobs access.;@lock/Speech %q0=ACCESS/1;&ACCESS %q0=lit([u(%va/FN_STAFFALL,%#)]);&TRANSPARENT %q0=1;&PUBLIC %q0=1;&HOOK_CRE %q0=lit(@set %0/COMMENT_1=no_inherit);@parent %q0=[v(JOB_VC)];@tel %q0=[v(JOB_VC)]}
@switch [v(JOB_PATCH)]=0,{think [setq(0,create(QUERY,10))];@Desc %q0=Query bucket.;@lock/Speech %q0=ACCESS/1;&PRIORITY %q0=2;&PUBLIC %q0=1;&ACCESS %q0=lit([u(%va/FN_STAFFALL,%#)]);&TURNAROUND %q0=168;&HOOK_OTH %q0=lit(@set %0/COMMENT_1=no_inherit;&ASSIGNED_TO %0=%1);&MLETTER_OTH %q0=lit(You have been issued an official query by the jobs system by [name(%2)]. You have [div(v(TURNAROUND),24)] days at the time of this mail to respond to the query%, otherwise staff may need to act on the issue without your input. To see your query%, please type '+myjob [last(name(%0))]'.);@set %q0=SAFE;@parent %q0=[v(JOB_VC)];@tel %q0=[v(JOB_VC)]}
@switch [v(JOB_PATCH)]=0,{think [setq(0,create(REQ,10))];@Desc %q0=Player requests.;@lock/Speech %q0=ACCESS/1;&PUBLIC %q0=1;&PRIORITY %q0=2;&ACCESS %q0=lit([u(%va/FN_STAFFALL,%#)]);&TURNAROUND %q0=72;&LOGFILE %q0=reqlog;&MLETTER_OTH %q0=lit(You have requested '[name(%0)]: [get(%0/TITLE)]' from staff: %r%r%3%r%r[repeat(-,75)]%rSee '[ansi(h,+help myjobs)]' for help on how to display and add to your jobs.%r%rPlease give staff at least [u(me/TURNAROUND)] hours from the date of this mail to process your request.);@set %q0=SAFE;@parent %q0=[v(JOB_VC)];@tel %q0=[v(JOB_VC)]}
@switch [v(JOB_PATCH)]=0,{think [setq(0,create(RP,10))];@Desc %q0=For storing potential plots.;@lock/Speech %q0=ACCESS/1;&ACCESS %q0=lit([u(%va/FN_STAFFALL,%#)]);&ACCESS_APPROVED %q0=lit([u(%va/FN_WIZONLY,%0)]);&ACCESS_ARC %q0=lit([u(%va/FN_STAFFALL,%0)]);&ACCESS_PLAYERS %q0=lit([u(%va/FN_STAFFALL,%0)]);&ACCESS_SCHEDULE %q0=lit([u(%va/FN_STAFFALL,%0)]);&ACCESS_STAFF %q0=lit([u(%va/FN_STAFFALL,%0)]);&ACCESS_SYNOPSIS %q0=lit([u(%va/FN_STAFFALL,%0)]);&ERROR_PLAYERS %q0=lit(I don't recognize [ansi(h,%qp)] as a player.);&ERROR_STAFF %q0=lit(I don't recognize [ansi(h,%qp)] as a player.);&HIDDEN %q0=1;&MAP_NAME %q0=lit([name(*%0)]);&PROCESS_APPROVED %q0=lit([setq(3,APPROVED)][setq(1,%0)]1);&PROCESS_ARC %q0=lit([setq(3,PLOT_ARC)][setq(1,u(%va/FN_STRTRUNC,%0,50))]);&PROCESS_PLAYERS %q0=lit([setq(3,PLAYERS)][ifelse(not(gt(strlen(u(%va/fn_trim,squish(iter(%0,ifelse(not(isdbref(pmatch(itext(0)))),setr(p,itext(0)),))))),0)),[setq(9,iter(%0,pmatch(itext(0))))][setq(8,get(%1/PLAYERS))][iter(%q9,ifelse(gt(member(%q8,##),0),setq(8,remove(%q8,##)),setq(8,setunion(%q8,##))))][setq(1,%q8)]1,0)]);&PROCESS_SCHEDULE %q0=lit([setq(3,SCHEDULE)][setq(1,u(%va/FN_STRTRUNC,%0,50))]1);&PROCESS_STAFF %q0=lit([setq(3,WRITER)][ifelse(not(gt(strlen(u(%va/fn_trim,squish(iter(%0,ifelse(not(isdbref(pmatch(itext(0)))),setr(p,itext(0)),))))),0)),[setq(9,iter(%0,pmatch(itext(0))))][setq(8,get(%1/WRITER))][iter(%q9,ifelse(gt(member(%q8,##),0),setq(8,remove(%q8,##)),setq(8,setunion(%q8,##))))][setq(1,%q8)]1,0)]);&PROCESS_SYNOPSIS %q0=lit([setq(3,BRIEF)][setq(1,%0)]1);&SUMMARY %q0=lit([rjust(ansi(hc,Approved:),10)]%b[ifelse(u(%va/FN_HASATTRP,%0,APPROVED),get(%0/APPROVED),Unapproved)]%r[rjust(ansi(hc,Players:),10)]%b[ifelse(u(%va/FN_HASATTRP,%0,PLAYERS),u(%va/FN_ITEMIZE,map(me/MAP_NAME,get(%0/PLAYERS),%b,|),|),Nobody)]%r[rjust(ansi(hc,Schedule:),10)]%b[ifelse(u(%va/FN_HASATTRP,%0,SCHEDULE),get(%0/SCHEDULE),Unset)]%r[rjust(ansi(hc,Arc:),10)]%b[ifelse(u(%va/FN_HASATTRP,%0,PLOT_ARC),get(%0/PLOT_ARC),Unset)]%r[rjust(ansi(hc,Staff:),10)]%b[ifelse(u(%va/FN_HASATTRP,%0,WRITER),u(%va/FN_ITEMIZE,map(me/MAP_NAME,get(%0/WRITER),%b,|),|),Nobody)]%r[rjust(ansi(hc,Synopsis:),10)]%b[ifelse(u(%va/FN_HASATTRP,%0,BRIEF),get(%0/BRIEF),Unset)]);&HELP %q0=lit(%r[space(5)]This bucket is for plots that have potential but aren't yet ready to run. Jobs in this bucket should remain here until the plot is approved to be run.%r%r[u(%va/FN_BREAK,ansi(hc,Settings for +job/sumset))]%r[ljust(ansi(h,PLAYERS),10)] Accepts <player> as a valid parameter.%r[ljust(ansi(h,SCHEDULE),10)] Describe when the plot is in effect.%r[ljust(ansi(h,ARC),10)] Describes the story arc associated to this plot.%r[ljust(ansi(h,STAFF),10)] Accepts <player> as a valid parameter.%r[ljust(ansi(h,SYNOPSIS),10)] A brief synopsis of the plot.%r[ljust(ansi(h,APPROVED),10)] Wiz-only, for approving plots. Accepts 'yes' or 'no'.);@parent %q0=[v(JOB_VC)];@tel %q0=[v(JOB_VC)]}
@switch [v(JOB_PATCH)]=0,{think [setq(0,create(TECH,10))];@Desc %q0=Technology issues - weapon objects, etc.;@lock/Speech %q0=ACCESS/1;&ACCESS %q0=lit([u(%va/FN_STAFFALL,%#)]);@parent %q0=[v(JOB_VC)];@tel %q0=[v(JOB_VC)]}
@switch [v(JOB_PATCH)]=0,{think [setq(0,create(THEME,10))];@Desc %q0=Thematic issues and discussion.;@lock/Speech %q0=ACCESS/1;&ACCESS %q0=lit([u(%va/FN_STAFFALL,%#)]);@parent %q0=[v(JOB_VC)];@tel %q0=[v(JOB_VC)]}
@switch [v(JOB_PATCH)]=0,{think [setq(0,create(TPS,10))];@Desc TPS=Actively running tiny plots.;@lock/Speech TPS=ACCESS/1;&SUMMARY TPS=lit([rjust(ansi(hc,Approved:),10)]%b[ifelse(u(%va/FN_HASATTRP,%0,APPROVED),get(%0/APPROVED),Unapproved)]%r[rjust(ansi(hc,Players:),10)]%b[ifelse(u(%va/FN_HASATTRP,%0,PLAYERS),u(%va/FN_ITEMIZE,map(me/MAP_NAME,get(%0/PLAYERS),%b,|),|),Nobody)]%r[rjust(ansi(hc,Schedule:),10)]%b[ifelse(u(%va/FN_HASATTRP,%0,SCHEDULE),get(%0/SCHEDULE),Unset)]%r[rjust(ansi(hc,Arc:),10)]%b[ifelse(u(%va/FN_HASATTRP,%0,PLOT_ARC),get(%0/PLOT_ARC),Unset)]%r[rjust(ansi(hc,Staff:),10)]%b[ifelse(u(%va/FN_HASATTRP,%0,WRITER),u(%va/FN_ITEMIZE,map(me/MAP_NAME,get(%0/WRITER),%b,|),|),Nobody)]%r[rjust(ansi(hc,Synopsis:),10)]%b[ifelse(u(%va/FN_HASATTRP,%0,BRIEF),get(%0/BRIEF),Unset)]);&MAP_NAME TPS=lit([name(*%0)]);&ACCESS TPS=lit([u(%va/FN_STAFFALL,%#)]);&ACCESS_PLAYERS TPS=lit([u(%va/FN_STAFFALL,%0)]);&PROCESS_PLAYERS TPS=lit([setq(3,PLAYERS)][ifelse(not(gt(strlen(u(%va/fn_trim,squish(iter(%0,ifelse(not(isdbref(pmatch(itext(0)))),setr(p,itext(0)),))))),0)),[setq(9,iter(%0,pmatch(itext(0))))][setq(8,get(%1/PLAYERS))][iter(%q9,ifelse(gt(member(%q8,##),0),setq(8,remove(%q8,##)),setq(8,setunion(%q8,##))))][setq(1,%q8)]1,0)]);&ERROR_PLAYERS TPS=lit(I don't recognize [ansi(h,%qp)] as a player.);&ACCESS_SCHEDULE TPS=lit([u(%va/FN_STAFFALL,%0)]);&PROCESS_SCHEDULE TPS=lit([setq(3,SCHEDULE)][setq(1,u(%va/FN_STRTRUNC,%0,50))]1);&ERROR_SCHEDULE TPS=lit(You must enter a valid date string.);&ACCESS_ARC TPS=lit([u(%va/FN_STAFFALL,%0)]);&PROCESS_ARC TPS=lit([setq(3,PLOT_ARC)][setq(1,u(%va/FN_STRTRUNC,%0,50))]);&ACCESS_STAFF TPS=lit([u(%va/FN_STAFFALL,%0)]);&PROCESS_STAFF TPS=lit([setq(3,WRITER)][ifelse(not(gt(strlen(u(%va/fn_trim,squish(iter(%0,ifelse(not(isdbref(pmatch(itext(0)))),setr(p,itext(0)),))))),0)),[setq(9,iter(%0,pmatch(itext(0))))][setq(8,get(%1/WRITER))][iter(%q9,ifelse(gt(member(%q8,##),0),setq(8,remove(%q8,##)),setq(8,setunion(%q8,##))))][setq(1,%q8)]1,0)]);&ERROR_STAFF TPS=lit(I don't recognize [ansi(h,%qp)] as a player.);&ACCESS_SYNOPSIS TPS=lit([u(%va/FN_STAFFALL,%0)]);&PROCESS_SYNOPSIS TPS=lit([setq(3,BRIEF)][setq(1,%0)]1);&ACCESS_APPROVED TPS=lit([u(%va/FN_WIZONLY,%0)]);&PROCESS_APPROVED TPS=lit([setq(3,APPROVED)][setq(1,%0)]1);&HELP TPS=lit(%r[space(5)]This bucket is for currently active plots that are running on the grid. Care should be taken to keep the headers of these jobs up-to-date, especially in terms of Progress settings and due dates. When the plot is completed, the job should be set complete and left open until follow-up requests are completed.%r%r[u(%va/FN_BREAK,ansi(hc,Settings for +job/sumset))]%r[ljust(ansi(h,PLAYERS),10)] Accepts <player> as a valid parameter.%r[ljust(ansi(h,SCHEDULE),10)] Describe when the plot is in effect.%r[ljust(ansi(h,ARC),10)] Describes the story arc associated to this plot.%r[ljust(ansi(h,STAFF),10)] Accepts <player> as a valid parameter.%r[ljust(ansi(h,SYNOPSIS),10)] A brief synopsis of the plot.%r[ljust(ansi(h,APPROVED),10)] Wiz-only, for approving plots. Accepts 'yes' or 'no'.);@parent TPS=[v(JOB_VC)];@tel TPS=[v(JOB_VC)]}
@switch [v(JOB_PATCH)]=0,{&HAS_ACCESS [v(JOB_VA)]=lit([or(haspower(%0,builder),u(%va/FN_STAFFALL,%0))]);&ADD_ACCESS [v(JOB_VA)]=lit([u(%va/FN_STAFFALL,%0)]);&APPROVE_ACCESS [v(JOB_VA)]=lit([u(%va/FN_STAFFALL,%0)]);&COMPLETE_ACCESS [v(JOB_VA)]=lit([u(%va/FN_STAFFALL,%0)]);&CREATE_ACCESS [v(JOB_VA)]=lit([u(%va/FN_STAFFALL,%0)]);&DENY_ACCESS [v(JOB_VA)]=lit([u(%va/FN_STAFFALL,%0)]);&EDIT_ACCESS [v(JOB_VA)]=lit([u(%va/FN_STAFFALL,%0)]);&GIVE_ACCESS [v(JOB_VA)]=lit([u(%va/FN_WIZONLY,%0)]);&LOG_ACCESS [v(JOB_VA)]=lit([u(%va/FN_WIZONLY,%0)]);&MAIL_ACCESS [v(JOB_VA)]=lit([u(%va/FN_STAFFALL,%0)]);&STATS_ACCESS [v(JOB_VA)]=lit([u(%va/FN_STAFFALL,%0)]);&CONFIG_ACCESS [v(JOB_VA)]=lit([u(%va/FN_STAFFALL,%0)]);}
@switch first(version())=RhostMUSH,{&FN_WIZONLY [v(JOB_VA)]=lit([gte(bittype(%0),5)])},{&FN_WIZONLY [v(JOB_VA)]=lit([hasflag(%0,WIZARD)])}
@switch first(version())=RhostMUSH,{&FN_STAFFALL [v(JOB_VA)]=lit([gte(bittype(%0),2)])},PennMUSH,{&FN_STAFFALL [v(JOB_VA)]=lit([orflags(%0,Wr)])},{&FN_STAFFALL [v(JOB_VA)]=lit([orflags(%0,WZ)])}
@switch [v(JOB_PATCH)]=0,{&JOB_LOGGING [v(JOB_VA)]=1;&LOGFILE [v(JOB_VC)]=joblog}
@switch [first(version())]=TinyMUSH,{&BUFFER [v(JOB_VA)]=4000},RhostMUSH,{&BUFFER [v(JOB_VA)]=3999},{&BUFFER [v(JOB_VA)]=8000}
think [ansi(hc,ANOMALY JOBS:)] Setting flags.
@switch [first(version())]=PennMUSH,{@set [v(JOB_GO)]=WIZARD},{@set [v(JOB_GO)]=INHERIT}
@switch [first(version())]=TinyMUSH,{@set [v(JOB_GO)]=COMMANDS},{@set [v(JOB_GO)]=!NO_COMMAND}
@switch [first(version())]=PennMUSH,{@set [v(JOB_GO)]=!HALT},{@set [v(JOB_GO)]=!HALTED}
@set [v(JOB_GO)]=UNFINDABLE
@set [v(JOB_GO)]=SAFE
@switch [first(version())]=RhostMUSH,{@set [v(JOB_GO)]=SIDEFX}
@switch [first(version())]=PennMUSH,{@set [v(JOB_VA)]=WIZARD},{@set [v(JOB_VA)]=INHERIT}
@set [v(JOB_VA)]=UNFINDABLE
@switch [first(version())]=TinyMUSH,{@set [v(JOB_VA)]=!COMMANDS},{@set [v(JOB_VA)]=NO_COMMAND}
@switch [first(version())]=PennMUSH,{@set [v(JOB_VA)]=!HALT},{@set [v(JOB_VA)]=!HALTED}
@set [v(JOB_VA)]=SAFE
@switch [first(version())]=RhostMUSH,{@set [v(JOB_VA)]=SIDEFX}
@set [v(JOB_VB)]=UNFINDABLE
@switch [first(version())]=TinyMUSH,{@set [v(JOB_VB)]=!COMMANDS},{@set [v(JOB_VB)]=NO_COMMAND}
@switch [first(version())]=PennMUSH,{@set [v(JOB_VB)]=!HALT},{@set [v(JOB_VB)]=!HALTED}
@set [v(JOB_VB)]=SAFE
@switch [first(version())]=PennMUSH,{@set [v(JOB_VC)]=WIZARD},{@set [v(JOB_VC)]=INHERIT}
@set [v(JOB_VC)]=SAFE
@set [v(JOB_VC)]=UNFINDABLE
@switch [first(version())]=TinyMUSH,{@set [v(JOB_VC)]=COMMANDS},{@set [v(JOB_VC)]=!NO_COMMAND}
@switch [first(version())]=PennMUSH,{@set [v(JOB_VC)]=!HALT},{@set [v(JOB_VC)]=!HALTED}
@switch [first(version())]=RhostMUSH,{@set [v(JOB_VC)]=SIDEFX}
@dolist lcon([v(JOB_VC)])={@switch [first(version())]=PennMUSH,{@set ##=!HALT},{@set ##=!HALTED};@switch [first(version())]=TinyMUSH,{@set ##=!COMMANDS},{@set ##=NO_COMMAND};@set ##=UNFINDABLE;@switch [first(version())]=PennMUSH,{@set ##=WIZARD},{@set ##=INHERIT};}
@switch [v(JOB_PATCH)]=0,{&INSTALL_DATE [v(JOB_VA)]=[time()]}
think [ansi(hc,ANOMALY JOBS:)] Setting locks.
@lock [v(JOB_GO)]=me
@lock [v(JOB_VA)]=me
@lock [v(JOB_VB)]=me
@lock [v(JOB_VC)]=me
@switch [setq(0,switch(first(version()),PennMUSH,lsearch(all,eobjects,\[strmatch(name(##),bbpocket)\]),RhostMUSH,searchng(object=bbpocket),search(object=bbpocket)))][isdbref(%q0)][v(JOB_PATCH)]=0*,{think [ansi(hc,ANOMALY JOBS:)] Couldn't find Myrddin's BBS. Installation is not complete.},10,{think [ansi(hc,ANOMALY JOBS:)] Setting up the BBS.;&BBPOCKET [v(JOB_VC)]=%q0;+bbnewgroup Job Tracker;@wait 2={+bbnewgroup Staff Job Tracker};@wait 5={&POST_COMPLETE [setq(1,extract(u(%q0/GROUPS),dec(words(u(%q0/GROUPS))),1))][setq(2,last(u(%q0/GROUPS)))][setq(3,v(JOB_VB))][setq(4,switch(first(version()),RhostMUSH,lit(gte(bittype(%0),2)),PennMUSH,lit(orflags(%0,Wr)),lit(orflags(%0,WZ))))][v(JOB_VC)]=%q1;&POST_APPROVE [v(JOB_VC)]=%q2;&POST_DENY [v(JOB_VC)]=%q2;&POST_DELETE [v(JOB_VC)]=%q2;&CANREAD %q1=1;&CANWRITE %q1=%[or%(strmatch%(%%0,%q3%),%q4%)%];&CANREAD %q2=%q4;&CANWRITE %q2=%[or%(strmatch%(%%0,%q3%),%q4%)%];}},{think [ansi(hc,ANOMALY JOBS:)] Updating BBS settings.;&BBPOCKET [v(JOB_VC)]=%q0;@dolist [v(JOB_VC)] [lcon(v(JOB_VC))]={@switch [and(hasattr(##,POST_COMPLETE),isnum(get(##/POST_COMPLETE)))][and(hasattr(##,POST_APPROVE),isnum(get(##/POST_APPROVE)))][and(hasattr(##,POST_DENY),isnum(get(##/POST_DENY)))][and(hasattr(##,POST_DELETE),isnum(get(##/POST_DELETE)))]=1???,{&POST_COMPLETE ##=[extract(u(%q0/GROUPS),get(##/POST_COMPLETE),1)]},?1??,{&POST_APPROVE ##=[extract(u(%q0/GROUPS),get(##/POST_APPROVE),1)]},??1?,{&POST_DENY ##=[extract(u(%q0/GROUPS),get(##/POST_DENY),1)]},???1,{&POST_DELETE ##=[extract(u(%q0/GROUPS),get(##/POST_DELETE),1)]}}}
&JOBSH me=
&JOBSB me=
@switch [v(JOB_PATCH)]=>0,{think [ansi(hc,ANOMALY JOBS:)] Checking hooks for compatibility.;@dolist [v(JOB_VC)] [lcon(v(JOB_VC))]={@switch [hasattr(##,HOOK_COMPLETE)][hasattr(##,HOOK_APPROVE)][hasattr(##,HOOK_DENY)][hasattr(##,HOOK_DELETE)]=1???,{think [ansi(hc,ANOMALY JOBS:)] ##/HOOK_COMPLETE not valid: move to ##/HOOK_COM;},?1??,{think [ansi(hc,ANOMALY JOBS:)] ##/HOOK_APPROVE not valid: move to ##/HOOK_APR;},??1?,{think [ansi(hc,ANOMALY JOBS:)] ##/HOOK_DENY not valid: move to ##/HOOK_DNY;},???1,{think [ansi(hc,ANOMALY JOBS:)] ##/HOOK_DELETE not valid: move to ##/HOOK_DEL;}}}
@wait 10={think [ansi(hc,ANOMALY JOBS:)] Thanks for using Anomaly Jobs!}
@@
@@DONE
@@
think [ansi(hc,MUX Core:)] Performing cleanup of Jobs installation and customizing buckets.
@switch [hasattr([v(JOB_VC)],STAT_ART)]=0,{&STAT_ART [v(JOB_VC)]=0 0}
@set [v(JOB_VC)]/STAT_ART=NO_INHERIT
@name #22=<JG> Job Globals
drop #22
@aconnect #22=@switch [u(%va/HAS_ACCESS,%#)]=1,{@fo %#=+jobs/new},{@if not(haspower(%#,guest))=@fo %#=+myjobs}
@cpattr me/JOB_GO=#3/JOB_GO
@cpattr me/JOB_VA=#3/JOB_VA
@cpattr me/JOB_VB=#3/JOB_VB
@cpattr me/JOB_VC=#3/JOB_VC
@cpattr me/JOB_PATCH=#3/JOB_PATCH
&JOB_GO me
&JOB_VA me
&JOB_VB me
&JOB_VC me
&JOB_PATCH me
&HAS_ACCESS #23=[u(%va/FN_STAFFALL,%0)]
&ACCESS #29=[u(%va/FN_STAFFALL,%#)]
&HOOK_CRE #29=@tr #12/TR.CREATE=[get(%0/TITLE)],%1;@cpattr #11/APR_ACCESS=%0/APR_ACCESS;@cpattr #11/COM_ACCESS=%0/COM_ACCESS;@wait 0={&D.BUILD %0=[locate(#12,ZMO: [get(%0/TITLE)],i)]}
&HOOK_APR #29=@tr #11/TR.ADVANCE.[get(get(%0/D.BUILD)/D.STATUS)]=[get(%0/D.BUILD)],%1
&HOOK_COM #29=@tr #11/TR.ADVANCE.[get(get(%0/D.BUILD)/D.STATUS)]=[get(%0/D.BUILD)],%1
&HOOK_DNY #29=@if [get(get(%0/D.BUILD)/D.STATUS)]={@@ Do Nothing},{@tr #11/TR.DESTROY=[get(%0/D.BUILD)],%1}
&HOOK_DEL #29=@if [get(get(%0/D.BUILD)/D.STATUS)]={@@ Do Nothing},{@tr #11/TR.DESTROY=[get(%0/D.BUILD)],%1}
&HOOK_OTH #29=&D.BUILD %0=[zone(%1)];@cpattr #11/APR_ACCESS=%0/APR_ACCESS;@cpattr #11/COM_ACCESS=%0/COM_ACCESS
&MLETTER_APR #29=[name(%0)] has been approved: %r%r[last(get(%0/COMMENT_1),|)]%r[repeat(-,75)]%r%tYour building project has been approved. The builder name for your project is [name(get(get(%0/D.BUILD)/D.BUILDER))] and the starting password is [get(get(%0/D.BUILD)/D.INITIALPASS)]. Please change this password after you have logged in the builder. An initial room has been dug for you in the Building Nexus. %r[ansi(h,Comments added by [name(%2)]:)] %3
&HOOK_COM #28=@unlock [setr(p,get(%0/OPENED_BY))]/D.APPROVAL;&D.APPROVAL %qp=Approved for play by [name(%1)] on [time()].;@lock %qp/D.APPROVAL
&HOOK_APR #28=@unlock [setr(p,get(%0/OPENED_BY))]/D.APPROVAL;&D.APPROVAL %qp=Approved for play by [name(%1)] on [time()].;@lock %qp/D.APPROVAL
&HOOK_DNY #28=@dolist [lattr(setr(p,get(%0/OPENED_BY))/D.BG.*)]={@unlock %qp/##};@unlock %qp/D.APPROVAL;&D.APPROVAL %qp
&HOOK_DEL #28=@dolist [lattr(setr(p,get(%0/OPENED_BY))/D.BG.*)]={@unlock %qp/##};@unlock %qp/D.APPROVAL;&D.APPROVAL %qp
+bucket/create JNOTE=Proposed Jnotes and Jnote inquiries.
@wait 3={&ACCESS #44=[u(%va/FN_STAFFALL,%#)]}
@@
&HOOK_COM #44=@unlock [setr(p,first(get(%0/OPENED_BY)))]/JNOTE-[setr(n,edit(get(%0/TITLE),%b,_))];&JNOTE-%qn %qp=[replace(get(%qp/JNOTE-%qn),1,{Approved by [name(%1)] (%1), [time()]},|)];@lock %qp/JNOTE-%qn
&HOOK_APR #44=@unlock [setr(p,first(get(%0/OPENED_BY)))]/JNOTE-[setr(n,edit(get(%0/TITLE),%b,_))];&JNOTE-%qn %qp=[replace(get(%qp/JNOTE-%qn),1,{Approved by [name(%1)] (%1), [time()]},|)];@lock %qp/JNOTE-%qn
&HOOK_DNY #44=@unlock [setr(p,first(get(%0/OPENED_BY)))]/JNOTE-[setr(n,edit(get(%0/TITLE),%b,_))];&JNOTE-%qn %qp
&HOOK_DEL #44=@unlock [setr(p,first(get(%0/OPENED_BY)))]/JNOTE-[setr(n,edit(get(%0/TITLE),%b,_))];&JNOTE-%qn %qp
@dolist lnum(22,44)={@chown #{##}=#3;@set #{##}=!HALTED}
@set #22=INHERIT SAFE
@set #23=INHERIT SAFE
@set #24=SAFE
@set #25=INHERIT SAFE
@set #26=INHERIT
@set #28=INHERIT
@set #29=INHERIT SAFE
@set #30=INHERIT
@set #31=INHERIT SAFE
@set #32=INHERIT
@set #33=INHERIT
@set #34=INHERIT SAFE
@set #35=INHERIT
@set #36=INHERIT SAFE
@set #37=INHERIT SAFE
@set #38=INHERIT
@set #39=INHERIT
@set #40=INHERIT
@set #41=INHERIT
@set #42=INHERIT SAFE
@set #43=INHERIT SAFE
@set #44=INHERIT
think [ansi(hc,MUX Core:)] Jobs install cleanup complete. If you install future +jobs patches, do so with CodeWIZ.
@@
@@ #45: Room Parent
@@
think [ansi(hc,MUX Core:)] Setting up Room and Build Parents.
@create Room Parent=10
@Desc Room Parent=%r%r%r
@NameFormat Room Parent=[header(name(me)[if(or(controls(%#,me),orflags(%#,WwZ)),([num(me)][flags(me)]))])]
@ConFormat Room Parent=[subheader(Players)][iter(%# %0,switch(type(##),thing,setq(o,setunion(%qo,%i0)),player,%r%b[ljust(strtrunc(ansi(ifelse(hasflag(%i0,DARK),xh,h),name(%i0)),19),20)][ljust(strtrunc(get(%i0/SHORT-DESC),47),48)][ljust(singletime(idle(%i0))%b,5)]),,@@)][if(words(%qo),%r[subheader(Objects)]%r%b[iter(%qo,[ljust([name(%i0)][if(or(controls(%i0,%#),hasflag(%#,WIZARD)),(%i0[flags(%i0)]))],38)][if(and(not(mod(inum(),2)),not(eq(inum(),words(%qo)))),%r)])])][setq(f,setunion(%qf,if(t(lattr(me/VIEW-*)),views),|))][setq(f,setunion(%qf,if(hasattr(me,PLACESMAX),places),|))][if(isstaff(%#),setq(f,setunion(%qf,if(t(u(#6/FN.JNOTES)),jnotes),|)))][ifelse(words(lexits(me)),,%r[footer(edit(%qf,|,%b))])]
@ExitFormat Room Parent=[setq(f,setunion(%qf,if(t(lattr(me/VIEW-*)),views),|))][setq(f,setunion(%qf,if(hasattr(me,PLACESMAX),places),|))][if(isstaff(%#),setq(f,setunion(%qf,if(t(u(#6/FN.JNOTES)),jnotes),|)))][case(words(lexits(me)),0,footer(edit(%qf,|,%b)),[subheader(Exits)]%r[columns(iter(if(hasflag(%#,WIZARD),lexits(me),%0),if(hasflag(%i0,DARK),%xh%xx*%xn)[name(%i0)],,|),26,|)][footer(edit(%qf,|,%b))])]
@DescFormat Room Parent=%0[localize(if(isdbref(setr(0,zone(me))),u(#6/FN.DESC,%#,%q0)))]
@chown Room Parent=#3
@set Room Parent=!HALTED INHERIT SAFE
@@
@@ #46: Business Build Parent
@@
@create Business Build Parent=10
&CMD.ADDOWNER Business Build Parent=$+addowner *:@switch [isstaff(%#)][isdbref(setr(0,pmatch(%0)))]=0*,{@pemit %#=Huh?%b%b(Type "help" for help.)},10,{@pemit %#=No such player: %0},11,{&D.OWNERS me=[setunion(v(D.OWNERS),%q0)];@pemit %#=Done. [name(%q0)] added to the list of owners for [rest(name(me),:%b)].}
&CMD.DELOWNER Business Build Parent=$+delowner *:@switch [isstaff(%#)][ismember(v(D.OWNERS),setr(0,pmatch(%0)))]=0*,{@pemit %#=Huh?%b%b(Type "help" for help.)},10,{@pemit %#=That player is not currently an owner.},11,{&D.OWNERS me=[setdiff(v(D.OWNERS),%q0)];@pemit %#=Done. [name(%q0)] removed from the list of owners for [rest(name(me),:%b)].}
&CMD.ADDTENANT Business Build Parent=$+addtenant *:@switch [or(ismember(v(D.OWNERS),%#),isstaff(%#))][isdbref(setr(0,pmatch(%0)))]=0*,{@pemit %#=Huh?%b%b(Type "help" for help.)},10,{@pemit %#=No such player: %0},11,{&D.TENANTS me=[setunion(v(D.TENANTS),%q0)];@pemit %#=Done. [name(%q0)] added to the list of tenants for [rest(name(me),:%b)].}
&CMD.DELTENANT Business Build Parent=$+deltenant *:@switch [or(ismember(v(D.OWNERS),%#),isstaff(%#))][ismember(v(D.TENANTS),setr(0,pmatch(%0)))]=0*,{@pemit %#=Huh?%b%b(Type "help" for help.)},10,{@pemit %#=That player is not currently a tenant.},11,{&D.TENANTS me=[setdiff(v(D.TENANTS),%q0)];@pemit %#=Done. [name(%q0)] removed from the list of tenants for [rest(name(me),:%b)].}
&CMD.GIVEKEY Business Build Parent=$+givekey *:@switch [or(ismember(v(D.OWNERS,%#),%#),ismember(v(D.TENANTS),%#),isstaff(%#))][isdbref(setr(0,pmatch(%0)))]=0*,{@pemit %#=Huh?%b%b(Type "help" for help.)},10,{@pemit %#=No such player: %0},11,{&D.KEYLIST me=[setunion(v(D.KEYLIST),%q0)];@pemit %#=Done. [name(%q0)] added to the list of keyholders for [rest(name(me),:%b)].}
&CMD.TAKEKEY Business Build Parent=$+takekey *:@switch [or(ismember(v(D.OWNERS,%#),%#),ismember(v(D.TENANTS),%#),isstaff(%#))][ismember(v(D.KEYLIST),setr(0,pmatch(%0)))]=0*,{@pemit %#=Huh?%b%b(Type "help" for help.)},10,{@pemit %#=That player is not currently a keyholder.},11,{&D.KEYLIST me=[setdiff(v(D.KEYLIST),%q0)];@pemit %#=Done. [name(%q0)] removed from the list of keyholders for [rest(name(me),:%b)].}
&CMD.SETLOCK Business Build Parent=$+setlock *=*:@switch/first [setr(0,locate(%#,%0,e))]|[or(ismember(get(zone(%q0)/D.OWNERS),%#),isstaff(%#))][isdbref(zone(%q0))][ismember(owners tenants keys none,%1)]=*|0*,{@pemit %#=Huh?%b%b(Type "help" for help.)},#-1|*,{@pemit %#=No such exit: %0},#-2|*,{@pemit %#=Too many matches. Please be more specific.},*|10*,{@pemit %#=That exit is not set up as part of a building project.},*|110,{@pemit %#=You may only set a lock to owners, tenants, keys, or none.},*|111,{&D.LOCK-%q0 me=[ifelse(strmatch(%1,none),,lcstr(%1))];&D.LOCK-[setr(1,regrab(iter(lexits(loc(%q0)),if(strmatch(where(%q0),loc(%i0)),%i0)),.+))] me=[ifelse(strmatch(%1,none),,lcstr(%1))];@if [strmatch(none,%1)]={@unlock %q0;@unlock %q1;&LOCK %q0;&LOCK %q1},{&LOCK %q0=\[\u(\zone(me)/FN.CANLOCK,\%#,\num(me))\];&LOCK %q1=\[\u(\zone(me)/FN.CANLOCK,\%#,\num(me))\];@lock %q0=LOCK/1;@lock %q1=LOCK/1;@fail %q0=You do not have a key.;@fail %q1=You do not have a key.};@pemit %#=Done. Lock type for [name(%q0)] and [name(%q1)] set to [lcstr(%1)].}
&CMD.SETLOCK/ONLY Business Build Parent=$+setlock/only *=*:@switch/first [setr(0,locate(%#,%0,e))]|[or(ismember(get(zone(%q0)/D.OWNERS),%#),isstaff(%#))][isdbref(zone(%q0))][ismember(owners tenants keys none,%1)]=*|0*,{@pemit %#=Huh?%b%b(Type "help" for help.)},#-1|*,{@pemit %#=No such exit: %0},#-2|*,{@pemit %#=Too many matches. Please be more specific.},*|10*,{@pemit %#=That exit is not set up as part of a building project.},*|110,{@pemit %#=You may only set a lock to owners, tenants, keys, or none.},*|111,{&D.LOCK-%q0 me=[ifelse(strmatch(%1,none),,lcstr(%1))];@if [strmatch(none,%1)]={@unlock %q0;&LOCK %q0},{&LOCK %q0=\[\u(\zone(me)/FN.CANLOCK,\%#,\num(me))\];@lock %q0=LOCK/1;@fail %q0=You do not have a key.};@pemit %#=Done. Lock type for [name(%q0)] set to [lcstr(%1)]. Note that this does not set the lock type for the "other side" of the exit.}
&CMD.BUILDHELP Business Build Parent=$+buildhelp:@switch [or(ismember(v(D.OWNERS),%#),ismember(v(D.TENANTS),%#),isstaff(%#))]=0,{@pemit %#=Huh?%b%b(Type "help" for help.)},1,{@pemit %#=[header(Building Project Commands)]%r[rjust(+buildhelp,17)]:%b%bShows this dialog.%r[if(or(ismember(v(D.TENANTS),%#),isstaff(%#)),[subheader(Tenant Commands)]%r[rjust(+givekey *,17)]:%b%b[wrap(Gives a key to a player. This will allow them to open any locks in the project that are set to "keys".,58,,,,20)]%r[rjust(+takekey *,17)]:%b%b[wrap(Takes a key away from a player.,58,,,,20)]%r[rjust(+keys,17)]:%b%bShows a list of all keyholders.%r)][if(or(ismember(v(D.OWNERS),%#),isstaff(%#)),[subheader(Owner Commands)]%r[rjust(+setlock *=*,17)]:%b%b[wrap(Sets the lock type of an exit. Options are owners\\\, tenants\\\, keys\\\, and none. Exits set "none" cannot be locked. Exits set 'keys' can be locked and unlocked by keyholders\\\, tenants\\\, and owners. Locks set 'tenants' can be locked and unlocked by tenants and owners. Locks set 'owners' can be locked and unlocked only by owners. In all cases\\\, anyone who can lock or unlock the exit will pass it automatically. They only need to unlock it to let through people who are not on the list. This command automatically sets the same lock type on the corresponding exit from the other side.,58,,,,20)]%r[rjust(+setlock/only *=*,17)]:%b%b[wrap(As +setlock\\\, but only for the target exit.,58,,,,20)]%r[rjust(+addtenant *,17)]:%b%b[wrap(Adds a player to the list of tenants.,58,,,,20)]%r[rjust(+deltenant *,17)]:%b%b[wrap(Removes a player from the list of tenants.,58,,,,20)]%r[rjust(+tenants,17)]:%b%bShows a list of all tenants.%r[rjust(+owners,17)]:%b%bShows a list of all owners.%r)][if(isstaff(%#),[subheader(Staff Commands)]%r[rjust(+addowner *,17)]:%b%b[wrap(Adds a player as an owner of a project.,58,,,,20)]%r[rjust(+delowner *,17)]:%b%b[wrap(Removes a player from the list of owners.,58,,,,20)]%r)][footer()]}
&CMD.KEYS Business Build Parent=$+keys:@switch [or(ismember(v(D.OWNERS),%#),ismember(v(D.TENANTS),%#),isstaff(%#))][t(setr(0,v(D.KEYLIST)))]=0*,{@pemit %#=Huh?%b%b(Type "help" for help.)},10,{@pemit %#=There are no keyholders for [rest(name(me),:%b)].},,11,{@pemit %#=The following people are keyholders for [rest(name(me),:%b)]: [itemize(iter(v(D.KEYLIST),name(%i0),,|),|)].}
&CMD.TENANTS Business Build Parent=$+tenants:@switch [or(ismember(v(D.OWNERS),%#),isstaff(%#))][t(setr(0,v(D.TENANTS)))]=0*,{@pemit %#=Huh?%b%b(Type "help" for help.)},10,{@pemit %#=There are no tenants for [rest(name(me),:%b)].},11,{@pemit %#=The following people are tenants of [rest(name(me),:%b)]: [itemize(iter(v(D.TENANTS),name(%i0),,|),|)].}
&CMD.OWNERS Business Build Parent=$+owners:@switch [or(ismember(v(D.OWNERS),%#),isstaff(%#))][t(setr(0,v(D.OWNERS)))]=0*,{@pemit %#=Huh?%b%b(Type "help" for help.)},10,{@pemit %#=There are no owners set for [rest(name(me),:%b)].},11,{@pemit %#=The following people are owners of [rest(name(me),:%b)]: [itemize(iter(v(D.OWNERS),name(%i0),,|),|)].}
&FN.CANLOCK Business Build Parent=switch(v(D.LOCK-%1),owners,or(ismember(v(D.OWNERS),%0),isstaff(%0)),tenants,or(ismember(v(D.OWNERS),%0),ismember(v(D.TENANTS),%0),isstaff(%0)),keys,or(ismember(v(D.OWNERS),%0),ismember(v(D.TENANTS),%0),ismember(v(D.KEYLIST),%0),isstaff(%0)),0)
&FN.DESC Business Build Parent=if(or(ismember(v(D.OWNERS),%0),ismember(v(D.TENANTS),%0),isstaff(%0)),%r%r[center(See +buildhelp for Building Project commands,78)])
@chown Business Build Parent=#3
@set Business Build Parent=!HALTED INHERIT SAFE
@@
@@ #47: Residential Build Parent
@@
@create Residential Build Parent=10
&CMD.ADDOWNER Residential Build Parent=$+addowner *:@switch [isstaff(%#)][isdbref(setr(0,pmatch(%0)))]=0*,{@pemit %#=Huh?%b%b(Type "help" for help.)},10,{@pemit %#=No such player: %0},11,{&D.OWNERS me=[setunion(v(D.OWNERS),%q0)];@pemit %#=Done. [name(%q0)] added to the list of owners for [rest(name(me),:%b)].}
&CMD.DELOWNER Residential Build Parent=$+delowner *:@switch [isstaff(%#)][ismember(v(D.OWNERS),setr(0,pmatch(%0)))]=0*,{@pemit %#=Huh?%b%b(Type "help" for help.)},10,{@pemit %#=That player is not currently an owner.},11,{&D.OWNERS me=[setdiff(v(D.OWNERS),%q0)];@pemit %#=Done. [name(%q0)] removed from the list of owners for [rest(name(me),:%b)].}
&CMD.ADDTENANT Residential Build Parent=$+addtenant *:@switch [or(ismember(v(D.OWNERS),%#),isstaff(%#))][isdbref(setr(0,pmatch(%0)))]=0*,{@pemit %#=Huh?%b%b(Type "help" for help.)},10,{@pemit %#=No such player: %0},11,{&D.TENANTS me=[setunion(v(D.TENANTS),%q0)];@pemit %#=Done. [name(%q0)] added to the list of tenants for [rest(name(me),:%b)].}
&CMD.DELTENANT Residential Build Parent=$+deltenant *:@switch [or(ismember(v(D.OWNERS),%#),isstaff(%#))][ismember(v(D.TENANTS),setr(0,pmatch(%0)))]=0*,{@pemit %#=Huh?%b%b(Type "help" for help.)},10,{@pemit %#=That player is not currently a tenant.},11,{&D.TENANTS me=[setdiff(v(D.TENANTS),%q0)];@pemit %#=Done. [name(%q0)] removed from the list of tenants for [rest(name(me),:%b)].}
&CMD.GIVEKEY Residential Build Parent=$+givekey *:@switch [or(ismember(v(D.OWNERS,%#),%#),ismember(v(D.TENANTS),%#),isstaff(%#))][isdbref(setr(0,pmatch(%0)))]=0*,{@pemit %#=Huh?%b%b(Type "help" for help.)},10,{@pemit %#=No such player: %0},11,{&D.KEYLIST me=[setunion(v(D.KEYLIST),%q0)];@pemit %#=Done. [name(%q0)] added to the list of keyholders for [rest(name(me),:%b)].}
&CMD.TAKEKEY Residential Build Parent=$+takekey *:@switch [or(ismember(v(D.OWNERS,%#),%#),ismember(v(D.TENANTS),%#),isstaff(%#))][ismember(v(D.KEYLIST),setr(0,pmatch(%0)))]=0*,{@pemit %#=Huh?%b%b(Type "help" for help.)},10,{@pemit %#=That player is not currently a keyholder.},11,{&D.KEYLIST me=[setdiff(v(D.KEYLIST),%q0)];@pemit %#=Done. [name(%q0)] removed from the list of keyholders for [rest(name(me),:%b)].}
&CMD.SETLOCK Residential Build Parent=$+setlock *=*:@switch/first [setr(0,locate(%#,%0,e))]|[or(ismember(get(zone(%q0)/D.OWNERS),%#),isstaff(%#))][isdbref(zone(%q0))][ismember(owners tenants keys none,%1)]=*|0*,{@pemit %#=Huh?%b%b(Type "help" for help.)},#-1|*,{@pemit %#=No such exit: %0},#-2|*,{@pemit %#=Too many matches. Please be more specific.},*|10*,{@pemit %#=That exit is not set up as part of a building project.},*|110,{@pemit %#=You may only set a lock to owners, tenants, keys, or none.},*|111,{&D.LOCK-%q0 me=[ifelse(strmatch(%1,none),,lcstr(%1))];&D.LOCK-[setr(1,regrab(iter(lexits(loc(%q0)),if(strmatch(where(%q0),loc(%i0)),%i0)),.+))] me=[ifelse(strmatch(%1,none),,lcstr(%1))];@if [strmatch(none,%1)]={@unlock %q0;@unlock %q1;&LOCK %q0;&LOCK %q1},{&LOCK %q0=\[\u(\zone(me)/FN.CANLOCK,\%#,\num(me))\];&LOCK %q1=\[\u(\zone(me)/FN.CANLOCK,\%#,\num(me))\];@lock %q0=LOCK/1;@lock %q1=LOCK/1;@fail %q0=You do not have a key.;@fail %q1=You do not have a key.};@pemit %#=Done. Lock type for [name(%q0)] and [name(%q1)] set to [lcstr(%1)].}
&CMD.SETLOCK/ONLY Residential Build Parent=$+setlock/only *=*:@switch/first [setr(0,locate(%#,%0,e))]|[or(ismember(get(zone(%q0)/D.OWNERS),%#),isstaff(%#))][isdbref(zone(%q0))][ismember(owners tenants keys none,%1)]=*|0*,{@pemit %#=Huh?%b%b(Type "help" for help.)},#-1|*,{@pemit %#=No such exit: %0},#-2|*,{@pemit %#=Too many matches. Please be more specific.},*|10*,{@pemit %#=That exit is not set up as part of a building project.},*|110,{@pemit %#=You may only set a lock to owners, tenants, keys, or none.},*|111,{&D.LOCK-%q0 me=[ifelse(strmatch(%1,none),,lcstr(%1))];@if [strmatch(none,%1)]={@unlock %q0;&LOCK %q0},{&LOCK %q0=\[\u(\zone(me)/FN.CANLOCK,\%#,\num(me))\];@lock %q0=LOCK/1;@fail %q0=You do not have a key.};@pemit %#=Done. Lock type for [name(%q0)] set to [lcstr(%1)]. Note that this does not set the lock type for the "other side" of the exit.}
&CMD.BUILDHELP Residential Build Parent=$+buildhelp:@switch [or(ismember(v(D.OWNERS),%#),ismember(v(D.TENANTS),%#),isstaff(%#))]=0,{@pemit %#=Huh?%b%b(Type "help" for help.)},1,{@pemit %#=[header(Building Project Commands)]%r[rjust(+buildhelp,17)]:%b%bShows this dialog.%r[if(or(ismember(v(D.TENANTS),%#),isstaff(%#)),[subheader(Tenant Commands)]%r[rjust(+givekey *,17)]:%b%b[wrap(Gives a key to a player. This will allow them to open any locks in the project that are set to "keys".,58,,,,20)]%r[rjust(+takekey *,17)]:%b%b[wrap(Takes a key away from a player.,58,,,,20)]%r[rjust(+keys,17)]:%b%bShows a list of all keyholders.%r)][if(or(ismember(v(D.OWNERS),%#),isstaff(%#)),[subheader(Owner Commands)]%r[rjust(+setlock *=*,17)]:%b%b[wrap(Sets the lock type of an exit. Options are owners\\\, tenants\\\, keys\\\, and none. Exits set "none" cannot be locked. Exits set 'keys' can be locked and unlocked by keyholders\\\, tenants\\\, and owners. Locks set 'tenants' can be locked and unlocked by tenants and owners. Locks set 'owners' can be locked and unlocked only by owners. In all cases\\\, anyone who can lock or unlock the exit will pass it automatically. They only need to unlock it to let through people who are not on the list. This command automatically sets the same lock type on the corresponding exit from the other side.,58,,,,20)]%r[rjust(+setlock/only *=*,17)]:%b%b[wrap(As +setlock\\\, but only for the target exit.,58,,,,20)]%r[rjust(+addtenant *,17)]:%b%b[wrap(Adds a player to the list of tenants.,58,,,,20)]%r[rjust(+deltenant *,17)]:%b%b[wrap(Removes a player from the list of tenants.,58,,,,20)]%r[rjust(+tenants,17)]:%b%bShows a list of all tenants.%r[rjust(+owners,17)]:%b%bShows a list of all owners.%r)][if(isstaff(%#),[subheader(Staff Commands)]%r[rjust(+addowner *,17)]:%b%b[wrap(Adds a player as an owner of a project.,58,,,,20)]%r[rjust(+delowner *,17)]:%b%b[wrap(Removes a player from the list of owners.,58,,,,20)]%r)][footer()]}
&CMD.KEYS Residential Build Parent=$+keys:@switch [or(ismember(v(D.OWNERS),%#),ismember(v(D.TENANTS),%#),isstaff(%#))][t(setr(0,v(D.KEYLIST)))]=0*,{@pemit %#=Huh?%b%b(Type "help" for help.)},10,{@pemit %#=There are no keyholders for [rest(name(me),:%b)].},,11,{@pemit %#=The following people are keyholders for [rest(name(me),:%b)]: [itemize(iter(v(D.KEYLIST),name(%i0),,|),|)].}
&CMD.TENANTS Residential Build Parent=$+tenants:@switch [or(ismember(v(D.OWNERS),%#),isstaff(%#))][t(setr(0,v(D.TENANTS)))]=0*,{@pemit %#=Huh?%b%b(Type "help" for help.)},10,{@pemit %#=There are no tenants for [rest(name(me),:%b)].},11,{@pemit %#=The following people are tenants of [rest(name(me),:%b)]: [itemize(iter(v(D.TENANTS),name(%i0),,|),|)].}
&CMD.OWNERS Residential Build Parent=$+owners:@switch [or(ismember(v(D.OWNERS),%#),isstaff(%#))][t(setr(0,v(D.OWNERS)))]=0*,{@pemit %#=Huh?%b%b(Type "help" for help.)},10,{@pemit %#=There are no owners set for [rest(name(me),:%b)].},11,{@pemit %#=The following people are owners of [rest(name(me),:%b)]: [itemize(iter(v(D.OWNERS),name(%i0),,|),|)].}
&FN.DESC Residential Build Parent=if(or(ismember(v(D.OWNERS),%0),ismember(v(D.TENANTS),%0),isstaff(%0)),%r%r[center(See +buildhelp for Building Project commands,78)])
&FN.CANLOCK Residential Build Parent=switch(v(D.LOCK-%1),owners,or(ismember(v(D.OWNERS),%0),isstaff(%0)),tenants,or(ismember(v(D.OWNERS),%0),ismember(v(D.TENANTS),%0),isstaff(%0)),keys,or(ismember(v(D.OWNERS),%0),ismember(v(D.TENANTS),%0),ismember(v(D.KEYLIST),%0),isstaff(%0)),0)
@chown Residential Build Parent=#3
@set Residential Build Parent=!HALTED INHERIT SAFE
@@
@@ #48: <OS> Object Storage
@@
@create <OS> Object Storage=10
@chown <OS> Object Storage=#3
@set <OS> Object Storage=!HALTED SAFE
@@
@@ #49: Public Channel
@@
think [ansi(hc,MUX Core:)] Creating channels...
@ccreate Public
@create Channel Object: Public
@chown Channel Object: Public=#3
@set Channel Object: Public=!HALTED SAFE
@cchown Public=#3
@cset/object Public=#49
@cset/log Public=200
@cset/timestamp_logs Public=1
@@
@@ #50: Guests Channel
@@
@ccreate Guests
@create Channel Object: Guests
@chown Channel Object: Guests=#3
@set Channel Object: Guests=!HALTED SAFE
@cchown Guests=#3
@cset/object Guests=#50
@cset/log Guests=200
@cset/timestamp_logs Guests=1
@@
@@ #51: Scan Channel
@@
@ccreate Scan
@create Channel Object: Scan
@chown Channel Object: Scan=#3
@set Channel Object: Scan=!HALTED SAFE
@cchown Scan=#3
@cset/object Scan=#51
@cset/log Scan=200
@cset/timestamp_logs Scan=1
@cpflags Scan=!join
@coflags Scan=!join
&JOIN #51=isstaff(%#)
@lock #51=JOIN/1
@fo #3={addcom scan=Scan;addcom pub=Public;addcom g=Guests}
@fo #4={addcom scan=Scan;addcom pub=Public;addcom g=Guests}
@parent #0=#45
@parent #2=#45
@tel #0
@@
@@ #52-#54: Staff Nexus
@@
think [ansi(hc,MUX Core:)] @Restarting and seting up basic rooms.
@restart
@dig Staff Nexus=Staff Nexus <SN>;staff;nexus;sn,Limbo <O>;limbo;o;back
&ISSTAFF #53=isstaff(%#)
@lock #53=isstaff/1
@fail #53=You must be Staff to enter the Staff Nexus.
@dolist #52 #53 #54={@chown ##=#4;@set ##=!HALTED}
@@
@@ #55-#57: Building Nexus
@dig Building Nexus=Building Nexus <BN>;building;nexus;bn,Limbo <O>;limbo;o;back
@set #55=LINK_OK OPEN_OK
&LINK #55=or(isstaff(%#),haspower(%#,BUILDER))
&OPEN #55=or(isstaff(%#),and(haspower(%#,BUILDER),eq(ladd(iter(lexits(#57),if(strmatch(%#,owner(%i0)),1))),0)))
@lock/linklock #55=LINK/1
@lock/openlock #55=OPEN/1
sn
@dolist #55 #56 #57={@chown ##=#4;@set ##=!HALTED}
@@
@@ #58-#60: Auxiliary Room
@@
@dig Auxiliary Room=Auxiliary Room <AUX>;auxiliary;room;aux,Out <O>;out;o;back
@dolist #58 #59 #60={@chown ##=#4;@set ##=!HALTED}
@@
@@ Final Setup!
@@
think [ansi(hc,MUX Core:)] Almost done. Performing final housecleaning.
@tel #51=#48
@tel #50=#48
@tel #49=#48
@tel #47=#48
@tel #46=#48
@tel #45=#48
@tel #48=#58
@tel #10=#58
@tel #5=#58
@tel #0
@attribute/access JOBSB=WIZARD
@attribute/access JOBSH=HIDDEN
@fo me=@pcreate Guest Parent=[scramble(sha1(secs(,6)))]
@restart
think [ansi(hc,MUX Core:)] MUX Core installation complete. Initial passwords for #1, CodeWIZ, and BuildWIZ are set to 'potrzebie'. You should use the @newpassword command to change them at this time.