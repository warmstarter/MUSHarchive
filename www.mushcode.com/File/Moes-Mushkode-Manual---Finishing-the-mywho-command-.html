<!doctype html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>Code: Moe&#39;s Mushkode Manual - Finishing the mywho command.</title>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <!-- Apple devices fullscreen -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <!-- Apple devices fullscreen -->
    <meta names="apple-mobile-web-app-status-bar-style" content="black-translucent" />

    <!-- Bootstrap -->
	<link rel="stylesheet" href="../Theme/Flat/html/css/bootstrap.min.css">
	<!-- Bootstrap responsive -->
	<link rel="stylesheet" href="../Theme/Flat/html/css/bootstrap-responsive.min.css">
	<!-- jQuery UI -->
	<link rel="stylesheet" href="../Theme/Flat/html/css/plugins/jquery-ui/smoothness/jquery-ui.css">
	<link rel="stylesheet" href="../Theme/Flat/html/css/plugins/jquery-ui/smoothness/jquery.ui.theme.css">
	<!-- Theme CSS -->
	<link rel="stylesheet" href="../Theme/Flat/html/css/style.css">
	<!-- Color CSS -->
	<link rel="stylesheet" href="../Theme/Flat/html/css/themes.css">


    <link rel="stylesheet" href="../Content/site.css">

    <!-- jQuery -->
    <script src="../Theme/Flat/html/js/jquery.min.js"></script>
    <!-- Nice Scroll -->
    <script src="../Theme/Flat/html/js/plugins/nicescroll/jquery.nicescroll.min.js"></script>
    <!-- jQuery UI -->
    <script src="../Theme/Flat/html/js/plugins/jquery-ui/jquery.ui.core.min.js"></script>
    <script src="../Theme/Flat/html/js/plugins/jquery-ui/jquery.ui.widget.min.js"></script>
    <script src="../Theme/Flat/html/js/plugins/jquery-ui/jquery.ui.mouse.min.js"></script>
    <script src="../Theme/Flat/html/js/plugins/jquery-ui/jquery.ui.resizable.min.js"></script>
    <script src="../Theme/Flat/html/js/plugins/jquery-ui/jquery.ui.sortable.min.js"></script>
    <!-- slimScroll -->
    <script src="../Theme/Flat/html/js/plugins/slimscroll/jquery.slimscroll.min.js"></script>
    <!-- Bootstrap -->
    <script src="../Theme/Flat/html/js/bootstrap.min.js"></script>
    <!-- Form -->
    <script src="../Theme/Flat/html/js/plugins/form/jquery.form.min.js"></script>

    <!-- Theme framework -->
    <script src="../Theme/Flat/html/js/eakroko.min.js"></script>
    <!-- Theme scripts -->
    <script src="../Theme/Flat/html/js/application.min.js"></script>

    <!--[if lte IE 9]>
		<script src="js/plugins/placeholder/jquery.placeholder.min.js"></script>
		<script>
			$(document).ready(function() {
				$('input, textarea').placeholder();
			});
		</script>
	<![endif]-->

    <!-- Favicon -->
    <link rel="shortcut icon" href="http://www.mushcode.com/File/img/favicon.ico" />
    <!-- Apple devices Homescreen icon -->
    <link rel="apple-touch-icon-precomposed" href="http://www.mushcode.com/File/img/apple-touch-icon-precomposed.png" />

</head>

<body class="theme-green">
    <div id="navigation">
        <div class="container-fluid">
            <a href="../index.html" id="brand">MUSHCode.com</a>
        </div>
    </div>
    <div class="container-fluid" id="content">
        <div id="left">
            <div class="subnav">
                <div class="subnav-title">
                    <a href="Moes-Mushkode-Manual---Finishing-the-mywho-command-.html#" class='toggle-subnav'>
                        <i class="icon-angle-down"></i>
                        <span>About</span>
                    </a>
                </div>
                <ul class="subnav-menu">
                    <li>
                        <a href="../index.html">Overview</a>
                    </li>
                </ul>
            </div>
            <div class="subnav">
                <div class="subnav-title">
                    <a href="Moes-Mushkode-Manual---Finishing-the-mywho-command-.html#" class='toggle-subnav'>
                        <i class="icon-angle-down"></i>
                        <span>Files</span>
                    </a>
                </div>
                <ul class="subnav-menu">
                    <li class='dropdown'>
                        <a href="Moes-Mushkode-Manual---Finishing-the-mywho-command-.html#" data-toggle="dropdown">Code</a>
                        
<ul class="dropdown-menu">
        <li>
            <a href="../Category/Administration.html">Administration</a>
        </li>
        <li>
            <a href="../Category/Building.html">Building</a>
        </li>
        <li>
            <a href="../Category/Bulletin-Board.html">Bulletin Board</a>
        </li>
        <li>
            <a href="../Category/Combat.html">Combat</a>
        </li>
        <li>
            <a href="../Category/Dynamic-Space.html">Dynamic Space</a>
        </li>
        <li>
            <a href="../Category/Fonts.html">Fonts</a>
        </li>
        <li>
            <a href="../Category/Functions.html">Functions</a>
        </li>
        <li>
            <a href="../Category/Games.html">Games</a>
        </li>
        <li>
            <a href="../Category/Globals.html">Globals</a>
        </li>
        <li>
            <a href="../Category/Mail-Systems.html">Mail Systems</a>
        </li>
        <li>
            <a href="../Category/Other.html">Other</a>
        </li>
        <li>
            <a href="../Category/Schedulers.html">Schedulers</a>
        </li>
        <li>
            <a href="../Category/Time.html">Time</a>
        </li>
        <li>
            <a href="../Category/Vehicles.html">Vehicles</a>
        </li>
        <li>
            <a href="../Category/Vendors.html">Vendors</a>
        </li>
        <li>
            <a href="../Category/Weather-Systems.html">Weather Systems</a>
        </li>
</ul>
                    </li>
                    <li class='dropdown'>
                        <a href="Moes-Mushkode-Manual---Finishing-the-mywho-command-.html#" data-toggle="dropdown">Classes</a>
                        
<ul class="dropdown-menu">
        <li>
            <a href="../Category/Administration.html">Administration</a>
        </li>
        <li>
            <a href="../Category/Building.html">Building</a>
        </li>
        <li>
            <a href="../Category/Globals.html">Globals</a>
        </li>
        <li>
            <a href="../Category/Hardcode.html">Hardcode</a>
        </li>
        <li>
            <a href="../Category/Other.html">Other</a>
        </li>
        <li>
            <a href="../Category/Softcode.html">Softcode</a>
        </li>
</ul>
                    </li>
                    <li>
                        <a href="../Manuals.html">Manuals</a>
                    </li>
                </ul>
            </div>
            <div class="subnav">
                <div class="subnav-title">
                    <a href="Moes-Mushkode-Manual---Finishing-the-mywho-command-.html#" class='toggle-subnav'>
                        <i class="icon-angle-down"></i>
                        <span>Misc</span>
                    </a>
                </div>
                <ul class="subnav-menu">
                    <li>
                        <a href="../Ascii2Mu.html">ASCII To MUSHCode</a>
                    </li>
                    <li>
                        <a href="../MushList.html">MUSH/MUX List</a>
                    </li>
                    <li>
                        <a href="../MushRoom.html">MUSHRoom</a>
                    </li>
                </ul>
            </div>
            <div class="subnav">
                <div class="subnav-title">
                    <a href="Moes-Mushkode-Manual---Finishing-the-mywho-command-.html#" class='toggle-subnav'>
                        <i class="icon-angle-down"></i>
                        <span>Contribute</span>
                    </a>
                </div>
                <ul class="subnav-menu">
                    <li>
                        <a href="../Submit.html">Submit</a>
                    </li>
                </ul>
            </div>
        </div>
        <div id="main">
            <div class="container-fluid">
                <div class="breadcrumbs">
                    <ul>
                        
    <li>
        <a href="../index.html">Home</a>
        <i class="icon-angle-right"></i>
    </li>
    <li>
        <a href="../Category/Globals.html">Globals</a>
        <i class="icon-angle-right"></i>
    </li>
    <li>
        <a href="Moes-Mushkode-Manual---Finishing-the-mywho-command-.html#">Moe&#39;s Mushkode Manual - Finishing the mywho command.</a>
    </li>

                    </ul>
                </div>
                <div class="row-fluid">
                    <div class="span12">
                        



<div class="box">
    <div class="box-title title">
        <h2>
            Moe&#39;s Mushkode Manual - Finishing the mywho command.
        </h2>
    </div>
    <div class="box-content">

        <div class="description">
            <p></p>
        </div>

        <div class="author">
            <strong>Author:</strong>
                <a href="../Author/Moe.html">Moe</a>
        </div>

        <div class="author">
            <strong>Category:</strong>
            <a href="../Category/Globals.html">Globals</a>
        </div>


            <div class="functions">
                <strong>Functions:</strong>
                        <a href="../Function/add.html" class="function">add&#40;&#41;</a>,
                        <a href="../Function/and.html" class="function">and&#40;&#41;</a>,
                        <a href="../Function/default.html" class="function">default&#40;&#41;</a>,
                        <a href="../Function/div.html" class="function">div&#40;&#41;</a>,
                        <a href="../Function/fdiv.html" class="function">fdiv&#40;&#41;</a>,
                        <a href="../Function/functions.html" class="function">functions&#40;&#41;</a>,
                        <a href="../Function/gt.html" class="function">gt&#40;&#41;</a>,
                        <a href="../Function/gte.html" class="function">gte&#40;&#41;</a>,
                        <a href="../Function/idle.html" class="function">idle&#40;&#41;</a>,
                        <a href="../Function/ifelse.html" class="function">ifelse&#40;&#41;</a>,
                        <a href="../Function/iter.html" class="function">iter&#40;&#41;</a>,
                        <a href="../Function/left.html" class="function">left&#40;&#41;</a>,
                        <a href="../Function/ljust.html" class="function">ljust&#40;&#41;</a>,
                        <a href="../Function/log.html" class="function">log&#40;&#41;</a>,
                        <a href="../Function/lwho.html" class="function">lwho&#40;&#41;</a>,
                        <a href="../Function/mod.html" class="function">mod&#40;&#41;</a>,
                        <a href="../Function/mul.html" class="function">mul&#40;&#41;</a>,
                        <a href="../Function/mwho.html" class="function">mwho&#40;&#41;</a>,
                        <a href="../Function/name.html" class="function">name&#40;&#41;</a>,
                        <a href="../Function/not.html" class="function">not&#40;&#41;</a>,
                        <a href="../Function/nwho.html" class="function">nwho&#40;&#41;</a>,
                        <a href="../Function/or.html" class="function">or&#40;&#41;</a>,
                        <a href="../Function/setdiff.html" class="function">setdiff&#40;&#41;</a>,
                        <a href="../Function/setinter.html" class="function">setinter&#40;&#41;</a>,
                        <a href="../Function/setq.html" class="function">setq&#40;&#41;</a>,
                        <a href="../Function/setr.html" class="function">setr&#40;&#41;</a>,
                        <a href="../Function/setunion.html" class="function">setunion&#40;&#41;</a>,
                        <a href="../Function/sort.html" class="function">sort&#40;&#41;</a>,
                        <a href="../Function/sqrt.html" class="function">sqrt&#40;&#41;</a>,
                        <a href="../Function/sub.html" class="function">sub&#40;&#41;</a>,
                        <a href="../Function/switch.html" class="function">switch&#40;&#41;</a>,
                        <a href="../Function/timestring.html" class="function">timestring&#40;&#41;</a>,
                        <a href="../Function/u.html" class="function">u&#40;&#41;</a>,
                        <a href="../Function/words.html" class="function">words&#40;&#41;</a>.
            </div>


            <div class="servers">
                <strong>Compatibility:</strong>
                        <a href="../Server/CobraMUSH.html" class="server">CobraMUSH</a>,
                        <a href="../Server/PennMUSH.html" class="server">PennMUSH</a>.
            </div>

    </div>
</div>


<div class="box box-bordered box-condensed">
    <div class="box-title">
        <h3>
	        <i class="icon-reorder"></i>
	        MUSHCode for Moe&#39;s Mushkode Manual - Finishing the mywho command.
        </h3>
        <div class="actions">
	        <a class="btn btn-mini select-all" href="Moes-Mushkode-Manual---Finishing-the-mywho-command-.html#">
                    <i class="icon-resize-full"></i> Select Content
            </a>
        </div>
    </div>
    <div id="code" class="box-content content">
        ~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*<br/>|\    /|       |\    /|         |\    /|<br/>| \  / |       | \  / |         | \  / |<br/>|  \/  |oe's   |  \/  |ushkode  |  \/  |anual<br/>~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*<br/><br/>Lesson 3 - HOW DO I REALLY MAKE THIS STUFF HUM?<br/><br/>	When last we met, we had extended our mywho command quite a ways,<br/>so that it was now bordered with graphical headers, and displayed its<br/>information in nicely-justified columns. We had a variety of information<br/>being displayed, including name, fullname if set, and their gender(@sex).<br/>We discussed how to put colour into our displays, and we separated our<br/>code into commands and ufuns.<br/>	When we were done, we had code that looked a lot like:<br/><br/>&amp;cmd_mywho obj=$mywho:@pemit<br/>%#=u(cmdheader,mywho)[iter(lwho(),u(fn-sex,##),,%R)][u(cmdfooter)] &amp;fn-sex<br/>obj=[ljust(left(default(%0/fullname,name(%0)),24),25)][default(%0/sex,Not<br/>set.)]<br/><br/>	Look familiar? Make sense? Again, if it at least makes sense, we<br/>can keep going, and learn some more stuff. If it doesn't make sense, go<br/>back to Lesson 2, or even 1 if you need to. It's better that you take the<br/>time to learn it. The MMM will still be here when you get back.<br/><br/>STORING VALUES IN MEMORY<br/><br/>	There will often be cases in mushcode where you are going to need<br/>to reference a value many many times. It's quite possible that this value<br/>is going to be produced by code you have written. And it's also possible<br/>that it would be cumbersome to have to type all of that code over and over<br/>again, each time you wanted that value. All a bunch of hypotheses, right?<br/>	Wrong. Let's show a practical example. Why don't we compute how<br/>many players are connected, and display that value at the end of our<br/>mywho. It really is simple, given the combination of the lwho() and the<br/>words() functions.<br/>	Remember from your rules that in mushcode, everything is a list.<br/>lwho(), as we know, returns a list of dbrefs of connected players. The<br/>words() function tells us how many 'words' or elements, are in a list. So,<br/>words(lwho()) would tell us the number of connected players.<br/>	And here, I'm going to start showing you how to accomodate for<br/>most every case you're going to find as a mushcoder. Quite often, a player<br/>will lose their connection, and wind up being on twice. We can account for<br/>this, in our representation of how many players are online, through the<br/>use of the setunion() function.<br/><br/>MERGING LISTS<br/><br/>	I'll take a minute here and talk about merging lists using the<br/>setunion(), setdiff(), and setinter() functions. These are functions for<br/>merging two lists that may or may not have items similar in each list.<br/>There are two things to remember about using these list-merging functions.<br/>	One, they are all case-sensitive. A bummer, so if case is an issue<br/>with your lists, make sure that you account for things like this when<br/>merging them. setinter(dan bob al,Dan bob Billy) is only going to return<br/>'bob', because 'dan' and 'Dan' don't match.<br/>	Two, the list that these functions returns will be sorted, in the<br/>best manner the game knows how. Read help sort() for more information<br/>about how the game's parser sorts things. Standard ways are<br/>alphabetically(also called lexicographically), numerically, or by dbref.<br/>The list that is returned will be sorted, so if the original order is an<br/>issue, then it's likely you should choose another way to merge your lists.<br/><br/>BACK TO MYWHO<br/><br/>	Now, why did I go off on that tangent about merging lists? Here's<br/>why: setunion(lwho(),lwho()) is going to return for us a sorted list of<br/>dbrefs, with all duplicates removed. Yes, we are merging two lists, as it<br/>is two instances of the lwho() list. The setunion() function returns all<br/>members of both lists, with duplicates removed. This can also be<br/>accomplished with setinter(), and it will produce the same results.<br/>	This is because setinter() returns the individual elements that<br/>are present in both lists, with duplicates removed. The list will be<br/>sorted, of course. The particular method you choose to use is up to you,<br/>as they both produce identical output, in /this/ case. Obviously, their<br/>behaviour is different when you have two lists that are not identical to<br/>each other in every way, as our two lwho() lists are.<br/>	Now, to make this work for us, in a manner that tells us how many<br/>players are connected, we should have the following code snippet, to count<br/>the number of connected players:<br/><br/>	words(setunion(lwho(),lwho()))<br/><br/>	For Wizards that are making their own @functions for their games,<br/>I personally suggest this one just as a nice cosmetic global function,<br/>named something like nwho(), as opposed to lwho(), or Penn's mwho(). The<br/>'n' is for 'number', of course. Give yourself a cookie if you figured that<br/>one out, too.<br/>	Now, where is this going to go? It could conceivably be anywhere<br/>in the display, but logically, it should go at the end of our display,<br/>just before the footer graphic.<br/><br/>&amp;cmd_mywho obj=$mywho:@pemit<br/>%#=u(cmdheader,mywho)[iter(lwho(),u(fn-sex,##),,%R)]<br/>%R[words(setunion(lwho(),lwho()))] players connected.[u(cmdfooter)]<br/><br/>	Now, if you go way back, you'll see that the title of this section<br/>of the lesson is about setting values into memory. Here's where we will<br/>give an example of that. You'll notice in the above code that we use<br/>lwho() three times. Why shouldn't we just use it once, set it into memory,<br/>and then be able to call that value into our code whenever we want, using<br/>a simple %-substitution?<br/><br/>SETR() AND SETQ() - NOW YOU SEE 'EM, NOW YOU DON'T<br/><br/>	The mush allows you to set ten(on Penn, thirty-six) temporary<br/>values into memory. These only last as long as it takes to run your single<br/>piece of code, and then are dropped into the abyss. They are numbered 0-9,<br/>and are set through the use of the setr() and setq() functions. Both of<br/>these functions operate on the same set of memory, but their behaviour is<br/>different. For those of you who thrive on mnemonic learning, the 'r' in<br/>setr() can stand for 'reveal', and the 'q' in setq() can stand for<br/>'quell'.<br/>	These words are chosen based on how the two functions act when you<br/>use them. The setr() function sets a value into memory, and allows it to<br/>be viewed at the same time, including it in the output. The setq()<br/>function sets the value into memory and obscures it from view, or quells<br/>it from the output.<br/>	Here's an example. To the mush, the sentence 'This is a<br/>[setr(0,good)] test.' would look like:<br/>	This is a good test.  However, the sentence 'This is a<br/>[setq(0,good)] test.' would look like:<br/>	This is a test.<br/><br/>	The setq() function removes the value it is setting from the<br/>output, while setr() both sets it and includes it into the output. As you<br/>can tell from the examples, you specify the number of the memory register<br/>into which you wish to place the value. In this example, we used 0.<br/>	Now, whether you have set the value using setr() or setq(), it can<br/>only be referenced by the substitutions %q0-%q9. In the example above, %q0<br/>would be 'good'. If you want to test this, run the following code:<br/><br/>think This is a [setr(0,good)] test. %q0<br/><br/>	You'll get 'This is a good test. good'. If you don't, you did<br/>something wrong, I guarantee it. Many people ask why setr() doesn't have<br/>%r0-%r9. Remember that %r is the substitution for a carriage return. And<br/>since both setr() and setq() are setting values into memory, why not just<br/>have one substitution by which to reference them?<br/><br/>APPLYING SETR()<br/><br/>	What we want to be able to do is take our first instance of lwho()<br/>and set it into memory, thereby calling it by %q0 later in the code. Doing<br/>so will wind up in something that looks a lot like this:<br/><br/>&amp;cmd_mywho obj=$mywho:@pemit<br/>%#=u(cmdheader,mywho)[iter(setr(0,lwho()),u(fn-sex,##),,%R)]<br/>%R[words(setunion(%q0,%q0))] players connected.[u(cmdfooter)]<br/><br/>	Not overly dramatic? Let's make a more practical example.<br/>Grammatically, it's more correct to say 'There is 1 player connected.',<br/>rather than having 'There are 1 players connected.' being the message in<br/>the case where only one person is on the game. Let's use switch(),<br/>words(), setr(), and two new functions to us, gt() and ifelse(), to make<br/>our code use better grammar.<br/><br/>IFELSE() VS. SWITCH()<br/><br/>	If you have a situation where you are going to be testing a<br/>boolean(1 or 0, true or false), it is syntactically better to use the<br/>ifelse() function, which says if &lt;test case&gt; is true, do &lt;this&gt;, else(if<br/>it's not true) do &lt;this&gt;. It looks like: ifelse(&lt;testcase&gt;,&lt;actions if<br/>true&gt;,&lt;actions if false&gt;). You can use switch(), but if all you are<br/>testing for is 1 or 0, it's best to use ifelse().<br/>	Why am I talking about this? Because our case is that we need to<br/>test and see if the number of people connected is greater than 1. This is<br/>a simple binary question, as it either is greater than 1, or it is not<br/>greater than 1. We can test this using the gt() function, which yes, does<br/>stand for 'greater than'. And we already have code in place to find how<br/>many people are connected. So, now we should put it all together.<br/><br/>	ifelse(gt(words(setunion(%q0,%q0)),1),There are<br/>[words(setunion(%q0,%q0))] players connected.,There is 1 player<br/>connected.)<br/><br/>	Interesting, and as you can see, a touch unwieldy. We re-use the<br/>words 'There' and 'connected.', and re-use the code<br/>[words(setunion(%q0,%q0))] as well. Let's look at another implementation<br/>of setr() to help us trim this down a bit, as well as rearranging things<br/>just a tad to make it smoother.<br/><br/>	There [ifelse(gt(setr(1,words(setunion(%q0,%q0))),1),are %q1<br/>players,is %q1 player)] connected.<br/><br/>	As you can see, it's much more streamlined, easy to read, easy to<br/>maintain, and logical in its function. So, if we fit this into our code,<br/>it now looks like:<br/><br/>&amp;cmd_mywho obj=$mywho:@pemit<br/>%#=u(cmdheader,mywho)[iter(setr(0,lwho()),u(fn-sex,##),,%R)] %RThere<br/>[ifelse(gt(setr(1,words(setunion(%q0,%q0))),1),are %q1 players,is %q1<br/>player)] connected.[u(cmdfooter)]<br/><br/>MATH! AIEEEEE!<br/><br/>	Okay, we're going to put one last flourishing touch on our mywho<br/>command, by including a third column which will display the idle time for<br/>each of the connected players. We are going to do this the hard way, using<br/>a fair number of the math functions. PennMUSH has the timestring()<br/>function, which does the formatting we're about to do, for you.<br/>TinyMUSH2.2 and 3.0 do not, nor does MUX, so we shall have to do it for<br/>ourselves. It's a good exercise, and teaches us about mushcode's math<br/>functions.<br/>	To start with, we're going to tidy things up a bit, and add some<br/>column headers to our code. Since our ufun is going to be doing all of our<br/>display now, doing both fullname, gender, /and/ idle time, we should<br/>probably change its name to fn-display, rather than fn-sex. Use your<br/>particularl codebase's flavour of @mvattr to change fn-sex to fn-display.<br/>And we're going to retype our cmd_mywho in a minute, so we'll do that<br/>edition there.<br/>	What we want to do is put headers on each of our three columns:<br/>Name, Gender, and Idle. This is a relatively simple process, and involves<br/>us left-justifying the first two, and leaving the third to sit by itself.<br/>We already have the measurement of 25 spaces for the first column,<br/>leftover from our fn-sex(now fn-display, remember?), so now we just need<br/>to make a measurement for our middle column. We know that of our two<br/>primary choices, Male and Female, that Female is six letters long. And we<br/>also know that unless kept in the strictest of circumstances, some yokel<br/>is going to put something other than just Male or Female, so we'll give<br/>them ten spaces to play with. Also remember that we do have it constructed<br/>to display 'Not set.' which is 8 characters, so ten is a really safe bet<br/>for us. Now, our mywho will look something like this:<br/><br/>&amp;cmd_mywho obj=$mywho:@pemit<br/>%#=u(cmdheader,mywho)[ljust(Name,25)][ljust(Gender,10)]Idle<br/>%R[ljust(----,25)][ljust(------,10)]----%R[iter(setr(0,lwho()),u(fn-display,##),,%R)]<br/>%RThere [ifelse(gt(setr(1,words(setunion(%q0,%q0))),1),are %q1 players,is<br/>%q1 player)] connected.[u(cmdfooter)]<br/><br/>	Yes, I put a little line under our headers, just to separate them<br/>from the following text. And now we need to add the functionality of<br/>computing the idle time to our fn-display. This is our old fn-sex,<br/>remember? Let's remember what it looks like again:<br/><br/>&amp;fn-display<br/>obj=[ljust(left(default(%0/fullname,name(%0)),24),25)][default(%0/sex,Not<br/>set.)]<br/><br/>	All familiar, sensible, understandable code, yes? Alright, the<br/>first thing we need to do is left-justify our gender display. Now it<br/>becomes:<br/><br/>&amp;fn-display<br/>obj=[ljust(left(default(%0/fullname,name(%0)),24),25)][ljust(default(%0/sex,Not<br/>set.),10)]<br/><br/>	And at long last, let's dive into the math business. When I say<br/>computing idle time, I mean I want to be able to display this time in<br/>days, hours, minutes, and seconds. The mush provides us with a nice<br/>hardcoded function with which to fetch the number of seconds someone has<br/>been idle. Conveniently, and not surprisingly, it's called idle(). Go<br/>figure, eh? Doing idle(dbref) or idle(*name) will return the number of<br/>seconds a character has been idle, meaning they haven't entered any<br/>commands.<br/>	We know from gradeschool that there are 60 seconds in a minute, 60<br/>minutes in an hour, 24 hours in a day. We know that if you multiply 60 x<br/>60, you get 3600. If you wanted to find that out with mushcode, you could<br/>use the mul() function. It multiplies two numbers together. mul(60,60)<br/>returns 3600. Now, we want our display to handle days too, so it would<br/>help if we knew how many seconds there were in a day. After all, we're<br/>getting our initial data(the idle() return) in seconds. If you do:<br/><br/>	think mul(3600,24)<br/><br/>	Which is the number of seconds in an hour, multiplied by the<br/>number of hours in a day, you learn that there are 86,400 seconds in an<br/>hour. Nifty, no? Well, kind of, at least. When planning mathematical<br/>computations such as this, we need to consider how our display should<br/>look. If the person hasn't been idle more than a day, we don't need to<br/>display a measurement of days. Similarly, if they haven't been idle more<br/>than an hour, there is no need to display an hour measurement.<br/>	So, what we can figure on doing two primary math functions. We<br/>need to be able to find out how many equal divisions we have, and then<br/>compute the remaineder. There are two easy functions that mush gives us to<br/>use. They are div() and mod(). They are both divisory functions, but they<br/>behave quite differently.<br/>	The div() function tells you how many integer divisions you have.<br/>For example, div(6,3) is 2, since 3 x 2 = 6. div(7,3) is also 2, because 7<br/>divided by 3 is 2, with a 1 remainder. (You do remember this from 3rd<br/>grade, yes?). The mod() function, on the other hand, gives us the<br/>remainder. mod(6,3) is 0. 3 divides into 6 evenly. mod(7,3) is 1, because<br/>that is the remainder of the basic division. These two functions are going<br/>to be invaluable to us in our computation of h/m/s notation for the idle<br/>times of our connected players. SWITCH(), ON STEROIDS<br/><br/>	I'm going to combine a great deal of information together here,<br/>since they are all generally one step towards the writing of our idle<br/>computation function. And we'd better just plan on putting this into a<br/>ufun, as it's going to be kind of big, anyway. As I said above, we don't<br/>need to compute days of idle time if the player hasn't been idle more than<br/>a day, nor hours if they haven't been idle over an hour. Nor even minutes<br/>if they haven't been idle for over a minute.<br/>	There are two ways to accomplish this series of tests. The first<br/>is to nest a number of switches together, a la:<br/><br/>switch(gte(idle(dbref),86400),1,&lt;compute<br/>time&gt;,switch(gte(idle(dbref),3600),1,&lt;compute<br/>time&gt;,switch(gte(idle(dbref),60),1,&lt;compute time&gt;,idle(dbref))))<br/><br/>	Quite obviously, this is balky, a parenthetic nightmare, and a<br/>perfect case for using a setr() to store the idle() value. The gte()<br/>function I used above is a variation on the gt() function we have used<br/>already. gte() just stands for greater-than-or-equal-to. I used this<br/>because if their idle() is at /least/ equal to 1 day, 1 hour, or 1 minute,<br/>we need to report using that format. Below, I offer you a substitute<br/>method for doing what we did above, using one switch() in place of three.<br/>I will also reference the player as %0, since we know we're going to have<br/>this in a ufun, and would pass the value.<br/><br/>switch(gte(setr(0,idle(%0)),86400):[gte(%q0,3600)]:[gte(%q0,60)],1:*:*,&lt;compute<br/>d/h/m/s format&gt;,*:1:*,&lt;compute h/m/s/ format&gt;,*:*:1,&lt;compute m/s<br/>format&gt;,%q0s)<br/><br/>	Yes, this is a switch() with multiple cases. Since switch() will<br/>stop on the first match it makes, we can use the wildcards to represent<br/>the cases we aren't currently testing for. We set our cases up in the<br/>order in which we want to test them, and we leave the %q0 as a default,<br/>since we know that if it isn't a value larger than 86400, 3600, or 60,<br/>then it just needs to be reported as seconds.<br/>	Now, we can work on filling in the computation. Like I said<br/>before, we're going to rely on the div() and mod() functions to accomplish<br/>our math work. Let's look at our day computation. We first need to divide<br/>our idle() value by 86400, to determine how many days the character has<br/>been idle. Since we have set our idle() return in %q0 in the test data for<br/>our switch(), this is as simple as: div(%q0,86400).<br/>	Next, we need to find out how many hours outside of those days,<br/>the character has been idle. In order to get the remainder after our first<br/>div(), we'll use mod(). And divide that by 3600. div(mod(%q0,86400),3600)<br/>will give us our hours. Now, the next division down is the minutes. We<br/>will do another div(mod()) pair, though you will realize that you can get<br/>into more parenthetic nightmares. Here are two ways to do the next step,<br/>bad and good, in that order:<br/><br/>div(mod(%q0,86400),3600)h [div(mod(mod(%q0,86400),3600),60)]m<br/>div(setr(0,mod(%q0,86400)),3600)h [div(mod(%q0,3600),60)]m<br/><br/>	Yes, I reset %q0. After our initial division of days, the total<br/>idle time isn't necessary. What we need to do is just retain one value<br/>through step of our computation. We can just keep it in one q-register,<br/>and be fine. Less %q's to keep track of. We will do this one final step,<br/>to find out our seconds, and since this is a fair chunk of code, we can<br/>further put this into a ufun, so that now our code is going to look like:<br/><br/>&amp;fn-dayfmt obj=[div(%0,86400)]d [div(setr(0,mod(%0,86400)),3600)]h<br/>[div(setr(0,mod(%q0,3600)),60)]m [mod(%q0,60)]s<br/><br/>	Whoa?! Where'd that %0 come from? As a rule, I don't like to trust<br/>%q0's to be read between ufunctions. Some people disagree with me, and<br/>point to x, y, and z piece of hardcode, or a, b, and c system that is<br/>tried and true and does it. Great, bully for them. I do it my way, because<br/>I know that it has always worked for me. We will pass the %q0 from our<br/>fn-idle(we'll call it that since it is computing the idle time), with the<br/>syntax: u(fn-dayfmt,%q0).<br/><br/>FILLING IN THE HOLES<br/><br/>	Let's flesh out our fn-idle, really quick, since we will have<br/>fn-dayfmt, and fn-hrfmt. Minute/seconds are easily computed, so don't have<br/>to have their own ufun, and the seconds are the default. fn-idle now looks<br/>like:<br/><br/>&amp;fn-idle<br/>obj=[switch(gte(setr(0,idle(%0)),86400):[gte(%q0,3600)]:[gte(%q0,60)],1:*:*,u(fn-dayfmt,%q0),*:1:*,u(fn-hrfmt,%q0),*:*:1,div(%q0,60)m<br/>[mod(%q0,60)]s,%q0s)]<br/><br/><br/>	And we need to be able to call fn-idle from our fn-display(the old<br/>fn-sex, remember?), so we need to change fn-display to look like:<br/><br/>&amp;fn-display<br/>obj=[ljust(left(default(%0/fullname,name(%0)),24),25)][ljust(default(%0/sex,Not<br/>set.),10)][u(fn-idle,%0)]<br/><br/>	Yeah, it really is that simple. Okay, we've got our fn-idle, and<br/>our fn-dayfmt. Let's look at the fn-hrfmt, which is going to be an awful<br/>lot like our fn-dayfmt, just shorter. Our top level of computation is the<br/>hour, followed by minute and second, respectively. So:<br/><br/>&amp;fn-hrfmt obj=[div(%0,3600)]h [div(setr(0,mod(%0,3600)),60)]m<br/>[mod(%q0,60)]s<br/><br/>	Not too painful? Didn't think so. Now that we have that one in,<br/>and our minutes and seconds are already being calcualted in<br/>fn-idle...whoa..we're done! Yep, the mywho command is done, a whole thing.<br/>It has a number of features that make it a very useful command, and if put<br/>on an object in the master room of a mush could even be used as a global<br/>command, like a +who. Try it out, now that we've got it all typed in. Make<br/>sure you changed all references to fn-sex to fn-display. Give it a reading<br/>over, making sure that you've matched up all your brackets and<br/>parentheses.<br/>	If you're interested in higher level math functions(or lower level<br/>ones like add() and sub()), then go to your mush flavour of choice, and<br/>type: help math functions. You'll get a whole list of what is available,<br/>including, but not limited to, logical functions like and(), or(), and<br/>not(), as well as spunkier math like log(), sqrt() and fdiv().<br/><br/>LE FIN<br/><br/>	That's it for Lesson 3. Congratulate yourself if you've gotten<br/>this far. You've learned a lot(I hope), and you've studied the basics of<br/>making a mush command, modifying your output, and keeping your code<br/>logical, sound, and maintainable.<br/>	The latter is perhaps one of the most important things. By<br/>compartmentalizing some of the more complex functions, you've made it<br/>possible to isolate where things are breaking, more easily. By keeping a<br/>consistent naming scheme for your attributes, you've made it easy for both<br/>yourself and coders that come after you to fix or modify your code. By not<br/>using excessive brackets and curly braces, you've made your code a lot<br/>easier to read. And believe me, anything that helps make mushcode easy to<br/>read is worth putting the effort into doing.<br/>	Lesson 4 is going to go a different direction, as we're going to<br/>explore how to accept user input in our $commands, and we're going to<br/>apply that knowledge(as well as everything we have learned here), into the<br/>making of the infamous mush Vendor. I'm going to discuss what is loosely<br/>referred to as a 'coding system', meaning a number of commands that all<br/>act on the same set of data. Some of the things we'll go into in Lesson 4<br/>can be brought back and applied to your mywho, but as a command, it is<br/>complete.<br/>
    </div>
</div>
<script type="text/javascript">
    var selectText = function(element) {
        var doc = document;
        var text = doc.getElementById(element);

        if (doc.body.createTextRange) { // ms
            var range = doc.body.createTextRange();
            range.moveToElementText(text);
            range.select();
        } else if (window.getSelection) { // moz, opera, webkit
            var selection = window.getSelection();
            var range = doc.createRange();
            range.selectNodeContents(text);
            selection.removeAllRanges();
            selection.addRange(range);
        }
    }

    $('a.select-all').click(function () {
        selectText('code');
    });
</script>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
</body>

</html>
<script src="../Scripts/Google.js" type="text/javascript"></script>