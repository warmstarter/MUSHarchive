<!doctype html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>Code: MUSH Manual - Section III: Programming Applications</title>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <!-- Apple devices fullscreen -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <!-- Apple devices fullscreen -->
    <meta names="apple-mobile-web-app-status-bar-style" content="black-translucent" />

    <!-- Bootstrap -->
	<link rel="stylesheet" href="../Theme/Flat/html/css/bootstrap.min.css">
	<!-- Bootstrap responsive -->
	<link rel="stylesheet" href="../Theme/Flat/html/css/bootstrap-responsive.min.css">
	<!-- jQuery UI -->
	<link rel="stylesheet" href="../Theme/Flat/html/css/plugins/jquery-ui/smoothness/jquery-ui.css">
	<link rel="stylesheet" href="../Theme/Flat/html/css/plugins/jquery-ui/smoothness/jquery.ui.theme.css">
	<!-- Theme CSS -->
	<link rel="stylesheet" href="../Theme/Flat/html/css/style.css">
	<!-- Color CSS -->
	<link rel="stylesheet" href="../Theme/Flat/html/css/themes.css">


    <link rel="stylesheet" href="../Content/site.css">

    <!-- jQuery -->
    <script src="../Theme/Flat/html/js/jquery.min.js"></script>
    <!-- Nice Scroll -->
    <script src="../Theme/Flat/html/js/plugins/nicescroll/jquery.nicescroll.min.js"></script>
    <!-- jQuery UI -->
    <script src="../Theme/Flat/html/js/plugins/jquery-ui/jquery.ui.core.min.js"></script>
    <script src="../Theme/Flat/html/js/plugins/jquery-ui/jquery.ui.widget.min.js"></script>
    <script src="../Theme/Flat/html/js/plugins/jquery-ui/jquery.ui.mouse.min.js"></script>
    <script src="../Theme/Flat/html/js/plugins/jquery-ui/jquery.ui.resizable.min.js"></script>
    <script src="../Theme/Flat/html/js/plugins/jquery-ui/jquery.ui.sortable.min.js"></script>
    <!-- slimScroll -->
    <script src="../Theme/Flat/html/js/plugins/slimscroll/jquery.slimscroll.min.js"></script>
    <!-- Bootstrap -->
    <script src="../Theme/Flat/html/js/bootstrap.min.js"></script>
    <!-- Form -->
    <script src="../Theme/Flat/html/js/plugins/form/jquery.form.min.js"></script>

    <!-- Theme framework -->
    <script src="../Theme/Flat/html/js/eakroko.min.js"></script>
    <!-- Theme scripts -->
    <script src="../Theme/Flat/html/js/application.min.js"></script>

    <!--[if lte IE 9]>
		<script src="js/plugins/placeholder/jquery.placeholder.min.js"></script>
		<script>
			$(document).ready(function() {
				$('input, textarea').placeholder();
			});
		</script>
	<![endif]-->

    <!-- Favicon -->
    <link rel="shortcut icon" href="http://www.mushcode.com/File/img/favicon.ico" />
    <!-- Apple devices Homescreen icon -->
    <link rel="apple-touch-icon-precomposed" href="http://www.mushcode.com/File/img/apple-touch-icon-precomposed.png" />

</head>

<body class="theme-green">
    <div id="navigation">
        <div class="container-fluid">
            <a href="../index.html" id="brand">MUSHCode.com</a>
        </div>
    </div>
    <div class="container-fluid" id="content">
        <div id="left">
            <div class="subnav">
                <div class="subnav-title">
                    <a href="MUSH-Manual---Section-IIIColon-Programming-Applications.html#" class='toggle-subnav'>
                        <i class="icon-angle-down"></i>
                        <span>About</span>
                    </a>
                </div>
                <ul class="subnav-menu">
                    <li>
                        <a href="../index.html">Overview</a>
                    </li>
                </ul>
            </div>
            <div class="subnav">
                <div class="subnav-title">
                    <a href="MUSH-Manual---Section-IIIColon-Programming-Applications.html#" class='toggle-subnav'>
                        <i class="icon-angle-down"></i>
                        <span>Files</span>
                    </a>
                </div>
                <ul class="subnav-menu">
                    <li class='dropdown'>
                        <a href="MUSH-Manual---Section-IIIColon-Programming-Applications.html#" data-toggle="dropdown">Code</a>
                        
<ul class="dropdown-menu">
        <li>
            <a href="../Category/Administration.html">Administration</a>
        </li>
        <li>
            <a href="../Category/Building.html">Building</a>
        </li>
        <li>
            <a href="../Category/Bulletin-Board.html">Bulletin Board</a>
        </li>
        <li>
            <a href="../Category/Combat.html">Combat</a>
        </li>
        <li>
            <a href="../Category/Dynamic-Space.html">Dynamic Space</a>
        </li>
        <li>
            <a href="../Category/Fonts.html">Fonts</a>
        </li>
        <li>
            <a href="../Category/Functions.html">Functions</a>
        </li>
        <li>
            <a href="../Category/Games.html">Games</a>
        </li>
        <li>
            <a href="../Category/Globals.html">Globals</a>
        </li>
        <li>
            <a href="../Category/Mail-Systems.html">Mail Systems</a>
        </li>
        <li>
            <a href="../Category/Other.html">Other</a>
        </li>
        <li>
            <a href="../Category/Schedulers.html">Schedulers</a>
        </li>
        <li>
            <a href="../Category/Time.html">Time</a>
        </li>
        <li>
            <a href="../Category/Vehicles.html">Vehicles</a>
        </li>
        <li>
            <a href="../Category/Vendors.html">Vendors</a>
        </li>
        <li>
            <a href="../Category/Weather-Systems.html">Weather Systems</a>
        </li>
</ul>
                    </li>
                    <li class='dropdown'>
                        <a href="MUSH-Manual---Section-IIIColon-Programming-Applications.html#" data-toggle="dropdown">Classes</a>
                        
<ul class="dropdown-menu">
        <li>
            <a href="../Category/Administration.html">Administration</a>
        </li>
        <li>
            <a href="../Category/Building.html">Building</a>
        </li>
        <li>
            <a href="../Category/Globals.html">Globals</a>
        </li>
        <li>
            <a href="../Category/Hardcode.html">Hardcode</a>
        </li>
        <li>
            <a href="../Category/Other.html">Other</a>
        </li>
        <li>
            <a href="../Category/Softcode.html">Softcode</a>
        </li>
</ul>
                    </li>
                    <li>
                        <a href="../Manuals.html">Manuals</a>
                    </li>
                </ul>
            </div>
            <div class="subnav">
                <div class="subnav-title">
                    <a href="MUSH-Manual---Section-IIIColon-Programming-Applications.html#" class='toggle-subnav'>
                        <i class="icon-angle-down"></i>
                        <span>Misc</span>
                    </a>
                </div>
                <ul class="subnav-menu">
                    <li>
                        <a href="../Ascii2Mu.html">ASCII To MUSHCode</a>
                    </li>
                    <li>
                        <a href="../MushList.html">MUSH/MUX List</a>
                    </li>
                    <li>
                        <a href="../MushRoom.html">MUSHRoom</a>
                    </li>
                </ul>
            </div>
            <div class="subnav">
                <div class="subnav-title">
                    <a href="MUSH-Manual---Section-IIIColon-Programming-Applications.html#" class='toggle-subnav'>
                        <i class="icon-angle-down"></i>
                        <span>Contribute</span>
                    </a>
                </div>
                <ul class="subnav-menu">
                    <li>
                        <a href="../Submit.html">Submit</a>
                    </li>
                </ul>
            </div>
        </div>
        <div id="main">
            <div class="container-fluid">
                <div class="breadcrumbs">
                    <ul>
                        
    <li>
        <a href="../index.html">Home</a>
        <i class="icon-angle-right"></i>
    </li>
    <li>
        <a href="../Category/Softcode.html">Softcode</a>
        <i class="icon-angle-right"></i>
    </li>
    <li>
        <a href="MUSH-Manual---Section-IIIColon-Programming-Applications.html#">MUSH Manual - Section III: Programming Applications</a>
    </li>

                    </ul>
                </div>
                <div class="row-fluid">
                    <div class="span12">
                        



<div class="box">
    <div class="box-title title">
        <h2>
            MUSH Manual - Section III: Programming Applications
        </h2>
    </div>
    <div class="box-content">

        <div class="description">
            <p></p>
        </div>

        <div class="author">
            <strong>Author:</strong>
                <a href="../Author/Amberyl.html">Amberyl</a>
        </div>

        <div class="author">
            <strong>Category:</strong>
            <a href="../Category/Softcode.html">Softcode</a>
        </div>

            <div class="commands">
            <strong>Commands:</strong>
                    <a href="../Command/@aenter.html" class="command">@aenter</a>,
                    <a href="../Command/@apayment.html" class="command">@apayment</a>,
                    <a href="http://www.mushcode.com/Command/@create" class="command">@create</a>,
                    <a href="../Command/@destroy.html" class="command">@destroy</a>,
                    <a href="http://www.mushcode.com/Command/@dolist" class="command">@dolist</a>,
                    <a href="http://www.mushcode.com/Command/@emit" class="command">@emit</a>,
                    <a href="../Command/@enter.html" class="command">@enter</a>,
                    <a href="../Command/@filter.html" class="command">@filter</a>,
                    <a href="http://www.mushcode.com/Command/@force" class="command">@force</a>,
                    <a href="../Command/@fpose.html" class="command">@fpose</a>,
                    <a href="../Command/@idescribe.html" class="command">@idescribe</a>,
                    <a href="../Command/@infilter.html" class="command">@infilter</a>,
                    <a href="../Command/@leave.html" class="command">@leave</a>,
                    <a href="../Command/@listen.html" class="command">@listen</a>,
                    <a href="http://www.mushcode.com/Command/@lock" class="command">@lock</a>,
                    <a href="../Command/@notify.html" class="command">@notify</a>,
                    <a href="../Command/@oenter.html" class="command">@oenter</a>,
                    <a href="../Command/@oleave.html" class="command">@oleave</a>,
                    <a href="../Command/@oxenter.html" class="command">@oxenter</a>,
                    <a href="../Command/@oxleave.html" class="command">@oxleave</a>,
                    <a href="http://www.mushcode.com/Command/@pemit" class="command">@pemit</a>,
                    <a href="../Command/@prefix.html" class="command">@prefix</a>,
                    <a href="http://www.mushcode.com/Command/@set" class="command">@set</a>,
                    <a href="http://www.mushcode.com/Command/@switch" class="command">@switch</a>,
                    <a href="http://www.mushcode.com/Command/@teleport" class="command">@teleport</a>,
                    <a href="http://www.mushcode.com/Command/@trigger" class="command">@trigger</a>,
                    <a href="../Command/@unlock.html" class="command">@unlock</a>,
                    <a href="http://www.mushcode.com/Command/@va" class="command">@va</a>,
                    <a href="http://www.mushcode.com/Command/@vb" class="command">@vb</a>,
                    <a href="http://www.mushcode.com/Command/@vc" class="command">@vc</a>,
                    <a href="../Command/@vd.html" class="command">@vd</a>,
                    <a href="../Command/@ve.html" class="command">@ve</a>,
                    <a href="http://www.mushcode.com/Command/@wait" class="command">@wait</a>.
            </div>

            <div class="functions">
                <strong>Functions:</strong>
                        <a href="../Function/add.html" class="function">add&#40;&#41;</a>,
                        <a href="../Function/capstr.html" class="function">capstr&#40;&#41;</a>,
                        <a href="../Function/elements.html" class="function">elements&#40;&#41;</a>,
                        <a href="../Function/escape.html" class="function">escape&#40;&#41;</a>,
                        <a href="../Function/extract.html" class="function">extract&#40;&#41;</a>,
                        <a href="../Function/first.html" class="function">first&#40;&#41;</a>,
                        <a href="../Function/flags.html" class="function">flags&#40;&#41;</a>,
                        <a href="../Function/get.html" class="function">get&#40;&#41;</a>,
                        <a href="../Function/grab.html" class="function">grab&#40;&#41;</a>,
                        <a href="../Function/hasflag.html" class="function">hasflag&#40;&#41;</a>,
                        <a href="../Function/home.html" class="function">home&#40;&#41;</a>,
                        <a href="../Function/iter.html" class="function">iter&#40;&#41;</a>,
                        <a href="../Function/last.html" class="function">last&#40;&#41;</a>,
                        <a href="../Function/lattr.html" class="function">lattr&#40;&#41;</a>,
                        <a href="../Function/lcon.html" class="function">lcon&#40;&#41;</a>,
                        <a href="../Function/lcstr.html" class="function">lcstr&#40;&#41;</a>,
                        <a href="../Function/lexits.html" class="function">lexits&#40;&#41;</a>,
                        <a href="../Function/lnum.html" class="function">lnum&#40;&#41;</a>,
                        <a href="../Function/loc.html" class="function">loc&#40;&#41;</a>,
                        <a href="../Function/lwho.html" class="function">lwho&#40;&#41;</a>,
                        <a href="../Function/match.html" class="function">match&#40;&#41;</a>,
                        <a href="../Function/matchall.html" class="function">matchall&#40;&#41;</a>,
                        <a href="../Function/member.html" class="function">member&#40;&#41;</a>,
                        <a href="../Function/mid.html" class="function">mid&#40;&#41;</a>,
                        <a href="../Function/name.html" class="function">name&#40;&#41;</a>,
                        <a href="../Function/nearby.html" class="function">nearby&#40;&#41;</a>,
                        <a href="../Function/num.html" class="function">num&#40;&#41;</a>,
                        <a href="../Function/pos.html" class="function">pos&#40;&#41;</a>,
                        <a href="../Function/r.html" class="function">r&#40;&#41;</a>,
                        <a href="../Function/rand.html" class="function">rand&#40;&#41;</a>,
                        <a href="../Function/rest.html" class="function">rest&#40;&#41;</a>,
                        <a href="../Function/round.html" class="function">round&#40;&#41;</a>,
                        <a href="../Function/s.html" class="function">s&#40;&#41;</a>,
                        <a href="../Function/secs.html" class="function">secs&#40;&#41;</a>,
                        <a href="../Function/secure.html" class="function">secure&#40;&#41;</a>,
                        <a href="../Function/strcat.html" class="function">strcat&#40;&#41;</a>,
                        <a href="../Function/strlen.html" class="function">strlen&#40;&#41;</a>,
                        <a href="../Function/switch.html" class="function">switch&#40;&#41;</a>,
                        <a href="../Function/trunc.html" class="function">trunc&#40;&#41;</a>,
                        <a href="../Function/type.html" class="function">type&#40;&#41;</a>,
                        <a href="../Function/u.html" class="function">u&#40;&#41;</a>,
                        <a href="../Function/ucstr.html" class="function">ucstr&#40;&#41;</a>,
                        <a href="../Function/v.html" class="function">v&#40;&#41;</a>,
                        <a href="../Function/words.html" class="function">words&#40;&#41;</a>,
                        <a href="../Function/zfun.html" class="function">zfun&#40;&#41;</a>.
            </div>


            <div class="servers">
                <strong>Compatibility:</strong>
                        <a href="../Server/TinyMUSH.html" class="server">TinyMUSH</a>,
                        <a href="../Server/TinyMUX.html" class="server">TinyMUX</a>.
            </div>

    </div>
</div>


<div class="box box-bordered box-condensed">
    <div class="box-title">
        <h3>
	        <i class="icon-reorder"></i>
	        MUSHCode for MUSH Manual - Section III: Programming Applications
        </h3>
        <div class="actions">
	        <a class="btn btn-mini select-all" href="MUSH-Manual---Section-IIIColon-Programming-Applications.html#">
                    <i class="icon-resize-full"></i> Select Content
            </a>
        </div>
    </div>
    <div id="code" class="box-content content">
        MUSH Manual Version 2.008:<br/>   Copyright 1993, 1994, 1995, Lydia Leong (lwl@netcom.com / Amberyl)<br/>   Last revised 5/22/95.<br/><br/>Section III: Programming Applications<br/><br/>5. Vehicle programming<br/> 5.1  Entering and leaving objects: @enter, @aenter, @oenter, @oxenter,<br/>      @leave, @aleave, @oleave, @oxleave<br/> 5.2  Inside vehicles: @idesc, @listen, relays, and commands, @remit, <br/>      AUDIBLE, @prefix, @filter, @forwardlist<br/> 5.3  Do it!  --  Wagon controller<br/>6. Complex programming<br/> 6.1  Useful functions: <br/>         General use: NUM(), LOC(), NEARBY()<br/>         List creation: LCON(), LEXITS(), LATTR(), LWHO()<br/>         Parsing: POS(), FIRST(), REST(), STRLEN(), MID(), WORDS()<br/>         Matching: EXTRACT(), MATCH(), MEMBER(), UCSTR(), LCSTR(), CAPSTR()<br/> 6.2  Non-standard attributes: &amp; and attribute flags<br/> 6.3  Introduction to @dolist<br/> 6.4  Time synchronization: semaphores, complex @wait, @notify, @drain<br/> 6.5  Security problems in programming, INHERIT, ESCAPE(), SECURE(),<br/>         @fsay, @femit, @fpose<br/> 6.6  Debugging: PUPPET and VERBOSE<br/> 6.7  On the New Programming Style<br/> 6.8  Hints and tips<br/>7. MUSH Programming: QuickStart Guide<br/> 7.1  Basic syntax<br/> 7.2  Conditional and loop constructs<br/> 7.3  Functions<br/><br/><br/>5. Vehicle programming<br/><br/>5.1   Entering and leaving objects<br/><br/>Objects can be used as containers if they are set ENTER_OK. You can<br/>enter an object by typing "enter &lt;object&gt;" and exit an object by typing<br/>"leave". You may enter any object that you own or is set ENTER_OK, and,<br/>in 1.50, that you pass the enter lock of.<br/><br/>You may set EALIAS and LALIAS attributes on objects. The string in<br/>these two aliases may be used as a substitute for "enter &lt;object&gt;" and<br/>"leave".<br/><br/>Entering an object triggers the messages @enter, @oenter, @oxenter, and<br/>@aenter. The player who enters is shown the @enter message. The others inside<br/>the object see the @oenter message. People in the room that the player just<br/>left (which may not necessarily be the same room that the object is in, if<br/>the object is @tel'ed to) see the @oxenter message. @aenter is the action<br/>list to be executed.<br/><br/>Leaving an object triggers the @leave, @oleave, @oxleave, and @aleave<br/>messages. @leave is shown to the leaving player, @oleave is shown to the<br/>things inside the object the player just left, @oxleave is shown to the <br/>things in the room the player goes to (not the room that the container object<br/>is in  - if the player teleports or goes home, for example, the @oxleave<br/>message is shown at the player's destination). @aleave is the action list<br/>to be executed.<br/><br/>========================<br/>[ Example 5.1:  Wagon ]<br/>[ This creates the most basic of container objects ]<br/>&gt; @create Wagon<br/>Wagon created as object #953<br/>&gt; @enter wagon=You climb into the wagon.<br/>Set.<br/>&gt; @oenter wagon=climbs up into this wagon.<br/>Set.<br/>&gt; @oxenter wagon=climbs up into the wagon.<br/>Set.<br/>&gt; @leave wagon=You climb down from the wagon.<br/>Set.<br/>&gt; @oleave wagon=climbs off this wagon.<br/>Set.<br/>&gt; @oxleave wagon=climbs off the wagon.<br/>Set.<br/>&gt; @set wagon=enter_ok<br/>Set.<br/>========================<br/><br/><br/>5.2   Inside objects: internal descriptions, echoing, and relays<br/><br/>An object's internal description - the description displayed to those<br/>inside it - can be set using @idesc &lt;object&gt;=&lt;description&gt;. This functions<br/>identically to @desc, except it is only visible by those inside.<br/><br/>To enable those inside the object to hear what is going on outside, set<br/>the @listen of the container to *. Anything that is in the object's @listen<br/>match will be relayed to the occupants.<br/><br/>Talking and posing within objects is identical to talking and posing in<br/>rooms. Unless there is some sort of relay set up (described below), only those<br/>inside the object can hear you. <br/><br/>* * * * *<br/><br/>It is frequently useful to be able to talk to the outside world, and<br/>perform other actions, like looking at the room that the object is in. This<br/>is best done with user-defined commands on an object which is placed inside<br/>the container object. It's a bad idea to define the commands directly on the<br/>container, since they can be used by those who are outside the object.<br/><br/>The simplest way to handle looking outside is to do a user-defined<br/>command which forces the object to do a "look".  This is extremely inelegant,<br/>though. On MUSHes which provide it (all 1.50 and most 2.0), the command<br/>"look/outside" will allow you to look outside the container you are in.<br/><br/>Taking objects which are outside, however, generally requires a<br/>user-defined command which forces the object to do a 'get' or @teleport.<br/><br/>* * * * *<br/><br/>In the past:<br/><br/>The simplest way of doing relays is to add special user-defined commands<br/>for say and pose which force the object to emit. When the object emits, both<br/>players inside and outside the object will hear the message.<br/><br/>Another, more direct, way of talking to the outside world from the<br/>inside - actually, of showing a message to only those outside - is to<br/>use @emit/room. This outputs the message to the outermost container - the<br/>room that the wagon or similar object is in.<br/><br/>* * * * *<br/><br/>The 'best' way to relay information, however, is to use the AUDIBLE <br/>flag. This flag essentially outputs text from one place to another, without<br/>danger of looping.<br/><br/>When set on an object, anything "said" (posed, emitted, etc.) inside <br/>the object will be broadcast to the object's location, prepended with the<br/>string "From &lt;name of AUDIBLE object&gt;,"  The AUDIBLE object does not receive<br/>its own propagated messages, nor does it bounce back things it hears via<br/>"@listen *" from the outside world.<br/><br/>AUDIBLE exits "funnel" noise from their source room to their <br/>destination room. In 1.50, the room itself must be set AUDIBLE, to activate<br/>AUDIBLE exits. The AUDIBLE exit propagates the message to the next room<br/>and no farther; if there are AUDIBLE exits in the next room, they do NOT<br/>pass the information on to their destinations. Messages channeled through<br/>AUDIBLE exits are prepended with, "From &lt;name of AUDIBLE exit's source&gt;,"<br/>(1.50) or "From a distance,"  (2.0).<br/><br/>2.0 also provides an additional command, @forwardlist. This command,<br/>with the syntax "@forwardlist &lt;object&gt;=&lt;space-separated list of dbrefs&gt;",<br/>forwards all messages heard by &lt;object&gt; to every object in the list of<br/>dbrefs. &lt;object&gt; must have its AUDIBLE flag set.<br/><br/>You can filter out messages by setting the @filter attribute with<br/>a (possibly wildcarded) pattern to suppress. For example, if you don't<br/>want "&lt;name&gt; has left." messages, "@filter &lt;exit&gt;=* has left.", and messages<br/>matching that pattern will not be propagated. You can have more than one<br/>pattern; they should be separated by commas.  (i.e., you can do:<br/>"@filter &lt;exit&gt;=* has left.,* has arrived." to suppress both arrival<br/>and departure messages). If the pattern contains a comma, the entire<br/>pattern should be enclosed in curly braces {} (just like in @switch).<br/><br/>You can change the string prepended to propagated messages via<br/>the "@prefix" attribute on the AUDIBLE object. The game always puts a <br/>space between the prefix and the propagated message. Generally, prefixes<br/>are of the format, "From Mnedranth's back,"  or  "In the gazebo,"  or<br/>the like -- something which indicates where the message is coming from.<br/>The game automatically prepends one if the @prefix attribute is not set.<br/>There are times when it is desirable to have no prefix prepended at all;<br/>in those cases, set the @prefix attribute to "\". <br/><br/>There is an additional refinement: @infilter and @inprefix.<br/>@infilter suppresses text that is normally sent to the object via @listen<br/>(usually "@listen *"). @inprefix will prefix text forwarded from the outside<br/>with a string. Normally, text forwarded via @listen is not prepended with<br/>anything.<br/><br/><br/>5.3   Do it!  --  Wagon controller<br/><br/>This section assumes that you have created a wagon as described in<br/>example 5.1. Below, &lt;#wagon&gt; refers to the dbref number of that wagon, and<br/>&lt;#cont&gt; refers to the dbref number of the controller.<br/><br/>Enter the following commands:<br/><br/>@idesc &lt;#wagon&gt;=&lt;description&gt;<br/>@listen &lt;#wagon&gt;=*<br/>@create Wagon controller<br/>@lock control=me<br/>drop control<br/><br/>Possibilities:<br/><br/>This is the old way of doing things:<br/>@va &lt;#cont&gt;=$'*:@fo &lt;#wagon&gt;=@emit {On the wagon, %N says, "%0"}<br/>@vb &lt;#cont&gt;=$.*:@fo &lt;#wagon&gt;=@emit {On the wagon, %N %0}<br/>[ These two commands define ' and . as alternates to " and : inside the wagon.<br/>  They relay to the outside world, as well as to those inside the vehicle.<br/>  There is one major problem with this: because of the @listen, the players<br/>  inside the wagon hear exactly what the wagon hears, which is the message<br/>  "You emit: &lt;whatever&gt;"  This is ugly, but it's effective. ]<br/>@vc &lt;#cont&gt;=$view:@fo &lt;#wagon&gt;=l<br/>@vd &lt;#cont&gt;=$view *:@fo &lt;#wagon&gt;=l %0<br/>[ These two commands substitute for look. ]<br/><br/>This is the new way of doing things:<br/>@set &lt;#wagon&gt;=AUDIBLE<br/>@prefix &lt;#wagon&gt;=On the wagon,<br/>[ There is no need for the view command; "look/outside" will suffice. ]<br/><br/>@ve &lt;#cont&gt;=$snag *:@fo &lt;#wagon&gt;=get %0<br/>[ This command forces the wagon to get an object outside. ]<br/><br/><br/>6.    Complex programming<br/><br/>6.1   Useful functions<br/><br/>Often, you will want to build machines that accept input from players <br/>only; the NUM() function is useful for checking whether or not something<br/>is a player. Simply evaluate: num(*%N), assuming that you are checking if<br/>the enactor is a player. The * forces %N to be evaluated as a player; if<br/>there is no player by that name, the function returns "#-1". The only case<br/>in which this trick with num(*%N) fails is if the enactor has the same<br/>name as a player.  You can also use the TYPE() function to see if an<br/>object is a player.<br/><br/>* * * * *<br/><br/>The LOC() function is useful for several things. If it is used to<br/>locate a player, it will return the number of the player's location, assuming<br/>that the player is not set UNFINDABLE. If it is used to locate an object<br/>that you control, it will return the number of its location. It will return<br/>#-1 if you try to locate an object you don't control. Used on an exit,<br/>LOC() will return the dbref number of the exit's destination (to get an<br/>exit's source, use the HOME() function). The LOC() function returns the<br/>drop-to of a room; usually, this is #-1.<br/><br/>Related to the loc function is the %L substitution. This returns<br/>the location of the enactor. Since it requires the enactor to trigger<br/>off a command of some sort, however, it cannot replace the LOC() function,<br/>unless you just want LOC(%#).<br/><br/>* * * * *<br/><br/>The NEARBY() function tests if one object is near another. It is<br/>called with: nearby(obj1,obj2). For this function to work, you must control<br/>at least one of the objects, or be near one of them. Object1 is considered<br/>to be nearby Object2 if it is in the same location, if it is being carried<br/>by Object2, or it is carrying Object2. If the two objects are nearby, the<br/>function returns a 1; otherwise, it returns 0.<br/><br/>* * * * *<br/><br/>The MUSH functions you will use most often will probably be those<br/>which return names and dbrefs. But almost all of MUSH programming involves <br/>the manipulation of lists - adding items, removing items, finding certain <br/>items within, etc. Lists, for MUSH purposes, are generally defined as a<br/>list of space-separated of words. The first word in a list is 1.<br/>Strings, on the other hand, are composed of arbitrary characters. The<br/>first character in a string is 0. Lists are basically special types of<br/>strings. Everything in MUSH is eventually treated as a string.<br/><br/>Several functions create lists: LCON(), LEXITS(), LATTR(), and LWHO() are<br/>perhaps the most frequently used of these. LCON() gives a list of the <br/>dbref numbers of all objects in a room (including dark objects). LEXITS() <br/>gives a list of the dbref numbers of all non-dark exits out of a room. <br/>LATTR() gives a list of all attributes on an object. LWHO() gives a list<br/>of all non-dark connected players.<br/><br/>* * * * *<br/><br/>Several functions are useful for parsing lists. The POS() function,<br/>called with pos(string1,string2), returns the position number of string1<br/>in string2. If string1 is not in string2, the function returns #-1. <br/>The first character is considered to be position 1. This function<br/>is particularly useful when checking flags on an object. For example, to<br/>check if an object is a puppet, check pos(p,flags(object))   If this returns<br/>anything but #-1, the object is a puppet.  (An easier way to do this is to <br/>use the HASFLAG function: HASFLAG(object,puppet) will return 1 if the object <br/>is a puppet).<br/><br/>For parsing, FIRST() and REST() are useful. They return the "head"<br/>and the "tail" of a list, respectively, and are basically identical to<br/>the LISP functions CAR() and CDR(). The "head" of a list is the first<br/>word in that list; the "tail" of the list is everything else. There's<br/>also the useful LAST() function in TinyMUSH 2.2, which returns the last<br/>word in a list.<br/><br/>The WORDS() function counts the number of words in a list. This is<br/>useful for a loop counter ("repeat this action until the counter variable<br/>is greater than the number of words in the list"), and for finding the<br/>last word in a list, which is done as follows:<br/>  Assuming that the list is in %0: extract(%0,words(%0),1)<br/>  This counts the number of words in the list, then uses extract to take a<br/>  one-word long list starting from that position - the last.<br/>(Of course, if you're programming in 2.2, you should just use the LAST()<br/>function instead of this somewhat-complicated extraction.)<br/><br/>The STRLEN() function returns the length of an entire string (list).<br/>It is extremely useful when used in conjunction with the MID() function.<br/>The latter is called with: mid(string,position of first character,length)<br/>and returns a string of &lt;length&gt; characters starting from &lt;position&gt;.<br/>The first character in the string is numbered 0, not 1.<br/>Supposing you wish to return a string starting with its third character.<br/>You would use: mid(string,2,strlen(string))<br/><br/>* * * * *<br/><br/>The EXTRACT() function, mentioned above, called with<br/>extract(list,first,length), is used to pull out words from the middle<br/>of a list. "Length" is the number of words to be extracted, _not_ the<br/>number of letters.<br/><br/>MATCH(), called with match(list,pattern), returns the number of the<br/>word where &lt;pattern&gt; first occurs. The first word in the list is numbered 1.<br/>If no match is found, the function will return 0. The pattern may be straight <br/>text, or it may contained the wildcards * and ?. The MEMBER() function is <br/>similar, except that it does not take wildcards, and is case-sensitive,<br/>so match(a B c d,b) will return 2, but member(a B c d,b) will return 0.<br/><br/>The case-sensitivity of MEMBER() can be worked around using the <br/>UCSTR(), LCSTR(), and CAPSTR() functions. These functions return a list with<br/>all letters capitalized, all letters in lowercase, or with the first letter<br/>of the first word of the list capitalized, respectively.<br/><br/>EXTRACT() and MATCH() functions can be combined to match two lists:<br/>  Suppose you have two registers, va and vb. The first contains a list of first<br/>  names, and the second contains a list of last names. Given a first name, you<br/>  want to find the last name. Assume that the first name given as input is in<br/>  %0, and that it is in the va. Then, the matching last name will be:<br/>  extract(v(vb),match(%va,%0),1)<br/>  It uses the match() function to find the position of the name in the first<br/>  name list, then uses extract() to get the word in the corresponding position<br/>  on the last name list.<br/><br/>There's a function which combines an EXTRACT() and MATCH(), called<br/>GRAB(). It takes the syntax "grab(list, wildcard)"; it finds the first<br/>element of the list which matches the wildcard, and returns that<br/>element. This is useful if you want to partial-match something, and<br/>then want to get its entire name. For example, the function call<br/>"grab(banana:yellow apple:red pear:green plum:purple, pear:*)" will<br/>return "pear:green".<br/><br/>* * * * *<br/><br/>There are two functions related to EXTRACT() and MATCH(), which operate<br/>on multiple elements of lists. They're called ELEMENTS() and MATCHALL().<br/>"matchall(list, wildcard)" will return the element numbers of all elements<br/>of the list which match. "extractall(list of words, list of numbers)"<br/>will return the elements of the list which correspond to the given list<br/>of numbers. These two functions can thus be combined to locate, and then<br/>grab, multiple elements of a list.<br/><br/>The MATCHALL() function can be used in conjunction with WORDS() to <br/>determine how many times a given word appears in a list, via<br/>"words(matchall(list, word))" -- MATCHALL() returns the list of<br/>element numbers which match, and the WORDS() counts them up.<br/><br/><br/>6.2   Non-standard attributes and attribute flags<br/><br/>Non-standard attributes act much like V-attributes, except that they<br/>may be arbitrarily named, as long as the names do not conflict with the names<br/>of any existing attribute. Objects can have an unlimited number of attributes,<br/>thus freeing the programmer from the necessity of creating multiple objects<br/>to handle extremely complex programs.  Non-standard attributes are set using <br/>one of two methods:<br/>  &amp;&lt;attribute name&gt; &lt;object&gt;=&lt;whatever&gt;<br/>  @set &lt;object&gt;=&lt;attribute name&gt;:&lt;whatever&gt;<br/>1.50 also allows:  @_&lt;attribute name&gt; &lt;object&gt;=&lt;whatever&gt;<br/><br/>These attributes may be accessed via the get() and v-functions,<br/>%-substitutions of the form %attrib do not work for user-named attributes,<br/>as they do with @va-@vz. In all other respects, however, user-named attributes<br/>behave like @va-@vz.<br/><br/>* * * * *<br/><br/>Non-standard attributes may be locked (prevented from being changed<br/>by anyone other than the person doing the locking, or a wizard), or <br/>chowned separately of the object. The syntax for doing this is<br/>"@lock &lt;object&gt;/&lt;attribute&gt;"; "@unlock &lt;object&gt;/&lt;attribute&gt;" unlocks<br/>the attribute.<br/><br/>Attributes can also have flags. These are set via the command<br/>"@set &lt;object&gt;/&lt;attribute&gt; = [!]&lt;flag name&gt;".  There are three flags<br/>which may be set. The VISUAL flag makes an attribute public; anyone<br/>can read it via the GET() function. The NO_COMMAND flag prevents an<br/>attribute from being checked for $-commands and ^-listens. The<br/>NO_INHERIT flag prevents an attribute from being inherited by the<br/>children of the object.<br/><br/>When you examine something, a locked attribute will have a "+"<br/>sign next to it. Attributes such as LAST are owned and locked to God;<br/>mortals may not change them. VISUAL attributes will be marked with "v",<br/>NO_COMMAND attributes will be marked with "$", and NO_INHERIT attributes<br/>will be marked with "i". <br/><br/>Certain 1.50 configurations always give the dbref of an attribute's<br/>owner next to the attribute name; other configurations, and 2.0, only<br/>show the attribute owner's dbref is it's different from the object's owner.<br/><br/>In 1.50, the ANSI_DISPLAY flag, when set on a player, will cause<br/>attribute names to be highlighted in boldface (if the player's terminal<br/>supports ANSI control sequences). This is useful if you are examining a <br/>very large object, and need to be able to quickly and easily see where <br/>the breaks between attributes are.<br/><br/>* * * * *<br/><br/>Non-standard attributes can make MUSH code much easier to read; it<br/>is also good practice to do a &amp;purpose or &amp;program register on the object<br/>which explains a little bit of the programming, for future reference.<br/><br/>One useful thing about non-standard attributes is that they are very<br/>useful when programming objects which contain numbered registers - mail<br/>objects, bulletin boards, etc. Instead of going through the clumsy method<br/>of putting get(me/va) get(me/vb) get(me/vc) etc. in a register and using<br/>extract() to force an evaluation, you can directly set registers, like:<br/>@va object=$foo *=*:&amp;r%0 me=%1<br/>@vb object=$bar *:@pemit %N=get(me/r%0)<br/>Note the use of the brackets within the get() to force register evaluation<br/>early. The two statements above allow you to set and retrieve numbered<br/>non-standard attributes.<br/><br/><br/>6.3   Introduction to @dolist<br/><br/>One very useful command is @dolist &lt;list&gt;=&lt;action&gt;. It performs<br/>&lt;action&gt; for every item in the list, replacing the symbol "##" with a<br/>word from the list. For example, @dolist [lexits(here)]="[name(##)]<br/>will make you say the names of all exits in the room you are in.<br/>It can be used to multi-page: @dolist Culyn RosaLil Jellan = page ## = Hello!<br/><br/>@dolist evaluates its arguments in order. So, for example,<br/>"@dolist Culyn RosaLil Jellan = page ## = Hello!"  would page Culyn,<br/>then RosaLil, then Jellan.<br/><br/>@dolist can also become rather confused by @switch statements and<br/>semi-colons. It is best to enclose the entire &lt;action&gt; section of the<br/>@dolist with braces - @dolist &lt;list&gt; = { &lt;action&gt; } <br/>This will prevent most errors.<br/><br/>@dolist should replace most list-based loops. In the past, the<br/>following was an efficient implementation of the problem listed above:<br/><br/>VA: $name-exits: @tr me/vb=[extract(lexits(here), 1, 1)], 1<br/>VB: @switch %1=&gt;[words(lexits(here)],{},{"[name(%0)];<br/>     @tr me/vb=[extract(lexits(here), add(%1,1), 1)], [add(%1,1)]}<br/>(It might be more efficient, if there are a lot of exits, to set<br/> @vc me=lexits(here) in the VA, but this is a small point).<br/><br/>Now, all that's needed is:  VA: $name-exits: @dolist [lexits(here)]="[name(##)]<br/><br/>Not only is this much cleaner, but it's considerably faster than<br/>the old method. Triggers take up quite a bit of time to execute, and<br/>@dolist is vastly more efficient.<br/><br/><br/>6.4   Time synchronization<br/><br/>Semaphores are a very flexible tool for the synchronization of<br/>objects. In practical terms, they make sure things occur in a specified<br/>order, and prevent simultaneous actions from conflicting with each other.<br/>The name "semaphore" comes from the name for signal flags used on ships;<br/>in modern computer systems, semaphores are used to prevent sections of<br/>memory from being concurrently read from or written to by different<br/>processes. Indeed, one of the main purposes of semaphores in MUSH is<br/>preventing two things from attempting to change the same attribute at<br/>the same time. More generally, in MUSH, semaphores are good for two<br/>major things: preventing an already triggered object from being used again<br/>until it has finished the action list associated with that trigger, and<br/>preventing a command from being run until a certain other command has<br/>executed. It is, fortunately, not necessary to completely understand how<br/>semaphores work in order to use them.<br/><br/>"Synchronized" actions are those which are correctly performed in<br/>some specified order. Semaphores effectively delay the execution of<br/>commands by queueing them up in the correct order, and preventing the<br/>execution of the next command before the previous command has finished,<br/>thus synchronizing the objects and actions. Every semaphore is associated <br/>with a number, called the "semaphore count", which is the number of actions<br/>(or in the case of MUSH, action lists) it is trying to synchronizing.<br/>Such actions are also referred to as "pending", "blocking", or "waiting" on<br/>the semaphore.<br/><br/>* * * * *<br/><br/>In MUSH, this semaphore count is stored in the SEMAPHORE attribute.<br/>A semaphore which has no commands pending will have a count of 0. If<br/>the semaphore count is positive, the semaphore has that many actions <br/>waiting on it. A negative semaphore count indicates that actions will not<br/>block on it; for example, a count of -3 indicates that the next three<br/>actions to wait on the semaphore will be immediately executed.<br/>(Computer science types: please note that this is the REVERSE of the<br/>convention generally used in operating systems theory!)<br/><br/>Two operations are used to control a semaphore: wait, and notify.<br/>"Waiting" an action list on a semaphore puts those actions at the end<br/>of that semaphore's queue. Each time a semaphore is notified, the first<br/>action list on its queue is executed. Thus, an action which waits on<br/>a semaphore is delayed until the semaphore is notified. A command which<br/>is waiting for its associated semaphore to be notified is referred to<br/>as "blocked"; when its semaphore allows it to be executed, the command<br/>is then "unblocked."<br/><br/>Eexecuting a wait on a semaphore increases its semaphore count by<br/>one, and executing a notify on a semaphore decreases the count by one. To<br/>execute a wait on a semaphore, use "@wait &lt;semaphore&gt;=&lt;action&gt;"; if<br/>&lt;action&gt; is a list of commands, it must be enclosed in curly braces.<br/>To notify a semaphore, use "@notify &lt;semaphore&gt;". Please note that the<br/>object that does the waiting executes the action; the semaphore is <br/>simply a timing device. Thus, in MUSH, you can use objects you do not<br/>own as semaphores, if they are LINK_OK.<br/><br/>Objects waiting on a semaphore run their actions on a first-come,<br/>first-served basis, If #2, #3, and #4 execute waits, in that order, on<br/>semaphore object #5, the first notify the semaphore receives will begin<br/>#2's action list. The next notify will execute #3's action list, and so<br/>on. In other words, notification of a semaphore just releases the FIRST<br/>object which waited on it. <br/><br/>It is possible to notify a semaphore repeatedly, by providing a<br/>numeric argument to @notify: "@notify &lt;semaphore&gt;=&lt;times to notify&gt;"<br/>If the number of times is not specified, the semaphore will be notified<br/>once. The semaphore executes the first &lt;times&gt; commands that were @waiting<br/>on it. As a reminder, if the semaphore is notified more times than it has <br/>commands queued, the semaphore count will become negative and further <br/>@waits dependent on that semaphore will be immediately executed, until the <br/>semaphore count is zero. This normal @notify is shorthand for the default <br/>switch, "@notify/first".<br/><br/>If you want all waits pending on the semaphore to execute, use <br/>"@notify/all &lt;semaphore&gt;". This will cause all the actions waiting on<br/>the semaphore to be executed, and resets the semaphore count to 0.<br/>The other method of clearing a semaphore is "@drain &lt;semaphore&gt;". This<br/>will reset the semaphore count to 0. Actions waiting on the semaphore<br/>are simply discarded. In 1.50, destroying an object automatically <br/>executes a @drain on it.<br/><br/>MUSH also allows for semaphore waits to have a timeout expiration.<br/>An object can use "@wait &lt;semaphore&gt;/&lt;time in seconds&gt;=&lt;action&gt;".<br/>If &lt;semaphore&gt; is notified before &lt;time&gt; passes, the action is executed<br/>and the semaphore count decreases by one, just as if a regular semaphore<br/>wait were done. If &lt;time&gt; passes, and the action is still blocked pending<br/>semaphore notification, it is executed anyway, and the semaphore count<br/>on the &lt;semaphore&gt; is decremented by one.<br/><br/>* * * * *<br/><br/>Most MUSH programmers will never use semaphores for anything more<br/>than basic synchronization. The most common form of this is preventing<br/>an action list associated with a trigger from being run while the action<br/>list from a prior trigger is still executing. This is especially <br/>important for vending machine objects that need to work on a single<br/>item at a time. One way of preventing this is to use an attribute BUSY;<br/>a @switch at the beginning of trigger checking for this attribute will<br/>tell you if the object is already trying to execute something. This,<br/>however, can force the player to make repeated attempts to trigger the<br/>object. A better way to do this is to associate the entire action list<br/>of the trigger with a semaphore.<br/><br/>Triggers for action lists are generally @a-actions like @apay,<br/>or user-defined commands, like $buy. We thus set up our wait in one<br/>of the following two forms:<br/><br/>@apayment object = @wait me={ @@ list of actions @@; @notify me}<br/>&amp;DO_COMMAND object =$command: @wait me={ @@ list of actions @@; @notify me}<br/><br/>We also need to initialize the semaphore state; this is best done<br/>by "@startup object = @drain me; @notify me".  The @drain makes sure that<br/>we start with a clear semaphore. We need the @notify in the startup because<br/>we don't want the first action we trigger on the object to block. The<br/>semaphore state of the object should thus begin at -1. (When programming<br/>your object, please remember that the very first time you use it, you will<br/>have to @notify it.)<br/><br/>In the above example, if someone tries to trigger the object before<br/>a prior trigger has completed, the action list will block. The last command<br/>in the prior action list is "@notify me"; this will clear the block, and<br/>allow the next action list to begin immediate execution. This simple<br/>technique is extremely useful for avoiding the headaches associated with<br/>preventing concurrent attribute updates.<br/><br/><br/>6.5   Security problems in programming<br/><br/>Although, in MUSH 1.50 and 2.0, any object that you own cannot force <br/>you, care should still be taken to make sure that objects are reasonable<br/>secure. Be extremely careful not to leave control objects lying around. <br/>_Always_ lock them to yourself, since possessive get works in 2.0 code.<br/>get &lt;person&gt;'s &lt;object&gt; will enable someone to take any unlocked object that<br/>you are carrying. One simple check you can make is to put a @switch in all<br/>commands that checks to see that the triggering object is its owner:<br/>@switch %#=&lt;Your dbref&gt;,{action list},{@pemit %#=You're not my owner!}<br/>Another secure way of doing this is to use "@lock/use" to prevent anyone<br/>but those who pass the lock from triggering $-commands on the object.<br/><br/>One common problem is carelessness with semi-colons. Unless enclosed by<br/>curly braces { }, commands like %0 can be extremely hazardous. For<br/>example, take the object Foo, with a @va of $foo *:@emit %0<br/>Type "foo bar" will force the object to emit bar. <br/><br/>Under old parsers, there's a nasty trick that can be done: <br/>"foo bar;@destroy me" (or, for that matter, any other command). Foo will <br/>emit bar, and then happily blow itself up. This, obviously, is a Bad Thing.<br/>The @va should be $foo *:@emit {%0}   This safely traps any semi-colons.<br/>Although this kind of trick shouldn't be (easily) possible to do under the <br/>new parser, it should still be something to keep in mind and avoid if possible.<br/><br/>* * * * *<br/><br/>Other problems involve registers that are directly set to whatever<br/>someone types in; if this is a force, triggering the register will execute<br/>the command. There are many variations on this; the most common is the<br/>bulletin board-type object which has a command like "post &lt;subject&gt;=&lt;message&gt;"<br/>and sets attributes to the subject and message, perhaps like this:<br/>$post *=*: &amp;SUBJ_[secs()] me={From %N: %0}; &amp;MSG_[secs()] me={%1}<br/><br/>Here, the SUBJ attribute is safe, since the "From" component<br/>prevents the placement of a $command into the attribute. The MSG, however,<br/>is subject to something like this: "post Problem=$foo: @emit Gotcha!"<br/>This would set something like MSG_746606174 to "$foo: @emit Gotcha!"<br/>thus allowing any player to type "foo" and force the bulletin board<br/>to @emit Gotcha!  This is, obviously, dangerous. This problem can<br/>be gotten around by setting MSG to "XX %1" or something similar, and<br/>using REST() to retrieve the message when it is needed. Never allow a<br/>player to directly set an attribute in such a manner, even for a moment!<br/>To do so is to invite trouble.<br/><br/>			----------<br/><br/>A great many problems can be taken care of under INHERIT. Only objects<br/>set INHERIT may force their owner. Objects that aren't INHERIT may not force<br/>objects that are. If a player is set INHERIT, all of his objects are<br/>considered to be INHERIT. This flag is reset in a @chown.<br/><br/>In 2.0, INHERIT objects owned by wizards have wizard powers. Any object <br/>with wizard powers may force anything else, regardless of its status. This <br/>flag is most useful for wizards and people who own large, complex, publicly<br/>used systems, such as mail.<br/><br/>Sometimes it's useful to be able to have a non-INHERIT object force<br/>one that is, for a single command or group of commands. Since the most common<br/>use of this is for say/pose/emit output, in 2.0, the commands @fsay, @femit, <br/>and @fpose have been provided. These do the obvious. The only thing to note is<br/>that @fpose has a switch, @fpose/nospace, which does eliminates the space<br/>between the name of the object and its pose (making it equivalent to<br/>player ";"). <br/><br/>* * * * *<br/><br/>There are two other notable techniques for getting around INHERIT<br/>restrictions. Frequently, you are going to want to have a non-INHERIT<br/>object trigger one that is; this is especially true if you are a wizard<br/>on a 2.0 MUSH and should not, for security reasons, set objects INHERIT<br/>unless they absolutely have to be. You can use LINK_OK as a "@trigger-ok"<br/>flag in 1.50, but this is not possible under 2.0. Therefore, there must<br/>be a kind of "message passing" used. <br/><br/>The first method is to uselock the object you want triggered (the<br/>"victim") to an auxiliary object inside it, and then have the non-INHERIT<br/>triggering object (the "actor") trigger the auxiliary, which then does<br/>something which matches a $command on the victim. In the following example,<br/>#88 is the auxiliary object.<br/><br/>&amp;DO_ACTION actor=$test *: @trigger #88/PROPAGATE=%0<br/>&amp;PROPAGATE #88=do_it %0<br/>&amp;ACTION victim=$do_it *: @dolist %0={@set ##=dark}<br/>@tel #88=victim<br/>@lock/use victim=#88<br/><br/>* * * * *<br/><br/>Unfortunately, the $command method is not very fast. A better<br/>method is to use ^-patterns, and uselock the victim to the actor to<br/>prevent spoofing. The victim should also be kept in a secure location<br/>where it's not going to "hear" anything accidentally. The actor<br/>@pemit's an action pattern to the victim, which acts on it.<br/>In the following example, #90 is the victim.<br/><br/>&amp;DO_ACTION actor=$test *:@pemit #90=TEST_PCODE %0<br/>&amp;TEST_PCODE_LISTEN #90=^TEST_PCODE *: @dolist %0={@set ##=dark}<br/>@set #90=LISTENER  (or MONITOR, in 2.0)<br/>@lock/use #90=actor<br/><br/>As long as you are careful to make sure that the victim doesn't hear<br/>anything other than the actor, and then only when appropriate, this<br/>is the best method for getting around INHERIT.<br/><br/><br/>* * * * *<br/><br/>The SECURE() function returns a string with all semi-colons and<br/>braces {}  converted to spaces. This is useful if you want to prevent<br/>people from abusing your stuff via triggers and the like.<br/><br/>The ESCAPE() function inserts the escape "\" character before<br/>all [ ], preventing the expression within from being evaluated - the string<br/>is returned exactly as typed. An escape character is also inserted before<br/>the first character of the string. The parser's handling of the escape<br/>character is reliable and consistent; another less reliable character<br/>which can act as an escape is the percent "%" character.<br/><br/><br/>6.7   Debugging<br/><br/>One of the things that is sadly lacking from MUSH is an easy way<br/>to debug objects. One is often reduced to having an object say registers<br/>out loud, or setting the object PUPPET.<br/><br/>If the object is PUPPET, you will see all the output from the commands<br/>it executes, such as "Set."  Unfortunately, in TinyMUSH 2.0, "Set." is<br/>used to acknowledge setting attributes, flags, and miscellaneous other<br/>things. Thus, puppet output can be rather useless (although an "I don't<br/>see that here." or "Huh?" or similar messages can be useful in notifying<br/>you of a typo).  1.50's output is a bit more informative; it will tell<br/>you which object is getting set, and differentiate between attribute<br/>sets and flag sets, enabling the PUPPET flag to be fairly useful for<br/>debugging purposes.<br/><br/>* * * * *<br/><br/>The VERBOSE flag has been provided for debugging purposes. It<br/>displays the commands getting executed, which is useful for checking<br/>evaluation order and the like.<br/><br/>In 2.0, it displays all commands executed by the object to the <br/>object's owner, in the format &lt;object name&gt;] &lt;command&gt;. The output can be <br/>slightly messy, especially if @switches are involved. When it goes to <br/>evaluate the switch, it will display the entire switch statement; it will <br/>then show the entire branch of commands and then go to execute them.<br/><br/>In 1.50, the VERBOSE flag displays all commands executed by the<br/>object to the object's owner, in the format &lt;object dbref&gt;] &lt;command&gt;.<br/>As with the 2.0 version of this flag, this is the command _before_ it has<br/>been interpreted by the parser. Placing a @force before the command<br/>_might_ be useful for _debugging purposes only_, since this will parse<br/>all the arguments, resulting in VERBOSE output which shows the final<br/>form of the arguments to the command.<br/><br/>* * * * *<br/><br/>In 1.50, there is a flag called DEBUG. Objects set DEBUG cause their<br/>owner to be notified of the results every call to the parser that that object<br/>makes. If used in conjunction with the VERBOSE flag, it can pinpoint<br/>precisely which expression is being evaluated to an undesirable quantity. The<br/>output is in the format &lt;object dbref&gt;! &lt;unparsed string&gt; =&gt; &lt;parsed string&gt;<br/><br/>A similar flag, called TRACE, exists in 2.0. Its output, however, is in<br/>the format "&lt;object name&gt;(&lt;dbref&gt;)} '&lt;unparsed string&gt; -&gt; '&lt;parsed string&gt;'<br/><br/>* * * * *<br/><br/>One interesting thing to note about @dolist is that it evaluates<br/>all switches on one "level" of command before executing the results of<br/>those switches.<br/><br/>This is a quirk which is only affects the output of @dolist; in<br/>terms of execution order, @dolist simply repeats its command sequence on<br/>each item in the list, completing the command sequence for each item before<br/>beginning on the next.<br/><br/><br/>6.8   On the New Programming Style<br/><br/><br/>The power of MUSH has increased dramatically in the past six months.<br/>Things that used to be difficult or slow are now fairly easy to do, mostly<br/>through the addition of new commands and functions.<br/><br/>The biggest advances are in MUSH's treat of list processing. It<br/>is now quite simple to take a list and perform a series of functions on<br/>it, via the function ITER() or the  1.50 command @map. These functions<br/>"map" another function onto each element of a list, returning a list.<br/>(The terminology comes from the LISP programming language).<br/><br/>ITER() and @dolist both use the "##" token to signify replacement,<br/>so it is fairly difficult to easily combine the two.<br/><br/>1.50's @map command maps a function onto a list, placing the<br/>new list into the MAPLIST attribute on the object executing the @map.<br/>This makes the parser somewhat more forgiving. @map can be thought of<br/>as a command version of the ITER() function provided by both MUSH<br/>versions. This command, however, is rather redundant and is likely to<br/>go away in future versions of 1.50; new programs should avoid its use.<br/><br/>* * * * *<br/><br/>Among the more useful complex list processing functions are<br/>SETUNION, SETINTER, and SETDIFF. These three functions return a sorted <br/>list from two lists. SETUNION concatenates two lists, removing duplicates.<br/>SETINTER returns the elements that the two lists have in common. SETDIFF <br/>returns the elements of the first list which are not in the second.<br/><br/>The SWITCH() function also enables one to do the equivalent of<br/>@switch on a pattern, but instead of triggering an action, the SWITCH()<br/>function returns a string.<br/><br/>The final major improvement is the U() function in 2.0 (also called<br/>UFUN() in 1.50. In 1.50, UFUN() also has a close relative, ZFUN()). This<br/>is a "user-defined function", which generally consists of a bunch of <br/>functions in an attribute. The uses of U() are beyond the scope of<br/>this section; suffice to say that it allows one to pass arguments into<br/>a function of one's own devising, and get a string back in return.<br/>It is most often  used to break up complex evaluations into something more<br/>readable, or to make a commonly used sequence of functions easily accessable.<br/>This function is described in detail later in this manual.<br/><br/>* * * * *<br/><br/>The increasingly popular "switchless style" of programming<br/>eschews the actual @switch command in favor of using function evaluations<br/>to generate a word. The object is then @forced to execute the attribute <br/>named that word, via the V() function.<br/><br/>Concatenation is merely a matter of leaving out things such as square <br/>brackets [] in the appropriate places. Under 1.50, the STRCAT() function can<br/>also be used to explicitly concatenate strings.<br/><br/>A very simple example of "standard" style vs. switchless coding <br/>follows. Let's suppose we want an object to respond with one of three <br/>different, randomly selected, messages, when someone types something.<br/><br/>Switchless style:<br/>&amp;FOOBASE object=$foo: @emit [v(FOO[rand(3)])]<br/>&amp;FOO0 object=Zero!<br/>&amp;FOO1 object=One!<br/>&amp;FOO2 object=Two!<br/><br/>[ or, alternatively, you could put the @emit in each statement and leave<br/>  it out in the main one, if you wanted to execute more complex commands. ]<br/><br/><br/>A slightly more interesting example, although not one that is<br/>really any more complicated -- there is a "cat" object upon which you<br/>wish to place a "pet cat" command which will get the cat to respond<br/>with a random action:<br/><br/>Standard style:<br/>&amp;PET_CAT cat=$pet cat:@switch [rand(3)]=<br/><br/>        0,@emit The cat purrs when %N pets her.,<br/>              1,@emit The kitty blinks at %N.,<br/>              2,@emit The cat arches her back and hisses at %N.<br/><br/>Switchless style:<br/>&amp;PET_CAT cat=$pet cat:@emit [s(v(PETMSG[rand(3)]))]<br/>&amp;PETMSG0 cat=The cat purrs when %N pets her.<br/>&amp;PETMSG1 cat=The kitty blinks at %N.<br/>&amp;PETMSSG2 cat=The cat arches her back and hisses at %N.<br/><br/><br/>In this particular example, the "switchless" style is wasteful;<br/>it is more efficient (as well as simpler) to use a @switch.<br/>The switchless style is useful when you have a very complex function with<br/>many possible outcomes, or need to run one huge batch of commands at a time,<br/>and want to avoid use of multiple @triggers.<br/><br/>The switchless style for objects like this, however, does make it<br/>quite easy to expand upon the basic object. For example, to add more<br/>responses to the cat, one merey has to change the "rand(3)" to, say,<br/>"rand(10)", and then add new PETMSG attributes. It is much more difficult<br/>to edit switches (plus, the switchless style is easier to read).<br/><br/>Some caution should be exercised when programming complex objects in<br/>the switchless style. Because "switchless" programs often involve extremely<br/>large, complicated function, they can take quite a long time to evaluate. <br/>Normally, in MUSH, commands are queued, so that no one object consumes a<br/>large chunk of time all at once. The switchless style more or less defeats<br/>that, forcing the game to focus all its time on evaluating that one<br/>monster function. This can contribute to server lag. One should thus<br/>save switchless programming for those objects that really require the<br/>speed provided by the switchless style.<br/><br/>Do note that it is presently trendy to brag that a given program uses<br/>no @switches (or SWITCH()es, or whatever the unpopular function of the<br/>week happens to be). One should be careful to always choose the method<br/>which is actually faster, rather than the method which seems the most<br/>impressive. Incomprehensible MUSHcode is poorly-written MUSHcode, usually.<br/><br/>* * * * *<br/><br/>Further notes on the parser:  while it is quite consistent in <br/>evaluation, many programmers continue to question exactly what is needed<br/>to accomplish certain types of evaluations.<br/><br/>The '\' character is an escape character. When placed in front of<br/>a "special" character (like brackets or percent signs), it prevents them<br/>from being evaluated. Each escape character delays evaluation for one<br/>pass through the parser.<br/><br/>The '%' character is most often used for "percent substitutions":<br/>%N, %r, %va, etc.  When it is not being used for that purpose, though,<br/>it, too, acts like an escape character.<br/><br/>The curly braces {}  are used to group commands. Also, in "weird"<br/>functions which cause a second pass through the parser (such as ITER())<br/>the curly braces are used to delimit functions that should not be <br/>evaluated on the first pass through the interpreter.<br/><br/>The square brackets [] signal the start and end of a function<br/>evaluation group. They can be nested, and for the purposes of concatenation<br/>show where "normal" text ends and substitutions begin.  Square brackets<br/>say, "Evaluate me now."  If you put square brackets into something like<br/>a call to ITER(), you will need to escape them out.<br/><br/>Note that functions such as ITER() and U() are _exceptions_ to<br/>the parser rules; because they call the interpreter again, the behavior<br/>of the special characters sometimes seems strange. Successfully getting<br/>ITER() to return the correct value depends on careful use of curly braces<br/>and escape characters.<br/><br/>For further details on complex programming in this style, as well<br/>as notes on efficiency and further parser details, consult the final <br/>sections of this manual.<br/><br/><br/>6.9   Hints and tips<br/><br/>This is by no means a complete guide to MUSH. The code is constantly<br/>changing, and new features are constantly being implemented. There are far<br/>more commands and functions available than can be covered in a manual like<br/>this one. If you are interested in MUSH programming, you should read through<br/>all the help files, on @-commands, functions, and flags.<br/><br/>The best way to learn how to program MUSH is to do it! Find some sort<br/>of project and work at it. If you come up with something really neat, I'd<br/>love to hear about it - I'm especially interested in unique applications of<br/>non-standard attributes. Besides, I like getting mail.<br/><br/>The non-standard attributes available in TinyMUSH make<br/>certain ways of doing things obsolete. Most notable is the use of extract()<br/>and member() combined with a list containing va-vz to access the va-vz<br/>attributes in numerical order; attributes can now be numbered a1-a10, for<br/>example. Also, worrying about running out of registers is now a thing of<br/>the past.<br/><br/>Corrections, complaints, or congratulations are always welcome;<br/>I can be found as Amberyl on most MU*s, or emailed at lwl@netcom.com<br/><br/><br/>7.    QuickStart Guide<br/><br/>7.1   Basic Syntax<br/><br/>This section is really separate from the rest of the manual. It<br/>assumes that the reader is familiar with some other programming language,<br/>and simply wishes to learn how to get started in MUSH as quickly as <br/>possible. Such users will still benefit from reading the rest of the <br/>manual, since there are many programming applications in MUSH that don't<br/>really match anything one would do in another language; this brief section<br/>is simply intended to explain concepts in a slightly more compact,<br/>"traditional" computer-science fashion.<br/><br/>Like most programming languages, MUSH has variables. There are<br/>temporary and permanent variables. Temporary variables are transitory,<br/>and are not saved in the database. They include the stack variables<br/>%0-%9, the enactor %# and related variables (the enactor name, %N, and<br/>the associated pronouns, %s, %o, and %p), the local registers r(0) - r(9),<br/>and so forth. Permanent variables are stored in attributes, and can be<br/>referenced by various functions which fetch variables. The most common<br/>of these are the V() function, which fetches an attribute off the current<br/>object, and GET(), which fetches an attribute off an arbitrary object.<br/><br/>Attributes are divided into two categories, normally called<br/>"built-in" and "user-defined". Built-in attributes are set with the<br/>command "@&lt;attribute name&gt; &lt;object&gt;=&lt;text&gt;". User-defined attributes<br/>are set with the command "&amp;&lt;attribute name&gt; &lt;object&gt;=&lt;text&gt;". You can<br/>set a built-in attribute using the user-defined syntax, but convention<br/>normally dictates the use of '@' for built-ins.<br/><br/>The majority of built-in commands also being with '@', although<br/>some, such as "page", do not. Conventionally, MUSHcoded global commands<br/>begin with '+'. All commands are interpreted at runtime. Normally, the<br/>'=' sign is used to separate the main two arguments to a command. If<br/>there are multiple components to the second argument, these components<br/>are separated by commas. Curly braces are used to indicate groupings,<br/>and prevent interpretation of special characters enclosed within. The<br/>escape character '\' can also be used to protect special characters.<br/><br/> MUSH is a scripting language, essentially. Most MUSH objects'<br/>"programs" either output text or change the database in some way. The<br/>generally accepted way to handle complex tasks is by manipulating lists<br/>or strings in some manner. Everything in MUSH is eventually treated as<br/>a string, and there is no system of types. Functional programming is<br/>at the heart of most complex MUSH items; MUSH inherits a few LISP<br/>constructs such as FOLD and SETQ.<br/><br/><br/>7.2    Conditional and Loop Constructs<br/><br/><br/>There is no IF-THEN-ELSE construct in MUSH. Instead, there is<br/>a command called @switch, which takes the format:<br/><br/>@switch &lt;variable&gt;=&lt;condition1&gt;,&lt;action1&gt;,<br/>                   &lt;condition2&gt;,&lt;action2&gt;, ...<br/>                   &lt;conditionN&gt;,&lt;actionN&gt;, &lt;default&gt;<br/><br/>This is equivalent to the SWITCH-CASE construct in languages such as C<br/>and Pascal. Wildcard patterns are allowed in both the variable and the<br/>conditions, thus making this a fairly powerful construct.<br/><br/>MUSH also lacks an equivalent of the FOR and WHILE constructs.<br/>Unfortunately, this type of structure is much more difficult to duplicate<br/>in MUSH. The closest is equivalent is the command @dolist, with syntax<br/>@dolist &lt;list&gt;=&lt;action&gt;, which performs an action repeatedly, substituting<br/>an element of &lt;list&gt; for the token '##' within &lt;action&gt;, each time.<br/>Thus, if you wanted to @create five items named 1, 2, 3, 4, and 5, you<br/>would try: @dolist 1 2 3 4 5 = @create ##<br/><br/><br/>FOR constructs in most programming languages typically perform<br/>a sequence of commands for some list of numbers, which might or might not<br/>be sequentially, but are mathematically related in some relatively simple<br/>fashion. The MUSH function LNUM() generates a list of numbers 0 to N.<br/>This list can then be manipulated via a function called ITER().<br/><br/>It is important to remember that because the language is list-oriented,<br/>manipulating lists generally turns out to be the most efficient way of coding<br/>something. Good MUSHcode generally puts a minimal number of actual action<br/>commands on the queue. Trying to write MUSH with the same type of logic<br/>you would use in C or a similar procedural language is generally a mistake.<br/><br/><br/>7.3	Functions<br/><br/>There are many, many functions in MUSH. Numeric manipulation, string<br/>manipulation, list manipulation, and functions to extract information from<br/>the database form the heart of the MUSH programming language. The important<br/>thing to remember here is that data in MUSH is untyped, and therefore, <br/>functions may be used to perform transformations on data types that one<br/>would normally not think of as useful for a particular type of data.<br/>Truncating a floating-point number, for example, can be as simple as<br/>taking X characters after the '.' of the number (which is simply a string).<br/>There are, however, MUSH functions to perform a variety of complex tasks;<br/>the above task can be done with TRUNC() or ROUND(), for example.<br/><br/>Functions take a fairly traditional parameter-format, with the<br/>syntax: FUNCTION-NAME(&lt;arg 1&gt;, &lt;arg 2&gt;, &lt;arg 3&gt;, &lt;arg N&gt;)<br/>Parameters are normally evaluated left to right, before the relevant<br/>outer function is called; in general, the innermost functions are the<br/>first to be evaluated.<br/><br/><br/>INDEX OF SECTION III EXAMPLES:<br/><br/>5.1  Wagon<br/>5.3  Wagon controller<br/>
    </div>
</div>
<script type="text/javascript">
    var selectText = function(element) {
        var doc = document;
        var text = doc.getElementById(element);

        if (doc.body.createTextRange) { // ms
            var range = doc.body.createTextRange();
            range.moveToElementText(text);
            range.select();
        } else if (window.getSelection) { // moz, opera, webkit
            var selection = window.getSelection();
            var range = doc.createRange();
            range.selectNodeContents(text);
            selection.removeAllRanges();
            selection.addRange(range);
        }
    }

    $('a.select-all').click(function () {
        selectText('code');
    });
</script>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
</body>

</html>
<script src="../Scripts/Google.js" type="text/javascript"></script>