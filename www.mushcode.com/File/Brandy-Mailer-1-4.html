<!doctype html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>Code: Brandy Mailer 1.4</title>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <!-- Apple devices fullscreen -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <!-- Apple devices fullscreen -->
    <meta names="apple-mobile-web-app-status-bar-style" content="black-translucent" />

    <!-- Bootstrap -->
	<link rel="stylesheet" href="../Theme/Flat/html/css/bootstrap.min.css">
	<!-- Bootstrap responsive -->
	<link rel="stylesheet" href="../Theme/Flat/html/css/bootstrap-responsive.min.css">
	<!-- jQuery UI -->
	<link rel="stylesheet" href="../Theme/Flat/html/css/plugins/jquery-ui/smoothness/jquery-ui.css">
	<link rel="stylesheet" href="../Theme/Flat/html/css/plugins/jquery-ui/smoothness/jquery.ui.theme.css">
	<!-- Theme CSS -->
	<link rel="stylesheet" href="../Theme/Flat/html/css/style.css">
	<!-- Color CSS -->
	<link rel="stylesheet" href="../Theme/Flat/html/css/themes.css">


    <link rel="stylesheet" href="../Content/site.css">

    <!-- jQuery -->
    <script src="../Theme/Flat/html/js/jquery.min.js"></script>
    <!-- Nice Scroll -->
    <script src="../Theme/Flat/html/js/plugins/nicescroll/jquery.nicescroll.min.js"></script>
    <!-- jQuery UI -->
    <script src="../Theme/Flat/html/js/plugins/jquery-ui/jquery.ui.core.min.js"></script>
    <script src="../Theme/Flat/html/js/plugins/jquery-ui/jquery.ui.widget.min.js"></script>
    <script src="../Theme/Flat/html/js/plugins/jquery-ui/jquery.ui.mouse.min.js"></script>
    <script src="../Theme/Flat/html/js/plugins/jquery-ui/jquery.ui.resizable.min.js"></script>
    <script src="../Theme/Flat/html/js/plugins/jquery-ui/jquery.ui.sortable.min.js"></script>
    <!-- slimScroll -->
    <script src="../Theme/Flat/html/js/plugins/slimscroll/jquery.slimscroll.min.js"></script>
    <!-- Bootstrap -->
    <script src="../Theme/Flat/html/js/bootstrap.min.js"></script>
    <!-- Form -->
    <script src="../Theme/Flat/html/js/plugins/form/jquery.form.min.js"></script>

    <!-- Theme framework -->
    <script src="../Theme/Flat/html/js/eakroko.min.js"></script>
    <!-- Theme scripts -->
    <script src="../Theme/Flat/html/js/application.min.js"></script>

    <!--[if lte IE 9]>
		<script src="js/plugins/placeholder/jquery.placeholder.min.js"></script>
		<script>
			$(document).ready(function() {
				$('input, textarea').placeholder();
			});
		</script>
	<![endif]-->

    <!-- Favicon -->
    <link rel="shortcut icon" href="http://www.mushcode.com/File/img/favicon.ico" />
    <!-- Apple devices Homescreen icon -->
    <link rel="apple-touch-icon-precomposed" href="http://www.mushcode.com/File/img/apple-touch-icon-precomposed.png" />

</head>

<body class="theme-green">
    <div id="navigation">
        <div class="container-fluid">
            <a href="../index.html" id="brand">MUSHCode.com</a>
        </div>
    </div>
    <div class="container-fluid" id="content">
        <div id="left">
            <div class="subnav">
                <div class="subnav-title">
                    <a href="Brandy-Mailer-1-4.html#" class='toggle-subnav'>
                        <i class="icon-angle-down"></i>
                        <span>About</span>
                    </a>
                </div>
                <ul class="subnav-menu">
                    <li>
                        <a href="../index.html">Overview</a>
                    </li>
                </ul>
            </div>
            <div class="subnav">
                <div class="subnav-title">
                    <a href="Brandy-Mailer-1-4.html#" class='toggle-subnav'>
                        <i class="icon-angle-down"></i>
                        <span>Files</span>
                    </a>
                </div>
                <ul class="subnav-menu">
                    <li class='dropdown'>
                        <a href="Brandy-Mailer-1-4.html#" data-toggle="dropdown">Code</a>
                        
<ul class="dropdown-menu">
        <li>
            <a href="../Category/Administration.html">Administration</a>
        </li>
        <li>
            <a href="../Category/Building.html">Building</a>
        </li>
        <li>
            <a href="../Category/Bulletin-Board.html">Bulletin Board</a>
        </li>
        <li>
            <a href="../Category/Combat.html">Combat</a>
        </li>
        <li>
            <a href="../Category/Dynamic-Space.html">Dynamic Space</a>
        </li>
        <li>
            <a href="../Category/Fonts.html">Fonts</a>
        </li>
        <li>
            <a href="../Category/Functions.html">Functions</a>
        </li>
        <li>
            <a href="../Category/Games.html">Games</a>
        </li>
        <li>
            <a href="../Category/Globals.html">Globals</a>
        </li>
        <li>
            <a href="../Category/Mail-Systems.html">Mail Systems</a>
        </li>
        <li>
            <a href="../Category/Other.html">Other</a>
        </li>
        <li>
            <a href="../Category/Schedulers.html">Schedulers</a>
        </li>
        <li>
            <a href="../Category/Time.html">Time</a>
        </li>
        <li>
            <a href="../Category/Vehicles.html">Vehicles</a>
        </li>
        <li>
            <a href="../Category/Vendors.html">Vendors</a>
        </li>
        <li>
            <a href="../Category/Weather-Systems.html">Weather Systems</a>
        </li>
</ul>
                    </li>
                    <li class='dropdown'>
                        <a href="Brandy-Mailer-1-4.html#" data-toggle="dropdown">Classes</a>
                        
<ul class="dropdown-menu">
        <li>
            <a href="../Category/Administration.html">Administration</a>
        </li>
        <li>
            <a href="../Category/Building.html">Building</a>
        </li>
        <li>
            <a href="../Category/Globals.html">Globals</a>
        </li>
        <li>
            <a href="../Category/Hardcode.html">Hardcode</a>
        </li>
        <li>
            <a href="../Category/Other.html">Other</a>
        </li>
        <li>
            <a href="../Category/Softcode.html">Softcode</a>
        </li>
</ul>
                    </li>
                    <li>
                        <a href="../Manuals.html">Manuals</a>
                    </li>
                </ul>
            </div>
            <div class="subnav">
                <div class="subnav-title">
                    <a href="Brandy-Mailer-1-4.html#" class='toggle-subnav'>
                        <i class="icon-angle-down"></i>
                        <span>Misc</span>
                    </a>
                </div>
                <ul class="subnav-menu">
                    <li>
                        <a href="../Ascii2Mu.html">ASCII To MUSHCode</a>
                    </li>
                    <li>
                        <a href="../MushList.html">MUSH/MUX List</a>
                    </li>
                    <li>
                        <a href="../MushRoom.html">MUSHRoom</a>
                    </li>
                </ul>
            </div>
            <div class="subnav">
                <div class="subnav-title">
                    <a href="Brandy-Mailer-1-4.html#" class='toggle-subnav'>
                        <i class="icon-angle-down"></i>
                        <span>Contribute</span>
                    </a>
                </div>
                <ul class="subnav-menu">
                    <li>
                        <a href="../Submit.html">Submit</a>
                    </li>
                </ul>
            </div>
        </div>
        <div id="main">
            <div class="container-fluid">
                <div class="breadcrumbs">
                    <ul>
                        
    <li>
        <a href="../index.html">Home</a>
        <i class="icon-angle-right"></i>
    </li>
    <li>
        <a href="../Category/Mail-Systems.html">Mail Systems</a>
        <i class="icon-angle-right"></i>
    </li>
    <li>
        <a href="Brandy-Mailer-1-4.html#">Brandy Mailer 1.4</a>
    </li>

                    </ul>
                </div>
                <div class="row-fluid">
                    <div class="span12">
                        



<div class="box">
    <div class="box-title title">
        <h2>
            Brandy Mailer 1.4
        </h2>
    </div>
    <div class="box-content">

        <div class="description">
            <p>A popular softcoded mail system for MUSH 2.2 or later.</p>
        </div>

        <div class="author">
            <strong>Author:</strong>
                <span>
                    <a href="../Author/Brandy@CrystalMUSH.html">Brandy</a>@<a href="../Source/CrystalMUSH.html">CrystalMUSH</a>
                </span>
        </div>

        <div class="author">
            <strong>Category:</strong>
            <a href="../Category/Mail-Systems.html">Mail Systems</a>
        </div>

            <div class="commands">
            <strong>Commands:</strong>
                    <a href="../Command/@chown.html" class="command">@chown</a>,
                    <a href="http://www.mushcode.com/Command/@create" class="command">@create</a>,
                    <a href="../Command/@destroy.html" class="command">@destroy</a>,
                    <a href="http://www.mushcode.com/Command/@dolist" class="command">@dolist</a>,
                    <a href="http://www.mushcode.com/Command/@drain" class="command">@drain</a>,
                    <a href="http://www.mushcode.com/Command/@edit" class="command">@edit</a>,
                    <a href="http://www.mushcode.com/Command/@pemit" class="command">@pemit</a>,
                    <a href="http://www.mushcode.com/Command/@set" class="command">@set</a>,
                    <a href="http://www.mushcode.com/Command/@startup" class="command">@startup</a>,
                    <a href="http://www.mushcode.com/Command/@switch" class="command">@switch</a>,
                    <a href="http://www.mushcode.com/Command/@teleport" class="command">@teleport</a>,
                    <a href="http://www.mushcode.com/Command/@trigger" class="command">@trigger</a>,
                    <a href="http://www.mushcode.com/Command/@va" class="command">@va</a>,
                    <a href="http://www.mushcode.com/Command/@vb" class="command">@vb</a>,
                    <a href="http://www.mushcode.com/Command/@vc" class="command">@vc</a>,
                    <a href="../Command/@vm.html" class="command">@vm</a>,
                    <a href="http://www.mushcode.com/Command/@wait" class="command">@wait</a>,
                    <a href="http://www.mushcode.com/Command/@wipe" class="command">@wipe</a>.
            </div>

            <div class="functions">
                <strong>Functions:</strong>
                        <a href="../Function/add.html" class="function">add&#40;&#41;</a>,
                        <a href="../Function/after.html" class="function">after&#40;&#41;</a>,
                        <a href="../Function/and.html" class="function">and&#40;&#41;</a>,
                        <a href="../Function/before.html" class="function">before&#40;&#41;</a>,
                        <a href="../Function/capstr.html" class="function">capstr&#40;&#41;</a>,
                        <a href="../Function/center.html" class="function">center&#40;&#41;</a>,
                        <a href="../Function/comp.html" class="function">comp&#40;&#41;</a>,
                        <a href="http://www.mushcode.com/Function/con" class="function">con&#40;&#41;</a>,
                        <a href="../Function/convtime.html" class="function">convtime&#40;&#41;</a>,
                        <a href="../Function/default.html" class="function">default&#40;&#41;</a>,
                        <a href="../Function/div.html" class="function">div&#40;&#41;</a>,
                        <a href="../Function/edit.html" class="function">edit&#40;&#41;</a>,
                        <a href="../Function/elements.html" class="function">elements&#40;&#41;</a>,
                        <a href="../Function/eq.html" class="function">eq&#40;&#41;</a>,
                        <a href="../Function/escape.html" class="function">escape&#40;&#41;</a>,
                        <a href="../Function/extract.html" class="function">extract&#40;&#41;</a>,
                        <a href="../Function/filter.html" class="function">filter&#40;&#41;</a>,
                        <a href="../Function/first.html" class="function">first&#40;&#41;</a>,
                        <a href="../Function/flags.html" class="function">flags&#40;&#41;</a>,
                        <a href="../Function/get.html" class="function">get&#40;&#41;</a>,
                        <a href="../Function/get_eval.html" class="function">get_eval&#40;&#41;</a>,
                        <a href="../Function/gt.html" class="function">gt&#40;&#41;</a>,
                        <a href="../Function/gte.html" class="function">gte&#40;&#41;</a>,
                        <a href="../Function/hasattr.html" class="function">hasattr&#40;&#41;</a>,
                        <a href="../Function/hasflag.html" class="function">hasflag&#40;&#41;</a>,
                        <a href="../Function/isdbref.html" class="function">isdbref&#40;&#41;</a>,
                        <a href="../Function/isnum.html" class="function">isnum&#40;&#41;</a>,
                        <a href="../Function/iter.html" class="function">iter&#40;&#41;</a>,
                        <a href="../Function/last.html" class="function">last&#40;&#41;</a>,
                        <a href="../Function/lcstr.html" class="function">lcstr&#40;&#41;</a>,
                        <a href="../Function/ldelete.html" class="function">ldelete&#40;&#41;</a>,
                        <a href="../Function/ljust.html" class="function">ljust&#40;&#41;</a>,
                        <a href="../Function/lnum.html" class="function">lnum&#40;&#41;</a>,
                        <a href="../Function/lt.html" class="function">lt&#40;&#41;</a>,
                        <a href="../Function/lte.html" class="function">lte&#40;&#41;</a>,
                        <a href="../Function/match.html" class="function">match&#40;&#41;</a>,
                        <a href="../Function/member.html" class="function">member&#40;&#41;</a>,
                        <a href="../Function/message.html" class="function">message&#40;&#41;</a>,
                        <a href="../Function/mid.html" class="function">mid&#40;&#41;</a>,
                        <a href="../Function/min.html" class="function">min&#40;&#41;</a>,
                        <a href="../Function/mul.html" class="function">mul&#40;&#41;</a>,
                        <a href="../Function/name.html" class="function">name&#40;&#41;</a>,
                        <a href="../Function/not.html" class="function">not&#40;&#41;</a>,
                        <a href="../Function/num.html" class="function">num&#40;&#41;</a>,
                        <a href="../Function/or.html" class="function">or&#40;&#41;</a>,
                        <a href="../Function/owner.html" class="function">owner&#40;&#41;</a>,
                        <a href="../Function/parent.html" class="function">parent&#40;&#41;</a>,
                        <a href="../Function/pos.html" class="function">pos&#40;&#41;</a>,
                        <a href="../Function/r.html" class="function">r&#40;&#41;</a>,
                        <a href="../Function/remove.html" class="function">remove&#40;&#41;</a>,
                        <a href="../Function/repeat.html" class="function">repeat&#40;&#41;</a>,
                        <a href="../Function/rest.html" class="function">rest&#40;&#41;</a>,
                        <a href="../Function/revwords.html" class="function">revwords&#40;&#41;</a>,
                        <a href="../Function/rjust.html" class="function">rjust&#40;&#41;</a>,
                        <a href="../Function/s.html" class="function">s&#40;&#41;</a>,
                        <a href="../Function/secs.html" class="function">secs&#40;&#41;</a>,
                        <a href="../Function/secure.html" class="function">secure&#40;&#41;</a>,
                        <a href="../Function/setdiff.html" class="function">setdiff&#40;&#41;</a>,
                        <a href="../Function/setinter.html" class="function">setinter&#40;&#41;</a>,
                        <a href="../Function/setq.html" class="function">setq&#40;&#41;</a>,
                        <a href="../Function/setunion.html" class="function">setunion&#40;&#41;</a>,
                        <a href="../Function/sign.html" class="function">sign&#40;&#41;</a>,
                        <a href="../Function/sort.html" class="function">sort&#40;&#41;</a>,
                        <a href="../Function/space.html" class="function">space&#40;&#41;</a>,
                        <a href="../Function/squish.html" class="function">squish&#40;&#41;</a>,
                        <a href="../Function/strlen.html" class="function">strlen&#40;&#41;</a>,
                        <a href="../Function/strmatch.html" class="function">strmatch&#40;&#41;</a>,
                        <a href="../Function/sub.html" class="function">sub&#40;&#41;</a>,
                        <a href="../Function/switch.html" class="function">switch&#40;&#41;</a>,
                        <a href="../Function/time.html" class="function">time&#40;&#41;</a>,
                        <a href="../Function/trim.html" class="function">trim&#40;&#41;</a>,
                        <a href="../Function/trunc.html" class="function">trunc&#40;&#41;</a>,
                        <a href="../Function/type.html" class="function">type&#40;&#41;</a>,
                        <a href="../Function/u.html" class="function">u&#40;&#41;</a>,
                        <a href="../Function/ulocal.html" class="function">ulocal&#40;&#41;</a>,
                        <a href="../Function/v.html" class="function">v&#40;&#41;</a>,
                        <a href="../Function/wordpos.html" class="function">wordpos&#40;&#41;</a>,
                        <a href="../Function/words.html" class="function">words&#40;&#41;</a>.
            </div>

            <div class="features">
                <strong>Features:</strong>
                        <a href="../Feature/named-Percentq-registers.html" class="feature">named %q-registers</a>.
            </div>

            <div class="servers">
                <strong>Compatibility:</strong>
                        <a href="../Server/PennMUSH.html" class="server">PennMUSH</a>.
            </div>

    </div>
</div>

    <div class="box box-color green box-condensed box-bordered">
	    <div class="box-title">
            <h3>Instructions</h3>
        </div>
	    <div class="box-content">
		    Copy and paste the below code into a compatible MUSH or MUX.
	    </div>
    </div>

<div class="box box-bordered box-condensed">
    <div class="box-title">
        <h3>
	        <i class="icon-reorder"></i>
	        MUSHCode for Brandy Mailer 1.4
        </h3>
        <div class="actions">
	        <a class="btn btn-mini select-all" href="Brandy-Mailer-1-4.html#">
                    <i class="icon-resize-full"></i> Select Code
            </a>
        </div>
    </div>
    <div id="code" class="box-content content">
        ###############################################################################<br/>#                                            code written by Brandy@CrystalMUSH<br/>#                                            for MUSH 2.2 or later *ONLY*<br/>#                                        <br/># NOTES AND CAUTIONS:  This file should only be installed on systems<br/># that do not currently have my mailer installed, or on systems already<br/># running version 13 (since 13 has been out more than a year, this shouldn't<br/># be a hardship).<br/>#                                        <br/># Notes on the formating of this file:                                         <br/>#  - is used to separate attributes<br/>#  # in the first column means a comment<br/>#  all leading blanks should be stripped, but tailing ones should not<br/>#<br/># This +mail code is available via anonymous FTP from<br/># ftp.tinymush.org (205.226.195.2) in file:<br/>#   /pub/mud/tinymush/mushcode/mail/brandy_mailer.14<br/>#<br/># A tool that parses this format is available in the same directory in file:<br/>#   amolitor_mush_unformatter.c<br/>#<br/># Carol <br/># a.k.a Brandy@CrystalMUSH<br/>#<br/># MAILING LIST:<br/>#<br/># To be kept abreast of patches and upgrades, or if you just want to <br/># make comments/suggestions whatever, subscribe to brandy-mail@lupine.org <br/># by sending an email message to listserv@lupine.org, with <br/># 'subscribe brandy-mail MyNameHere' in the body of the mail message.<br/>#<br/>###############################################################################<br/># Possibilities for the future:<br/>#<br/># fix 'store' to not have dested player in held and dist from alias<br/># example: michael was dested, but was still in either the singer or<br/># the rp_coordinator alias<br/>#<br/>###############################################################################<br/>#<br/># Version 14:<br/>#<br/>#  Misc:<br/>#    Updated to use new 2.2 functions:  <br/>#      last(), squish, ulocal, default, hasattr<br/>#    use %q&lt;number&gt; instead of r(&lt;number&gt;)<br/>#<br/>#  Bug fixes.<br/>#   MAJOR BUG fix for +destroy mailbox command<br/>#   fixed bug in +set mail default separator<br/>#   fixed bug in +read, cc line not showing if set<br/>#   fixed bug in +remove filter<br/>#   fixed bug in +status of mail sent to &lt;name&gt;, time read was wrong<br/>#   +edit global aliases and +edit personal alias now filters out <br/>#     non-player names BEFORE attempting to edit, without bitching about it.<br/>#   fixed +list folders to not crap out on big mailboxes with lots of folders<br/>#     (used to get function limit exceeded)<br/>#    restructured 'expand_letter_range' some to avoid function limit exceeded<br/>#      when +skim author:&lt;name&gt; is done on very large mailboxes.<br/>#   changed 'snag_dbrefs' to verify each dbref is a player <br/>#      (had a mailbox inconsistency problem when an alias had a player<br/>#      who had an autoforward to someone who wasn't a player anymore)<br/>#   Fixed bug where vacation messages would loop of the mush default<br/>#      switch for @swi is '/all'.<br/>#   Added a restriction for global mail aliases to 14 chars to avoid a<br/>#      server bug<br/>#   Added a restriction for personal mail aliases to 25 chars to avoid a<br/>#      server bug<br/>#<br/>#  Features:<br/>#   forwarded mail now shows up with a FORWARDED flag on a +read, and<br/>#   a F on a skim (request so that people can't fake forwarded messages)<br/>#<br/>#   show 'a' for mailboxes with autoforward set in +mail status<br/>#<br/>#   spell check subject and text when +proof is done (if +spell is installed)<br/>#   (See Andrew Molitor if you're interested in the spell robot)<br/>#<br/>#   +include &lt;letter number or keyword&gt;   (while +replying or writing mail)<br/>#<br/>#   added a debug attribute<br/>#<br/>#   revamped +help per request of Ambar<br/>#<br/>#   removed 'mode' option.  Slimmed enter/finish messages.<br/>#<br/>#   added '+check mail/all' command<br/>#<br/>#   If 'null' is specified as the folder on a mail filter, automatically<br/>#     toss it<br/>#<br/>#   New command:  +set mail option filter reject = &lt;text&gt;.<br/>#   This command comes into play if one or more mail filters have been <br/>#   defined that point to the 'null' (discard) folder.  If 'filter reject'<br/>#   text is registered, mail containing that text is sent to the originator.<br/>#   (Note that this differs from the pre-existing 'reject' text in that<br/>#   that is when ALL mail is being refused).<br/>#<br/>#   New command:  +verify mail config<br/>#     verifies that @admin space_compress=yes<br/>#     verifies that @swi/first works (don't laugh, I've been called on<br/>#       games to fix 'bugs' where it turned out that certain cases of<br/>#       @swi/first were busted. :P)<br/>#     verifies that @attribute/access mail_config_options=wizard<br/>#     verifies that mail system does not have I or W flags<br/>#     verifies that Wiz-Inherit Object is owned by a wizard and I or W<br/>#     verifies that the mail system is parented to the parent mail object<br/>#     verifies that the mail system is allowed to @create objects<br/>#     NOTE:  I would *like* to verify that 1) remote @pemit's are allowed,<br/>#     2) @attribute/access mail_config_options=!private and 3)<br/>#     @attribute/access mail_sig=!private, but I can't figure out how to<br/>#     do that automatically on generic systems, so y'all will just have to<br/>#     verify that yourself.<br/>#<br/>#   Changed +mail status to show warning message if mailbox is owned by<br/>#     the wrong player.<br/>#<br/>#   Changed hidden command '+sanity check' to automatically fix detected<br/>#   problems<br/>#<br/>#   Added timeout of 'mail-in-progress' stuff (assumes attribute 'last' <br/>#   is not private, see @list attr_permissions)<br/>#<br/>#   New command:  +set mail option RGA = yes | no<br/>#   (RGA stands for Restrict Global Aliases.  If set to 'yes', only wizards<br/>#   may create global aliases.  Default is no restrictions)<br/>#<br/>#   Added a @startup for the Master Mailbox to automatically clean out<br/>#   dbrefs that no longer are players in global aliases.<br/>#<br/>###############################################################################<br/>#<br/># The following are the mapping of dbref to object in this file.<br/># <br/>#    #300 - Mail System                     <br/>#     #25 - Wiz-Inherit Object         <br/>#      #7 - Master Mailbox                  <br/>#     #13 - Help Text <br/>#   #4167 - Parent Mail Object   <br/>#<br/># To modify this file for use on another MUSH, basically, 5 vi commands <br/># must be used to change the dbrefs to the ones for the matching objects<br/># on the MUSH this is being installed on.  Then run it through Andrew <br/># Molitor's MUSH code unformatter.  It is then ready for quoting in via <br/># tf or whatever.  (For first time installations, see instructions below).<br/>#<br/>#    (brief instructions)<br/>#    create the objects needed <br/>#    edit brandy_mailer.14 to reference the relevant dbrefs<br/>#    compile the unformatter:         cc amolitor_mush_unformatter.c<br/>#    then run the mailer through it:  a.out brandy_mailer.14 &gt;mailer<br/>#    and install via tf:              /quote -5 'mailer<br/>#<br/>#   (vi commands to change dbrefs through the file)<br/>#<br/>#   :1,$s/#300/&lt;the dbref on your MUSH for the mail system object&gt;/g<br/>#   :1,$s/#25/&lt;the dbref on your MUSH for the wiz-inherit object&gt;/g<br/>#   :1,$s/#7/&lt;the dbref on your MUSH for the master mailbox object&gt;/g<br/>#   :1,$s/#13/&lt;the dbref on your MUSH for the help text object&gt;/g<br/>#   :1,$s/#4167/&lt;the dbref on your MUSH for the parent mail object&gt;/g<br/>#<br/># NOTE:<br/>#<br/>#   The personal mail option commands won't work on #1, since there<br/>#   are permission problems with setting attributes on 'god'.  If<br/>#   'god' is so inclined to use +mail and wants personal options<br/>#   set, s/he will need to set the &amp;mail_config_options attribute<br/>#   on him/herself.<br/>#<br/>###############################################################################<br/>#<br/># For those installing it for the first time....<br/>#<br/># @create Mail System (must reside in the master room)<br/># @create Wiz-Inherit Object <br/>#   (Note: must reside in the master room, this object holds the few mail <br/>#    commands that need wiz powers)<br/># @create Master Mailbox<br/># @create Help Text<br/># @create Parent Mail Object<br/>#<br/># @parent Mail System = Parent Mail Object<br/>#<br/># @set Wiz-Inherit Object=inherit <br/>#   (Note: the other objects need not and indeed<br/>#   should not be set inherit)<br/>#<br/># &amp;mail_config_options me=soft<br/># &amp;mail_config_options me=<br/># ^_____(just to get that attribute in the list of user attributes)<br/>#<br/># &amp;mail_sig me=something<br/># &amp;mail_sig me=<br/># ^_____(just to get that attribute in the list of user attributes)<br/>#<br/># @attribute/access mail_config_options=wizard (must be done by god(#1))<br/># @attribute/access mail_config_options=!private (must be done by god(#1))<br/># @attribute/access mail_sig=!private (must be done by god(#1))<br/>#<br/># The Mail System object and the Wiz-Inherit Object must reside<br/># in the Master Room.  The remaining objects should not be in the<br/># master room.  Just stick them in a bag somewhere and forget about them. ;)<br/>#<br/># CAUTION:  In order for the +mailer to work, space compression<br/># MUST be turned on (@admin space_compress=yes).  This shouldn't<br/># present a problem since most (all?) MUSHes run this way.<br/>#<br/># Also, remote @pemit's must be allowed.<br/>#<br/># The mail system needs to be able to create objects.<br/>#<br/>-<br/>#<br/># Set the MAILBOXES_NUM_OF_ATTRIBUTEs, only if not previously set by<br/># a prior installation.<br/>#<br/><br/><br/>@swi hasattr(#7, mailboxes_num_of_attributes) = 0,&amp;mailboxes_num_of_attributes #7=1<br/>@swi hasattr(#4167, SPELL_CHECKER_AVAILABLE) = 0,&amp;SPELL_CHECKER_AVAILABLE #4167 = 0<br/>@swi hasattr(#7, DEFAULT_RGA_OPTION) = 0,&amp;DEFAULT_RGA_OPTION #7 = 0<br/>@swi hasattr(#7, DEFAULT_DELETE_OPTION) = 0,&amp;DEFAULT_DELETE_OPTION #7 = soft<br/>@swi hasattr(#7, DELETE_WHEN_EMPTY) = 0,&amp;DELETE_WHEN_EMPTY #7 = 1<br/>@swi hasattr(#7, DEFAULT_TIMEOUT_OPTION) = 0,&amp;DEFAULT_TIMEOUT_OPTION #7 = 1209600<br/>@swi hasattr(#7, DEFAULT_PURGE_TIME) = 0,&amp;DEFAULT_PURGE_TIME #7 = Wednesday 04:00<br/>@swi hasattr(#7, DEFAULT_FORMAT_OPTION) = 0,&amp;DEFAULT_FORMAT_OPTION #7 = standard<br/>@swi hasattr(#7, DEFAULT_SAVE_OPTION) = 0,&amp;DEFAULT_SAVE_OPTION #7 = enabled<br/>@swi hasattr(#7, DEFAULT_SEPARATOR_OPTION) = 0,&amp;DEFAULT_SEPARATOR_OPTION #7 = space<br/>&amp;DELIVERY_NOTIFICATION #4167=A light blinks on your wrist unit indicating that a new message has been received from [name(%0)] in folder '%5'[switch(or(%1, %2, %3, %4), 1, {%b([switch(%1, 1, %b[v(mail_flag_u)])][switch(%2, 1, %b[v(mail_flag_p)])][switch(%3, 1, %b[v(mail_flag_rr)])][switch(%4, 1, %b[v(mail_flag_r)])]%b).}, .)]<br/>&amp;PICKUP_NOTIFICATION #4167=The mail has been sent.<br/>&amp;FORWARD_NOTIFICATION #4167=Letter %1 in folder '%0' has been forwarded.<br/>&amp;TEXT_ADDED_NOTIFICATION #4167 = Text added.<br/>&amp;MAIL_VERSION #4167=Thu Mar 6, 1997<br/>@VM #4167 = #7<br/>@VM #25 = #7<br/>&amp;MAIL_SYSTEM #4167=#300<br/>&amp;MAIL_SYSTEM #25=#300<br/>@drain #7<br/>@no #7<br/>&amp;EQUAL_LINE #4167=repeat(=, 78)<br/>&amp;DASH_LINE #4167=repeat(-, 78)<br/>&amp;MAIL_FLAG_RR #4167=REPLY REQUESTED<br/>&amp;MAIL_FLAG_P #4167=PRIVATE<br/>&amp;MAIL_FLAG_U #4167=URGENT<br/>&amp;MAIL_FLAG_R #4167=REGISTERED<br/>&amp;MAIL_FLAG_D #4167=MARKED FOR DELETION<br/>&amp;MAIL_FLAG_T #4167=TIMEOUT WARNING    <br/>&amp;MAIL_FLAG_S #4167=SAVED <br/>&amp;MAIL_FLAG_M #4167=MARKED <br/>&amp;MAIL_FLAG_F #4167=FORWARDED <br/>&amp;SECONDS_IN_DAY #4167 = 86400<br/>&amp;SECONDS_IN_DAY #25 = 86400<br/>&amp;ENTER_MSG #4167=You may now enter the message text.%b%bTo see options, type '-'.<br/>&amp;ENTER_MSG_VERBOSE #4167=<br/>&amp;ENTER_MSG_TERSE #4167=<br/>&amp;FINISH_MSG_VERBOSE #4167=<br/>&amp;FINISH_MSG_TERSE #4167=<br/>&amp;FINISH_MSG #4167=Options: %b+proof, +send, +toss, +cc, +bcc, +edit &lt;part&gt;=&lt;old&gt;/&lt;new&gt; or %r+set mail flag \[!\]&lt;flag&gt;.%b%bTo see expanded option help, type '-'.<br/>&amp;NOMAIL #4167=There is no mail in folder '[secure(%0)]'.<br/>&amp;NO_SENT_MAIL #4167 = There is no mail from you remaining in the mail system.<br/>&amp;NOFUNC #4167=I'm sorry, but function calls are not allowed within an input parameter.<br/>&amp;NOT_PLAYER #4167 = You must be a player to use the mail system.<br/>&amp;NOT_WRITING_MAIL #4167 = There is not a mail message in progress.<br/>&amp;NO_MATCH #4167 = %0:%b%bNo letter matches the specified criteria%1 in folder '%2'.<br/>&amp;NO_MAIL_FROM_YOU #4167 = There is no mail from you in %0's mailbox.<br/>&amp;overflow_point #7=3900<br/>&amp;percent_r #4167=%r<br/>&amp;temp_cmd #300=$setnewline *:&amp;newline #4167=%0<br/>setnewline %r<br/>&amp;temp_cmd #300=<br/>&amp;CHECK_MAIL_COMMAND #300=$+check mail: @swi/first [setq(0, get(%vm/mailbox_%#))]0 = strmatch(type(%#), PLAYER),{@pemit %# = u(not_player)},strlen(%q0),{@pemit %# = u(nomail, ulocal(get_inbox, %#))},{@wait %q0 = {&amp;debug_mail %q0 = +check mail; @pemit %# = [setq(1, u(get_folder_in_list, %q0))][setq(2, u(get_active_folder, %q0))][setq(3, switch(words(%q1), 0, 0, words(filter(mail_not_read, %q1))))][switch(0, words(%q1),u(nomail, %q2), %q3, You do not have unread mail in your '%q2' mail folder., You have %q3 unread mail message(s) out of a total of [words(%q1)] in your '%q2' mail folder.)][switch(get(%q0/mail-in-progress),true, %b%b(Warning:%b Your mail in progress flag is set))];  @no %q0}}<br/>&amp;CHECK_MAIL_ALL_COMMAND #300=$+check mail/a*: @swi/first [setq(0, get(%vm/mailbox_%#))]0 = strmatch(type(%#), PLAYER), {@pemit %# = u(not_player)}, strlen(%q0), {@pemit %# = u(nomail, ulocal(get_inbox, %#))}, {@wait %q0 = {&amp;debug_mail %q0 = +check mail/all; @dolist get(%q0/folder-list) = {@pemit %# = [setq(1, get(%q0/in-list-##))][setq(2, secure(##))][setq(3,switch(words(%q1), 0, 0, words(filter(mail_not_read, %q1))))][switch(0, words(%q1),,%q3,,You have %q3 unread message(s) out of [words(%q1)] in mail folder '%q2'.)]}; @swi 1 = 1, {@pemit %# = [switch(get(%q0/mail-in-progress),true, %b%b(Warning:%b Your mail in progress flag is set))]; @no %q0}}}<br/>&amp;MAIL_NOT_READ #4167 = strmatch(get(%q0/in-%0-time_read), 0)<br/>&amp;SKIM_COMMAND #300=$+skim*: @swi/first [setq(0, get(%vm/mailbox_%#))]0 = strmatch(type(%#), PLAYER),{@pemit %# = u(not_player)},not(strmatch(escape(%0), *[*)),{@pemit %# = u(nofunc)},strlen(%q0), {@pemit %# = u(nomail, ulocal(get_inbox, %#))},{@wait %q0 = {&amp;debug_mail %q0 = +skim%0; @swi/first [setq(1, u(get_folder_in_list, %q0))][setq(2, u(get_folder_current_letter, %q0))][setq(3, u(grab_timeout_value, get(%q0/message_timeout), get(%vm/default_timeout_option)))][setq(9, u(get_format_option, get(%#/mail_config_options)))]1 = eq(words(%q1), 0), {@pemit %# = [u(nomail, u(get_active_folder, %q0))][switch(get(%q0/mail-in-progress), true,%b(Warning:%b Your mail in progress flag is set))];  @no %q0},eq(words(%0), 0),{@pemit %# = [switch(%q9, standard,{[u(equal_line)]%r%r[space(27)]List of Mail Messages%r%r})][space(9)]Sender[space(12)]Subject[space(22)]Size%b%bReceived%r[space(9)]------[space(12)]-------[space(22)]----%b%b--------;  @dolist %q1 ={@pemit %# = ulocal(skim_bulk, %#, ##, %q0, %q1, %q2, %q3, u(get_src_dbref, %q0, ##), u(get_src_num, %q0, ##))};@swi 1 = 1,{@pemit %# =[setq(1, u(get_active_folder, %q0))][setq(2, squish(remove(remove(get(%q0/folder-list), edit(%q1, %b, $)), null)))]%rSelected folder:%b%b%q1[switch(words(%q2), 0,, %rOther folders:%b%b[u(secure_names, %q2)])][switch(%q9, standard,%r%r[u(equal_line)])]; @no %q0}},{@swi/first [setq(4, ulocal(expand_letter_range, %0, %q1, u(get_folder_current_letter, %q0)))]1 = strmatch(%q4, *ABORT*),{@pemit %# = after(before(%q4, ENDABORT), ABORT);  @no %q0},eq(words(%q4), 0),{@pemit %# = u(no_match, +skim, ulocal(format_request, trim(%0)), u(get_active_folder, %q0)); @no %q0},{@pemit %# = [switch(%q9, standard,{[u(equal_line)]%r%r[space(27)]List of Mail Messages%r%r})][space(9)]Sender[space(12)]Subject[space(22)]Size%b%bReceived%r[space(9)]------[space(12)]-------[space(22)]----%b%b--------;  @dolist [setq(4, u(filter_list, setunion(%q4, ), %q1))]%q4 = {@pemit %# = ulocal(skim_bulk, %#, ##, %q0, %q1, %q2, %q3, u(get_src_dbref, %q0, ##), u(get_src_num, %q0, ##))};@swi 1 = 1,{@pemit %# = [setq(1, u(get_active_folder, %q0))][setq(2, squish(remove(remove(get(%q0/folder-list), edit(%q1, %b, $)), null)))]%rSelected folder:%b%b%q1[switch(words(%q2), 0,, %rOther folders:%b%b[u(secure_names, %q2)])][switch(%q9, standard,%r%r[u(equal_line)])]; @no %q0}}}}}<br/>&amp;SKIM_BULK #4167=[setq(4, get(%2/in-%1-flags))][setq(5, member(%3, %1))][setq(6, default(%6/out-%7-sender, get(%6/owner_dbref)))][setq(6, switch(type(%q6), PLAYER, name(%q6), destroyed player))][setq(7, trim(get(%6/out-%7-subject)))][setq(8, get(%2/in-%1-time_read))][switch(%1, %4, +, %b)][switch([gt(match(%q4, m), 0)]+[gt(match(%q4, d), 0)]+[gt(match(%q4, s), 0)]+[gt(match(%q4, f), 0)]+%q8+[gte(sub(secs(), switch(%q8, 0, convtime(get(%6/out-%7-time_sent)), convtime(%q8))), div(%5, 2))], 1+*+*+*+*+*, M, *+1+*+*+*+*, D, *+*+1+*+*+*, S, 0+0+0+*+*+1, T, 0+0+0+*+0+*, U, *+*+*+1+*+*, F, %b)][switch(hasattr(%2, in-%1-note), 0, %b, n)][rjust(%q5\)%b%b, 6)][ljust(mid(%q6, 0, min(16, strlen(%q6))), 18)][ljust(mid(%q7, 0, min(27, strlen(%q7))), 29)][ljust(strlen(u(%6/out-%7-text)), 6)][mid(get(%6/out-%7-time_sent), 0, 16)]<br/>&amp;READ_COMMAND #300=$+read*: @swi/first [setq(0, get(%vm/mailbox_%#))]0 = strmatch(type(%#), PLAYER),{@pemit %# = u(not_player)},not(strmatch(escape(%0), *[*)),{@pemit %# = u(nofunc)},strlen(%q0), {@pemit %# = u(nomail, ulocal(get_inbox, %#))},{@wait %q0 = {&amp;debug_mail %q0 = +read%0; @swi/first [setq(1, u(get_folder_in_list, %q0))][setq(2, u(get_active_folder, %q0))][setq(9, u(get_format_option, get(%#/mail_config_options)))]0 = words(%q1), {@pemit %# = [u(nomail, %q2)][switch(get(%q0/mail-in-progress), true,%b(Warning:%b Your mail in progress flag is set))];  @no %q0},strlen(%0), {@pemit %# = [setq(3, switch(words(%q1), 0, 0, words(filter(mail_not_read, %q1))))][switch([words(%q1)]+%q3, 0+*, u(nomail, %q2), *+0,You do not have unread mail in your '%q2' mail folder., You have %q3 unread mail message(s) out of a total of [words(%q1)] in your '%q2' mail folder.)][switch(get(%q0/mail-in-progress),true, %b%b(Warning:%b Your mail in progress flag is set))];  @no %q0},{@swi/first [setq(3, ulocal(expand_letter_range,%0,%q1, u(get_folder_current_letter, %q0)))]1 = strmatch(%q3, *ABORT*),{@pemit %# = after(before(%q3, ENDABORT), ABORT);  @no %q0},eq(words(%q3), 0),{@pemit %# = u(no_match, +read, ulocal(format_request, trim(%0)), %q2); @no %q0},{@dolist [setq(3, u(filter_list, setunion(%q3, ), %q1))][setq(4, u(grab_timeout_value, get(%q0/message_timeout), get(%vm/default_timeout_option)))]%q3 ={@pemit %# = ulocal(read_bulk, %#, %q2, ##, %q1, %q9, %q0, %q4, u(get_src_dbref, %q0, ##), u(get_src_num, %q0, ##)); @tr me/check_if_registered = %#, %q0, ##, u(get_src_dbref, %q0, ##), u(get_src_num, %q0, ##)}; @swi 1 = 1, {&amp;[u(which_current_letter, %q0)] %q0 = last(%q3); @swi 1 = 1,{@no %q0}}}}}}<br/>&amp;READ_BULK #4167=[setq(5, match(%3, %2))][setq(6, get(%7/out-%8-cc))][setq(7, get(%5/in-%2-flags))][setq(8, get(%5/in-%2-time_read))][switch(%4, standard, {[u(equal_line)]%r})][ljust(Message:%b%b%q5/[words(%3)] in folder %1, 43)]Received:%b%b[get(%7/out-%8-time_sent)]%rFrom:[space(5)][setq(9, default(%7/out-%8-sender, get(%7/owner_dbref)))][switch(type(%q9), PLAYER, name(%q9), destroyed player)]%rTo:[space(7)][trim(get(%7/out-%8-to))][switch(words(%q6), 0,,%rCc:[space(7)][trim(%q6)])][switch(match(get(%7/out-%8-bcc-expanded), %0),0,,%rBcc:[space(6)][name(%0)])]%rSubject:%b%b[trim(get(%7/out-%8-subject))][switch(%q7, *A*,%b\( autoforwarded from [name(after(before(%q7, AEND), A))] \))][switch(words(setinter(%q7, RR P U R D S M F)), 0,, %rFlags:%b%b%b%b)][switch(match(%q7, u), 0,, [v(mail_flag_u)]%b%b)][switch(match(%q7, rr), 0,, [v(mail_flag_rr)]%b%b)][switch(match(%q7, r), 0,, [v(mail_flag_r)]%b%b)][switch(match(%q7, p), 0,, [v(mail_flag_p)]%b%b)][switch(match(%q7, d), 0,, [v(mail_flag_d)]%b%b)][switch(match(%q7, m), 0,, [v(mail_flag_m)]%b%b)][switch(match(%q7, s), 0,, [v(mail_flag_s)]%b%b)][switch(match(%q7, f), 0,, [v(mail_flag_f)]%b%b)][switch(%4, standard, {%r[u(dash_line)]%r%r},%rText:[space(5)])][u(%7/out-%8-text)][switch(hasattr(%5, in-%2-note), 1,{[switch(%4, standard, {%r%r[u(dash_line)]})]%rNote:[space(5)][get_eval(%5/in-%2-note)]})][switch(%4, standard, {%r%r[u(equal_line)]})]%rOptions:%b +add note=&lt;text&gt;, +delete, +forward, +move, +reply, +replyall, +save<br/>&amp;CHECK_IF_REGISTERED #4167=&amp;in-%2-time_read %1 = [setq(6, get(%1/in-%2-time_read))]time(); @swi/first [setq(5, default(%3/out-%4-sender, get(%3/owner_dbref)))]1 = and(strmatch(%q6, 0), sign(match(get(%1/in-%2-flags), r))), {@tr me/store_letter = %1, Receipt Notification, name(%q5), %q5, , , , , , {[name(%0)] has read the message which had a subject line of "[trim(get(%3/out-%4-subject))]" which was originally sent by you on [get(%3/out-%4-time_sent)].}}<br/>&amp;UNREAD_COMMAND #300=$+unread*: @swi/first [setq(0, get(%vm/mailbox_%#))]0 = strmatch(type(%#), PLAYER),{@pemit %# = u(not_player)},not(strmatch(escape(%0), *[*)), {@pemit %# = u(nofunc)},strlen(%q0), {@pemit %# = u(nomail, ulocal(get_inbox, %#))},{@wait %q0 = {&amp;debug_mail %q0 = +unread%0; @swi/first [setq(1, u(get_folder_in_list, %q0))][setq(2, ulocal(expand_letter_range, %0, %q1, u(get_folder_current_letter, %q0)))]1 = eq(words(%q1), 0), {@pemit %# = u(nomail, u(get_active_folder, %q0)); @no %q0},strmatch(%q2, *ABORT*), {@pemit %# = after(before(%q2, ENDABORT), ABORT); @no %q0},eq(words(%q2), 0),{@pemit %# = u(no_match, +unread, ulocal(format_request, trim(%0)), u(get_active_folder, %q0)); @no %q0},{@dolist [setq(2, u(filter_list, setunion(%q2, ), %q1))]%q2 ={&amp;in-##-time_read %q0 = 0}; @swi 1 = 1, {&amp;[u(which_current_letter, %q0)] %q0 = last(%q2);  @pemit %# = Letter(s) [u(convert_nums, %q2, %q1)][ulocal(format_request, trim(%0))] marked as 'unread' in folder '[u(get_active_folder, %q0)]'.;@no %q0}}}}<br/>&amp;ADD_NOTE_COMMAND #300=$+add note to *=*: @swi/first [setq(0, get(%vm/mailbox_%#))]0 = strmatch(type(%#), PLAYER),{@pemit %# = u(not_player)},not(strmatch(escape(%0), *[*)), {@pemit %# = u(nofunc)},strlen(%q0), {@pemit %# = u(nomail, ulocal(get_inbox, %#))},{@wait %q0 = {&amp;debug_mail %q0 = +add note to %0=%1; @swi/first [setq(1, u(get_folder_in_list, %q0))][setq(2, ulocal(expand_single_letter_range, trim(%0), %q1, u(get_folder_current_letter, %q0)))]1 = eq(words(%q1), 0), {@pemit %# = u(nomail, u(get_active_folder, %q0));@no %q0},strmatch(%q2, *ABORT*), {@pemit %# = after(before(%q2, ENDABORT), ABORT); @no %q0},eq(words(%q2), 0), {@pemit %# = u(no_match, +add note, ulocal(format_request, trim(%0)), u(get_active_folder, %q0)); @no %q0},{&amp;in-%q2-note %q0 = u(clean_text, %1); &amp;[u(which_current_letter, %q0)] %q0 = %q2;@pemit %# = Note [switch(words(%1), 0, removed from, added to)] message [u(convert_nums, %q2, %q1)][ulocal(format_request, trim(%0))] in folder '[u(get_active_folder, %q0)]'.;@no %q0}}}<br/>&amp;ADD_NOTE_2_COMMAND #300=$+add note=*: @swi/first [setq(0, get(%vm/mailbox_%#))]0 = strmatch(type(%#), PLAYER),{@pemit %# = u(not_player)},strlen(%q0), {@pemit %# = u(nomail, ulocal(get_inbox, %#))},{@wait %q0 = {&amp;debug_mail %q0 = +add note=%0; @swi/first [setq(1, u(get_folder_in_list, %q0))][setq(2, u(get_folder_current_letter, %q0)))]1 = eq(words(%q1), 0), {@pemit %# = u(nomail, u(get_active_folder, %q0));@no %q0},{&amp;in-%q2-note %q0 = u(clean_text, %0); @pemit %# = Note [switch(strlen(%0), 0, removed from, added to)] message [u(convert_nums, %q2, %q1)] (%bcurrent%b) in folder '[u(get_active_folder, %q0)]'.;@no %q0}}}<br/>&amp;ADD_NOTE #300 = $+add note: @pemit %# = The syntax is +add note to &lt;number&gt;=&lt;text&gt;.<br/>&amp;DELETE_COMMAND #300=$+delete*: @swi/first [setq(0, get(%vm/mailbox_%#))]0 = strmatch(type(%#), PLAYER),{@pemit %# = u(not_player)},not(strmatch(escape(%0), *[*)), {@pemit %# = u(nofunc)},strlen(%q0), {@pemit %# = u(nomail, ulocal(get_inbox, %#))},{@wait %q0 = {&amp;debug_mail %q0 = +delete%0; @swi/first [setq(1, u(get_folder_in_list, %q0))][setq(6, u(get_delete_option, %#))][setq(2, ulocal(expand_letter_range, %0, %q1, u(get_folder_current_letter, %q0)))][setq(5, u(get_active_folder, %q0))]1 = eq(words(%q1), 0),  {@pemit %# = u(nomail, %q5);@no %q0},strmatch(%q2, *ABORT*), {@pemit %# = after(before(%q2, ENDABORT), ABORT); @no %q0},eq(strlen(%q0), 0), {@pemit %# = u(no_match, +delete, ulocal(format_request, trim(%0)), %q5); @no %q0},{@dolist [setq(2, u(filter_list, setunion(%q2, ), %q1))][setq(3, squish(u(filter_list, setdiff(%q1, %q2), %q1)))][setq(3, switch(%q6, soft, last(%q2), switch(last(%q2), last(%q1), first(%q3), extract(%q1, add(match(%q1, last(%q2)), 1), 1))))][setq(4, u(convert_nums, %q2, %q1))]%q2 = {@swi/first %q6 = soft, {&amp;in-##-flags %q0 = setunion(get(%q0/in-##-flags) D, )}, {@tr me/remove_letter = u(get_src_dbref, %q0, ##), u(get_src_num, %q0, ##), %#, %q0, ##, edit(%q5, %b, $), +delete*}}; @swi 1 = 1,{&amp;current_letter-%q5 %q0 = %q3; @pemit %# = Message(s) %q4[ulocal(format_request, trim(%0))] [switch(u(get_delete_option, %#), hard, deleted from, marked for deletion in)] folder '%q5'.; @no %q0}}}}<br/>&amp;UNDELETE_COMMAND #300=$+undelete*: @swi/first [setq(0, get(%vm/mailbox_%#))]0 = strmatch(type(%#), PLAYER),{@pemit %# = u(not_player)},not(strmatch(escape(%0), *[*)), {@pemit %# = u(nofunc)},strlen(%q0), {@pemit %# = u(nomail, ulocal(get_inbox, %#))},{@wait %q0 = {&amp;debug_mail %q0 = +undelete%0; @swi/first [setq(1, u(get_folder_in_list, %q0))][setq(2, ulocal(expand_letter_range, %0, %q1, u(get_folder_current_letter, %q0)))]1 = eq(words(%q1), 0),  {@pemit %# = u(nomail, u(get_active_folder, %q0));@no %q0},strmatch(%q2, *ABORT*), {@pemit %# = after(before(%q2, ENDABORT), ABORT); @no %q0},eq(words(%q2), 0), {@pemit %# = u(no_match, +undelete, ulocal(format_request, trim(%0)), u(get_active_folder, %q0)); @no %q0},{@dolist [setq(2, u(filter_list, setunion(%q2, ), %q1))]%q2 = {&amp;in-##-flags %q0 = squish(remove(get(%q0/in-##-flags), D))}; @swi 1 = 1, {&amp;[u(which_current_letter, %q0)] %q0 = last(%q2); @pemit %# = 'Marked for deletion' flag(s) removed from message(s) [u(convert_nums, %q2, %q1)][ulocal(format_request, trim(%0))] in folder '[u(get_active_folder, %q0)]'.; @no %q0}}}}<br/>&amp;CLEAR_COMMAND #300=$+clear*: @swi/first [setq(0, get(%vm/mailbox_%#))]0 = strmatch(type(%#), PLAYER),{@pemit %# = u(not_player)},not(strmatch(escape(%0), *[*)), {@pemit %# = u(nofunc)},strlen(%q0), {@pemit %# = u(nomail, ulocal(get_inbox, %#))},{@wait %q0 = {&amp;debug_mail %q0 = +clear%0; @swi/first [setq(1, u(get_folder_in_list, %q0))][setq(2, ulocal(expand_letter_range, %0, %q1, u(get_folder_current_letter, %q0)))][setq(5, u(get_active_folder, %q0))][setq(6, u(get_delete_option, %#))]1 = eq(words(%q1), 0),  {@pemit %# = u(nomail, %q5);@no %q0},strmatch(%q2, *ABORT*), {@pemit %# = after(before(%q2, ENDABORT), ABORT); @no %q0},eq(strlen(%q0), 0), {@pemit %# = u(no_match, +clear, ulocal(format_request, trim(%0)), %q5); @no %q0},{@dolist [setq(2, u(filter_list, setunion(%q2, ), %q1))][setq(3, squish(u(filter_list, setdiff(%q1, %q2), %q1)))][setq(3, switch(%q6, soft, last(%q2), switch(last(%q2), last(%q1), first(%q3), extract(%q1, add(match(%q1, last(%q2)), 1), 1))))][setq(4, u(convert_nums, %q2, %q1))]%q2 = {@swi/first %q6 = soft, {&amp;in-##-flags %q0 = setunion(get(%q0/in-##-flags) D, )}, {@tr me/remove_letter = u(get_src_dbref, %q0, ##), u(get_src_num, %q0, ##), %#, %q0, ##, edit(%q5, %b, $), +clear*}}; @swi 1 = 1,{&amp;current_letter-%q5 %q0 = %q3; @pemit %# = Message(s) %q4[ulocal(format_request, trim(%0))] [switch(u(get_delete_option, %#), hard, cleared from, marked for deletion in)] folder '%q5'.; @no %q0}}}}<br/>&amp;FLUSH_COMMAND #300=$+flush: @swi/first [setq(0, get(%vm/mailbox_%#))]0 = strmatch(type(%#), PLAYER),{@pemit %# = u(not_player)},strlen(%q0),{@pemit %# = There is no mail marked for deletion in folder '[ulocal(get_inbox, %#)]'.},{@wait %q0 = {&amp;debug_mail %q0 = +flush; @swi/first [setq(1, u(get_folder_in_list, %q0))][setq(5, u(find_letters_to_flush, %q0, %q1))][setq(8, u(get_active_folder, %q0))][setq(9, squish(u(filter_list, setdiff(%q1, %q5), %q1)))][setq(9, switch(last(%q5), last(%q1), first(%q9), extract(%q1, add(member(%q1, last(%q5)), 1), 1)))]0 = words(%q1), {@pemit %# = There is no mail marked for deletion in folder '%q8'.;@no %q0},words(%q5),  {@pemit %# = There is no mail marked for deletion in folder '%q8'.;@no %q0},{@dolist [setq(2, words(%q1))]setunion(%q5,) = {@tr me/remove_letter = u(get_src_dbref, %q0, ##), u(get_src_num, %q0, ##), %#, %q0, ##, edit(%q8, %b, $),+flush}; @swi 1 = 1, {@pemit %# = [setq(4, words(%q5))]All messages that were marked for deletion have been deleted from folder '%q8'. (%b%q4 deleted, [sub(%q2, %q4)] remain%b); &amp;[u(which_current_letter, %q0)] %q0 = %q9; @no %q0}}}}<br/>&amp;FIND_LETTERS_TO_FLUSH #4167 = iter(%1, switch(member(get(%0/in-##-flags), D), 0,, ##))<br/>&amp;REPLY_COMMAND #300=$+reply*: @swi/first [setq(0, get(%vm/mailbox_%#))]1 = strmatch(%0, all*),,not(strmatch(type(%#), PLAYER)),{@pemit %# = u(not_player)},strmatch(escape(%0), *[*), {@pemit %# = u(nofunc)},eq(strlen(%q0), 0), {@pemit %# = u(nomail, ulocal(get_inbox, %#))},{@wait %q0 = {&amp;debug_mail %q0 = +reply%0; @swi/first [setq(1, u(get_folder_in_list, %q0))][setq(2, ulocal(expand_single_letter_range, trim(%0), %q1, u(get_folder_current_letter, %q0)))][setq(4, u(get_src_dbref, %q0, %q2))][setq(5, u(get_src_num, %q0, %q2))][setq(6, default(%q4/out-%q5-sender, get(%q4/owner_dbref)))]1 = strmatch(get(%q0/mail-in-progress), true),{@pemit %# = You are already in the middle of sending a message. You must complete that one before you reply to this one.; @no %q0},eq(words(%q1), 0), {@pemit %# = u(nomail, u(get_active_folder, %q0));@no %q0},strmatch(%q2, *ABORT*), {@pemit %# = after(before(%q2, ENDABORT), ABORT); @no %q0},eq(words(%q2), 0), {@pemit %# = u(no_match, +reply, ulocal(format_request, trim(%0)), u(get_active_folder, %q0)); @no %q0},not(strmatch(type(%q6), PLAYER)), {@pemit %# = Originator of letter [u(convert_nums, %q2, %q1)][ulocal(format_request, trim(%0))] in folder '[u(get_active_folder, %q0)]' is no longer a player.; @no %q0},{&amp;[u(which_current_letter, %q0)] %q0 = %q2;&amp;mail-in-progress %q0 = true; &amp;mail-in-progress-to %q0 = name(%q6); &amp;mail-in-progress-to-expanded %q0 = %q6; &amp;mail-in-progress-subject %q0 = [setq(3, get(%q4/out-%q5-subject))]switch(mid(%q3, 0, 3), Re:, %q3, Re:%b%b%q3); @pemit %# = u(enter_msg); @no %q0}}}<br/>&amp;REPLYALL_COMMAND #300=$+replyall*: @swi/first [setq(0, get(%vm/mailbox_%#))]1 = not(strmatch(type(%#), PLAYER)),{@pemit %# = u(not_player)},strmatch(escape(%0), *[*), {@pemit %# = u(nofunc)},eq(strlen(%q0), 0), {@pemit %# = u(nomail, ulocal(get_inbox, %#))},{@wait %q0 = {&amp;debug_mail %q0 = +replyall%0; @swi/first [setq(1, u(get_folder_in_list, %q0))][setq(2, ulocal(expand_single_letter_range, trim(%0), %q1, u(get_folder_current_letter, %q0)))][setq(4, u(get_src_dbref, %q0, %q2))][setq(5, u(get_src_num, %q0, %q2))]1 = strmatch(get(%q0/mail-in-progress), true),{@pemit %# = You are already in the middle of sending a message. You must complete that one before you reply to this one.; @no %q0},eq(words(%q1), 0),{@pemit %# = u(nomail, u(get_active_folder, %q0));@no %q0},strmatch(%q2, *ABORT*), {@pemit %# = after(before(%q2, ENDABORT), ABORT); @no %q0},eq(words(%q2), 0), {@pemit %# = u(no_match, +replyall, ulocal(format_request, trim(%0)), u(get_active_folder, %q0)); @no %q0},not(hasattr(%q4, out-%q5-replyall_to)), {@pemit %# = +replyall:%b%bUnable to perform this function on the specified letter[ulocal(format_request, trim(%0))] in folder '[u(get_active_folder, %q0)]'.;@no %q0},{&amp;[u(which_current_letter, %q0)] %q0 = %q2;&amp;mail-in-progress %q0 = true; &amp;mail-in-progress-to %q0 = u(pretty_dist, get(%q4/out-%q5-replyall_to)); &amp;mail-in-progress-to-expanded %q0 = get(%q4/out-%q5-replyall_to); &amp;mail-in-progress-subject %q0 = [setq(3, get(%q4/out-%q5-subject))]switch(mid(%q3, 0, 3), Re:, %q3, Re:%b%b%q3); @pemit %# = u(enter_msg); @no %q0}}}<br/>&amp;INCLUDE_COMMAND #300=$+include*: @swi/first [setq(0, get(%vm/mailbox_%#))][setq(9, switch(words(%0), 0, current, trim(%0)))]0 = strmatch(type(%#), PLAYER),{@pemit %# = u(not_player)},not(strmatch(escape(%0), *[*)), {@pemit %# = u(nofunc)},strlen(%q0), {@pemit %# = u(nomail, ulocal(get_inbox, %#))},{@wait %q0 = {&amp;debug_mail %q0 = +include%0; @swi/first [setq(1, u(get_folder_in_list, %q0))][setq(2, ulocal(expand_single_letter_range, %q9, %q1, u(get_folder_current_letter, %q0)))]1 = eq(words(%q1), 0), {@pemit %# = u(nomail, u(get_active_folder, %q0));@no %q0},strmatch(%q2, *ABORT*), {@pemit %# = after(before(%q2, ENDABORT), ABORT); @no %q0},strmatch(get(%q0/mail-in-progress), false), {@pemit %# = u(not_writing_mail); @no %q0}, eq(words(%q2), 0), {@pemit %# = u(no_match, +include, ulocal(format_request, %q9), u(get_active_folder, %q0)); @no %q0},{&amp;mail-in-progress-body %q0 = [setq(3, u(get_src_dbref, %q0, %q2))][setq(4, u(get_src_num, %q0, %q2))][setq(5, default(%q3/out-%q4-sender, get(%q3/owner_dbref)))][setq(5, switch(type(%q5), PLAYER, name(%q5), destroyed player))][setq(6, get(%q3/out-%q4-time_sent))][setq(7, edit(edit(get(%q3/out-%q4-text), v(newline),v(percent_r)), v(percent_r), [v(percent_r)]&gt;%b))][setq(3, get(%q0/mail-in-progress-body))]%q3[switch(words(%q3), 0,, %r)]On %q6, %q5 wrote:[switch(1, gt(strlen(%q7), 3000),{[setq(8, wordpos(%q7, 1000))][setq(3, wordpos(%q7, 2000))][setq(4, wordpos(%q7, 3000))][u(format_include_text, 0, 76, extract(%q7, 1, sub(%q8, 1)))] [u(format_include_text, 0, 76, extract(%q7, %q8, sub(%q3, %q8)))];[u(format_include_text, 0, 76, extract(%q7, %q3, sub(%q4, %q3)))];[u(format_include_text, 0, 76, extract(%q7, %q4, add(sub(words(%q7), %q4), 1)))];},gt(strlen(%q7), 2000),{[setq(8, wordpos(%q7, 1000))][setq(3, wordpos(%q7, 2000))][u(format_include_text, 0, 76, extract(%q7, 1, sub(%q8, 1)))] [u(format_include_text, 0, 76, extract(%q7, %q8, sub(%q3, %q8)))];[u(format_include_text, 0, 76, extract(%q7, %q3, add(sub(words(%q7), %q3), 1)))];},gt(strlen(%q7), 1000),{[setq(8, wordpos(%q7, 1000))][u(format_include_text, 0, 76, extract(%q7, 1, %q8))] [u(format_include_text, 0, 76, extract(%q7, add(1, %q8), sub(words(%q7), %q8)))];},{ [u(format_include_text, 0, 76, %q7)]})]%r; @pemit %# = Message [u(convert_nums, %q2, %q1)][ulocal(format_request, %q9)] in folder '[u(get_active_folder, %q0)]' has been included.; @no %q0}}}<br/>&amp;FORMAT_INCLUDE_TEXT #4167=switch(gt(strlen(%2), sub(%1, %0)), 1, %r[space(%0)]&gt;%b[setq(6, sub(wordpos(%2, sub(%1, %0)), 1))][switch(%q6, 0,{[setq(6, sub(%1, %0))][mid(%2, 0, %q6)][u(format_include_text, %0, %1, mid(%2, %q6, sub(strlen(%2), %q6)))]},{[setq(6, wordpos(%2, sub(%1, %0)))][extract(%2, 1, sub(%q6, 1))][u(format_include_text, %0, %1, extract(%2, %q6, add(sub(words(%2), %q6), 1)))]})], %r[space(%0)]&gt;%b%2)<br/>&amp;FORWARD_MAIL #300=$+forward* to *: @swi/first [setq(0, get(%vm/mailbox_%#))]1 = not(strmatch(type(%#), PLAYER)),{@pemit %# = u(not_player)},or(strmatch(escape(%0), *[*),strmatch(escape(%1), *[*)),{@pemit %# = u(nofunc)},eq(strlen(%q0), 0), {@pemit %# = u(nomail, ulocal(get_inbox))},{@wait %q0 = {&amp;debug_mail %q0 = +forward%0 to %1; @swi/first [setq(1, u(get_folder_in_list, %q0))][setq(2, ulocal(expand_single_letter_range, trim(%0), %q1, u(get_folder_current_letter, %q0)))][setq(3, ulocal(identify_to_list, {%1}, %q0))][setq(7, get(%vm/global-mail-aliases))][setq(8, get(%q0/alias-list))][setq(4, u(get_aliases, {%1}, %q0, %q7, %q8))][setq(5, setunion(%q3 [ulocal(expand_aliases, %q4, %q0, %b, %q7, %q8)], ))][setq(6, [u(pretty_dist, %q4, %q0, %q8, %q7, %q3)])]0 = strlen(%1), {@pemit %# = You must specify a destination to forward this piece of mail to.; @no %q0},words(%q1),{@pemit %# = u(nomail, u(get_active_folder, %q0));@no %q0},not(strmatch(%q2, *ABORT*)), {@pemit %# = after(before(%q2, ENDABORT), ABORT); @no %q0},words(%q2), {@pemit %# = u(no_match, +forward, ulocal(format_request, trim(%0)), u(get_active_folder, %q0)); @no %q0},not(strmatch(%q3, *ABORT*)), {@pemit %# = secure(after(before(%q3, ENDABORT), ABORT)); @no %q0},{@tr me/store_letter =[setq(3, u(get_src_dbref, %q0, %q2))][setq(4, u(get_src_num, %q0, %q2))][setq(7, default(%q3/out-%q4-sender, get(%q3/owner_dbref)))][setq(8, get(%q3/out-%q4-subject))][setq(9, get(%q0/in-%q2-note))]%q0, switch(mid(%q8, 0, 4), Fwd:, %q8, Fwd:%b%b%q8), %q6, %q5, , , , , F, {Received from:%b%b[name(%q7)]%r[u(%q3/out-%q4-text)][switch(words(%q9),0,,%r%r[u(dash_line)]%r%N's comment section:%r%r%q9)]}; &amp;[u(which_current_letter, %q0)] %q0 = %q2;@pemit %# = u(forward_notification, u(get_active_folder, %q0), [u(convert_nums, %q2, %q1)][ulocal(format_request, trim(%0))]); @no %q0}}}<br/>&amp;FORWARD_COMMAND #300=$+forward: @pemit %# = u(#13/forward_help)<br/>&amp;FORWARD_MAIL2 #300=$+forward *=*: @swi/first [setq(0, get(%vm/mailbox_%#))]1 = not(strmatch(type(%#), PLAYER)),{@pemit %# = u(not_player)},or(strmatch(escape(%0), *[*), strmatch(escape(%1), *[*)), {@pemit %# = u(nofunc)},eq(strlen(%q0), 0), {@pemit %# = u(nomail, ulocal(get_inbox))},{@wait %q0 = {&amp;debug_mail %q0 = +forward %0=%1; @swi/first [setq(1, u(get_folder_in_list, %q0))][setq(2, ulocal(expand_single_letter_range, trim(%1), %q1, u(get_folder_current_letter, %q0)))][setq(3, ulocal(identify_to_list, {%0}, %q0))][setq(7, get(%vm/global-mail-aliases))][setq(8, get(%q0/alias-list))][setq(4, u(get_aliases, {%0}, %q0, %q7, %q8))][setq(5,setunion(%q3 [ulocal(expand_aliases, %q4, %q0, %b, %q7, %q8)], ))][setq(6,[u(pretty_dist, %q4, %q0, %q8, %q7, %q3)])]1 = eq(strlen(%0), 0), {@pemit %# = You must specify a destination to forward this pieceof mail to.;@no %q0},strmatch(get(%q0/mail-in-progress), true),{@pemit %# = You are already in the middle of sending a message. You must complete that one before you can forward another.; @no %q0},eq(words(%q1), 0), {@pemit %# = u(nomail, u(get_active_folder, %q0));@no %q0},strmatch(%q2, *ABORT*), {@pemit %# = after(before(%q2, ENDABORT), ABORT); @no %q0},eq(words(%q2), 0), {@pemit %# = u(no_match, +forward, ulocal(format_request, trim(%1)), u(get_active_folder, %q0)); @no %q0},strmatch(%q3, *ABORT*),{@pemit %# = secure(after(before(%q3, ENDABORT), ABORT));@no %q0},{&amp;[u(which_current_letter, %q0)] %q0 = %q2;&amp;mail-in-progress %q0 = true; &amp;mail-in-progress-to %q0 = %q6; &amp;mail-in-progress-to-expanded %q0 = %q5; &amp;mail-in-progress-flags %q0 = setunion(get(%q0/mail-in-progress-flags) F, );&amp;mail-in-progress-body %q0 = [setq(9, u(get_src_dbref, %q0, %q2))]Received from:%b%b[name(get(%q9/owner_dbref))]%r[u(%q9/out-[u(get_src_num, %q0, %q2)]-text)]%r%r---- Below this line are comments added by %N ----%r; &amp;mail-in-progress-subject %q0 = [setq(9, u(%q9/out-[u(get_src_num, %q0, %q2)]-subject))]switch(mid(%q9, 0, 4), Fwd:, %q9, Fwd:%b%b%q9); @pemit %# = You may now enter text to send along with the message to forward.; @no %q0}}}<br/>&amp;MARK_COMMAND #300=$+mark*: @swi/first [setq(0, get(%vm/mailbox_%#))]1 = not(strmatch(type(%#), PLAYER)),{@pemit %# = u(not_player)},strmatch(escape(%0), *[*), {@pemit %# = u(nofunc)},eq(strlen(%q0), 0),{@pemit %# = u(nomail, ulocal(get_inbox, %#))},{@wait %q0 = {&amp;debug_mail %q0 = +mark%0; @swi/first  [setq(1, u(get_folder_in_list, %q0))][setq(2, u(get_folder_current_letter, %q0))][setq(3, u(get_active_folder, %q0))][setq(4, ulocal(expand_letter_range, %0, %q1, %q2))]0 = words(%q1), {@pemit %# = u(nomail, %q3);@no %q0},not(strmatch(%q4, *ABORT*)), {@pemit %# = after(before(%q4, ENDABORT), ABORT); @no %q0},words(%q4), {@pemit %# = u(no_match, +mark, ulocal(format_request, trim(%0)), %q3); @no %q0},{@dolist [setq(4, u(filter_list, setunion(%q4, ), %q1))]%q4 = {&amp;in-##-flags %q0 = setunion(get(%q0/in-##-flags) M, )}; @swi 1 = 1,{&amp;[u(which_current_letter, %q0)] %q0 = last(%q4); @pemit %# = Message(s) [u(convert_nums, %q4, %q1)][ulocal(format_request, trim(%0))] marked in folder '%q3'.; @no %q0}}}}<br/>&amp;UNMARK_COMMAND #300=$+unmark*: @swi/first [setq(0, get(%vm/mailbox_%#))]1 = not(strmatch(type(%#), PLAYER)),{@pemit %# = u(not_player)},strmatch(escape(%0), *[*), {@pemit %# = u(nofunc)},eq(strlen(%q0), 0), {@pemit %# = u(nomail, ulocal(get_inbox, %#))},{@wait %q0 = {&amp;debug_mail %q0 = +unmark%0; @swi/first [setq(1, u(get_folder_in_list, %q0))][setq(2, u(get_folder_current_letter, %q0))][setq(3, u(get_active_folder, %q0))][setq(4, ulocal(expand_letter_range, %0, %q1, %q2))]0 = words(%q1), {@pemit %# = u(nomail, %q3);@no %q0},not(strmatch(%q4, *ABORT*)), {@pemit %# = after(before(%q4, ENDABORT), ABORT); @no %q0},words(%q4), {@pemit %# = u(no_match, +unmark, ulocal(format_request, trim(%0)), %q3); @no %q0},{@dolist [setq(4, u(filter_list, setunion(%q4, ), %q1))]%q4 = {&amp;in-##-flags %q0 = squish(remove(get(%q0/in-##-flags), M))}; @swi 1 = 1,{&amp;[u(which_current_letter, %q0)] %q0 = last(%q4); @pemit %# = Mark(s) removed from message(s) [u(convert_nums, %q4, %q1)][ulocal(format_request, trim(%0))] in folder '%q3'.; @no %q0}}}}<br/>&amp;SAVE_COMMAND #300=$+save*: @swi/first [setq(0, get(%vm/mailbox_%#))]1 = not(strmatch(type(%#), PLAYER)),{@pemit %# = u(not_player)},strmatch(get(%vm/default_save_option), disabled), {@pemit %# = I'm sorry, but the +save command has been disabled by the game administrators.},strmatch(escape(%0), *[*), {@pemit %# = u(nofunc)},eq(strlen(%q0), 0),{@pemit %# = u(nomail, ulocal(get_inbox, %#))},{@wait %q0 = {&amp;debug_mail %q0 = +save%0; @swi/first [setq(1, u(get_folder_in_list, %q0))][setq(2, u(get_folder_current_letter, %q0))][setq(3, u(get_active_folder, %q0))][setq(4, ulocal(expand_letter_range, %0, %q1, %q2))]0 = words(%q1), {@pemit %# = u(nomail, %q3);@no %q0},not(strmatch(%q4, *ABORT*)), {@pemit %# = after(before(%q4, ENDABORT), ABORT); @no %q0},words(%q4), {@pemit %# = u(no_match, +save, ulocal(format_request, trim(%0)), %q3); @no %q0},{@dolist [setq(4, u(filter_list, setunion(%q4, ), %q1))]%q4 = {&amp;in-##-flags %q0 = setunion(get(%q0/in-##-flags) S, )}; @swi 1 = 1, {&amp;[u(which_current_letter, %q0)] %q0 = last(%q4); @pemit %# = Message(s) [u(convert_nums, %q4, %q1)][ulocal(format_request, trim(%0))] marked as 'saved' in folder '%q3'.; @no %q0}}}}<br/>&amp;UNSAVE_COMMAND #300=$+unsave*: @swi/first [setq(0, get(%vm/mailbox_%#))]1 = not(strmatch(type(%#), PLAYER)),{@pemit %# = u(not_player)},strmatch(escape(%0), *[*), {@pemit %# = u(nofunc)},eq(strlen(%q0), 0), {@pemit %# = u(nomail, ulocal(get_inbox, %#))},{@wait %q0 = {&amp;debug_mail %q0 = +unsave%0; @swi/first [setq(1, u(get_folder_in_list, %q0))][setq(2, u(get_folder_current_letter, %q0))][setq(3, ulocal(expand_letter_range, %0, %q1, %q2))][setq(4, u(get_active_folder, %q0))]0 = words(%q1), {@pemit %# = u(nomail, %q4);@no %q0},not(strmatch(%q3, *ABORT*)), {@pemit %# = after(before(%q3, ENDABORT), ABORT); @no %q0},words(%q3), {@pemit %# = u(no_match, +unsave, ulocal(format_request, trim(%0)), %q4); @no %q0},{@dolist [setq(3, u(filter_list, setunion(%q3, ), %q1))]%q3 = {&amp;in-##-flags %q0 = squish(remove(get(%q0/in-##-flags), S))}; @swi 1 = 1,{&amp;[u(which_current_letter, %q0)] %q0 = last(%q3); @pemit %# = The 'S' flag has been removed from message(s) [u(convert_nums, %q3, %q1)][ulocal(format_request, trim(%0))] in folder '%q4'.; @no %q0}}}}<br/>&amp;MAIL_COMMAND #300=$+mail *=*: @swi/first [setq(0, get(%vm/mailbox_%#))]1 = or(strmatch(escape(%0), *[*), strmatch(escape(%1), *[*)),{@pemit %# = u(nofunc)},not(strmatch(type(%#), PLAYER)),{@pemit %# = u(not_player)},eq(strlen(%q0), 0), {@swi/first  [setq(6, get(%vm/global-mail-aliases))][setq(1, ulocal(identify_to_list, {%0}, %vm))][setq(2, u(get_aliases, {%0}, #0, %q6, ))][setq(3, setunion(%q1 [ulocal(expand_aliases, %q2, #0, %b, %q6, )], ))]1 = strmatch(%q1, *ABORT*),{@pemit %# = secure(after(before(%q1, ENDABORT), ABORT))},eq(words(%q3), 0),{@pemit %# = You must specify a destination for this piece of mail.},{@create %N's Mailbox; @set [setq(4, con(me))]%q4 = quiet; @drain %q4; &amp;debug_mail %q4 = +mail %0=%1; @tel %q4 = %vm; &amp;mailbox_%# %vm = %q4; @tr %vm/add_mailbox = %q4; &amp;owner_dbref %q4 = %#; @startup %q4 = {@drain me; @no me}; @set %q4 = safe; &amp;current_folder %q4 = ulocal(get_inbox, %#); &amp;folder-list %q4 = get(%q4/current_folder); &amp;mail-in-progress %q4 = true; &amp;mail-in-progress-to %q4 = u(pretty_dist, %q2, #0, , %q6, %q1); &amp;mail-in-progress-to-expanded %q4 = %q3; &amp;mail-in-progress-subject %q4 = %1; @pemit %# = u(enter_msg); @no %q4}},{@wait %q0 = {&amp;debug_mail %q0 = +mail %0=%1; @swi/first [setq(1, ulocal(identify_to_list, {%0}, %q0))][setq(7, get(%q0/alias-list))][setq(6, get(%vm/global-mail-aliases))][setq(2, u(get_aliases, {%0}, %q0, %q6, %q7))]1 = strmatch(get(%q0/mail-in-progress), true),{@pemit %# = You are already in the middle of sending a message. %bYou must complete that one before you begin another.; @no %q0},eq(strlen(%0), 0),{@pemit %# = You must specify a destination for this piece of mail.; @no %q0},strmatch(%q1, *ABORT*),{@pemit %# = secure(after(before(%q1, ENDABORT), ABORT)); @no %q0},{&amp;mail-in-progress %q0 = true; &amp;mail-in-progress-to %q0 = u(pretty_dist, %q2, %q0, %q7, %q6, %q1); &amp;mail-in-progress-to-expanded %q0 = %q1 [ulocal(expand_aliases, %q2, %q0, %b, %q6, %q7)]; &amp;mail-in-progress-subject %q0 = %1; @swi/first hasattr(%q0, mail-in-progress-to-expanded) = 0,{@pemit %# = You must specify a destination for this piece of mail.; &amp;mail-in-progress %q0 = false; &amp;mail-in-progress-to %q0 = ; &amp;mail-in-progress-to-expanded %q0 = ; &amp;mail-in-progress-subject %q0 = ; @no %q0},{@pemit %# = u(enter_msg); @no %q0}}}}<br/>&amp;MAIL_NO_PARAM #300 = $+mail: @pemit %# = You must specify the name(s) of the individual(s) that you wish to send mail to, and an optional 'subject' line.%b (format: +mail &lt;name1 name2 .. nameN&gt;=&lt;Subject line&gt;)<br/>&amp;NOTE_COMMAND #300 = $+note*: @swi/first [setq(0, get(%vm/mailbox_%#))]0 = strlen(%0), {@pemit %# = No text specified for note.%b Syntax:%b +note &lt;text&gt;},strlen(%q0), {@create %N's Mailbox;@set [setq(0, con(me))]%q0 = quiet;@drain %q0;&amp;debug_mail %q0 = +note%0; @no %q0;@tel %q0 = %vm;&amp;mailbox_%# %vm = %q0;@tr %vm/add_mailbox = %q0; &amp;owner_dbref %q0 = %#;@startup %q0 = {@drain me; @no me};@set %q0 = safe;&amp;mail-in-progress %q0 = false;&amp;current_folder %q0 = ulocal(get_inbox, %#);&amp;folder-list %q0 = get(%q0/current_folder); @tr me/store_letter = %q0, Personal Note, %N, %#, , , , , , u(clean_text, %0); @pemit %# = A personal note has been stored in your mailbox.},{@tr me/store_letter = %q0, Personal Note, %N, %#, , , , , , u(clean_text, %0); @pemit %# = A personal note has been stored in your mailbox.}<br/>&amp;DASH_COMMAND #300=$-*: @swi/first [setq(0, get(%vm/mailbox_%#))]1 = strmatch(%0, -),,not(strmatch(type(%#), PLAYER)),{@pemit %# = u(not_player)},eq(strlen(%q0), 0),{@pemit %# = u(not_writing_mail)},{@wait %q0 = {&amp;debug_mail %q0 = -%0; @swi/first [setq(4, get(%q0/mail-in-progress-body))]1 = strmatch(get(%q0/mail-in-progress), false),{@pemit %# = u(not_writing_mail); @no %q0},eq(words(escape(%0)), 0),{@pemit %# = Options:%r%r%b%b[ljust(-, 40)] ( show this help display )%r%b%b[ljust(-&lt;text&gt;, 40)] ( add text to the message )%r%b%b[ljust(+proof, 40)] ( proofread the message )%r%b%b[ljust(+send, 40)] ( send the message )%r%b%b[ljust(--, 40)] ( same as +send )%r%b%b[ljust(+toss, 40)] ( discard the message )%r%b%b[ljust(+include \[&lt;letter number or keyword&gt;\], 40)] ( include letter into text )%r%b%b[ljust(+cc &lt;list of people or aliases&gt;, 40)] ( set carbon copy list )%r%b%b[ljust(+bcc &lt;list of people or aliases&gt;, 40)] ( set blind carbon copy list )%r%r%b%b[ljust(+edit &lt;mail part&gt;=&lt;old&gt;/&lt;new&gt;, 40)] ( edit your message )%r%b%b%b%b(where mail part = to, cc, bcc, subject or text)%r%r%b%b[ljust(+set mail flag \[!\]&lt;flag&gt;, 40)] ( set or clear mail flag )%r%b%b%b%b(where flag = urgent, private, registered, or reply requested); @no %q0},{&amp;mail-in-progress-body %q0 = u(clean_text, switch(words(%q4), 0, %0, %q4[u(get_separator_option, %#)]%0)); @pemit %# = [setq(1, u(size_of_mail_in_progress, %q0))][u(text_added_notification)][switch(gt(%q1, 4000), 1, %b%bWarning, message is [sub(4000, %q1)] characters too long and will be truncated.,)]; @no %q0}}}<br/>&amp;CLEAN_TEXT #4167=edit(escape(edit(edit(%0, \\,), v(newline), v(percent_r))), [v(backslash)][v(percent_r)],[v(percent_r)])<br/>&amp;BACKSLASH #4167=\<br/>&amp;SIZE_OF_MAIL_IN_PROGRESS #4167 =add(196, mul(strlen(u(equal_line)), 2), strlen(u(dash_line)), strlen(u(%0/mail-in-progress-subject)), strlen(u(%0/mail-in-progress-to)), switch(strlen(get(%0/mail-in-progress-cc)), 0, 0, {[add(11, strlen(u(%0/mail-in-progress-cc)))]}), switch(strlen(get(%0/mail-in-progress-bcc)), 0, 0, {[add(11, strlen(u(%0/mail-in-progress-bcc)))]}), strlen(u(%0/mail-in-progress-body)), [setq(2, get(%0/mail-in-progress-flags))]switch(words(%q2), 0, 0, {[add(11, switch(match(%q2, RR), 0, 0, strlen(v(mail_flag_rr))), switch(match(%q2, P), 0, 0, strlen(v(mail_flag_p))), switch(match(%q2, U), 0, 0, strlen(v(mail_flag_u))), switch(match(%q2, R), 0, 0, strlen(v(mail_flag_r))), mul(sub(words(%q2), 1), 2))]}))<br/>&amp;DOUBLE_DASH_COMMAND #300=$--: @swi/first [setq(0, get(%vm/mailbox_%#))]0 = strmatch(type(%#), PLAYER),{@pemit %# = u(not_player)},strlen(%q0),{@pemit %# = u(not_writing_mail)},{@wait %q0 = {&amp;debug_mail %q0 = --; @swi/first [setq(1, u(get_final_delivery_list, %q0))]1 = strmatch(get(%q0/mail-in-progress), false), {@pemit %# = You do not have a mail message ready to send.; @no %q0},eq(words(%q1), 0), {  @pemit %# = You do not have a destination specified.; @no %q0},{@tr me/store_letter = %q0, get(%q0/mail-in-progress-subject), get(%q0/mail-in-progress-to), get(%q0/mail-in-progress-to-expanded), get(%q0/mail-in-progress-cc), get(%q0/mail-in-progress-cc-expanded), get(%q0/mail-in-progress-bcc), get(%q0/mail-in-progress-bcc-expanded), get(%q0/mail-in-progress-flags), get(%q0/mail-in-progress-body); @tr me/cleanup_send = %#, %q0}}}<br/>&amp;STORE_LETTER #4167 = &amp;[setq(0, u(free_num, get(%0/out-list)))]out-%q0-time_sent %0 = time(); &amp;[setq(3, get(%0/owner_dbref))]out-%q0-subject %0 = %1; &amp;out-list %0 = [get(%0/out-list)] %q0; &amp;out-list-current %0 = switch(words(get(%0/out-list)), 1, %q0, get(%0/out-list-current)); &amp;out-%q0-to %0 = %2; &amp;out-%q0-cc %0 = %4; &amp;out-%q0-bcc %0 = %6; &amp;out-%q0-bcc-expanded %0 = %7; &amp;out-%q0-text %0 = %9[switch([setq(4, get(%q3/MAIL_SIG))]strlen(%q4), 0,, %r%q4)]; &amp;out-%q0-replyall_to %0 = setunion(%q3 %3 %5, ); &amp;out-%q0-held %0 = [setq(8, setunion(iter(setunion(%3 %5 %7, ), ulocal(autoforward_test, ##)), ))]%q8; &amp;out-%q0-dist %0 = iter(%q8, ##:); @dolist %q8 = {@swi/first [setq(1, get(%vm/mailbox_##))][setq(9, u(folder_to_store_into, %q1, get(%0/owner_dbref), %1, ##))]1 = and(strmatch(type(##), PLAYER), eq(strlen(%q1), 0)),{@create [name(##)]'s Mailbox; @set [setq(2, con(me))]%q2 = quiet; @drain %q2; &amp;debug_mail %q2 = store_letter; @tel %q2 = %vm; &amp;mailbox_## %vm = %q2; @tr %vm/add_mailbox = %q2; &amp;owner_dbref %q2 = ##; @startup %q2 = {@drain me; @no me}; @set %q2 = safe; &amp;mail-in-progress %q2 = false; &amp;current_folder %q2 = %q9; &amp;folder-list %q2 = %q9; &amp;in-list-%q9 %q2 = 0; &amp;current_letter-%q9 %q2 = 0; &amp;in-0-time_read %q2 = 0; &amp;in-0-flags %q2 = %8; &amp;in-0-note %q2 = ; &amp;in-0-location %q2 = %0 %q0; @edit %0/out-%q0-dist = ##:,##:0; @pemit ## = switch(%1, Personal Note,, {u(delivery_notification, %q3, sign(match(%8, u)),sign(match(%8, p)),sign(match(%8, rr)),sign(match(%8, r)), secure(%q9))}); @no %q2}, strmatch(type(##), PLAYER), {&amp;folder-list %q1 = setunion(%q9 [get(%q1/folder-list)], ); &amp;in-list-%q9 %q1 = [setq(6, u(free_num, u(get_all_in_lists, %q1)))][setq(7, get(%q1/in-list-%q9))]squish(%q7 %q6); &amp;current_letter-%q9 %q1 = switch(words(%q7), 0, %q6, get(%q1/current_letter-%q9)); &amp;in-%q6-time_read %q1 = 0; &amp;in-%q6-flags %q1 = %8; &amp;in-%q6-note %q1 = ; &amp;in-%q6-location %q1 = %0 %q0; @edit %0/out-%q0-dist = ##:,##:%q6; @pemit ## = switch(1, strmatch(%1, Personal Note),, hasattr(%q1, reject_msg),, {u(delivery_notification, %q3, sign(match(%8, u)),sign(match(%8, p)),sign(match(%8, rr)),sign(match(%8, r)), secure(%q9))}); @swi/first 1 = strmatch(%1, On Vacation),,strmatch(%1, Letter Rejected),,and(strmatch(%q9, null), hasattr(%q1, filter_reject)),{@tr me/remove_letter =%0, %q0, get(%q1/owner_dbref), %q1, %q6, %q9, discard;@tr me/store_letter =%q1,Letter Rejected,name(get(%0/owner_dbref)),get(%0/owner_dbref),,,,,,{Message with subject line "%1" has been rejected by [name(get(%0/owner_dbref))]'s mailbox.%r%r----- Reject Message -----%r%r[get(%q1/filter_reject)]}; @pemit ## = Discarded due to personal mail filter.},strmatch(%q9, null),{@tr me/remove_letter = %0, %q0, get(%q1/owner_dbref), %q1, %q6, %q9,discard; @pemit ## = Discarded due to personal mail filter. },hasattr(%q1, reject_msg), {@tr me/remove_letter = %0, %q0, get(%q1/owner_dbref), %q1, %q6, %q9,reject; @tr me/store_letter = %q1, Letter Rejected, name(get(%0/owner_dbref)), get(%0/owner_dbref), ,  , ,  , , {Message with subject line "%1" has been rejected by [name(get(%0/owner_dbref))]'s mailbox.%r%r----- Reject Message -----%r%r[get(%q1/reject_msg)]}},hasattr(%q1, vacation), {@tr me/store_letter = %q1, On Vacation, name(get(%0/owner_dbref)), get(%0/owner_dbref), ,  , ,  , , {Message with subject line "%1" has been stored in [name(get(%0/owner_dbref))]'s mailbox.%r%r----- Vacation Message -----%r%r[get(%q1/vacation)]}}}, {@pemit get(%0/owner_dbref) = Unable to deliver message.} }<br/>&amp;REMOVE_LETTER #4167 = &amp;[setq(4, trim(%4))][setq(1, trim(%1))]in-list-%5 %3 = squish(remove(get(%3/in-list-%5), %q4)); @wipe %3/in-%q4-*; &amp;out-%q1-held %0 = squish(remove(get(%0/out-%q1-held), %2)); @swi get(%0/out-%q1-held) = ,{@wipe %0/out-%q1-*; &amp;out-list %0 = squish(remove(get(%0/out-list), %q1)); &amp;out-list-current %0 = switch(member(get(%0/out-list), get(%0/out-list-current)), 0, last(get(%0/out-list)), get(%0/out-list-current)); @swi 1 = u(ok_to_dest_mailbox, %0),{@tr %vm/destroy_mailbox = get(%0/owner_dbref), num(me), %0, remove_letter_a} }; @swi 1 = u(ok_to_dest_mailbox, %3),{@tr %vm/destroy_mailbox = get(%3/owner_dbref), num(me), %3, remove_letter_b}<br/>&amp;PROOF_COMMAND #300=$+proof: @swi/first [setq(0, get(%vm/mailbox_%#))]0 = strmatch(type(%#), PLAYER),{@pemit %# = u(not_player)},strlen(%q0),{@pemit %# = You are not currently writing a mail message.},{@wait %q0 = {&amp;debug_mail %q0 = +proof; @pemit %# = switch(get(%q0/mail-in-progress),false, You are not currently writing a mail message.,{[setq(1, get(%q0/mail-in-progress-cc))][setq(2, get(%q0/mail-in-progress-bcc))][setq(3, get(%q0/mail-in-progress-flags))][setq(4, u(get_format_option, get(%#/mail_config_options)))][switch(%q4, standard, {[u(equal_line)]%r})]To:[space(7)][trim(get(%q0/mail-in-progress-to))][switch(words(%q1), 0,, %rCc:[space(7)][trim(%q1)])][switch(words(%q2), 0,, %rBcc:[space(6)][trim(%q2)])]%rSubject:%b%b[trim(get(%q0/mail-in-progress-subject))][switch(words(%q3), 0,, %rFlags:%b%b%b%b)][switch(match(%q3, u), 0,, [v(mail_flag_u)]%b%b)][switch(match(%q3, rr), 0,, [v(mail_flag_rr)]%b%b)][switch(match(%q3, r), 0,, [v(mail_flag_r)]%b%b)][switch(match(%q3, p), 0,, [v(mail_flag_p)]%b%b)][switch(%q4, standard, {%r[u(dash_line)]%r%r},%rText:[space(5)])][get_eval(%q0/mail-in-progress-body)][switch(%q4, standard, {%r%r[u(equal_line)]})]%r[u(finish_msg)]}); @swi and(v(spell_checker_available), hasflag(v(spell_checker), connect), strmatch(get(%q0/mail-in-progress), true)) = 1,{@pemit v(spell_checker) = StartSpelling %# 0 0 subject 0; @pemit v(spell_checker) = get(%q0/mail-in-progress-subject); @pemit v(spell_checker) = StopSpelling; @pemit v(spell_checker) = StartSpelling %# 0 0 text 0; @pemit v(spell_checker) = get(%q0/mail-in-progress-body); @pemit v(spell_checker) = StopSpelling}; @no %q0}}<br/>&amp;TOSS_COMMAND #300=$+toss: @swi/first [setq(0, get(%vm/mailbox_%#))]0 = strmatch(type(%#), PLAYER),{@pemit %# = u(not_player)},strlen(%q0),{@pemit %# = u(not_writing_mail)},{@wait %q0 = {&amp;debug_mail %q0 = +toss; @swi/first get(%q0/mail-in-progress) = false,{@pemit %# = u(not_writing_mail); @no %q0},{@pemit %# = The mail message has been discarded.; &amp;mail-in-progress %q0 = false; &amp;mail-in-progress-subject %q0; &amp;mail-in-progress-to %q0; &amp;mail-in-progress-to-expanded %q0; &amp;mail-in-progress-cc %q0; &amp;mail-in-progress-cc-expanded %q0; &amp;mail-in-progress-bcc %q0; &amp;mail-in-progress-bcc-expanded %q0; &amp;mail-in-progress-flags %q0; &amp;mail-in-progress-body %q0; @swi/first 1 = u(ok_to_dest_mailbox, %q0),{@tr %vm/destroy_mailbox = %#, num(me), %q0, +toss; @no %q0},{@no %q0}}}}<br/>&amp;CC_COMMAND #300=$+cc*: @swi/first [setq(0, get(%vm/mailbox_%#))]0 = strmatch(type(%#), PLAYER),{@pemit %# = u(not_player)},not(strmatch(escape(%0), *[*)), {@pemit %# = u(nofunc)},strlen(%q0), {@pemit %# = u(not_writing_mail)},{@wait %q0 = {&amp;debug_mail %q0 = +cc%0; @swi/first [setq(1, ulocal(identify_to_list, {%0}, %q0))][setq(2, get(%vm/global-mail-aliases))][setq(3, get(%q0/alias-list))][setq(4, u(get_aliases, {%0}, %q0, %q2, %q3))]1 = strmatch(get(%q0/mail-in-progress), false),{@pemit %# = u(not_writing_mail); @no %q0},strmatch(%q1, *ABORT*),{@pemit %# = secure(after(before(%q1, ENDABORT), ABORT)); @no %q0},{&amp;mail-in-progress-cc %q0 = u(pretty_dist, %q4, %q0, %q3, %q2, %q1); &amp;mail-in-progress-cc-expanded %q0 = setunion(%q1 [ulocal(expand_aliases, %q4, %q0, %b, %q2, %q3)], ); @pemit %# = switch(hasattr(%q0, mail-in-progress-cc-expanded), 0, No carbon copy (cc) set., The carbon copy (cc) line now reads:%b%b[get(%q0/mail-in-progress-cc)]); @no %q0}}}<br/>&amp;CC_NO_PARAM #300=$+cc: @pemit %# = You must specify the name of the individual(s) that you wish to be carbon copied on this piece of mail.<br/>&amp;EDIT_MAIL_CC #300=$+edit cc*=*/*: @swi/first [setq(0, get(%vm/mailbox_%#))]0 = strmatch(type(%#), PLAYER),{@pemit %# = u(not_player)},not(strmatch(escape(%2), *[*)),{@pemit %# = u(nofunc)},strlen(%q0), {@pemit %# = u(not_writing_mail)},{@wait %q0 = {&amp;debug_mail %q0 = +edit cc%0=%1/%2; @swi/first [setq(1, lcstr(trim(%1)))][setq(2, trim(%2))][setq(3, lcstr(get(%q0/mail-in-progress-cc)))]1 = strmatch(get(%q0/mail-in-progress), false), {@pemit %# = u(not_writing_mail); @no %q0},not(hasattr(%q0, mail-in-progress-cc)),{@swi/first or(strmatch(%q1, $), strmatch(%q1, ^), eq(strlen(%q1), 0)) = 1, {@tr me/cleanup_edit_mail_cc = %#, u(clean_dist, %q2), %q0},{@pemit %# = Unable to find '%q1' in current value for CC.; @no %q0}},strmatch(%q1, $), {@tr me/cleanup_edit_mail_cc = %#, u(clean_dist, {%q3, %q2}), %q0},strmatch(%q1, ^), {@tr me/cleanup_edit_mail_cc = %#, u(clean_dist, {%q2, %q3}), %q0},strmatch(%q3, *%q1*),{@tr me/cleanup_edit_mail_cc = %#, u(clean_dist, edit(%q3, %q1, %q2)), %q0},{@pemit %# = Unable to find '%q1' in current value for CC.%b Please check the exact format of the current value for CC by doing a +proof.; @no %q0}}}<br/>&amp;CLEAN_DIST #4167 = squish(remove(edit(edit(%0, \(personal mail alias\), ), \(global mail alias\), ), and))<br/>&amp;CLEANUP_EDIT_MAIL_CC #4167=@swi/first [setq(1, ulocal(identify_to_list, {%1}, %2))][setq(2, get(%vm/global-mail-aliases))][setq(3, get(%2/alias-list))][setq(4, u(get_aliases, {%1}, %2, %q2, %q3))]%q1 = *ABORT*, {@pemit %0 = secure(after(before(%q1, ENDABORT), ABORT)); @no %2},{&amp;mail-in-progress-cc %2 = u(pretty_dist, %q4, %2, %q3, %q2, %q1); &amp;mail-in-progress-cc-expanded %2 = setunion(%q1 [ulocal(expand_aliases, %q4, %2, %b, %q2, %q3)], ); @swi/first words(get(%2/mail-in-progress-cc-expanded)) = 0,{@pemit %0 = No carbon copy set.; @no %2},{@pemit %0 = The carbon copy (cc) line now reads:%b%b[get(%2/mail-in-progress-cc)]; @no %2}}<br/>&amp;edit_cc_blank #300 = $+edit cc: @pemit %# = The syntax is +edit cc=&lt;old text&gt;/&lt;new text&gt;.<br/>&amp;BCC_COMMAND #300=$+bcc*: @swi/first [setq(0, get(%vm/mailbox_%#))]0 = strmatch(type(%#), PLAYER),{@pemit %# = u(not_player)},not(strmatch(escape(%0), *[*)), {@pemit %# = u(nofunc)},strlen(%q0), {@pemit %# = u(not_writing_mail)},{@wait %q0 = {&amp;debug_mail %q0 = +bcc%0; @swi/first [setq(1, ulocal(identify_to_list, {%0}, %q0))][setq(2, get(%vm/global-mail-aliases))][setq(3, get(%q0/alias-list))][setq(4, u(get_aliases, {%0}, %q0, %q2, %q3))]1 = strmatch(get(%q0/mail-in-progress), false),{@pemit %# = u(not_writing_mail); @no %q0},strmatch(%q1, *ABORT*),{@pemit %# = secure(after(before(%q1, ENDABORT), ABORT)); @no %q0},{&amp;mail-in-progress-bcc %q0 = u(pretty_dist, %q4, %q0, %q3, %q2, %q1); &amp;mail-in-progress-bcc-expanded %q0 = setunion(%q1 [ulocal(expand_aliases, %q4, %q0, %b, %q2, %q3)], ); @pemit %# = switch(hasattr(%q0, mail-in-progress-bcc-expanded), 0,No blind carbon copy (bcc) set.,The blind carbon copy (bcc) line now reads:%b%b[get(%q0/mail-in-progress-bcc)]); @no %q0}}}<br/>&amp;BCC_NO_PARAM #300=$+bcc: @pemit %# = You must specify the name of the individual(s) that you wish to be blind carbon copied on this piece of mail.<br/>&amp;EDIT_MAIL_BCC #300=$+edit bcc*=*/*: @swi/first [setq(0, get(%vm/mailbox_%#))]0 = strmatch(type(%#), PLAYER),{@pemit %# = u(not_player)},not(strmatch(escape(%2), *[*)),{@pemit %# = u(nofunc)},strlen(%q0), {@pemit %# = u(not_writing_mail)},{@wait %q0 = {&amp;debug_mail %q0 = +edit bcc%0=%1/%2; @swi/first [setq(1, lcstr(trim(%1)))][setq(2, trim(%2))][setq(3, lcstr(get(%q0/mail-in-progress-bcc)))]1 =  strmatch(get(%q0/mail-in-progress), false), {@pemit %# = u(not_writing_mail); @no %q0},not(hasattr(%q0, mail-in-progress-bcc)),{@swi/first or(strmatch(%q1, $), strmatch(%q1, ^), eq(strlen(%q1), 0)) = 1, {@tr me/cleanup_edit_mail_bcc = %#, u(clean_dist, %q2), %q0},{@pemit %# = Unable to find '%q1' in current value for BCC.; @no %q0}},strmatch(%q1, $),{@tr me/cleanup_edit_mail_bcc = %#, u(clean_dist, {%q3, %q2}), %q0},strmatch(%q1, ^),{@tr me/cleanup_edit_mail_bcc = %#, u(clean_dist, {%q2, %q3}), %q0},strmatch(%q3, *%q1*),{@tr me/cleanup_edit_mail_bcc = %#, u(clean_dist, edit(%q3, %q1, %q2)), %q0},{@pemit %# = Unable to find '%q1' in current value for BCC.%b Please check the exact format of the current value for CC bydoing a +proof.; @no %q0}}}<br/>&amp;CLEANUP_EDIT_MAIL_BCC #4167=@swi/first [setq(1, ulocal(identify_to_list, {%1}, %2))][setq(2, get(%vm/global-mail-aliases))][setq(3, get(%2/alias-list))][setq(4, u(get_aliases, {%1}, %2, %q2, %q3))]%q1 = *ABORT*,{@pemit %0 = secure(after(before(%q1, ENDABORT), ABORT)); @no %2},{&amp;mail-in-progress-bcc %2 = u(pretty_dist, %q4, %2, %q3, %q2, %q1); &amp;mail-in-progress-bcc-expanded %2 = %q1 [ulocal(expand_aliases, %q4, %2, %b, %q2, %q3)]; @swi/first words(get(%2/mail-in-progress-bcc-expanded)) = 0,{@pemit %0 = No blind carbon copy set.; @no %2},{@pemit %0 = The blind carbon copy (bcc) line now reads:%b%b[get(%2/mail-in-progress-bcc)]; @no %2}}<br/>&amp;EDIT_BCC_BLANK #300 =$+edit bcc: @pemit %# = The syntax is +edit bcc=&lt;old text&gt;/&lt;new text&gt;.<br/>&amp;EDIT_MAIL_TO #300=$+edit to*=*/*: @swi/first [setq(0, get(%vm/mailbox_%#))]0 = strmatch(type(%#), PLAYER),{@pemit %# = u(not_player)},not(strmatch(escape(%2), *[*)),{@pemit %# = u(nofunc)},strlen(%q0), {@pemit %# = u(not_writing_mail)},{@wait %q0 = {&amp;debug_mail %q0 = +edit to%0=%1/%2; @swi/first [setq(1, lcstr(trim(%1)))][setq(2, trim(%2))][setq(3, lcstr(get(%q0/mail-in-progress-to)))]1 = strmatch(get(%q0/mail-in-progress), false),{@pemit %# = u(not_writing_mail); @no %q0},not(hasattr(%q0, mail-in-progress-to)),{@swi/first or(strmatch(%q1, $), strmatch(%q1, ^), eq(strlen(%q1), 0)) = 1, {@tr me/cleanup_edit_mail_to = %#, u(clean_dist, %q2), %q0},{@pemit %# = Unable to find '%q1' in current value for TO.; @no %q0}},strmatch(%q1, $),{@tr me/cleanup_edit_mail_to = %#, u(clean_dist, {%q3, %q2}), %q0},strmatch(%q1, ^),{@tr me/cleanup_edit_mail_to = %#, u(clean_dist, {%q2, %q3}), %q0},strmatch(%q3, *%q1*),{@tr me/cleanup_edit_mail_to = %#, u(clean_dist, edit(%q3,%q1, %q2)), %q0},{@pemit %# = Unable to find '%q1' in current value for TO.%b Please check the exact format of the current value for TO bydoing a +proof.; @no %q0}}}<br/>&amp;CLEANUP_EDIT_MAIL_TO #4167=@swi/first [setq(1, ulocal(identify_to_list, {%1}, %2))][setq(2, get(%vm/global-mail-aliases))][setq(3, get(%2/alias-list))][setq(4, u(get_aliases, {%1}, %2, %q2, %q3))]%q1 = *ABORT*, {@pemit %0 = secure(after(before(%q1, ENDABORT), ABORT)); @no %2},{&amp;mail-in-progress-to %2 = u(pretty_dist, %q4, %2, %q3, %q2, %q1); &amp;mail-in-progress-to-expanded %2 = %q1 [ulocal(expand_aliases, %q4, %2, %b, %q2, %q3)]; @swi/first words(get(%2/mail-in-progress-to-expanded)) = 0,{@pemit %0 = No destination set.; @no %2},{@pemit %0 = The 'TO' line now reads:%b%b[get(%2/mail-in-progress-to)]; @no %2}}<br/>&amp;EDIT_TO_BLANK #300 = $+edit to: @pemit %# = The syntax is +edit to=&lt;old text&gt;/&lt;new text&gt;.<br/>&amp;EDIT_MAIL_SUBJECT #300=$+edit sub*=*/*: @swi/first [setq(0, get(%vm/mailbox_%#))]0 = strmatch(type(%#), PLAYER),{@pemit %# = u(not_player)},not(strmatch(escape(%2), *[*)),{@pemit %# = u(nofunc)},strlen(%q0), {@pemit %# = u(not_writing_mail)},{@wait %q0 = {&amp;debug_mail %q0 = +edit sub%0=%1/%2; @swi/first [setq(1, squish(u(clean_text, %1)))][setq(2, squish(u(clean_text, %2)))]1 = strmatch(get(%q0/mail-in-progress), false),{@pemit %# = u(not_writing_mail); @no %q0},not(hasattr(%q0, mail-in-progress-subject)),{@swi/first or(strmatch(%q1, $), strmatch(%q1, ^), eq(words(%q1), 0)) = 1, {&amp;mail-in-progress-subject %q0 = %q2; @pemit %# = The subject line now reads:%b%b[get_eval(%q0/mail-in-progress-subject)]; @no %q0},{@pemit %# = Unable to find '%q1' in current value for SUBJECT.; @no %q0}},strmatch(%q1, $),{@edit %q0/mail-in-progress-subject = %q1, {%q2}; @pemit %# = The subject line now reads:%b%b[get_eval(%q0/mail-in-progress-subject)]; @no %q0},strmatch(%q1, ^),{@edit %q0/mail-in-progress-subject = %q1, {%q2}; @pemit %# = The subject line now reads:%b%b[get_eval(%q0/mail-in-progress-subject)]; @no %q0},strmatch(get(%q0/mail-in-progress-subject), *%q1*), {@edit %q0/mail-in-progress-subject = {%q1}, {%q2}; @pemit %# = The subject line now reads:%b%b[get_eval(%q0/mail-in-progress-subject)]; @no %q0},{@pemit %# = Unable to find '%q1' in current value for SUBJECT.; @no %q0}}}<br/>&amp;EDIT_SUBJECT_BLANK #300=$+edit subject: @pemit %# = The syntax is +edit subject=&lt;old text&gt;/&lt;new text&gt;.<br/>&amp;EDIT_MAIL_TEXT #300=$+edit text*=*/*: @swi/first [setq(0, get(%vm/mailbox_%#))]0 = strmatch(type(%#), PLAYER),{@pemit %# = u(not_player)},strlen(%q0),{@pemit %# = u(not_writing_mail)},{@wait %q0 = {&amp;debug_mail %q0 = +edit text%0=%1/%2; @swi/first [setq(1, squish(u(clean_text, %1)))][setq(2, squish(u(clean_text, %2)))]1 = strmatch(get(%q0/mail-in-progress), false),{@pemit %# = u(not_writing_mail); @no %q0}, not(hasattr(%q0, mail-in-progress-body)), {@swi/first or(strmatch(%q1, $), strmatch(%q1, ^), eq(words(%q1), 0)) = 1, {&amp;mail-in-progress-body %q0 = %q2; @tr me/cleanup_edit_mail_text = %#, %q0},{@pemit %# = Unable to find '%q1' in current value for TEXT.; @no %q0}}, strmatch(%q1, $),{@edit %q0/mail-in-progress-body = %q1, {%q2}; @tr me/cleanup_edit_mail_text = %#, %q0},strmatch(%q1, ^),{@edit %q0/mail-in-progress-body = %q1, {%q2}; @tr me/cleanup_edit_mail_text = %#, %q0},strmatch(get(%q0/mail-in-progress-body), *%q1*),{@edit %q0/mail-in-progress-body = {%q1}, {%q2}; @tr me/cleanup_edit_mail_text = %#, %q0},{@pemit %# = Unable to find '%q1' in current value for TEXT.; @no %q0}}}<br/>&amp;CLEANUP_EDIT_MAIL_TEXT #4167=&amp;mail-in-progress-body %1 = u(clean_text, get(%1/mail-in-progress-body)); @pemit %0 = [setq(0, u(get_format_option, get(%0/mail_config_options)))][setq(1, get(%1/mail-in-progress-cc))][setq(2, get(%1/mail-in-progress-bcc))][setq(3, get(%1/mail-in-progress-flags))][switch(%q0, standard, {[u(equal_line)]%r})]To:[space(7)][trim(get(%1/mail-in-progress-to))][switch(words(%q1), 0,, %rCc:[space(7)][trim(%q1)])][switch(words(%q2), 0,, %rBcc:[space(6)][trim(%q2)])]%rSubject:%b%b[get(%1/mail-in-progress-subject)][switch(words(%q3), 0,, %rFlags:%b%b%b%b)][switch(match(%q3, u), 0,, [v(mail_flag_u)]%b%b)][switch(match(%q3, rr), 0,, [v(mail_flag_rr)]%b%b)][switch(match(%q3, r), 0,, [v(mail_flag_r)]%b%b)][switch(match(%q3, o), 0,, [v(mail_flag_p)]%b%b)][switch(%q0, standard, {%r[u(dash_line)]%r%r},%rText:%b%b)][get_eval(%1/mail-in-progress-body)][switch(%q0, standard, {%r%r[u(equal_line)]})]%r[u(finish_msg)]; @no %1<br/>&amp;EDIT_TEXT_BLANK #300=$+edit text: @pemit %# = The syntax is +edit text=&lt;old text&gt;/&lt;new text&gt;.<br/>&amp;EDIT_BLANK #300=$+edit: @pemit %# = You must specify what you wish to edit. The syntax of the command is +edit &lt;mail part&gt;=&lt;old text&gt;/&lt;new text&gt;, where mail part may be one of the following:%b%bto, cc, bcc, subject or text.<br/>&amp;SET_MAIL_FLAG #300=$+set mail flag *: @swi/first [setq(0, get(%vm/mailbox_%#))]0 = strmatch(type(%#), PLAYER),{@pemit %# = u(not_player)},strlen(%q0),{@pemit %# = u(not_writing_mail)},{@wait %q0 = {&amp;debug_mail %q0 = +set mail flag %0; @swi/first 1 = strmatch(get(%q0/mail-in-progress), false),{@pemit %# = u(not_writing_mail); @no %q0},strmatch(%0, r), {@tr me/set_flag_guts = %#, R, v(mail_flag_r) (R), %q0},strmatch(%0, rr), {@tr me/set_flag_guts = %#, RR, v(mail_flag_rr) (RR), %q0},strmatch(%0, u*), {@tr me/set_flag_guts = %#, U, v(mail_flag_u) (U), %q0},strmatch(%0, p*), {@tr me/set_flag_guts = %#, P, v(mail_flag_p) (P), %q0},strmatch(%0, rep*), {@tr me/set_flag_guts = %#, RR, v(mail_flag_rr) (RR), %q0},strmatch(%0, reg*), {@tr me/set_flag_guts = %#, R, v(mail_flag_r) (R), %q0}, strmatch(%0, !r), {@tr me/clear_flag_guts = %#, R, v(mail_flag_r) (R), %q0},strmatch(%0, !rr), {@tr me/clear_flag_guts = %#, RR, v(mail_flag_rr) (RR), %q0},strmatch(%0, !u*), {@tr me/clear_flag_guts = %#, U, v(mail_flag_u) (U), %q0},strmatch(%0, !p*), {@tr me/clear_flag_guts = %#, P, v(mail_flag_p) (P), %q0},strmatch(%0, !rep*), {@tr me/clear_flag_guts = %#, RR, v(mail_flag_rr) (RR), %q0},strmatch(%0, !reg*), {@tr me/clear_flag_guts = %#, R, v(mail_flag_r) (R), %q0},{@pemit %# = That is not a valid mail flag. Available flags are: [v(mail_flag_u)] (U), [v(mail_flag_rr)] (RR), [v(mail_flag_p)] (P), [v(mail_flag_r)] (R);  @no %q0}}}<br/>&amp;CLEAR_FLAG_GUTS #4167=@pemit %0 = [setq(0, get(%3/mail-in-progress-flags))]switch(match(%q0, %1), 0, The %2 flag is not currently set for this mail message.,The %2 flag has been cleared.); &amp;mail-in-progress-flags %3 = squish(remove(%q0, %1)); @no %3<br/>&amp;SET_FLAG_GUTS #4167=@pemit %0 = [setq(0, get(%3/mail-in-progress-flags))]switch(match(%q0, %1), 0, The %2 flag has been set., The %2 flag is already set for this mail message.); &amp;mail-in-progress-flags %3 = setunion(get(%3/mail-in-progress-flags) %1, ); @no %3<br/>&amp;SET_MAIL_FLAG_BLANK #300=$+set mail flag: @pemit %# = You must specify which flag you wish to set. Current options are: Private (P), Urgent (U), Registered (R) and Reply Requested (RR).<br/>&amp;SEND_COMMAND #300=$+send: @swi/first [setq(0, get(%vm/mailbox_%#))]0 = strmatch(type(%#), PLAYER), {@pemit %# = u(not_player)}, strlen(%q0), {@pemit %# = u(not_writing_mail)}, {@wait %q0 = {&amp;debug_mail %q0 = +send; @swi/first [setq(1, u(get_final_delivery_list, %q0))]1 = strmatch(get(%q0/mail-in-progress), false), {@pemit %# = You do not have a mail message ready to send.; @no %q0}, eq(words(%q1), 0), {  @pemit %# = You do not have a destination specified.; @no %q0}, {@tr me/store_letter = %q0, get(%q0/mail-in-progress-subject), get(%q0/mail-in-progress-to), get(%q0/mail-in-progress-to-expanded), get(%q0/mail-in-progress-cc), get(%q0/mail-in-progress-cc-expanded), get(%q0/mail-in-progress-bcc), get(%q0/mail-in-progress-bcc-expanded), get(%q0/mail-in-progress-flags), get(%q0/mail-in-progress-body); @tr me/cleanup_send = %#, %q0}}}<br/>&amp;GET_FINAL_DELIVERY_LIST #4167=trim(setunion([get(%0/mail-in-progress-to-expanded)] [get(%0/mail-in-progress-cc-expanded)] [get(%0/mail-in-progress-bcc-expanded)], ))<br/>&amp;CLEANUP_SEND #4167=@pemit %0 = u(pickup_notification); &amp;mail-in-progress-subject %1; &amp;mail-in-progress-to %1; &amp;mail-in-progress-to-expanded %1; &amp;mail-in-progress-cc %1; &amp;mail-in-progress-cc-expanded %1; &amp;mail-in-progress-bcc %1; &amp;mail-in-progress-bcc-expanded %1; &amp;mail-in-progress-flags %1; &amp;mail-in-progress-body %1; &amp;mail-in-progress %1 = false; @no %1<br/>&amp;RETRACT_MAIL #300=$+retract*: @swi/first [setq(0, get(%vm/mailbox_%#))]0 = strmatch(type(%#), PLAYER),{@pemit %# = u(not_player)},not(strmatch(escape(%0), *[*)), {@pemit %# = u(nofunc)},strlen(%q0), {@pemit %# = There is no mail to retract in your mailbox.},{@wait %q0 = {&amp;debug_mail %q0 = +retract%0; @swi/first [setq(1, get(%q0/out-list))][setq(2,ulocal(expand_single_letter_range,trim(%0), %q1, get(%q0/out-list-current)))]1 = eq(words(%q1), 0), {@pemit %# = There is no mail to retract in your mailbox.; @no %q0}, strmatch(%q2, *ABORT*), {@pemit %# = after(before(%q2, ENDABORT), ABORT); @no %q0},u(any_read, %q0, %q2), {@pemit %# = One or more recipients of the designated letter has already read it, therefore it cannot be retracted.; @no %q0}, {@tr me/retract_main = %#, %q0, %q2, [u(convert_nums, %q2, %q1)][ulocal(format_request, trim(%0))] }}}<br/>&amp;ANY_READ #4167 = strmatch(iter(get(%0/out-%1-dist), [setq(3, get(#7/mailbox_[before(##, :)]))][setq(4, after(##, :))]and(strmatch(get(%q3/in-%q4-time_read), 0), strmatch(first(get(%q3/in-%q4-location)), %0), strmatch(rest(get(%q3/in-%q4-location)), %1))), *0*)<br/>&amp;RETRACT_MAIN #4167=@dolist get(%1/out-%2-dist) = {@tr [setq(2, get(%vm/mailbox_[before(##, :)]))][setq(3, after(##, :))]me/remove_letter[switch(member(get(%1/out-%2-held), before(##, :)), 0,-NO-OP,2)] = %q2, %q3, %0, %1, %2, %3}; @swi 1 = 1, {&amp;out-list-current %1 = [setq(0, get(%1/out-list))][setq(1, get(%1/out-list-current))]switch(%q1+[last(%q0)], %2+%2, first(rest(revwords(%q0))), %2+*, extract(%q0, add(member(%q0, %2), 1), 1), %q1);  &amp;out-list %1 = squish(remove(%q0, %2)); @wipe %1/out-%2-*; @pemit %0 = Letter %3 has been retracted.; @no %1}<br/>&amp;REMOVE_LETTER-NO-OP #4167=@@ do nothing<br/>&amp;REMOVE_LETTER2 #4167 =@dolist get(%0/folder-list) = {&amp;current_letter-## %0 = [setq(0, get(%0/in-list-##))][setq(1, get(%0/current_letter-##))]switch(%q1+[last(%q0)], %1+%1, first(rest(revwords(%q0))), %1+*, extract(%q0, add(member(%q0, %1), 1), 1), %q1);  &amp;in-list-## %0 = squish(remove(get(%0/in-list-##), %1))};@swi 1 = 1, {@wipe %0/in-%1-*}<br/>&amp;REVIEW_LETTERS #300=$+review: @swi/first [setq(0, get(%vm/mailbox_%#))][setq(1, get(%q0/out-list))][setq(2, get(%q0/out-list-current))][setq(9, u(get_format_option, get(%#/mail_config_options)))]0 = strlen(%q0),{@pemit %# = u(no_sent_mail)},words(%q1), {@pemit %# = u(no_sent_mail)}, {@pemit %# =[switch(%q9, standard,{[u(equal_line)]%r%r[center(List of Previously Sent Mail Messages, 78)]%r%r})][space(8)][ljust(Subject, 46)]%b%bSize%b%bSent%r[space(8)]-------[space(41)]----%b%b--------;@dolist get(%q0/out-list) ={@pemit %# = u(review_brief, %#, ##, %q0, %q1, %q2)};@swi 1 = 1,{@pemit %# = switch(%q9, standard, %r[u(equal_line)],,)}}<br/>&amp;REVIEW_BRIEF #4167 = [setq(2, member(%3, %1))][setq(3, trim(get(%2/out-%1-subject)))][switch(%1, %4, +, %b)][rjust(%q2\)%b%b, 7)][ljust(mid(%q3, 0, min(46, strlen(%q3))), 48)][ljust(strlen(u(%2/out-%1-text)), 6)][mid(get(%2/out-%1-time_sent), 0, 16)]<br/>&amp;REVIEW_LETTER #300=$+review*: @swi/first [setq(0, get(%vm/mailbox_%#))]0 = strmatch(type(%#), PLAYER),{@pemit %# = u(not_player)},words(%0),,not(strmatch(escape(%0), *[*)),{@pemit %# = u(nofunc)},strlen(%q0), {@pemit %# = u(no_sent_mail)},{@wait %q0 = {&amp;debug_mail %q0 = +review%0; @swi/first [setq(1, get(%q0/out-list))][setq(9, u(get_format_option, get(%#/mail_config_options)))]0 = words(%q1), {@pemit %# = u(no_sent_mail); @no %q0},{@swi/first [setq(3, ulocal(expand_outgoing_letter_range, %0, %q1, get(%q0/out-list-current), %q0))]1 = strmatch(%q3, *ABORT*),{@pemit %# = after(before(%q3, ENDABORT), ABORT);  @no %q0},eq(words(%q3), 0),{@pemit %# = u(no_match, +review, ulocal(format_request, trim(%0)), %q2); @no %q0},{@dolist [setq(3, u(filter_list, setunion(%q3, ), %q1))]%q3 ={@pemit %# = ulocal(read_bulk_private, %#, %q0, ##, %q9)}; @swi 1 = 1, {&amp;out-list-current %q0 = last(%q3); @swi 1 = 1,{@no %q0}}}}}}<br/>&amp;READ_BULK_PRIVATE #4167=[setq(4, get(%1/out-%2-cc))][setq(5, get(%1/out-%2-bcc))][setq(7, get(%1/out-list))][setq(6, member(%q7, %2))][switch(%3, standard, {[u(equal_line)]%r})][ljust(Message:, 10)][ljust(%q6/[words(%q7)], 9)][rjust(Sent:%b%b[get(%1/out-%2-time_sent)], 59)]%r[ljust(To:, 10)][trim(get(%1/out-%2-to))][switch(words(%q4), 0,,%r[ljust(Cc:, 10)][trim(%q4)])][switch(words(%q5), 0,,%r[ljust(Bcc:, 10)][trim(%q5)])]%r[ljust(Held By:, 10)][u(pretty_dist, get(%1/out-%2-held))]%r[ljust(Subject:, 10)][trim(get(%1/out-%2-subject))][switch(%3, standard, {%r[u(dash_line)]%r%r},%rText:[space(11)])][u(%1/out-%2-text)][switch(%3, standard, {%r%r[u(equal_line)]})]<br/>&amp;STATUS_OF_MAIL_SENT #300=$+status of mail sent to *: @swi/first [setq(0, get(%vm/mailbox_%#))][setq(1, get(%vm/mailbox_[num(*%0)]))]0 = strmatch(type(%#), PLAYER),{@pemit %# = u(not_player)},strmatch(type(*%0), PLAYER),{@pemit %# = [capstr(%0)] is not a player.}, strlen(%q0), {@pemit %# = u(no_mail_from_you, [name(*%0)])},{@wait %q0 = {&amp;debug_mail %q0 = +status of mail sent to %0; @swi/first [setq(2, get(%q0/out-list))][setq(3, squish(iter(%q2, switch(get(%q0/out-##-dist), *[num(*%0)]:*, ##))))]0 = words(%q2),{@pemit %# = u(no_mail_from_you, [name(*%0)]); @no %q0},words(%q3), {@pemit %# = u(no_mail_from_you, [name(*%0)]); @no %q0},{@pemit %# = [setq(4, u(get_format_option, get(%#/mail_config_options)))][switch(%q4, standard, {[u(equal_line)]%r%r[space(13)]Status of messages you have sent to [name(*%0)]%r%r})]Subject[space(28)]Sent on[space(11)]Read[switch(%q4, standard, {%r[u(dash_line)]})]; @dolist %q3 = {@pemit %# = [setq(5, trim(get(%q0/out-##-subject)))][setq(6, get(%q1/in-[after(extract(get(%q0/out-##-dist), match(get(%q0/out-##-dist), [num(*%0)]:*), 1), :)]-time_read))][ljust(mid(%q5, 0, min(33, strlen(%q5))), 35)][mid(get(%q0/out-##-time_sent), 0, 16)]%b%b[switch(%q6+[words(%q6)], *+0, Message has been deleted, 0+*, Message has not been read, mid(%q6, 0, 16))]}; @swi 1 = 1, {@pemit %# = switch(%q4, standard, u(equal_line),,); @no %q0}}}}<br/>&amp;STATUS_OF_MAIL_SENT_BLANK #300=$+status of mail sent: @pemit %# = The syntax is +status of mail sent to &lt;person&gt;.<br/>&amp;MAIL_ADMIN_COMMAND #300=$+mail status: @swi/first hasflag(%#, wizard) = 1,{@pemit %# = [setq(0, u(get_format_option, get(%#/mail_config_options)))][switch(%q0, standard, {[u(equal_line)]%r[space(26)]Summary status of mailboxes%r%r})]Mailbox%b%bOwner[space(12)]Writing? %b Filters%b Aliases%b Folders%b Sent%b Received[switch(%q0, standard, {%r[u(dash_line)]})]; @tr me/continue_mail_status = %#, 1, %q0, get(%vm/mailboxes_num_of_attributes)}, {@pemit %# = Permission denied.}<br/>&amp;CONTINUE_MAIL_STATUS #4167=@swi/first [setq(0, get(%vm/mailboxes_%1))][strlen(%q0)]+[gt(%3, %1)] = 0+0,{@pemit %0 = switch(%2, standard, u(equal_line), )},0+*, {@tr me/continue_mail_status = %0, add(1, %1), %2, %3}, {@tr me/show_one_mailbox = %0, %q0, 1, words(%q0),continue_mail_status, 0, %1, %2, %3}<br/>&amp;EVALUATE_NEXT_LIST #4167 = iter(get(%vm/mailboxes_%0),switch(u(%1, ##, %2),1,##,))<br/>&amp;SHOW_ONE_MAILBOX #4167 = @swi/first %3+[gt(%8, %6)] = 0+0,{@pemit %0 = switch(%7, standard, u(equal_line), )},0+*,{@tr me/%4 = %0, add(1, %6), %5, %7, %8},{@pemit %0 = u(get_info_for_one_mailbox, extract(%1, %2, 1)); @swi/first %2+[gt(%8, %6)] = %3+0, {@pemit %0 = switch(%7, standard, u(equal_line), )},%3+*, {@tr me/%4 = %0, add(1, %6), %7, %8},{@tr me/show_one_mailbox = %0, %1, add(%2, 1), %3, %4, %5, %6, %7, %8}}<br/>&amp;GET_INFO_FOR_ONE_MAILBOX #4167 = [setq(0, get(%0/owner_dbref))][setq(1, get(%0/semaphore))][setq(2, get(%0/mail-in-progress))][setq(3, [switch(%q1, -1,, {[switch(strlen(%q1), 0,%bsem 0, %bsem%q1)]})])][ljust(%0, 7)][switch(hasattr(%0, autoforward), 0, %b%b, a%b)][switch(0, strmatch(owner(%0), owner(#7)), {%b-- WARNING -- This mailbox object is not owned by the right player!},strlen(%q2),{%b-- WARNING -- This does not seem to be a valid mailbox.},strmatch(type(%q0), PLAYER), {%b-- INFORMATIVE -- Mailbox for dest'ed player (do a +destroy mailbox for %q0.  Caution:%b all mail sent by that player will be removed from the destination mailboxes)},{[ljust(name(%q0), 17)][ljust(%q2%q3, 11)][rjust(add(words(get(%0/author_filter), ~), words(get(%0/subject_filter), ~)), 7)][rjust(words(get(%0/alias-list)), 9)][rjust(words(remove(get(%0/folder-list), null)), 9)][rjust(words(get(%0/out-list)), 6)][rjust(words(u(get_all_in_lists, %0)), 10)]})]<br/>&amp;MAIL_ADMIN_COMMAND_SPECIFIC #300 = $+mail status for *: @swi/first [setq(0, get(%vm/mailbox_[num(*%0)]))]0 = hasflag(%#, wizard),{@pemit %# = Permission denied.},strmatch(type(*%0), PLAYER),{@pemit %# = [capstr(%0)] is not a player.},strlen(%q0),{@pemit %# = [name(*%0)] does not currently have a mailbox.},{@tr me/display_mail_admin = %#, %q0}<br/>&amp;DISPLAY_MAIL_ADMIN #4167 = &amp;folder-list %0 = squish(remove(get(%0/folder-list), null)); @pemit %0 = [setq(0, u(get_format_option, get(%0/mail_config_options)))][setq(1, get(%1/owner_dbref))][setq(2, get(%1/mail-in-progress))][switch(%q0, standard, {[u(equal_line)]%rDetailed status for [name(%q1)]'s mailbox:%r[u(dash_line)]%r})][rjust(Mailbox dbref:, 20)]%b%b%1[switch(strlen(%q2), 0,{%r-- WARNING --  This does not seem to be a valid mailbox.})]%r[rjust(Mail-in-progress:, 20)]%b%b%q2%r[rjust(Received:, 20)]%b%b[words(u(get_all_in_lists, %1))]%r[rjust(Sent:, 20)]%b%b[words(get(%1/out-list))]%r[rjust(Personal aliases:, 20)]%b%b[words(get(%1/alias-list))] [switch(hasattr(%1, alias-list), 0,,([u(list_names, trim(get(%1/alias-list)))]))]%r[rjust(Filters:, 20)]%b%b[ulocal(get_filter_count, %q1)]%r[rjust(Folders:, 20)]%b%b[words(get(%1/folder-list))] [switch(hasattr(%1, folder-list), 0,,{([u(secure_names, trim(get(%1/folder-list)))])})]%r[rjust(Autoforward:, 20)]%b%b[ulocal(get_autoforward_option, %q1)]%r[rjust(Message Timeout:, 20)]%b%b[ulocal(get_timeout_option, %q1)]%r[rjust(Semaphore:, 20)]%b%b[get(%1/semaphore)]%r[rjust(Current Letter:, 20)]%b%b[get(%1/[u(which_current_letter, %1)])]%r[rjust(Current Folder:, 20)]%b%b[secure(get(%1/current_folder))]%r[rjust(Inbox:, 20)]%b%b[secure(ulocal(get_inbox, %q1))]%r[rjust(Vacation:, 20)]%b%b[u(%1/vacation)]%r[rjust(Reject:, 20)]%b%b[u(%1/reject_msg)]%r[rjust(Filter reject:, 20)]%b%b[u(%1/filter_reject)][switch(%q0, standard, {%r[u(equal_line)]})]; <br/>&amp;MAIL_MEMORY_HOGS #300 = $+mail status &gt;*: @swi/first hasflag(%#, wizard) = 1,{@pemit %# = [setq(0, u(get_format_option, get(%#/mail_config_options)))][switch(%q0, standard, {[u(equal_line)]%r[space(8)]Summary status of mailboxes with greater than [trim(%0)] messages%r%r})]Mailbox%b%bOwner[space(12)]Writing? %b Filters%b Aliases%b Folders%b Sent%b Received[switch(%q0, standard, {%r[u(dash_line)]})]; @tr me/continue_memory_hogs = %#, 1, %0, %q0, get(%vm/mailboxes_num_of_attributes)}, {@pemit %# = Permission denied.}<br/>&amp;CONTINUE_MEMORY_HOGS #4167 = @swi/first [strlen(get(%vm/mailboxes_%1))]+[gt(%4, %1)] = 0+0,{@pemit %0 = switch(%3, standard, u(equal_line), )},0+*, {@tr me/continue_memory_hogs = %0, add(1, %1), %2, %3, %4},{@tr me/show_one_mailbox =[setq(0, u(evaluate_next_list, %1, memory_hog_test, %2))]%0, %q0, 1, words(%q0), continue_memory_hogs, %2, %1,  %3, %4}<br/>&amp;MEMORY_HOG_TEST #4167 = gt(words(u(get_all_in_lists, %0)), %1)<br/>&amp;MAIL_STATUS_LESS_THAN #300 = $+mail status &lt;*: @swi/first hasflag(%#, wizard) = 1,{@pemit %# = [setq(0, u(get_format_option, get(%#/mail_config_options)))][switch(%q0, standard, {[u(equal_line)]%r[space(8)]Summary status of mailboxes with less than [trim(%0)] messages%r%r})]Mailbox%b%bOwner[space(12)]Writing? %b Filters%b Aliases%b Folders%b Sent%b Received[switch(%q0, standard, {%r[u(dash_line)]})]; @tr me/continue_less_than = %#, 1, %0, %q0, get(%vm/mailboxes_num_of_attributes)}, {@pemit %# = Permission denied.}<br/>&amp;CONTINUE_LESS_THAN #4167 = @swi/first [strlen(get(%vm/mailboxes_%1))]+[gt(%4, %1)] = 0+0, {@pemit %0 = switch(%3, standard, u(equal_line), )},0+*, {@tr me/continue_less_than = %0, add(1, %1), %2, %3, %4},{@tr me/show_one_mailbox =[setq(0, u(evaluate_next_list, %1, letters_less_than_test, %2))]%0,%q0, 1,words(%q0),continue_less_than,%2, %1, %3, %4}<br/>&amp;LETTERS_LESS_THAN_TEST #4167 = lt(words(u(get_all_in_lists, %0)), %1)<br/>&amp;MAIL_STATUS_BAD_SEM #300 =$+mail status bad sem*:@swi/first hasflag(%#, wizard) = 1,{@pemit %# =[setq(0, u(get_format_option, get(%#/mail_config_options)))][switch(%q0, standard, {[u(equal_line)]%r[space(8)]Summary status of mailboxes with semaphores that are off%r%r})]Mailbox%b%bOwner[space(12)]Writing? %b Filters%b Aliases%b Folders%b Sent%b Received[switch(%q0, standard, {%r[u(dash_line)]})];@tr me/continue_semaphore_off = %#, 1, %q0, get(%vm/mailboxes_num_of_attributes)}, {@pemit %# = Permission denied.}<br/>&amp;CONTINUE_SEMAPHORE_OFF #4167 =@swi/first [strlen(get(%vm/mailboxes_%1))]+[gt(%3, %1)] = 0+0, {@pemit %0 = switch(%2, standard, u(equal_line), )},0+*, {@tr me/continue_semaphore_off = %0, add(1, %1), %2, %3},{@tr me/show_one_mailbox =[setq(0, u(evaluate_next_list, %1, semaphore_off_test))]%0, %q0, 1, words(%q0), continue_semaphore_off, 0, %1,%2,%3}<br/>&amp;SEMAPHORE_OFF_TEST #4167 = switch(get(%0/semaphore), -1, 0, 1)<br/>&amp;SANITY_CHECK #300 = $+sanity check: @swi/first hasflag(%#, wizard) = 1,{&amp;last_sanity_checked me = time(); @tr me/continue_sanity_check =%#, 1, get(%vm/mailboxes_num_of_attributes)},{@pemit %# = Permission denied.}<br/>&amp;CONTINUE_SANITY_CHECK #4167 = @swi/first [strlen(get(%vm/mailboxes_%1))]+[gt(%2, %1)] =0+0,{@pemit %0 = Sanity check complete.},0+*,{@tr me/continue_sanity_check = %0, add(1, %1), %2},{@tr #7/sanity_check_one_mailbox =first(get(%vm/mailboxes_%1)), %0, %1,%2, get(%vm/mailboxes_%1), words(get(%vm/mailboxes_%1)), 1}<br/>&amp;SANITY_CHECK_ONE_MAILBOX #7 = @pemit %1 = Sanity checking [name(get(%0/owner_dbref))]'s mailbox.; @dolist u(#300/get_all_in_lists, %0) = {@swi/first [setq(0, get(%0/in-##-location))]1 = and(eq(member(get(first(%q0)/out-list), rest(%q0)), 0),not(strmatch(rest(%q0), a*))), {@pemit %1 = Error detected in mailbox %0.%b Internal mail number ## is not present in source mailbox.}, and(eq(member(get(first(%q0)/out-[rest(%q0)]-held), get(%0/owner_dbref)), 0), not(strmatch(rest(%q0), a*))), {@pemit %1 = Error detected in mailbox %0.%b Internal mail number ## is not in the 'held' list in source mailbox.}, and(or(eq(words(get(%0/in-##-time_read)), 0), eq(words(get(%0/in-##-location)), 0)), strmatch(rest(%q0), a*)), {@pemit %1 = Error detected in mailbox %0.%b Internal mail number ## for 'old' mail does not have matching in-* attributes.}, and(eq(words(get(%0/out-a##-time_sent)), 0), strmatch(rest(%q0), a*)), {@pemit %1 = Error detected in mailbox %0.%b Internal mail number ## for 'old' mail does not have matching out-a* attributes.}}; @dolist get(%0/out-list) = {@tr me/sanity_check_outgoing_mail = %0, %1, ##};@swi 1 = 1, {@swi 1 = 1, {@swi 1 = 1, {@swi %6 = %5,{@tr #300/continue_sanity_check = %1, add(1, %2), %3},{@tr #7/sanity_check_one_mailbox =extract(%4, add(1, %6), 1), %1, %2, %3, %4, %5, add(1, %6)}}}}<br/>&amp;SANITY_CHECK_OUTGOING_MAIL #7 = @dolist [setq(0, get(%0/out-%2-dist))]get(%0/out-%2-held) = {@swi/first [setq(1, match(%q0, ##:*))][setq(2, extract(%q0, %q1, 1))][setq(3, v(mailbox_[before(%q2, :)]))][setq(4, after(%q2, :))][setq(5, get(%q3/in-%q4-location))][setq(6, u(#300/get_all_in_lists, %q3))][setq(7, name(get(%q3/owner_dbref)))]0 = %q1,{@pemit %1 = Error detected in mailbox %0.%b Outgoing mail number %2 has a 'held' member (##) which isn't in the 'dist' list.},words(%q7),{@pemit %1 = Error detected in mailbox %0.%b Outgoing mail number %2 has a 'held' member (##) who does not even have a mailbox.%b Fixed.;&amp;out-%2-held %0 = squish(remove(get(%0/out-%2-held), ##)) },words(%q5),{@pemit %1 = Error detected in mailbox %0.%b Outgoing mail number %2 does not exist in destination mailbox %q3 \(%q7\).%b Fixed.;&amp;out-%2-held %0 = squish(remove(get(%0/out-%2-held), ##)) },strmatch(first(%q5), %0),{@pemit %1 = Error detected in mailbox %0.%b Outgoing mail number %2 'dist' does not match in-%q4-location in mailbox %q3 \(%q7\)%b Fixed.;&amp;out-%2-held %0 = squish(remove(get(%0/out-%2-held), ##)) }, strmatch(rest(%q5), %2), {@pemit %1 = Error detected in mailbox %0.%b Outgoing mail number %2 'dist' does not match in-%q4-location in mailbox %q3 \(%q7\).%b Fixed.;&amp;out-%2-held %0 = squish(remove(get(%0/out-%2-held), ##)) }, member(%q6, %q4), {@pemit %1 = Error detected in mailbox %0.%b Outgoing mail number %2 exists in destination mailbox %q3 \(%q7\), but is not in any of its IN lists.}};@swi 1 = 1,{@swi 2 = 2,{@swi hasattr(%0, out-%2-held) = 0,{@wipe %0/out-%2-*;&amp;out-list %0 = squish(remove(get(%0/out-list), %2))}}}<br/>&amp;WIZ_MAKE_MAILBOX #300 = $+make mailbox for *: @swi/first hasflag(%#, wizard) = 1,{@tr %vm/make_mailbox = %0, %#}, {@pemit %# = Permission denied.}<br/>&amp;WIZ_DESTROY_MAILBOX #300=$+destroy mailbox for *: @swi/first hasflag(%#, wizard) = 1,{@tr %vm/destroy_mailbox = %0, %#, 0, +destroy_mailbox}, {@pemit %# = Permission denied.}<br/>&amp;MAIL_CONFIGURATION #300=$+mail config*: @swi hasflag(%#, wizard) = 1,{@pemit %# = [setq(0, u(get_format_option, get(%#/mail_config_options)))][setq(1, get(%vm/default_timeout_option))][switch(%q0, standard, {[u(equal_line)]%rCurrent mail configuration:%r[u(dash_line)]%r})]Defaults:%r%r%b%bdestroy:%b%b[ljust(switch(get(%vm/delete_when_empty), 0, no, yes), 16)][rjust(\(+set mail option destroy = yes or no\), 50)]%r%b%b%b%b%b%bRGA:%b%b[ljust(switch(get(%vm/default_rga_option), 0, no, yes), 16)][rjust(\(+set mail default RGA = yes or no\), 50)]%r%b%b%bdelete:%b%b[ljust(get(%vm/default_delete_option), 16)][rjust(\(+set mail default delete = hard or soft\), 50)]%r%b%b%bformat:%b%b[ljust(get(%vm/default_format_option), 16)][rjust(\(+set mail default format = standard or compact\), 50)]%r%b%b%b%b%bsave:%b%b[ljust(get(%vm/default_save_option), 16)][rjust(\(+set mail default save = enabled or disabled\), 50)]%rseparator:%b%b[ljust(get(%vm/default_separator_option), 16)][rjust(\(+set mail default separator = space or return\), 50)]%r%b%btimeout:%b%b[ljust(switch(%q1, 0, &lt;disabled&gt;,{[div(%q1, v(seconds_in_day))] days}), 16)][rjust(\(+set mail default timeout = &lt;number of days&gt;\), 50)]%r%b%b%b%bpurge:%b%b[ljust(get(%vm/default_purge_time), 16)][rjust(\(+set mail default purge = &lt;day&gt; &lt;hour&gt;:&lt;minute&gt;\), 50)]%r%rNotifications:  \(set on Parent Mail Object/#4167\)%r%r%b%bENTER_MSG:%b%b[get(#4167/enter_msg)]%r%r%b%bFINISH_MSG:%b%b[get(#4167/finish_msg)]%r%r%b%bDELIVERY_NOTIFICATION:%b%b[get(#4167/delivery_notification)]%r%r%b%bPICKUP_NOTIFICATION:%b%b[get(#4167/pickup_notification)]%r%r%b%bFORWARD_NOTIFICATION:%b%b[get(#4167/forward_notification)]%r%r%b%bTEXT_ADDED_NOTIFICATION:%b%b[get(#4167/text_added_notification)]%r%rCurrent Status:%r%r%b%bThere are [words(get(%vm/global-mail-aliases))] global mail aliases.%r%b%bThere are [words(iter(lnum(get(%vm/mailboxes_num_of_attributes)),get(%vm/mailboxes_[add(1, ##)])))] mailboxes.%r%b%b[switch(get(#7/mailboxes_num_of_attributes), 1, One attribute is, [get(#7/mailboxes_num_of_attributes)] are)] used to hold the list of mailboxes. [switch(%q0, standard, {%r[u(equal_line)]})]}<br/>&amp;VERIFY_MAIL_CONFIG #300=$+verify mail config*:@swi hasflag(%#, wizard) = 1,{&amp;mail_config_options me=this is a test;&amp;test_space_compression me = z%b%b%b%b%bz;@create Test Object; &amp;new_object me = switch(name(con(me)), Test Object, con(me), #-1);  @swi/first 0+0 = 0+0,, 0+*, {@pemit %# = @swi/first is broken! Don't bother trying to run the mailer until it is fixed.}, {}; @pemit %# =[switch(words(v(mail_config_options)), 0,,%r%rWARNING:%b%bhave [name(#1)]\(#1\) do a@attribute/access mail_config_options=wizard)][switch(flags(#300), *I*, %r%rWARNING:%b%bThe [name(#300)] object \(#300\) should not be inherit.)][switch([flags(#25)]+[flags(owner(#25))],*I*+*W*,, *W*+*W*,, %r%rFATAL:%b%bThe [name(#25)] object \(#25\)should be inherit and owned by a Wizard.)][switch(parent(me), #4167,, %r%rFATAL:%b%bThe [name(me)] object \([num(me)]\) should be parented tothe [name(#4167)] \(#4167\).)][switch(strlen(u(test_space_compression), 3,,{%r%rFATAL:%b%b have [name(#1)]\(#1\) do a @adminspace_compress=yes}))][switch(isdbref(v(new_object)), 1,, 0, {FATAL:%b%bThe Mail System must be allowed to create objects, but a @create failed!})]; @swi 1 = 1, @pemit %# = Verify complete.;&amp;test_space_compression me = ;@dest v(new_object); &amp;new_object me = ; &amp;mail_config_options me =}<br/>&amp;SET_MAIL_OPTION_DESTROY #300=$+set mail option destroy*=*: @swi/first hasflag(%#, wizard) = 1,{@swi/first 1 = or(strmatch(%1, *yes), strmatch(%1, *on), strmatch(%1, *true), strmatch(%1, *t), strmatch(%1, *1)),{&amp;delete_when_empty %vm = 1; @pemit %# = Mailboxes will be automatically destroyed when they are empty.},or(strmatch(%1, *no), strmatch(%1, *off), strmatch(%1, *false), strmatch(%1, *f), strmatch(%1, *0)),{&amp;delete_when_empty %vm = 0; @pemit %# = Mailboxes will not be automatically destroyed when they are empty.}, {@pemit %# = The value for this option must be specified as a boolean. For example: %bon, off, yes, no, true, false are all acceptable values.} }, {@pemit %# = Permission denied.}<br/>&amp;SET_MAIL_OPTION_RGA #300=$+set mail option RGA*=*:@swi/first hasflag(%#, wizard) = 1,{@swi/first 1 =or(strmatch(%1, *yes),strmatch(%1, *on),strmatch(%1, *true),strmatch(%1, *t),strmatch(%1, *1)),{&amp;default_rga_option #7 = 1;@pemit %# = Adding global mail aliases is now restricted to wizards.},or(strmatch(%1, *no),strmatch(%1, *off),strmatch(%1, *false),strmatch(%1, *f),strmatch(%1, *0)),{&amp;default_rga_option #7 = 0;@pemit %# = Adding global mail aliases is no longer restricted.},{@pemit %# = The value for this option must be specified as aboolean. For example: %bon, off, yes, no, true, false are allacceptable values.}},{@pemit %# = Permission denied.}<br/>&amp;SET_MAIL_OPTION_BLANK #300=$+set mail option: @swi/first hasflag(%#, wizard) = 1,{@pemit %# = You must specify which option you wish to set and the desired value. The current options are:%r%r%b%bdelete=hard | soft%r%r%b%bdestroy=on | off%r%r%b%bformat=compact | standard%r%r%b%bseparator=space | return%r%r%b%binbox=&lt;folder name&gt;%r%r%b%bvacation=&lt;text&gt;%r%r%b%breject=&lt;text&gt;%r%r%b%bfilter reject=&lt;text&gt;%r%r%b%bautoforward=&lt;list of people and/or mail aliases&gt;%r%r%b%btimeout=&lt;number of days&gt; for &lt;player&gt;%r%r%b%bRGA=yes | no  (RGA stands for Restrict Global Aliases)},{@pemit %# = You must specify which option you wish to set and the desired value. The current options are:%r%r%b%bdelete=hard | soft%r%r%b%bformat=compact | standard%r%r%b%bseparator=space | return%r%r%b%binbox=&lt;folder name&gt;%r%r%b%bvacation=&lt;text&gt;%r%r%b%breject=&lt;text&gt;%r%r%b%bfilter reject=&lt;text&gt;%r%r%b%bautoforward=&lt;list of people and/or mail aliases&gt;}<br/>&amp;SET_MAIL_OPTION_TIMEOUT #25=$+set mail option timeout*=* for *: @swi/first [setq(0, get(%vm/mailbox_[num(*%2)]))]0 = hasflag(%#, wizard), {@pemit %# = Permission denied.},strmatch(type(*%2), PLAYER),{@pemit %# = [capstr(%2)] is not a player.},strlen(%q0),{@pemit %# = [name(*%2)] does not currently have a mailbox.},%1,{&amp;message_timeout %q0 = 0; @pemit %# = The message timeout has been set to 0 days (indicating that the timeout option has been turned off for [name(*%2)]).},lt(%1, 7),{&amp;message_timeout %q0 = mul(%1, v(seconds_in_day));@pemit %# = The message timeout value for [name(*%2)] has been set to [add(%1, 0)] days.},{@pemit %# = The value specified for the message timeout must be either a '0' (indicating the timeout option has been turned off) or a value greater than or equal to 7 days.}<br/>&amp;SET_MAIL_DEFAULT_DELETE #25=$+set mail default delete*=*: @swi/first 1 = eq(hasflag(%#, wizard), 0),{@pemit %# = Permission denied.},strmatch(%1, *s*),{@pemit %# = switch(get(%vm/default_delete_option), hard, The mail system default for 'delete' is now 'soft'., The mail system default for 'delete' is already 'soft'.); &amp;default_delete_option %vm = soft; },strmatch(%1, *h*),{@pemit %# = switch(get(%vm/default_delete_option), soft, The mail system default for 'delete' is now 'hard'., The mail system default for 'delete' is already 'hard'.); &amp;default_delete_option %vm = hard; },{@pemit %# = The value specified for the mail system default for 'delete', must be either 'soft' or 'hard'.}<br/>&amp;SET_MAIL_DEFAULT_MODE #25=<br/>&amp;SET_MAIL_DEFAULT_FORMAT #25=$+set mail default format*=*: @swi/first 1 = eq(hasflag(%#, wizard), 0),{@pemit %# = Permission denied.},strmatch(%1, *s*),{@pemit %# = switch(get(%vm/default_format_option), compact, The mail system default for 'format' is now 'standard'., The mail system default for 'format' is already 'standard'.); &amp;default_format_option %vm = standard},strmatch(%1, *c*),{@pemit %# = switch(get(%vm/default_format_option), standard, The mail system default for 'format' is now 'compact'., The mail system default for 'format' is already 'compact'.); &amp;default_format_option %vm = compact},{@pemit %# = The value specified for the mail system default for 'format', must be either 'standard' or 'compact'.}<br/>&amp;SET_MAIL_DEFAULT_SAVE #25=$+set mail default save*=*: @swi/first [setq(0, trim(%1))]1 = eq(hasflag(%#, wizard), 0),{@pemit %# = Permission denied.},strmatch(%q0, e*),{@pemit %# = switch(get(%vm/default_save_option), disabled, The mail system default for 'save' is now 'enabled'., The mail system default for 'save' is already 'enabled'.); &amp;default_save_option %vm = enabled},strmatch(%q0, d*),{@pemit %# = switch(get(%vm/default_save_option), enabled, The mail system default for 'save' is now 'disabled'., The mail system default for 'save' is already 'disabled'.); &amp;default_save_option %vm = disabled},{@pemit %# = The value specified for the mail system default for 'save', must be either 'enabled' or 'disabled'.}<br/>&amp;SET_MAIL_DEFAULT_SEPARATOR #25=$+set mail default separator*=*: @swi/first [setq(0, trim(%1))]1 = eq(hasflag(%#, wizard), 0),{@pemit %# = Permission denied.},strmatch(%q0, s*),{@pemit %# = switch(get(%vm/default_separator_option), return, The mail system default for 'separator' is now 'space'., The mail system default for 'separator' is already 'space'.); &amp;default_separator_option %vm = space},strmatch(%q0, r*),{@pemit %# = switch(get(%vm/default_separator_option), space, The mail system default for 'separator' is now 'return'., The mail system default for 'separator' is already 'return'.); &amp;default_separator_option %vm = return},{@pemit %# = The value specified for the mail system default for 'separator', must be either 'space' or 'return'.}<br/>&amp;SET_MAIL_DEFAULT_TIMEOUT #25=$+set mail default timeout*=*:@swi/first 0 = hasflag(%#, wizard), {@pemit %# = Permission denied.},%1,{&amp;default_timeout_option %vm = 0;@pemit %# = The mail system default for 'timeout' has been set to 0 days (indicating that the timeout option has been turned off).},lt(%1, 7), {&amp;default_timeout_option %vm = mul(%1, v(seconds_in_day));@pemit %# = The mail system default for 'timeout' is now [add(%1, 0)] days and will run on [get(%vm/default_purge_time)].},{@pemit %# = The value specified for the mail system default for 'timeout', must be either a '0' (indicating the timeout option has been turned off) or a value greater than or equal to 7 days.}<br/>&amp;SET_MAIL_DEFAULT_PURGE #25=$+set mail default purge*=* *:@swi/first 0 = hasflag(%#, wizard), {@pemit %# = Permission denied.},match(Monday Tuesday Wednesday Thursday Friday Saturday Sunday Mon Tue Tues Wed Thu Thur Thurs Fri Sat Sun, %1),{@pemit %# = Please specify day of week.  (example:%b Monday)},strmatch(%2, *:*),{@pemit %# = Please specify the time in the format of &lt;hour&gt;:&lt;minute&gt;.},not(strmatch(%2, *:*:*)),{@pemit %# = Please specify the time in the format of &lt;hour&gt;:&lt;minute&gt;.},[setq(0, before(%2, :))]not(or(lt(%q0, 0), gt(%q0, 24))), {@pemit %# = Hour must be between 0 and 24.},[setq(1, after(%2, :))]not(or(lt(%q1, 0), gt(%q1, 59))), {@pemit %# = Minute must be between 0 and 59.},{&amp;default_purge_time %vm =    %1 [mid(00, 0, sub(2, strlen(%q0)))]%q0:[mid(00, 0, sub(2, strlen(%q1)))]%q1; @pemit %# = The mail system letter and mailbox purge code will run on [get(%vm/default_purge_time)].}<br/>&amp;SET_MAIL_OPTION_DELETE #25=$+set mail option delete*=*: @swi/first [setq(0, get(%#/mail_config_options))]trim(%1) = s*,{@pemit %# = switch(member(%q0, soft), 0, Your 'delete' mail option is now set to 'soft'., Your 'delete' mail option is already set to 'soft'.); &amp;mail_config_options %# = setunion(squish(remove(%q0, hard) soft), )},h*,{@pemit %# = switch(member(%q0, hard), 0, Your 'delete' mail option is now set to 'hard'., Your 'delete' mail option is already set to 'hard'.); &amp;mail_config_options %# = setunion(squish(remove(%q0, soft) hard), )},{@pemit %# = The value specified for the mail option 'delete', must be either 'soft' or 'hard'.}<br/>&amp;SET_MAIL_OPTION_MODE #25=<br/>&amp;SET_MAIL_OPTION_AUTOFORWARD #25 = $+set mail option autoforward*=*: @swi/first [setq(0, get(%vm/mailbox_%#))][setq(2, get(%vm/global-mail-aliases))][setq(3, get(%q0/alias-list))]1 = and(eq(strlen(%q0), 0), eq(strlen(%1), 0)), {@pemit %# = Mail will not be autoforwarded.},eq(strlen(%1), 0), {&amp;autoforward %q0 = ; @pemit %# = Mail will not be autoforwarded.},eq(strlen(%q0), 0), {@swi/first [setq(1,[ulocal(#300/identify_to_list, {%1}, %vm)] [u(#300/get_aliases, {%1}, #0, %q2, )])]%q1 = *ABORT*, {@pemit %# = secure(after(before(%q1, ENDABORT), ABORT));@no %q0},{@create %N's Mailbox; @set [setq(0, con(me))]%q0 = quiet; @drain %q0; &amp;debug_mail %q0 = +set mail option autoforward%0=%1; @chown %q0 = owner(%vm); @set %q0 = !halt; @tel %q0 = %vm; &amp;mailbox_%# %vm = %q0; @tr %vm/add_mailbox = %q0; &amp;owner_dbref %q0 = %#; @startup %q0 = {@drain me; @no me}; @set %q0 = safe; &amp;mail-in-progress %q0 = false; &amp;current_folder %q0 = ulocal(#300/get_inbox, %#); &amp;folder-list %q0 = get(%q0/current_folder); &amp;autoforward %q0 = %q1; @pemit %# = All mail destined for this mailbox will now be autoforwarded to [u(#300/pretty_dist, u(#300/get_aliases, %q1, %q0, %q2, ), %q0, , %q2, u(#300/snag_dbrefs, %q1))].; @no %q0}},{@swi/first [setq(1,[ulocal(#300/identify_to_list, {%1}, %q0)] [u(#300/get_aliases, {%1}, %q0, %q2, %q3)])]%q1 = *ABORT*, {@pemit %# = secure(after(before(%q1, ENDABORT), ABORT));@no %q0},{&amp;autoforward %q0 = %q1; @pemit %# = All mail destined for this mailbox will now be autoforwarded to [u(#300/pretty_dist, u(#300/get_aliases, %q1, %q0, %q2, %q3), %q0, %q3, %q2, u(#300/snag_dbrefs, %q1))].}}<br/>&amp;SET_MAIL_OPTION_FORMAT #25=$+set mail option format*=*: @swi/first [setq(0, get(%#/mail_config_options))]trim(%1) = s*,{@pemit %# = switch(member(%q0, standard), 0, Your 'format' mail option is now set to 'standard'., Your 'standard' mail option is already set to 'standard'.); &amp;mail_config_options %# = setunion(squish(remove(%q0, compact) standard), )},c*,{@pemit %# = switch(member(%q0, compact), 0, Your 'format' mail option is now set to 'compact'., Your 'standard' mail option is already set to 'compact'.); &amp;mail_config_options %# = setunion(squish(remove(%q0, standard) compact), )},{@pemit %# = The value specified for the mail option 'format', must be either 'standard' or 'compact'.}<br/>&amp;SET_MAIL_OPTION_SEPARATOR #25=$+set mail option separator*=*: @swi/first [setq(0, get(%#/mail_config_options))]trim(%1) = s*,{@pemit %# = switch(member(%q0, space), 0, Your 'separator' mail option is now set to 'space'., Your 'separator' mail option is already set to 'space'.); &amp;mail_config_options %# = setunion(squish(remove(%q0, return) space), )},r*,{@pemit %# = switch(member(%q0, return), 0, Your 'separator' mail option is now set to 'return'., Your 'separator' mail option is already set to 'return'.); &amp;mail_config_options %# = setunion(squish(remove(%q0, space) return), )},{@pemit %# = The value specified for the mail option 'separator', must be either 'space' or 'return'.}<br/>&amp;SET_MAIL_OPTION_INBOX #25=$+set mail option inbox*=*: @swi/first [setq(0, get(%vm/mailbox_%#))][setq(1, edit(lcstr(trim(%1)), %b, $))]1 = strmatch(escape(%1), *[*),{@pemit %# = u(#300/nofunc)},not(strmatch(type(%#), PLAYER)),{@pemit %# = u(#300/not_player)},eq(strlen(%1), 0),{@pemit %# = You must specify a name for the folder to be the designated inbox.},gt(strlen([setq(2, [setq(3, %1)]filter(#300/check_for_bad_chars, get(#300/bad_chars)))]%q2), 0),{@pemit %# = Invalid character(s) %q2 detected in folder name.},gt(strlen(%1), 16),{@pemit %# = Folder name specified is too long (maximum of 16 characters).},eq(strlen(%q0), 0),{&amp;MAIL_CONFIG_OPTIONS %# = [before(get(%#/mail_config_options), INBOX:)] [after(get(%#/mail_config_options), :INBOXEND)] INBOX:%q1:INBOXEND; @pemit %# = '[secure(%q1)]' is now the designated inbox[switch(%q1, null, {WARNING:%b This will result in all of your incoming mail being automatically discarded.},.)]},{&amp;MAIL_CONFIG_OPTIONS %# = [before(get(%#/mail_config_options), INBOX:)] [after(get(%#/mail_config_options), :INBOXEND)] INBOX:%q1:INBOXEND; &amp;folder-list %q0 = setunion([get(%q0/folder-list)] %q1, ); @pemit %# = '[secure(%q1)]' is now the designated inbox.[switch(%q1, null, {WARNING:%b This will result in all of your incoming mail being automatically discarded.},.)]}<br/>&amp;SET_MAIL_OPTION_VACATION #25=$+set mail option vacation*=*: @swi/first [setq(0, get(%vm/mailbox_%#))]1 = and(eq(strlen(%q0), 0), eq(words(%1), 0)), {@pemit %# = No vacation text registered.},eq(words(%1), 0), {&amp;vacation %q0 = ; @pemit %# = Vacation text cleared.},eq(strlen(%q0), 0), {@create %N's Mailbox; @set [setq(0, con(me))]%q0 = quiet; @drain %q0; &amp;debug_mail %q0 = +set mail option vacation%0=%1; @chown %q0 = owner(%vm); @set %q0 = !halt; @tel %q0 = %vm; &amp;mailbox_%# %vm = %q0; @tr %vm/add_mailbox = %q0; &amp;owner_dbref %q0 = %#; @startup %q0 = {@drain me; @no me}; @set %q0 = safe; &amp;mail-in-progress %q0 = false; &amp;current_folder %q0 = ulocal(#300/get_inbox, %#); &amp;folder-list %q0 = get(%q0/current_folder); &amp;vacation %q0 = u(#300/clean_text, %1); @pemit %# = Vacation text set.; @no %q0},{&amp;vacation %q0 = u(#300/clean_text, %1); @pemit %# = Vacation text set.; }<br/>&amp;SET_MAIL_OPTION_REJECT #25=$+set mail option reject*=*: @swi/first [setq(0, get(%vm/mailbox_%#))]1 = and(eq(strlen(%q0), 0), eq(words(%1), 0)), {@pemit %# = No reject text registered.},eq(words(%1), 0), {&amp;reject_msg %q0 = ; @pemit %# = Reject text cleared.},eq(strlen(%q0), 0), {@create %N's Mailbox; @set [setq(0, con(me))]%q0 = quiet; @drain %q0; &amp;debug_mail %q0 = +set mail option reject%0=%1; @chown %q0 = owner(%vm); @set %q0 = !halt; @tel %q0 = %vm; &amp;mailbox_%# %vm = %q0; @tr %vm/add_mailbox = %q0; &amp;owner_dbref %q0 = %#; @startup %q0 = {@drain me; @no me}; @set %q0 = safe; &amp;mail-in-progress %q0 = false; &amp;current_folder %q0 = ulocal(#300/get_inbox, %#); &amp;folder-list %q0 = get(%q0/current_folder); &amp;reject_msg %q0 = u(#300/clean_text, %1); @pemit %# = Reject text set.; @no %q0},{&amp;reject_msg %q0 = u(#300/clean_text, %1); @pemit %# = Reject text set.; }<br/>&amp;SET_MAIL_OPTION_FILTER_REJECT #25=$+set mail option filter reject*=*: @swi/first [setq(0, get(%vm/mailbox_%#))]1 = and(eq(strlen(%q0), 0), eq(words(%1), 0)), {@pemit %# = No filter reject text registered.},eq(words(%1), 0), {&amp;filter_reject %q0 = ; @pemit %# = Filter reject text cleared.},eq(strlen(%q0), 0), {@create %N's Mailbox; @set [setq(0, con(me))]%q0 = quiet; @drain %q0; &amp;debug_mail %q0 = +set mail option filter reject%0=%1; @chown %q0 = owner(%vm); @set %q0 = !halt; @tel %q0 = %vm; &amp;mailbox_%# %vm = %q0; @tr %vm/add_mailbox = %q0; &amp;owner_dbref %q0 = %#; @startup %q0 = {@drain me; @no me}; @set %q0 = safe; &amp;mail-in-progress %q0 = false; &amp;current_folder %q0 = ulocal(#300/get_inbox, %#); &amp;folder-list %q0 = get(%q0/current_folder); &amp;filter_reject %q0 = u(#300/clean_text, %1); @pemit %# = Filter reject text set.; @no %q0},{&amp;filter_reject %q0 = u(#300/clean_text, %1); @pemit %# = Filter reject text set.; }<br/>&amp;SHOW_MAIL_OPTIONS #25=$+show mail option*: @pemit %# = [setq(0, #300)][setq(1, u(%q0/get_format_option, get(%#/mail_config_options)))][setq(2, get(%vm/mailbox_%#))][switch(%q1, standard,{[u(%q0/equal_line)]%rUser mail configuration options:%r[u(%q0/dash_line)]%r})][rjust(Delete:, 15)]%b%b[u(%q0/get_delete_option, %#)]%r[rjust(Format:, 15)]%b%b%q1%r[rjust(Autoforward:, 15)]%b%b[ulocal(%q0/get_autoforward_option, %#)]%r[rjust(Timeout:, 15)]%b%b[ulocal(%q0/get_timeout_option, %#)]%r[rjust(Separator:, 15)]%b%b[switch(u(%q0/get_separator_option, %#), %b, space, return)]%r[rjust(Aliases:, 15)]%b%b[ulocal(%q0/get_personal_aliases, %#)]%r[rjust(Filters:, 15)]%b%b[ulocal(%q0/get_filter_count, %#)]%r[rjust(Folders:, 15)]%b%b[ulocal(%q0/get_folders, %#)]%r[rjust(Inbox:, 15)]%b%b[secure(ulocal(%q0/get_inbox, %#))]%r[rjust(Current Folder:, 15)]%b%b[switch(words(%q2), 0, secure(ulocal(%q0/get_inbox, %#)), secure(get(%q2/current_folder)))]%r[rjust(Vacation:, 15)]%b%b[switch(words(%q2), 0, &lt;none&gt;, switch(get(%q2/vacation),, &lt;none&gt;, u(%q2/vacation)))]%r[rjust(Reject:, 15)]%b%b[switch(words(%q2), 0, &lt;none&gt;, switch(get(%q2/reject_msg),, &lt;none&gt;, u(%q2/reject_msg)))]%r[rjust(Filter Reject:, 15)]%b%b[switch(words(%q2),0, &lt;none&gt;,switch(get(%q2/filter_reject),, &lt;none&gt;, u(%q2/filter_reject)))][switch(%q1, standard, {%r[u(#300/equal_line)]})]<br/>&amp;MAIL_CREDITS #300=$+mail credits: @pemit %# = Credits:%r%r%b%bTesting help, moral support[space(9)]- Kelson of CrystalMUSH%r%b%bIdea for +unread, .signature %r%b%b%b%b+mark, +unmark [space(19)]- Anastasia of TooMUSH%r%b%bBug fixes, additional help text[space(5)]- Zalcor of Singlenesia%r%b%bSuggested improvements and patience - Ambar      %r%b%bSpace option, author:&lt;name&gt;, subject:&lt;text&gt; keywords, +note and performance ideas%b - Amberyl      %r%r%b%b+mail, -, --, +proof, +toss, +send, +skim, +read, +delete (clear), +edit%r%b%bwere written from scratch, without seeing his code, but based on the%r%b%buser interface of the mailer written by F'jon of PernMUSH, with%r%b%bnumerous enhancements.%r%r%b%bThe credit/blame for the rest of the commands, goes to Brandy of %r%b%bCrystalMUSH.%r%r%b%bThis +mail code is available via anonymous FTP from %r%b%bftp.tinymush.org (205.226.195.2) in file:%r%b%b/pub/mud/tinymush/mushcode/mail/brandy_mailer.14%r%r%b%b(source code last updated [v(mail_version)])%r<br/>&amp;MAIL_CHANGES #300=$+mail changes: @pemit %# = Changes since version 13:%r%rUpdated to use some new 2.2 functions%rSome bug fixes (see source file for details)%rNew flag 'forwarded' on +read and +skim%rNew command '+include &lt;letter number or keyword&gt;' %rNew command '+check mail/all' %rNew special folder 'null' mail filters, meaning auto-discard%rNew admin command '+verify mail config'%rNew admin command '+set mail option RGA = yes | no'<br/>&amp;ADD_PERSONAL_ALIAS #300=$+add personal alias *=*: @swi/first [setq(0, get(%vm/mailbox_%#))][setq(5, get(%q0/alias-list))]1 = or(strmatch(escape(%0), *[*), strmatch(escape(%1), *[*)),{@pemit %# = u(nofunc)},strmatch(type(*[trim(%0)]), PLAYER),{@pemit %# = I'm sorry, but the alias you specified is the name of%ba player.},not(strmatch(type(%#), PLAYER)), {@pemit %# = u(not_player)}, eq(strlen(%0), 0),{@pemit %# = You must specify a name for the alias.},gt(words(%0), 1),{@pemit %# = The alias must be a single word.},gt(strlen(%0), 25), {@pemit %# = Sorry, personal alias names are restricted to a maximum of 25 characters.},gt(strlen([setq(2,[setq(3, %0)]filter(check_for_bad_chars, v(bad_chars)))]%q2), 0),{@pemit %# = Invalid character(s) %q2 detected in alias name.},eq(strlen(%1), 0),{@pemit %# = You need to specify a list of people to associate with the alias.},eq(strlen(%q0), 0),{@swi/first [setq(1, [ulocal(identify_to_list, {%1}, %vm)] [u(get_aliases, {%1}, #0, get(%vm/global-mail-aliases), )])]%q1 = *ABORT*,{@pemit %# = secure(after(before(%q1, ENDABORT), ABORT))},{@create %N's Mailbox; @set [setq(2, con(me))]%q2 = quiet; @drain %q2; &amp;debug_mail %q2 = +add personal alias %0=%1; @tel %q2 = %vm; &amp;mailbox_%# %vm = %q2; @tr %vm/add_mailbox = %q2; &amp;owner_dbref %q2 = %#; @startup %q2 = {@drain me; @no me}; @set %q2 = safe; &amp;mail-in-progress %q2 = false; &amp;current_folder %q2 = ulocal(get_inbox, %#); &amp;folder-list %q2 = get(%q2/current_folder); &amp;alias-list %q2 = [setq(3, lcstr(trim(%0)))]%q3; &amp;alias-%q3 %q2 = %q1; @pemit %# = '%q3' has been added as a personal mail alias.;@no %q2}},{@wait %q0 = {&amp;debug_mail %q0 = +add personal alias %0=%1; @swi/first [setq(1,[ulocal(identify_to_list, {%1}, %q0)] [u(get_aliases, {%1}, %q0, get(%vm/global-mail-aliases), %q5)])][setq(3, lcstr(trim(%0)))]1 = gt(match(%q5, %q3), 0),{@pemit %# = You already have a personal alias with this name. If you really mean to totally overwrite it, you should do a +remove personal alias %q3, followed by a +add personal alias%b%q3=&lt;list of people&gt;.; @no %q0},strmatch(%q1, *ABORT*),{@pemit %# = secure(after(before(%q1, ENDABORT), ABORT)); @no %q0},{&amp;alias-list %q0 = %q5 %q3; &amp;alias-%q3 %q0 = %q1; @pemit %# = '%q3' has been added as a personal mail alias.; @no %q0}}}<br/>&amp;ADD_PERSONAL_ALIAS_BLANK #300=$+add personal alias: @pemit %# = The syntax is +add personal alias &lt;alias&gt;=&lt;list of people&gt;.&amp;ADD_ALIAS_BLANK #300=$+add alias: @pemit %# = There are two varieties of mail distribution lists (aliases): personal and global. Personal aliases may be used only by you. Global aliases may be used by all. The syntax is:%r%r+add personal alias &lt;alias&gt;=&lt;list of people&gt; -or-%r+add global alias &lt;alias&gt;=&lt;list of people&gt;<br/>&amp;LIST_PERSONAL_ALIASES #300=$+list personal a*: @swi/first [setq(0, get(%vm/mailbox_%#))]strlen(%q0) = 0, {@pemit %# = You have no personal mail aliases defined.},{@wait %q0 = {&amp;debug_mail %q0 = +list personal aliases; @pemit %# = [setq(1, get(%q0/alias-list))][setq(2, u(get_format_option, get(%#/mail_config_options)))]switch(strlen(%q1), 0, You have no personal mail aliases defined.,{[switch(%q2, standard, {[u(equal_line)]%rList of [name(%#)]'s personal mail aliases:%r[u(dash_line)]%r})][iter(%q1, [lcstr(##)][switch(type(*##), PLAYER, {%b-%b( Warning: there is a player%bwith this name, therefore using this alias will send to%bthat player instead%b)%b})])][switch(%q2, standard, {%r[u(equal_line)]})]}); @no %q0}}<br/>&amp;LIST_ALIASES_BLANK #300=$+list alias*: @pemit %# = There are two varieties of mail distribution lists (aliases): personal and global. Personal aliases may be used only by you. Global aliases may be used by all. The syntax is:%r%r+list personal aliases -or-%r+list global aliases<br/>&amp;EXPAND_PERSONAL_ALIAS #300=$+expand personal alias *: @swi/first [setq(0, get(%vm/mailbox_%#))]0 = strlen(%q0),{@pemit %# = You do not have a personal mail alias defined with that name.},eq(strlen([setq(2,[setq(3, %0)]filter(check_for_bad_chars, v(bad_chars)))]%q2), 0),{@pemit %# = Invalid character(s) %q2 detected in alias name.},{@wait %q0 = {&amp;debug_mail %q0 = +expand personal alias %0; @pemit %# = [setq(1, get(%q0/alias-list))][setq(2, u(get_format_option, get(%#/mail_config_options)))][setq(3, get(%vm/global-mail-aliases))][setq(4, get(%q0/alias-%0))]switch(or(eq(strlen(%q1), 0), eq(match(%q1, %0), 0)), 1, You do not have a personal mail alias defined with that name.,{[switch(%q2, standard, {[u(equal_line)]%rExpansion of %N's personal mail alias '[lcstr(%0)]':[switch(type(*##), PLAYER, {%rWARNING: there is a player%bwith this name, therefore using this alias will send to%bthat player instead%b)%b})]%r[u(dash_line)]%r})][u(pretty_dist, u(get_aliases, {%q4}, %q0, %q3, %q1), %q0, %q1, %q3, u(snag_dbrefs, %q4))][switch(%q2, standard, {%r[u(equal_line)]})]}); @no %q0}}<br/>&amp;EXPAND_PERSONAL_ALIAS_BLANK #300=$+expand personal alias: @pemit %# = The syntax is +expand personal alias &lt;alias&gt;.<br/>&amp;EXPAND_ALIAS_BLANK #300=$+expand alias: @pemit %# = There are two varieties of mail distribution lists (aliases): personal and global. Personal aliases may be used only by you. Global aliases may be used by all. The syntax is:%r%r+expand personal alias &lt;alias&gt; -or-%r+expand global alias &lt;alias&gt;<br/>&amp;REMOVE_PERSONAL_ALIAS #300=$+remove personal alias *: @swi/first [setq(0, get(%vm/mailbox_%#))]1 = or(eq(strlen(%0), 0), eq(strlen(%q0), 0)),{@pemit %# = You do not have a personal mail alias defined with that name.},gt(strlen([setq(2,[setq(3, %0)]filter(check_for_bad_chars, v(bad_chars)))]%q2), 0),{@pemit %# = Invalid character(s) %q2 detected in alias name.},{@wait %q0 = {&amp;debug_mail %q0 = +remove personal alias %0; @swi/first [setq(1, get(%q0/alias-list))][setq(2, lcstr(%0))]or(eq(strlen(%q1), 0), eq(match(%q1, %0), 0)) = 1,{@pemit %# = You do not have a personal mail alias defined with that name.; @no %q0},{&amp;alias-list %q0 = squish(remove(%q1, %q2)); &amp;alias-%0 %q0 = ;  @pemit %# = '%q2' has been removed from your list of personal mail aliases.; @no %q0; }}}<br/>&amp;REMOVE_PERSONAL_ALIAS_BLANK #300=$+remove personal alias: @pemit %# = The syntax is +remove personal alias &lt;alias&gt;.<br/>&amp;REMOVE_ALIAS_BLANK #300=$+remove alias: @pemit %# = There are two varieties of mail distribution lists (aliases):  personal and global. Personal aliases may be used only by you. Global aliases may be used by all. The syntax is:%r%r+remove personal alias &lt;alias&gt; -or-%r+remove global alias &lt;alias&gt;<br/>&amp;EDIT_PERSONAL_ALIAS #300=$+edit personal alias *=*/*: @swi/first [setq(0, get(%vm/mailbox_%#))]0 = strlen(%q0), {@pemit %# = You do not have a personal mail alias defined with that name.},eq(strlen([setq(2,[setq(3, %0)]filter(check_for_bad_chars, v(bad_chars)))]%q2), 0),{@pemit %# = Invalid character(s) %q2 detected in alias name.},{@wait %q0 = {&amp;debug_mail %q0 = +edit personal alias %0=%1/%2; @swi/first [setq(1, lcstr(trim(%0)))][setq(2, lcstr(trim(%1)))][setq(3, trim(%2))][setq(4, u(purify_alias_list, get(%q0/alias-%q1)))][setq(5, get(%q0/alias-list))][setq(6, get(%vm/global-mail-aliases))][setq(7, lcstr(u(pretty_dist, u(get_aliases, %q4, %q0, %q6, %q5), %q0, %q5, %q6, u(snag_dbrefs, %q4))))]1 = eq(strlen(%q1), 0),{@pemit %# = You must specify a name for the alias you wish to edit.; @no %q0},gt(words(%q1), 1), {@pemit %# = The alias must be a single word.; @no %q0},eq(match(%q5, %q1), 0), {@pemit %# = You do not have a personal mail alias defined with that%bname.; @no %q0},eq(words(%q4), 0),{@tr me/cleanup_edit_mail_palias = %#, %q3, %q0, %q1},strmatch(%q2, $), {@tr me/cleanup_edit_mail_palias = %#,u(clean_dist, {%q4, %q3}), %q0,%q1},strmatch(%q2, ^), {@tr me/cleanup_edit_mail_palias = %#,u(clean_dist, {%q3, %q4}), %q0,%q1},strmatch(%q7, *%q2*), {@tr me/cleanup_edit_mail_palias = %#,u(clean_dist, edit(%q7, %q2, %q3)), %q0, %q1}, {@pemit %# = Unable to find '%q2' in current value for personal alias '%q1'.%b Please check the exact format by doing a '+expand personal alias %q1'.; @no %q0}}}<br/>&amp;CLEANUP_EDIT_MAIL_PALIAS #4167=@swi/first [setq(1, ulocal(identify_to_list, {%1}, %2))][setq(2, get(%vm/global-mail-aliases))][setq(3, get(%2/alias-list))][setq(4, u(get_aliases, {%1}, %2, %q2, %q3))]%q1 = *ABORT*, {@pemit %0 = secure(after(before(%q1, ENDABORT), ABORT)); @no %2},{&amp;alias-%3 %2 = %q1 %q4; @pemit %0 = switch(words(%q1 %q4), 0, {No names are associated with the specified alias.}, {Your '%3' personal alias has been updated and is now set to:%b [u(pretty_dist, %q4, %2, %q3, %q2, %q1)]}); @no %2}<br/><br/>&amp;LIST_GLOBAL_ALIASES #300=$+list global a*: @swi/first [setq(0, get(%vm/global-mail-aliases))]strlen(%q0) = 0, {@pemit %# = There are no global mail aliases defined.},{@pemit %# = [setq(1, u(get_format_option, get(%#/mail_config_options)))][switch(%q1, standard, {[u(equal_line)]%rList of global mail aliases:%r[u(dash_line)]%r})][iter(%q0, [lcstr(##)][switch(type(*##), PLAYER, {%b-%b( Warning:%b there is a player%bwith this name, therefore using this alias will send to%bthat player instead%b)%b})])][switch(%q1, standard, {%r[u(equal_line)]})]; }<br/>&amp;ADD_GLOBAL_ALIAS #300=$+add global alias *=*: @wait %vm = {&amp;debug_mail %vm = +add global alias %0=%1; @swi/first [setq(0, lcstr(trim(%0)))][setq(1, trim(%1))][setq(2, get(%vm/global-mail-aliases))]1 = or(strmatch(escape(%0), *[*), strmatch(escape(%1), *[*)),{@pemit %# = u(nofunc); @no %vm},and(get(#7/default_rga_option), not(hasflag(%#, wizard))), {@pemit %# = I'm sorry, creation of global aliases has been restricted to wizards.; @no %vm},strmatch(type(*%q0), PLAYER),{@pemit %# = I'm sorry, the alias you specified is the name of a%bplayer.; @no %vm},not(strmatch(type(%#), PLAYER)),{@pemit %# = u(not_player); @no %vm},eq(strlen(%q0), 0),{@pemit %# = You must specify a name for the global alias.; @no %vm},gt(strlen(%q0), 14), {@pemit %# = Sorry, global alias names are restricted to a maximum of 14 characters.;@no %vm},gt(strlen([setq(4,[setq(3, %0)]filter(check_for_bad_chars, v(bad_chars)))]%q4), 0),{@pemit %# = Invalid character(s) %q4 detected in alias name.; @no %vm},gt(words(%q0), 1), {@pemit %# = The global alias must be a single word.; @no %vm},eq(strlen(%q1), 0),{@pemit %# = You need to specify a list of people to associate%bwith the global alias.; @no %vm},gt(match(%q2, %q0), 0),{@pemit %# = A global already exists with this name.; @no %vm},{@swi/first [setq(3, [ulocal(identify_to_list, {%q1}, %vm)] [u(get_aliases, {%q1}, %0, %q2, )])]%q3 = *ABORT*,{@pemit %# = secure(after(before(%q3, ENDABORT), ABORT)); @no %vm},{&amp;global-mail-aliases %vm = %q2 %q0; &amp;alias-%q0 %vm = %q3; @pemit %# = '%q0' has been added as a global mail alias.; &amp;alias-%q0-created-by %vm = %# %N on [time()]; @no %vm}}}<br/>&amp;ADD_GLOBAL_ALIAS_BLANK #300=$+add global alias: @pemit %# = The syntax is +add global alias &lt;alias&gt;=&lt;list of people&gt;.<br/>&amp;EXPAND_GLOBAL_ALIAS #300=$+expand global alias *: @swi/first [setq(0, get(%vm/global-mail-aliases))]1 = gt(strlen([setq(1,[setq(3, %0)]filter(check_for_bad_chars, v(bad_chars)))]%q1), 0),{@pemit %# = Invalid character(s) %q1 detected in alias name.},or(eq(strlen(%0), 0), eq(strlen(%q0), 0), eq(match(%q0, %0), 0)),{@pemit %# = There is no global mail alias defined with that name.},{@pemit %# = [setq(1, u(get_format_option, get(%#/mail_config_options)))][setq(2, get(%vm/alias-%0))][switch(%q1, standard, {[u(equal_line)]%rExpansion of global mail alias '[lcstr(%0)]'%r( Last modified by [rest(get(%vm/alias-%0-created-by))] )[switch(type(*%0), PLAYER, {%rWARNING: there is a player%bwith this name, therefore using this alias will send to%bthat player instead%b)%b})]%r[u(dash_line)]%r})][u(pretty_dist, u(get_aliases, {%q2}, %vm, %q0, , ), %vm, , %q0, u(snag_dbrefs, %q2))][switch(%q1, standard, {%r[u(equal_line)]})]; }<br/>&amp;EXPAND_GLOBAL_ALIAS_BLANK #300=$+expand global alias: @pemit %# = The syntax is +expand global alias &lt;alias&gt;.<br/>&amp;EDIT_GLOBAL_ALIAS #300=$+edit global alias *=*/*: @wait %vm = {&amp;debug_mail %vm = +edit global alias %0=%1/%2; @swi/first [setq(0, trim(lcstr(%0)))][setq(1, lcstr(trim(%1)))][setq(2, trim(%2))][setq(4, u(purify_alias_list, get(%vm/alias-%q0)))][setq(6, get(%vm/global-mail-aliases))][setq(7, lcstr(u(pretty_dist, u(get_aliases, %q4, #0, %q6, ), #0, , %q6, u(snag_dbrefs, %q4))))]1 = gt(strlen([setq(5,[setq(3, %0)]filter(check_for_bad_chars, v(bad_chars)))]%q5), 0),{@pemit %# = Invalid character(s) %q5 detected in alias name.; @no %vm},[or(eq(strlen(%q0), 0),eq(strlen(%q6), 0),eq(match(%q6, lcstr(%q0)), 0))],{@pemit %# = There is no global mail alias defined with that name.; @no %vm},not(or(hasflag(%#, wizard),strmatch(%#,first(get(%vm/alias-%q0-created-by))))),{@pemit %# = I'm sorry, you may only edit global mail aliases%bthat you added. If you still desire to have the alias modified,%bplease contact the person who added the alias, or a wizard.; @no %vm},eq(words(%q4), 0),{@tr me/cleanup_edit_mail_galias = %#, %q2, %q0},strmatch(%q1, $),{@tr me/cleanup_edit_mail_galias = %#, u(clean_dist, {%q4, %q2}), %q0},strmatch(%q1, ^),{@tr me/cleanup_edit_mail_galias = %#, u(clean_dist, {%q4, %q2}), %q0},strmatch(%q7, *%q1*), {@tr me/cleanup_edit_mail_galias =%#,u(clean_dist, edit(%q7, %q1, %q2)), %q0},{@pemit %# = Unable to find '%q1' in current value for global alias '%q0'.%b Please check the exact format by doing a '+expand global alias %q0'.; @no %vm}}<br/>&amp;CLEANUP_EDIT_MAIL_GALIAS #4167=@swi/first [setq(1, ulocal(identify_to_list, {%1}, %vm))][setq(2, get(%vm/global-mail-aliases))][setq(3, u(get_aliases, {%1}, #0, %q2, ))]%q1 = *ABORT*, {@pemit %0 = secure(after(before(%q1, ENDABORT), ABORT)); @no %vm}, {&amp;alias-%2 %vm = %q1 %q3; &amp;alias-%2-created-by %vm = %0 [name(%0)] on [time()]; @pemit %0 = switch(words(%q1 %q3), 0, {No names are associated with the specified alias.}, {The '%2' global alias has been updated and is now set to:%b [u(pretty_dist, %q3, #0, , %q2, %q1)]}); @no %vm}<br/>&amp;SNAG_DBREFS #4167 = iter(%0, switch(##+[type(##)], #*+PLAYER, ##, ))<br/>&amp;REMOVE_GLOBAL_ALIAS #300=$+remove global alias *: @wait %vm = {&amp;debug_mail %vm = +remove global alias %0; @swi/first 1 = [setq(0, get(%vm/global-mail-aliases))][setq(1, lcstr(trim(%0)))]gt(strlen([setq(2,[setq(3, %0)]filter(check_for_bad_chars, v(bad_chars)))]%q2), 0),{@pemit %# = Invalid character(s) %q2 detected in alias name.; @no %vm},or(eq(strlen(%0), 0),eq(strlen(%q0), 0),eq(match(%q0, %0), 0)),{@pemit %# = There is no global mail alias defined with that name.; @no %vm},or(hasflag(%#, wizard),strmatch(%#, first(get(%vm/alias-%q1-created-by)))),{&amp;global-mail-aliases %vm = squish(remove(%q0, %q1)); &amp;alias-%0 %vm = ; &amp;alias-%q1-created-by %vm = ; @pemit %# = '%q1' has been removed from the list of global mail aliases.; @no %vm},{@pemit %# = I'm sorry, you may only remove global mail aliases%bthat you added. If you still desire to have the alias removed,%bplease contact the person who added the alias, or a wizard.; @no %vm}}<br/>&amp;REMOVE_GLOBAL_ALIAS_BLANK #300=$+remove global alias: @pemit %# = The syntax is +remove global alias &lt;alias&gt;.<br/>&amp;LIST_FOLDERS #300=$+list folders: @swi/first [setq(0, get(%vm/mailbox_%#))][setq(3, u(get_format_option, get(%#/mail_config_options)))]strlen(%q0) = 0,{@pemit %# = [switch(%q3, standard,{[u(equal_line)]%rList of %N's folders:%r%r})]Folder Name[space(5)]D-flag[space(5)]Marked[space(6)]Saved[space(2)]Timed Out[space(5)]Unread[space(6)]Total%r[u(dash_line)]%r[ljust(secure(ulocal(get_inbox, %#)), 21)]0[space(10)]0[space(10)]0[space(10)]0[space(10)]0[space(10)]0[switch(%q3, standard, {%r[u(equal_line)]})]},{@wait %q0 = {&amp;debug_mail %q0 = +list folders; @pemit %# = [switch(%q3, standard, {[u(equal_line)]%rList of %N's folders:%r})]Folder Name[space(5)]D-flag[space(5)]Marked[space(6)]Saved[space(2)]Timed Out[space(5)]Unread[space(6)]Total%r[u(dash_line)]; &amp;folder-list %q0 = squish(remove(get(%q0/folder-list), null)); @dolist get(%q0/folder-list) = {@pemit %# = [setq(2, get(%q0/in-list-##))][ljust(secure(lcstr(##)), 17)][switch(strlen(%q2), 0, [space(4)]0[space(10)]0[space(10)]0[space(10)]0[space(10)]0[space(10)]0, {[rjust(u(count_deleted_letters, %q0, %q2), 5)][rjust(u(count_marked_letters, %q0, %q2), 11)][rjust(u(count_saved_letters, %q0, %q2), 11)][rjust(ulocal(count_timed_out_letters, %q0, %q2), 11)][rjust(u(count_unread_letters, %q0, %q2), 11)][rjust(words(%q2), 11)]})]}; @swi 1 = 1,{@pemit %# = %rSelected folder:%b [u(get_active_folder, %q0)][switch(%q3, standard, {%r[u(equal_line)]})]; @no %q0}}}<br/>&amp;MOVE_LETTER_TO_FOLDER #300=$+move* to *: @swi/first [setq(0, get(%vm/mailbox_%#))][setq(5, lcstr(edit(trim(%1), %b, $)))]0 = strmatch(type(%#), PLAYER),{@pemit %# = u(not_player)},not(or(strmatch(escape(%0), *[*), strmatch(escape(%1), *[*))),{@pemit %# = u(nofunc)},strlen(%q0), {@pemit %# = u(nomail, ulocal(get_inbox, %#))},not(strmatch(%1, null)), {@pemit %# = Gimme a break, just +delete it. \;)}, eq(strlen([setq(2,[setq(3, %1)]filter(check_for_bad_chars, v(bad_chars)))]%q2), 0),{@pemit %# = Invalid character(s) %q2 detected in folder name.},{@wait %q0 = {&amp;debug_mail %q0 = +move%0 to %1; @swi/first [setq(6, u(get_folder_in_list, %q0))][setq(1, ulocal(expand_letter_range,%0,%q6, u(get_folder_current_letter, %q0)))][setq(1, u(filter_list, setunion(%q1, ), %q6))][setq(2, match(%q6, last(%q1)))][setq(2, switch(last(%q1), last(%q6), first(%q6), extract(%q6, add(%q2, 1), 1)))][setq(3, u(convert_nums, %q1, %q6))]0 = strlen(%1),{@pemit %# = You must specify a destination folder to move the mail to.; @no %q0},lte(strlen(%1), 16),{@pemit %# = Folder name specified is too long (maximum of 16 characters).; @no %q0},words(%q6),{@pemit %# = u(nomail, u(get_active_folder, %q0)); @no %q0},not(strmatch(%q1, *ABORT*)),{@pemit %# = after(before(%q1, ENDABORT), ABORT); @no %q0},words(%q1), {@pemit %# = u(no_match, +move, ulocal(format_request, trim(%0)), u(get_active_folder, %q0)); @no %q0},not(strmatch(%q5, get(%q0/current_folder))), {@pemit %# = The folder specified to move the letter(s) to is the current folder ([u(get_active_folder, %q0)]), no action needed.; @no %q0},match(get(%q0/folder-list), %q5), {&amp;folder-list %q0 = get(%q0/folder-list) %q5; &amp;in-list-%q5 %q0 = %q1; &amp;current_letter-%q5 %q0 = first(%q1); &amp;[setq(7, u(which_in_list, %q0))]%q7 %q0 = u(filter_list, setdiff(%q6, %q1), %q6); &amp;[setq(8, u(which_current_letter, %q0))]%q8 %q0 = switch(member(get(%q0/%q7), %q2), 0, first(get(%q0/%q7)), %q2); @pemit %# = Message(s) %q3[ulocal(format_request, trim(%0))] moved from folder '[u(get_active_folder, %q0)]' to newly created folder '[lcstr(%1)]'.; @no %q0}, {&amp;in-list-%q5 %q0 = squish([get(%q0/in-list-%q5)] %q1);&amp;current_letter-%q5 %q0 = first(get(%q0/in-list-%q5)); &amp;[setq(7, u(which_in_list, %q0))]%q7 %q0 = u(filter_list, setdiff(%q6, %q1), %q6); &amp;[setq(8, u(which_current_letter, %q0))]%q8 %q0 = switch(member(get(%q0/%q7), %q2), 0, first(get(%q0/%q7)), %q2); @pemit %# = Message(s) %q3[ulocal(format_request, trim(%0))] moved from folder '[u(get_active_folder, %q0)]' to folder '[lcstr(%1)]'.; @no %q0}}}<br/>&amp;MOVE_NO_PARAM #300=$+move:@pemit %# = There are two ways to +move one or more letters to another folder.%r%r1) +move to &lt;folder name&gt; - will move the current letter to the specified folder (example:%b +move to things to do)%r%r2) +move &lt;keyword or list of letters&gt; to &lt;folder name&gt; - will move the specified letters to the named folder.%r%rThe folder will be created if it doesn't already exist.%b See '+help move' for more details.<br/>&amp;ADD_FOLDER #300=$+add folder *: @swi/first [setq(0, get(%vm/mailbox_%#))][setq(1, edit(lcstr(%0), %b, $))]1 = strmatch(escape(%0), *[*),{@pemit %# = u(nofunc)},not(strmatch(type(%#), PLAYER)),{@pemit %# = u(not_player)},eq(strlen(%0), 0),{@pemit %# = You must specify a name for the folder.},strmatch(%0, null),{@pemit %# = Sorry, you cannot create a folder with the name of 'null'.},gt(strlen([setq(2, [setq(3, %0)]filter(check_for_bad_chars, v(bad_chars)))]%q2), 0),{@pemit %# = Invalid character(s) %q2 detected in folder name.},gt(strlen(%0), 16),{@pemit %# = Folder name specified is too long (maximum of 16 characters).},eq(strlen(%q0), 0),{@create %N's Mailbox; @set [setq(2, con(me))]%q2 = quiet; @drain %q2; &amp;debug_mail %q2 = +add folder %0; @tel %q2 = %vm; &amp;mailbox_%# %vm = %q2; @tr %vm/add_mailbox = %q2; &amp;owner_dbref %q2 = %#; @startup %q2 = {@drain me; @no me}; @set %q2 = safe; &amp;mail-in-progress %q2 = false; &amp;folder-list %q2 = setunion(%q1, ulocal(get_inbox, %#)); &amp;current_folder %q2 = ulocal(get_inbox, %#); @pemit %# = '[secure(%q1)]' has been added as a folder.;@no %q2},{@wait %q0 = {&amp;debug_mail %q0 = +add folder %0; @pemit %# = [setq(4, remove(get(%q0/folder-list), null))]switch(gt(match(%q4, %q1), 0), 1, You already have a folder with this name., '[secure(%q1)]' has been added as a folder.); &amp;folder-list %q0 = setunion(%q4 %q1, ); @no %q0}}<br/>&amp;REMOVE_FOLDER #300=$+remove folder*: @swi/first [setq(0, get(%vm/mailbox_%#))][setq(2, lcstr(edit(trim(%0), %b, $)))]1 = strmatch(escape(%0), *[*),{@pemit %# = u(nofunc)},strmatch(%q2, ulocal(get_inbox, %#)),{@pemit %# = You are not allowed to remove the designated 'inbox' folder.},eq(words(%0), 0), {@pemit %# = You must specify a name for the folder.},eq(strlen(%q0), 0), {@pemit %# = You do not have a folder defined with that name.},not(strmatch(type(%#), PLAYER)),{@pemit %# = u(not_player)},gt(strlen(%q0), 16),{@pemit %# = Folder name specified is too long (maximum of 16 characters).},gt(strlen([setq(1,[setq(3, trim(%0))]filter(check_for_bad_chars, v(bad_chars)))]%q1), 0),{@pemit %# = Invalid character(s) %q1 detected in folder name.},{@wait %q0 = {&amp;debug_mail %q0 = +remove folder%0; @swi/first 1 = [setq(1, get(%q0/folder-list))]or(eq(strlen(%q1), 0), eq(match(%q1, %q2), 0)),{@pemit %# = You do not have a folder defined with that name.; @no %q0},sign(strlen(get(%q0/in-list-%q2))),{@pemit %# = The folder specified is not empty and therefore cannot be removed.; @no %q0},{&amp;folder-list %q0 = squish(remove(%q1, %q2)); &amp;in-list-%q2 %q0 = ; &amp;current_letter-%q2 %q0 = ; &amp;current_folder %q0 = [setq(3, get(%q0/current_folder))]switch(%q2, %q3, ulocal(get_inbox, %#), %q3); @pemit %# = '[lcstr(trim(%0))]' has been removed from your list of folders.[switch(%q2, %q3,%b '[get(%q0/current_folder)]' is now the active folder)]; @no %q0}}}<br/>&amp;SELECT_FOLDER #300=$+select folder *: @swi/first [setq(0, get(%vm/mailbox_%#))][setq(2, lcstr(edit(%0, %b, $)))]1 = strmatch(escape(%0), *[*),{@pemit %# = u(nofunc)},eq(strlen(%0), 0), {@pemit %# = You must specify a name for the folder.},strmatch(%0, null),{@pemit %# = 'null' is an invalid folder name.},and(eq(strlen(%q0), 0), strmatch(%0, secure(ulocal(get_inbox, %#)))),{@pemit %# = '[lcstr(%0)]' is already the selected folder.},eq(strlen(%q0), 0), {@pemit %# = You do not have a folder defined with that name.},not(strmatch(type(%#), PLAYER)),{@pemit %# = u(not_player)},gt(strlen(%0), 16),{@pemit %# = Folder name specified is too long (maximum of 16 characters).},gt(strlen([setq(1,[setq(3, %0)]filter(check_for_bad_chars, v(bad_chars)))]%q1), 0),{@pemit %# = Invalid character(s) %q1 detected in folder name.},{@wait %q0 = {&amp;debug_mail %q0 = +select folder %0; @swi/first [setq(1, get(%q0/folder-list))]eq(match(%q1, %q2), 0) = 1, {@pemit %# = You do not have a folder defined with that name.; @no %q0},{@pemit %# = switch(get(%q0/current_folder), %q2, '[lcstr(%0)]' is already the selected folder., '[lcstr(%0)]' is now the selected folder.); &amp;current_folder %q0 = %q2; @no %q0}}}<br/>&amp;ADD_FILTER #300=$+add filter *=* folder*=*: @swi/first [setq(0, get(%vm/mailbox_%#))][setq(1, edit(lcstr(trim(%3)), %b, $))][setq(4, switch(trim(%0), s*, subject, a*, author, error))]1 = strmatch(%3, *reject*=*),,or(strmatch(escape(%0), *[*), strmatch(escape(%1), *[*), strmatch(escape(%3), *[*)), {@pemit %# = u(nofunc)},not(strmatch(type(%#), PLAYER)),{@pemit %# = u(not_player)},strmatch(%q4, error),{@pemit %# = You must specify the type of filter, author or subject.%b (syntax:%b +add filter author|subject=&lt;name or text&gt; folder=&lt;folder name&gt;)},eq(words(%1), 0),{@pemit %# = You must specify [switch(%q4, author, A player name to filter on, Some text to filter based on subject line)].%b (syntax:%b +add filter author|subject=&lt;name or text&gt; folder=&lt;folder name&gt;)}, and(strmatch(%q4, author), not(strmatch(type(*%1), PLAYER))),{@pemit %# = Name specified to filter based on author is not an existing player.},eq(words(%3), 0),{@pemit %# = You must specify a name for the folder.},gt(strlen([setq(2, [setq(3, %3)]filter(check_for_bad_chars, v(bad_chars)))]%q2), 0),{@pemit %# = Invalid character(s) %q2 detected in folder name.},gt(strlen(%3), 16),{@pemit %# = Folder name specified is too long (maximum of 16 characters).},eq(strlen(%q0), 0),{@create %N's Mailbox; @set [setq(2, con(me))]%q2 = quiet; @drain %q2; &amp;debug_mail %q2 = +add filter %0=%1 folder%2=%3;  @tel %q2 = %vm; &amp;mailbox_%# %vm = %q2; @tr %vm/add_mailbox = %q2; &amp;owner_dbref %q2 = %#; @startup %q2 = {@drain me; @no me}; @set %q2 = safe; &amp;mail-in-progress %q2 = false; &amp;%q4_filter %q2 = [switch(%q4, author, [num(*%1)], %1)]|%q1; &amp;current_folder %q2 = ulocal(get_inbox, %#); @pemit %# = Filter added.; @no %q2},{@wait %q0 = {&amp;debug_mail %q0 = +add filter %0=%1 folder%2=%3;  &amp;%q4_filter %q0 = trim([get(%q0/%q4_filter)]~[switch(%q4, author, [num(*%1)], %1)]|%q1,,~); @pemit %# = Filter added.; @no %q0}}<br/>&amp;REMOVE_FILTER #300=$+remove filter*: @swi/first [setq(0, get(%vm/mailbox_%#))]1 = strmatch(escape(%0), *[*),{@pemit %# = u(nofunc)},eq(words(%0), 0), {@pemit %# = You must specify which filter to remove.},eq(strlen(%q0), 0), {@pemit %# = You have no filters defined.},or(not(strmatch(trunc(%0), trim(%0))),lt(%0, 1),not(isnum(%0))),{@pemit %# = You must enter a non-zero integer.%b See +list filters for a list of valid numbers.}, {@wait %q0 = {&amp;debug_mail %q0 = +remove filter%0;  @swi/first 1 = [setq(1, get(%q0/author_filter))][setq(2, get(%q0/subject_filter))]gt(%0, add(words(%q1, ~), words(%q2, ~))), {@pemit %# = Filter specified does not exist.; @no %q0},gt(%0, words(%q1, ~)), {&amp;subject_filter %q0 = ldelete(%q2, sub(%0, words(%q1, ~)), ~); @pemit %# = Subject filter removed.; @no %q0}, {&amp;author_filter %q0 = ldelete(%q1, %0, ~);@pemit %# = Author filter removed.;@no %q0} }}<br/>&amp;LIST_FILTERS #300=$+list filters: @swi/first [setq(0, get(%vm/mailbox_%#))]strlen(%q0) = 0,{@pemit %# = You have no filters defined.},{@wait [setq(1, get(%q0/author_filter))][setq(2, get(%q0/subject_filter))][setq(3, u(get_format_option, get(%#/mail_config_options)))]%q0 = {&amp;debug_mail %q0 = +list filters;  @pemit %# = switch(add(words(%q1, ~), words(%q2, ~)), 0, You have no filters defined.,{[switch(%q3, standard, {[u(equal_line)]%r[center(List of Mail Filters, 78)]%r})][space(6)]Type[space(5)]Value[space(41)]Folder%r[u(dash_line)][iter(%q1, %r[rjust(member(%q1, ##, ~), 3)]\\)%b%bauthor%b%b%b[ljust(switch(type(before(##, |)), PLAYER, name(before(##, |)), destroyed player), 46)][ljust(secure(after(##, |)), 16)][switch(after(##, |), null, {%b\(discard\)},)],~)][iter(%q2, %r[rjust(add(words(%q1, ~), member(%q2, ##, ~)), 3)]\\)%b%bsubject%b%b[ljust(before(##, |), 46)][ljust(secure(after(##, |)), 16)][switch(after(##, |), null, {%b\(discard\)},)],~)][switch(%q3, standard, {%r[u(equal_line)]})]}); @no %q0}}<br/>&amp;GENERIC_INFO_RECORD #7=<br/>&amp;GENERIC_MAILBOX #7=<br/>&amp;PROCESS_INFO_RECORD #7=<br/>&amp;ADD_MAILBOX #7 = @swi/first [setq(0, v(mailboxes_num_of_attributes))][setq(1, add(1, v(mailboxes_num_of_attributes)))]gt(strlen(v(mailboxes_%q0)), v(overflow_point)) = 1, {&amp;mailboxes_num_of_attributes me = %q1; &amp;mailboxes_%q1 me = [v(mailboxes_%q1)] %0}, {&amp;mailboxes_%q0 me = sort([v(mailboxes_%q0)] %0, d)}<br/>&amp;MAKE_MAILBOX #7=@swi/first [setq(0, num(*%0))][setq(1, name(%q0))]0 = strmatch(type(%q0), PLAYER),{@pemit %1 = [capstr(%0)] is not a player.},strlen(v(mailbox_%q0)),{@create %q1's Mailbox; @set [setq(2, con(me))]%q2 = quiet; @drain %q2; &amp;debug_mail %q2 = make mailbox; @tel %q2 = me; &amp;mailbox_%q0 me = %q2; @tr %vm/add_mailbox = %q2; &amp;owner_dbref %q2 = %q0; @startup %q2 = {@drain me; @no me}; @set %q2 = safe; &amp;mail-in-progress %q2 = false; &amp;current_folder %q2 = ulocal(#300/get_inbox, %q0); &amp;folder-list %q2 = get(%q2/current_folder); @no %q2; @pemit %1 = Mailbox created for %q1.},{@pemit %1 = %q1 already has a mailbox.}<br/>&amp;MAKE_MAILBOX2 #7=<br/>&amp;DESTROY_MAILBOX #7=@wait me = {&amp;debug_mail me = destroy mailbox - parameters: %0, %1, %2, %3; &amp;mailbox_[setq(0, switch(isdbref(%0), 1, %0, num(*%0)))][setq(1, v(mailbox_%q0))]%q0 me=switch(get(%q1/owner_dbref), %q0,,v(mailbox_%q0)); @swi/first strlen(%q1) = 0, {@swi/first %2 = 0,{@pemit %1 = [name(%q0)] does not have a mailbox.; @no me},{@dolist lnum(v(mailboxes_num_of_attributes)) = {&amp;mailboxes_[add(1, ##)] me = squish(remove(v(mailboxes_[add(1, ##)]), %2))}; @swi 1 = 1, {&amp;weird_mailboxes me = [v(weird_mailboxes)] %q1/%2:%0-%1-%2-%3; @no me}}},{@swi/first and(strmatch(get(%q1/owner_dbref), %q0),or(strmatch(%2, 0),strmatch(%2, %q1))) = 1,{@dolist u(#300/get_all_in_lists, %q1) = {@tr #300/remove_letter = u(#300/get_src_dbref, %q1, ##), u(#300/get_src_num, %q1, ##), get(%q1/owner_dbref), %q1, ##, %b,+destroy mailbox}; @dolist get(%q1/out-list) = {@tr #300/retract_main = num(me), %q1, ##, %b}; @dolist lnum(v(mailboxes_num_of_attributes)) = {&amp;mailboxes_[add(1, ##)] me = squish(remove(v(mailboxes_[add(1, ##)]), %q1))}; @swi 1 = 1, {@swi 1 = 1, {@swi 1 = 1, {@destroy/override %q1; @pemit %1 = Mailbox for [name(%q0)] has been destroyed.; @no me}}}},{@pemit %1 = WARNING: mailbox_%q0 on the master mailbox does%bnot appear to contain the dbref of a mailbox object for the%bspecified player. Therefore, the 'mailbox' was NOT%bdestroyed. Someone should look into this. The mailbox has been moved to attribute 'weird_mailboxes' on the Master Mailbox.; @dolist lnum(v(mailboxes_num_of_attributes)) = {&amp;mailboxes_[add(1, ##)] me = squish(remove(remove(v(mailboxes_[add(1, ##)]), %q1), %2))}; @swi 1 = 1, {&amp;weird_mailboxes me = [v(weird_mailboxes)] %q1/%2:%0-%1-%2-%3; @no me}}}}<br/>@startup #7 = @drain me; @no me; @wait u(how_long_til_purge) = @tr me/periodic_letter_purge; @dolist v(global-mail-aliases)={&amp;alias-## me=s(u(cleanup_one_alias, ##))}<br/>&amp;cleanup_one_alias #7=iter(v(alias-%0), switch(strmatch(type(##), PLAYER), 1, ##,))<br/>&amp;HOW_LONG_TIL_PURGE #7 =[setq(0, v(day_[first(time())]))][setq(1, v(day_[mid(v(default_purge_time), 0, 3)]))][setq(2, mul(mid(extract(time(), 4, 1), 0, 2), 60))][setq(3, mul(mid(first(rest(v(default_purge_time))), 0, 2), 60))][setq(4, mid(extract(time(), 4, 1), 3, 2))][setq(5, mid(first(rest(v(default_purge_time))), 3, 2))][setq(6, add(%q2, %q4))][setq(7, add(%q3, %q5))]switch([eq(%q0, %q1)]+[gt(%q7, %q6)],1+1,mul(sub(%q7, %q6), 60),1+0,sub(604800, mul(sub(%q6, %q7), 60)),add(mul(u(full_days, %q0, %q1), 86400),mul(%q7, 60),mul(sub(1440, %q6), 60)))<br/>&amp;DAY_MON #7=1<br/>&amp;DAY_TUE #7=2<br/>&amp;DAY_WED #7=3<br/>&amp;DAY_THU #7=4<br/>&amp;DAY_FRI #7=5<br/>&amp;DAY_SAT #7=6<br/>&amp;DAY_SUN #7=7<br/>&amp;FULL_DAYS #7 =switch(gt(%0, %1),1,add(sub(6, %0), %1),sub(sub(%1, %0), 1))<br/>&amp;PERIODIC_LETTER_PURGE #7 = @swi/first v(default_timeout_option) = 0,{@wait 604800 = @tr me/periodic_letter_purge},{@tr me/purge_old_letters = first(v(mailboxes_1)), #7, 1, 1, v(mailboxes_1)}<br/>&amp;PURGE_OLD_LETTERS #7 = @wait me = {&amp;debug_mail me = purge_old_letters; @swi/first type(get(%0/owner_dbref)) = PLAYER, {@pemit %1 = Scanning [name(get(%0/owner_dbref))]'s mailbox for messages which have timed out.; @va me = u(#300/grab_timeout_value, get(%0/message_timeout), v(default_timeout_option)); @swi/first %va = 200000000,{@pemit %1 = %tTimeout capability disabled.; @tr me/move_to_next_mailbox = %1, %2, %3, %4; @va me = ; @no me},{@vb me = secs(); @vc me = 0; @swi gte(sub(%vb, convtime(get(get(%0/owner_dbref)/last))), %va) = 1,{@wipe %0/mail-in-progress-*;&amp;mail-in-progress %0 = false}; @dolist [iter(get(%0/folder-list), u(grab_letters, %0, ##))] ZZ = {@swi/first 1 = [setq(0, before(##, ~))][setq(1, after(##, ~))][setq(2, get(%0/in-%q0-time_read))][setq(3, strmatch(%q2, 0))][setq(4, eq(match(get(%0/in-%q0-flags), S), 0))][setq(5, gte(sub(%vb, convtime(get(u(get_src_dbref, %0, %q0)/out-[u(get_src_num, %0, %q0)]-time_sent))), %va))][setq(6, gte(sub(%vb, convtime(%q2)), %va))]strmatch(##, ZZ),{@swi 1 = 1,{@pemit %1 = %t%vc message(s) deleted.; @tr me/move_to_next_mailbox = %1, %2, %3, %4; @va me = ; @vb me = ; @vc me = ; @no me}},and(%q3, %q4, %q5),{@vc me = add(%vc, 1);@tr #300/remove_letter = u(get_src_dbref, %0, %q0), u(get_src_num, %0, %q0), get(%0/owner_dbref), %0, %q0, %q1,timeout A},and(not(%q3), %q4, %q6),{@vc me = add(%vc, 1); @tr #300/remove_letter = u(get_src_dbref, %0, %q0), u(get_src_num, %0, %q0), get(%0/owner_dbref), %0, %q0, %q1, timeout B}}}}, {@tr me/destroy_mailbox = get(%0/owner_dbref), num(me), %0, purge_old_letters;@pemit %1 = Mailbox belongs to dest'ed player.%b Mailbox destroyed.;@tr me/move_to_next_mailbox = %1, %2, %3, %4;@va me = ; @no me}}<br/>&amp;GRAB_LETTERS #7 = iter(get(%0/in-list-%1), ##~%1)<br/>&amp;MOVE_TO_NEXT_MAILBOX #7 = @wait me = {&amp;debug_mail me = move_to_next_mailbox; @swi/first 1 = gte(%2, words(%3)), {@swi/first lt(%1, v(mailboxes_num_of_attributes)) = 1,{@tr me/move_to_next_mailbox = %0, add(1, %1), 0, v(mailboxes_[add(1, %1)]); @no me },{@pemit %0 = Purge complete.; @no me; @wait u(how_long_til_purge) = @tr me/periodic_letter_purge}},{@tr me/purge_old_letters = extract(%3, add(1, %2), 1), %0, %1, add(1, %2), %3; @no me }}<br/>&amp;CHECK_FOR_BAD_CHARS #4167 = comp(pos(%0, %q3), #-1)<br/>&amp;BAD_CHARS #4167 = ' ` * ( ) = [ ] { } % | , &lt; &gt; / ? : ; "<br/>&amp;COUNT_UNREAD_LETTERS #4167 =words(iter(%1,switch(get(%0/in-##-time_read), 0, ##,)))<br/>&amp;COUNT_MARKED_LETTERS #4167 = words(iter(%1, switch(get(%0/in-##-flags), *m*, ##, )))<br/>&amp;COUNT_DELETED_LETTERS #4167 = words(iter(%1, switch(get(%0/in-##-flags), *d*, ##, )))<br/>&amp;COUNT_SAVED_LETTERS #4167 = words(iter(%1, switch(get(%0/in-##-flags), *s*, ##, )))<br/>&amp;COUNT_TIMED_OUT_LETTERS #4167 = [setq(0, get(%0/message_timeout))][setq(1, get(%vm/default_timeout_option))][setq(1, div(u(grab_timeout_value, %q0, %q1), 2))]words(iter(%1,[setq(2, get(%0/in-##-time_read))]switch(and(eq(match(get(%0/in-##-flags), s), 0), not(strmatch(%q2, 0)), gte(sub(secs(), convtime(%q2)), %q1)), 1, ##, )))<br/>&amp;OK_TO_DEST_MAILBOX #4167 =and(eq(words(u(get_all_in_lists, %0)), 0),eq(words(get(%0/out-list)), 0),strmatch(get(%0/mail-in-progress), false),get(%vm/delete_when_empty),lte(get(%0/semaphore), 0),not(hasattr(%0, alias-list)), not(hasattr(%0, author_filter)), not(hasattr(%0, subject_filter)), not(hasattr(%0, vacation)), not(hasattr(%0, reject_msg)), not(hasattr(%0, filter_reject)), not(hasattr(%0, autoforward)))<br/>&amp;GET_ALIASES #4167=setunion(iter(edit({%0},\\,,%b), switch(match(%3 %2, ##), 0,, ##)), )<br/>&amp;TEST_IF_ALIAS #4167=switch(match(get(%1/alias-list) [get(%vm/global-mail-aliases)], %0), 0, no, yes)<br/>&amp;EXPAND_ALIASES #4167=iter(u(expand_aliases2, %0, %1, %2, %3, %4),switch(and(isdbref(##), strmatch(type(##), PLAYER)), 1, ##, ))<br/>&amp;EXPAND_ALIASES2 #4167=iter(escape(trim(%0)),[setq(1, get(%1/alias-##))][setq(2, get(%vm/alias-##))][setq(3, get(%vm/global-mail-aliases))]switch(1, sign(match(%2, ##)),, sign(match(%4, ##)),{%q1 [u(expand_aliases, u(get_aliases, %q1, %1, %q3, %4), %1, %2 ##, %3, %4)]}, sign(match(%3, ##)), {%q2 [u(expand_aliases, u(get_aliases, %q2, %1, %q3, %4), %1, %2 ##, %3, %4)]},))<br/>&amp;PRETTY_DIST #4167=u(list_names, iter(%0 %4,switch(1,sign(match(%2, ##)),##&amp;(personal&amp;mail&amp;alias),sign(match(%3, ##)),##&amp;(global&amp;mail&amp;alias),strmatch(type(##), PLAYER), edit(name(##), %b, &amp;),)))<br/>&amp;IDENTIFY_TO_LIST #4167=squish(setunion(iter(u(identify_to_list2, %0), [setq(1, edit(##, &amp;, %b))]switch(1, strmatch(type(*%q1), PLAYER), num(*%q1), strmatch(u(test_if_alias, ##, %1), yes), ,ABORTOne$or$more$of$the$destinations$specified$is$not$a$player$or$mail$alias.ENDABORT.)),))<br/>&amp;IDENTIFY_TO_LIST2 #4167=iter({%0}, switch(type(*##), player, edit(##, %b, &amp;), ##), \,)<br/>&amp;FORMAT_NAMES #4167=u(format_names2, iter(%0, switch(##, #*, ##,)))<br/>&amp;FORMAT_NAMES2 #4167=switch(words(%0),0,,1, {[name(%0)]},2, {[name(first(%0))] and [name(rest(%0))]},{[iter(extract(%0, 1, sub(words(%0), 1)), {[name(##)],})] and [name(extract(%0, words(%0), 1))]})<br/>&amp;LIST_NAMES #4167=switch(words(%0), 0,, 1, {[edit(%0, &amp;, %b)]},2, {[edit(first(%0), &amp;, %b)] and [edit(rest(%0), &amp;, %b)]},{[edit(iter(extract(%0, 1, sub(words(%0), 1)), {##,}), &amp;, %b)] and [edit(extract(%0, words(%0), 1), &amp;, %b)]})<br/>&amp;SECURE_NAMES #4167=switch(words(%0),0,,1, {[secure(%0)]},2, {[secure(first(%0))] and [secure(rest(%0))]},{[iter(extract(%0, 1, sub(words(%0), 1)), {[secure(##)],})] and [secure(extract(%0, words(%0), 1))]})<br/>&amp;FREE_NUM #4167=first(sort(setdiff(lnum(add(words(%0), 1)), %0), N))<br/>&amp;EXPAND_LETTER_RANGE #4167=squish(switch(0, strlen(%1),,strlen(%0), switch(hasattr(%q0, in-%2-location), 1, %2, u(first_unread, %q0)),eq(%0, 0), [setq(3, iter(%0,switch(##, *-*, [setq(1, before(##, -))][setq(2, after(##, -))]switch(or(lte(%q1, 0), gt(%q2, words(%1)), lt(%q2, %q1)),1,ABORTInvalid message range specified.ENDABORT,lnum(%q1, %q2)),*..*, [setq(1, before(##, ..))][setq(2, after(##, ..))]switch(or(lte(%q1, 0), gt(%q2, words(%1)), lt(%q2, %q1)),1,ABORTInvalid message range specified.ENDABORT,lnum(%q1, %q2)),switch(or(lte(##, 0), gt(##, words(%1))),1,ABORTInvalid message number specified.ENDABORT,##))))]switch(%q3, *ABORT*, %q3, elements(%1, %q3)),switch(trim(%0), a*:*,[setq(1, trim(after(%0, :)))]switch(type(*%q1), PLAYER, squish(iter(%1, [setq(2, u(get_src_dbref, %q0, ##))]switch([get(%q2/out-[u(get_src_num, %q0, ##)]-sender)] [get(%q2/owner_dbref)], *[num(*%q1)]*, ##,))), ABORTAuthor specified is not a player.ENDABORT), s*:*,[setq(1, trim(after(%0, :)))]squish(iter(%1, switch(get(u(get_src_dbref, %q0, ##)/out-[u(get_src_num, %q0, ##)]-subject), *%q1*, ##))),s*,squish(iter(%1, switch(get(%q0/in-##-flags), *S*, ##,))),t*:*,[setq(1, trim(after(%0, :)))]squish(iter(%1, switch(get(u(get_src_dbref, %q0, ##)/out-[u(get_src_num, %q0, ##)]-text), *%q1*, ##))),a*, %1,f*, first(%1),p*, switch(%2, first(%1),ABORTYou have reached the beginning of your mail messages.ENDABORT,extract(%1, sub(match(%1, %2), 1), 1)),m*, squish(iter(%1, switch(get(%q0/in-##-flags), *M*, ##,))),c*, switch(hasattr(%q0, in-%2-location), 1, %2, u(first_unread, %q0)),u*, squish(iter(%1, switch(get(%q0/in-##-time_read), 0, ##, %b))), d*, squish(iter(%1, switch(get(%q0/in-##-flags), *D*, ##,))),n*, switch(%2,last(%1),ABORTYou have reached the end of your mail messages.ENDABORT,extract(%1, add(match(%1, %2), 1), 1)),l*, last(%1), ABORTInvalid keyword specified.ENDABORT)))<br/>&amp;GET_SRC_DBREF #4167 = first(get(%0/in-%1-location))<br/>&amp;GET_SRC_DBREF #7 = first(get(%0/in-%1-location))<br/>&amp;GET_SRC_NUM #7 = rest(get(%0/in-%1-location))<br/>&amp;GET_SRC_NUM #4167 = rest(get(%0/in-%1-location))<br/>&amp;FORMAT_REQUEST #4167=switch([setq(1, after(%0, :))]%0+[strlen(%0)], *+0,{%b( current )},a*:*,{%b( author: %q1 )},s*, {[switch(%0,*:*, {%b( subject: %q1 )}, {%b( saved )})]},t*:*,{[switch(%0,te*, {%b( text: %q1 )}, {%b( to: %q1 )}, )]},a*, {%b( all )},f*, {%b( first )},p*, {%b( previous )},m*, {%b( marked )},c*, {%b( current )},u*, {%b( unread )},d*, {%b( deleted )},l*, {%b( last )},n*, {%b( next )},)<br/>&amp;CONVERT_NUMS #4167=iter(%0, match(%1, ##))<br/>&amp;EXPAND_SINGLE_LETTER_RANGE #4167=squish(switch(%0+1, *+[eq(strlen(%1), 0)], ,*+[eq(strlen(%0), 0)], switch(hasattr(%q0, in-%2-location), 1, %2, u(first_unread, %q0)),*+[gt(words(%0), 1)],ABORTInput parameter may only be a single word.ENDABORT, *+[strmatch(%0, *-*)], ABORTRange specifier (-) not allowed for this command.ENDABORT, *+[strmatch(%0, *..*)], ABORTRange specifier (..) not allowed for this command.ENDABORT, *+[gt(%0, 0)], switch(or(gt(%0, words(%1)), not(strmatch(%0, sub(%0, 0)))),1, ABORTInvalid message number specified.ENDABORT,extract(%1, %0, 1)),f*, first(%1),l*, last(%1),p*, switch(%2, first(%1),ABORTYou have reached the beginning of your mail messages.ENDABORT,extract(%1, sub(match(%1, %2), 1), 1)),c*, switch(hasattr(%q0, in-%2-location), 1, %2, u(first_unread, %q0)),n*, switch(%2,last(%1),ABORTYou have reached the end of your mail messages.ENDABORT,extract(%1, add(match(%1, %2), 1), 1)),ABORTUnrecognized keyword specified.ENDABORT))<br/>&amp;EXPAND_OUTGOING_LETTER_RANGE #4167=squish(switch(0, strlen(%1),, strlen(%0), switch(hasattr(%q0, out-%2-text), 1, %2, last(%1)),eq(%0, 0), [setq(3, iter(%0,switch(##, *-*, [setq(1, before(##, -))][setq(2, after(##, -))]switch(or(lte(%q1, 0), gt(%q2, words(%1)), lt(%q2, %q1)),1,ABORTInvalid message range specified.ENDABORT,lnum(%q1, %q2)), *..*,[setq(1, before(##, ..))][setq(2, after(##, ..))]switch(or(lte(%q1, 0), gt(%q2, words(%1)), lt(%q2, %q1)),1,ABORTInvalid message range specified.ENDABORT,lnum(%q1, %q2)),switch(or(lte(##, 0), gt(##, words(%1))),1,ABORTInvalid message number specified.ENDABORT,##))))]switch(%q3, *ABORT*, %q3, elements(%1, %q3)),switch(trim(%0),te*:*,[setq(1, trim(after(%0, :)))]squish(iter(%1, switch(get(%3/out-##-text), *%q1*, ##))),t*:*,[setq(1, trim(after(%0, :)))][setq(2, num(*%q1))]switch(type(*%q1), PLAYER, squish(iter(%1, switch(match(get(%3/out-##-dist), %q2:*), 0,, ##))), ABORTName specified is not a player.ENDABORT), s*:*,[setq(1, trim(after(%0, :)))]squish(iter(%1, switch(get(%3/out-##-subject), *%q1*, ##))),a*, %1,f*, first(%1),p*, switch(%2, first(%1),ABORTYou have reached the beginning of your mail messages.ENDABORT,extract(%1, sub(match(%1, %2), 1), 1)),c*, switch(hasattr(%q0, out-%2-text), 1, %2, last(%1)),l*, last(%1), n*, switch(%2,last(%1),ABORTYou have reached the end of your mail messages.ENDABORT,extract(%1, add(match(%1, %2), 1), 1)), ABORTInvalid keyword specified.ENDABORT)))<br/>&amp;FILTER_LIST #4167=squish(switch(%0, *ABORT*, %0, iter(%1, switch(member(%0, ##), 0, , ##))))<br/>&amp;FIRST_UNREAD #4167=first([iter(u(get_folder_in_list, %0)),switch(get(%0/in-##-time_read), 0, %b##%b, %b))]%b[last(u(get_folder_in_list, %0)))])<br/>&amp;GET_DELETE_OPTION #4167=switch(get(%0/mail_config_options),*soft*, soft, *hard*, hard, get(%vm/default_delete_option))<br/>&amp;GET_FORMAT_OPTION #4167=switch(%0, *standard*, standard, *compact*, compact, get(%vm/default_format_option))<br/>&amp;GET_SEPARATOR_OPTION #4167=switch(get(%0/mail_config_options),*space*, %b,*return*, %r,switch(get(%vm/default_separator_option), space, %b, %r))<br/>&amp;GET_INBOX #4167=switch([setq(1, get(%0/mail_config_options))]%q1, *INBOX*, before(after(%q1, INBOX:), :INBOXEND), main)<br/>&amp;FOLDER_TO_STORE_INTO #4167=first([iter(get(%0/subject_filter), switch(strmatch(%2, *[before(##, |)]*), 1, after(##, |)), ~)] [iter(get(%0/author_filter), switch(strmatch(%1, [before(##, |)]), 1, after(##, |)), ~)] [ulocal(get_inbox, %3)])<br/>&amp;AUTOFORWARD_TEST #4167=[setq(1, get(%vm/mailbox_%0))][setq(2, get(%q1/autoforward))]switch(0, strlen(%q1), %0,strlen(%q2), %0,trim(setunion([u(snag_dbrefs, %q2)] [u(expand_aliases, %q2, %q1, %b, get(%vm/global-mail-aliases), get(%q1/alias-list))], )))<br/>&amp;GET_AUTOFORWARD_OPTION #4167=[setq(7, get(%vm/mailbox_%0))][setq(4, get(%q7/autoforward))][setq(8, get(%vm/global-mail-aliases))][setq(9, get(%q7/alias-list))]switch(0, strlen(get(%vm/mailbox_%0)), {Mail will not be autoforwarded},strlen(%q4), {Mail will not be autoforwarded},{Mail will be autoforwarded to [u(pretty_dist, u(get_aliases, %q4, %q7, %q8, %q9), %q7, %q9, %q8, u(snag_dbrefs, %q4))]})<br/>&amp;GET_PERSONAL_ALIASES #4167=switch([setq(1, get(%vm/mailbox_%0))][setq(2, get(%q1/alias-list))]0, strlen(%q1), No personal mail aliases defined, words(%q2), No personal mail aliases defined, u(list_names, trim(%q2)))<br/>&amp;GET_ACTIVE_FOLDER #4167 =secure(get(%0/current_folder))<br/>&amp;GET_FOLDERS #4167=switch([setq(1, get(%vm/mailbox_%0))]0, strlen(%q1), secure(ulocal(get_inbox, %0)), u(secure_names, trim(get(%q1/folder-list))))<br/>&amp;GET_FILTER_COUNT #4167 = switch([setq(1, get(%vm/mailbox_%0))]0, strlen(%q1), 0, add(words(get(%q1/author_filter), ~), words(get(%q1/subject_filter), ~)))<br/>&amp;WHICH_IN_LIST #4167 =in-list-[default(%0/current_folder, main)]<br/>&amp;WHICH_CURRENT_LETTER #4167 =current_letter-[default(%0/current_folder, main)]<br/>&amp;GET_ALL_IN_LISTS #4167 =iter(get(%0/folder-list), get(%0/in-list-##))<br/>&amp;GET_FOLDER_IN_LIST #4167 =get(%0/in-list-[default(%0/current_folder, main)])<br/>&amp;GET_FOLDER_CURRENT_LETTER #4167 =get(%0/current_letter-[default(%0/current_folder, main)])<br/>&amp;GET_TIMEOUT_OPTION #4167=[setq(1, get(%vm/mailbox_%0))][setq(2, get(%q1/message_timeout))][setq(3, get(%vm/default_timeout_option))][setq(4, div(%q3, v(seconds_in_day)))]switch([strlen(%q1)]+[strlen(%q2)]+%q2,0+*+*,switch([strlen(%q3)]+%q3, 0+*,{0 (timeout capability disabled system-wide)},*+0,{0 (timeout capability disabled system-wide)},{%q4 days}),*+0+*,switch([strlen(%q3)]+%q3, 0+*,{0 (timeout capability disabled system-wide)},*+0,{0 (timeout capability disabled system-wide)},{%q4 days}),*+*+0,0 (timeout capability disabled for this mailbox),{[div(%q2, v(seconds_in_day))] days})<br/>@startup #300 = @wipe me/mail_temp*; @startup me=<br/>&amp;GRAB_TIMEOUT_VALUE #4167 =switch(0, strlen(%0), switch(0, strlen(%1), 200000000, %1, 200000000, %1),%0, 200000000,%0)<br/>&amp;PURIFY_ALIAS_LIST #4167=squish(iter(%0, switch(##+[type(##)], #*+PLAYER, ##, #*,, ##)))<br/><br/><br/>+mail configuration<br/><br/>+verify mail config<br/><br/><br/><br/>
    </div>
</div>
<script type="text/javascript">
    var selectText = function(element) {
        var doc = document;
        var text = doc.getElementById(element);

        if (doc.body.createTextRange) { // ms
            var range = doc.body.createTextRange();
            range.moveToElementText(text);
            range.select();
        } else if (window.getSelection) { // moz, opera, webkit
            var selection = window.getSelection();
            var range = doc.createRange();
            range.selectNodeContents(text);
            selection.removeAllRanges();
            selection.addRange(range);
        }
    }

    $('a.select-all').click(function () {
        selectText('code');
    });
</script>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
</body>

</html>
<script src="../Scripts/Google.js" type="text/javascript"></script>