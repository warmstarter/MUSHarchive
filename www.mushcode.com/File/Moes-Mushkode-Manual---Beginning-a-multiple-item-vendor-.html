<!doctype html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>Code: Moe&#39;s Mushkode Manual - Beginning a multiple-item vendor.</title>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <!-- Apple devices fullscreen -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <!-- Apple devices fullscreen -->
    <meta names="apple-mobile-web-app-status-bar-style" content="black-translucent" />

    <!-- Bootstrap -->
	<link rel="stylesheet" href="../Theme/Flat/html/css/bootstrap.min.css">
	<!-- Bootstrap responsive -->
	<link rel="stylesheet" href="../Theme/Flat/html/css/bootstrap-responsive.min.css">
	<!-- jQuery UI -->
	<link rel="stylesheet" href="../Theme/Flat/html/css/plugins/jquery-ui/smoothness/jquery-ui.css">
	<link rel="stylesheet" href="../Theme/Flat/html/css/plugins/jquery-ui/smoothness/jquery.ui.theme.css">
	<!-- Theme CSS -->
	<link rel="stylesheet" href="../Theme/Flat/html/css/style.css">
	<!-- Color CSS -->
	<link rel="stylesheet" href="../Theme/Flat/html/css/themes.css">


    <link rel="stylesheet" href="../Content/site.css">

    <!-- jQuery -->
    <script src="../Theme/Flat/html/js/jquery.min.js"></script>
    <!-- Nice Scroll -->
    <script src="../Theme/Flat/html/js/plugins/nicescroll/jquery.nicescroll.min.js"></script>
    <!-- jQuery UI -->
    <script src="../Theme/Flat/html/js/plugins/jquery-ui/jquery.ui.core.min.js"></script>
    <script src="../Theme/Flat/html/js/plugins/jquery-ui/jquery.ui.widget.min.js"></script>
    <script src="../Theme/Flat/html/js/plugins/jquery-ui/jquery.ui.mouse.min.js"></script>
    <script src="../Theme/Flat/html/js/plugins/jquery-ui/jquery.ui.resizable.min.js"></script>
    <script src="../Theme/Flat/html/js/plugins/jquery-ui/jquery.ui.sortable.min.js"></script>
    <!-- slimScroll -->
    <script src="../Theme/Flat/html/js/plugins/slimscroll/jquery.slimscroll.min.js"></script>
    <!-- Bootstrap -->
    <script src="../Theme/Flat/html/js/bootstrap.min.js"></script>
    <!-- Form -->
    <script src="../Theme/Flat/html/js/plugins/form/jquery.form.min.js"></script>

    <!-- Theme framework -->
    <script src="../Theme/Flat/html/js/eakroko.min.js"></script>
    <!-- Theme scripts -->
    <script src="../Theme/Flat/html/js/application.min.js"></script>

    <!--[if lte IE 9]>
		<script src="js/plugins/placeholder/jquery.placeholder.min.js"></script>
		<script>
			$(document).ready(function() {
				$('input, textarea').placeholder();
			});
		</script>
	<![endif]-->

    <!-- Favicon -->
    <link rel="shortcut icon" href="http://www.mushcode.com/File/img/favicon.ico" />
    <!-- Apple devices Homescreen icon -->
    <link rel="apple-touch-icon-precomposed" href="http://www.mushcode.com/File/img/apple-touch-icon-precomposed.png" />

</head>

<body class="theme-green">
    <div id="navigation">
        <div class="container-fluid">
            <a href="../index.html" id="brand">MUSHCode.com</a>
        </div>
    </div>
    <div class="container-fluid" id="content">
        <div id="left">
            <div class="subnav">
                <div class="subnav-title">
                    <a href="Moes-Mushkode-Manual---Beginning-a-multiple-item-vendor-.html#" class='toggle-subnav'>
                        <i class="icon-angle-down"></i>
                        <span>About</span>
                    </a>
                </div>
                <ul class="subnav-menu">
                    <li>
                        <a href="../index.html">Overview</a>
                    </li>
                </ul>
            </div>
            <div class="subnav">
                <div class="subnav-title">
                    <a href="Moes-Mushkode-Manual---Beginning-a-multiple-item-vendor-.html#" class='toggle-subnav'>
                        <i class="icon-angle-down"></i>
                        <span>Files</span>
                    </a>
                </div>
                <ul class="subnav-menu">
                    <li class='dropdown'>
                        <a href="Moes-Mushkode-Manual---Beginning-a-multiple-item-vendor-.html#" data-toggle="dropdown">Code</a>
                        
<ul class="dropdown-menu">
        <li>
            <a href="../Category/Administration.html">Administration</a>
        </li>
        <li>
            <a href="../Category/Building.html">Building</a>
        </li>
        <li>
            <a href="../Category/Bulletin-Board.html">Bulletin Board</a>
        </li>
        <li>
            <a href="../Category/Combat.html">Combat</a>
        </li>
        <li>
            <a href="../Category/Dynamic-Space.html">Dynamic Space</a>
        </li>
        <li>
            <a href="../Category/Fonts.html">Fonts</a>
        </li>
        <li>
            <a href="../Category/Functions.html">Functions</a>
        </li>
        <li>
            <a href="../Category/Games.html">Games</a>
        </li>
        <li>
            <a href="../Category/Globals.html">Globals</a>
        </li>
        <li>
            <a href="../Category/Mail-Systems.html">Mail Systems</a>
        </li>
        <li>
            <a href="../Category/Other.html">Other</a>
        </li>
        <li>
            <a href="../Category/Schedulers.html">Schedulers</a>
        </li>
        <li>
            <a href="../Category/Time.html">Time</a>
        </li>
        <li>
            <a href="../Category/Vehicles.html">Vehicles</a>
        </li>
        <li>
            <a href="../Category/Vendors.html">Vendors</a>
        </li>
        <li>
            <a href="../Category/Weather-Systems.html">Weather Systems</a>
        </li>
</ul>
                    </li>
                    <li class='dropdown'>
                        <a href="Moes-Mushkode-Manual---Beginning-a-multiple-item-vendor-.html#" data-toggle="dropdown">Classes</a>
                        
<ul class="dropdown-menu">
        <li>
            <a href="../Category/Administration.html">Administration</a>
        </li>
        <li>
            <a href="../Category/Building.html">Building</a>
        </li>
        <li>
            <a href="../Category/Globals.html">Globals</a>
        </li>
        <li>
            <a href="../Category/Hardcode.html">Hardcode</a>
        </li>
        <li>
            <a href="../Category/Other.html">Other</a>
        </li>
        <li>
            <a href="../Category/Softcode.html">Softcode</a>
        </li>
</ul>
                    </li>
                    <li>
                        <a href="../Manuals.html">Manuals</a>
                    </li>
                </ul>
            </div>
            <div class="subnav">
                <div class="subnav-title">
                    <a href="Moes-Mushkode-Manual---Beginning-a-multiple-item-vendor-.html#" class='toggle-subnav'>
                        <i class="icon-angle-down"></i>
                        <span>Misc</span>
                    </a>
                </div>
                <ul class="subnav-menu">
                    <li>
                        <a href="../Ascii2Mu.html">ASCII To MUSHCode</a>
                    </li>
                    <li>
                        <a href="../MushList.html">MUSH/MUX List</a>
                    </li>
                    <li>
                        <a href="../MushRoom.html">MUSHRoom</a>
                    </li>
                </ul>
            </div>
            <div class="subnav">
                <div class="subnav-title">
                    <a href="Moes-Mushkode-Manual---Beginning-a-multiple-item-vendor-.html#" class='toggle-subnav'>
                        <i class="icon-angle-down"></i>
                        <span>Contribute</span>
                    </a>
                </div>
                <ul class="subnav-menu">
                    <li>
                        <a href="../Submit.html">Submit</a>
                    </li>
                </ul>
            </div>
        </div>
        <div id="main">
            <div class="container-fluid">
                <div class="breadcrumbs">
                    <ul>
                        
    <li>
        <a href="../index.html">Home</a>
        <i class="icon-angle-right"></i>
    </li>
    <li>
        <a href="../Category/Vendors.html">Vendors</a>
        <i class="icon-angle-right"></i>
    </li>
    <li>
        <a href="Moes-Mushkode-Manual---Beginning-a-multiple-item-vendor-.html#">Moe&#39;s Mushkode Manual - Beginning a multiple-item vendor.</a>
    </li>

                    </ul>
                </div>
                <div class="row-fluid">
                    <div class="span12">
                        



<div class="box">
    <div class="box-title title">
        <h2>
            Moe&#39;s Mushkode Manual - Beginning a multiple-item vendor.
        </h2>
    </div>
    <div class="box-content">

        <div class="description">
            <p></p>
        </div>

        <div class="author">
            <strong>Author:</strong>
                <a href="../Author/Moe.html">Moe</a>
        </div>

        <div class="author">
            <strong>Category:</strong>
            <a href="../Category/Vendors.html">Vendors</a>
        </div>

            <div class="commands">
            <strong>Commands:</strong>
                    <a href="../Command/@apayment.html" class="command">@apayment</a>,
                    <a href="../Command/@clone.html" class="command">@clone</a>,
                    <a href="../Command/@cost.html" class="command">@cost</a>,
                    <a href="http://www.mushcode.com/Command/@create" class="command">@create</a>,
                    <a href="http://www.mushcode.com/Command/@emit" class="command">@emit</a>,
                    <a href="../Command/@payment.html" class="command">@payment</a>,
                    <a href="http://www.mushcode.com/Command/@pemit" class="command">@pemit</a>,
                    <a href="http://www.mushcode.com/Command/@set" class="command">@set</a>.
            </div>

            <div class="functions">
                <strong>Functions:</strong>
                        <a href="../Function/and.html" class="function">and&#40;&#41;</a>,
                        <a href="../Function/art.html" class="function">art&#40;&#41;</a>,
                        <a href="../Function/capstr.html" class="function">capstr&#40;&#41;</a>,
                        <a href="../Function/center.html" class="function">center&#40;&#41;</a>,
                        <a href="../Function/controls.html" class="function">controls&#40;&#41;</a>,
                        <a href="../Function/edit.html" class="function">edit&#40;&#41;</a>,
                        <a href="../Function/extract.html" class="function">extract&#40;&#41;</a>,
                        <a href="../Function/hasattr.html" class="function">hasattr&#40;&#41;</a>,
                        <a href="../Function/iter.html" class="function">iter&#40;&#41;</a>,
                        <a href="../Function/lattr.html" class="function">lattr&#40;&#41;</a>,
                        <a href="../Function/lcstr.html" class="function">lcstr&#40;&#41;</a>,
                        <a href="../Function/match.html" class="function">match&#40;&#41;</a>,
                        <a href="../Function/member.html" class="function">member&#40;&#41;</a>,
                        <a href="../Function/not.html" class="function">not&#40;&#41;</a>,
                        <a href="../Function/or.html" class="function">or&#40;&#41;</a>,
                        <a href="../Function/orflags.html" class="function">orflags&#40;&#41;</a>,
                        <a href="../Function/repeat.html" class="function">repeat&#40;&#41;</a>,
                        <a href="../Function/set.html" class="function">set&#40;&#41;</a>,
                        <a href="../Function/setr.html" class="function">setr&#40;&#41;</a>,
                        <a href="../Function/setunion.html" class="function">setunion&#40;&#41;</a>,
                        <a href="../Function/sort.html" class="function">sort&#40;&#41;</a>,
                        <a href="../Function/switch.html" class="function">switch&#40;&#41;</a>,
                        <a href="../Function/u.html" class="function">u&#40;&#41;</a>,
                        <a href="../Function/v.html" class="function">v&#40;&#41;</a>.
            </div>


            <div class="servers">
                <strong>Compatibility:</strong>
                        <a href="../Server/CobraMUSH.html" class="server">CobraMUSH</a>,
                        <a href="../Server/PennMUSH.html" class="server">PennMUSH</a>,
                        <a href="../Server/TinyBit.html" class="server">TinyBit</a>,
                        <a href="../Server/TinyMUSH.html" class="server">TinyMUSH</a>,
                        <a href="../Server/TinyMUX.html" class="server">TinyMUX</a>.
            </div>

    </div>
</div>


<div class="box box-bordered box-condensed">
    <div class="box-title">
        <h3>
	        <i class="icon-reorder"></i>
	        MUSHCode for Moe&#39;s Mushkode Manual - Beginning a multiple-item vendor.
        </h3>
        <div class="actions">
	        <a class="btn btn-mini select-all" href="Moes-Mushkode-Manual---Beginning-a-multiple-item-vendor-.html#">
                    <i class="icon-resize-full"></i> Select Content
            </a>
        </div>
    </div>
    <div id="code" class="box-content content">
        ~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*<br/>|\    /|       |\    /|         |\    /|<br/>| \  / |       | \  / |         | \  / |<br/>|  \/  |oe's   |  \/  |ushkode  |  \/  |anual<br/>~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*<br/><br/>LESSON 4 - HOW MUCH IS THAT DOGGY IN THE WINDOW?<br/><br/>	In Lessons 1, 2, and 3, we learned a lot about the basics and<br/>fundamentals of mushcoding. We covered a variety of things, including<br/>setting of attributes, memory, nesting functions. A lot of stuff. At the<br/>end, we had a workable command, called mywho, that told us a comfortable<br/>amount of information about the players connected to our mush of choice.<br/>	In this lesson, we're going to go a wholly different direction,<br/>and explore what it takes to create that most sought-after of mushcode<br/>projects, the mushcode vendor. This vendor will sell items, cloning them<br/>from objects in its inventory. It will keep track of multiple costs, and<br/>handle multiple customers at once. It will be somewhat interactive, and<br/>hopefully fun to find in an RP situation.<br/><br/>DISCLAIMER AND BRIEF SPURT OF STREAMLINED EDUCATION<br/><br/>	Before I start teaching you to code the guts of a multi-item<br/>vendor, let me cover the absolute bare-bones basics of what makes a vendor<br/>work. There are three @commands, hardcoded into mushes, that do the work<br/>of a vendor. @cost, @pay, and @apay. They work on one item at a time, in<br/>general. Here is a brief rundown of how to set them up to sell just one<br/>item. I shall use a Horse seller as an example.<br/>@create Vendor		&lt;This creates a Vendor object.&gt;<br/>@create Horse		&lt;This creates a Horse object.&gt;<br/>@set Horse=chown_ok	&lt;This allows customers to chown the clone of their<br/>object&gt;<br/>give Vendor=Horse	&lt;This puts the Horse in the Vendor's inventory.&gt;<br/>@cost Vendor=50 	&lt;This sets the cost in pennies to buy a horse.&gt;<br/>@pay Vendor=You give the Horse seller your money.	&lt;Message shown when<br/>they pay the appropriate cost in pennies.&gt;<br/>@apay Vendor=@clone Horse;@emit Your horse is brought out for you.;wh<br/>%N=Please 'get Horse', then '@chown Horse', and finally '@set<br/>Horse=!halt'.		&lt;This is the work attribute. When someone pays the right<br/>number of pennies, it makes a clone of the Horse object, which is put in<br/>the same room as the Vendor. It gives a brief message that tells the<br/>customer what is happening, and then whispers to them instructions on how<br/>to make the object their own. This is a series of commands, separated by<br/>semicolons.&gt;<br/><br/>	There really isn't more to a single-object vendor than that. You<br/>can make fancier messages in your @pay and @apay. You can have lots of<br/>ansi, or other decorations. But, this is, in essence, all there is to a<br/>vendor. It's when you want to sell more than one item that it gets much<br/>trickier.<br/><br/>WHERE DO WE START??<br/><br/>	The first thing you always have to ask yourself when you're going<br/>to code something like this is: What do I want it to do? What capabilities<br/>do I want this particular piece of code to have? You must realize that you<br/>are approaching something that could be called a 'system', in that you<br/>have many different commands that potentially all work on the same set of<br/>data.<br/>	In this case, we are designing a vendor, so therefore we need to<br/>think of what a vendor can do. A vendor greets their customers. A vendor<br/>displays their wares. A vendor allows the customer to order something from<br/>the store. A vendor takes the money, and provides the item. It sounds like<br/>a lot, but in truth, many of those are combined into lumps of code, so<br/>they are smaller tasks than they sound.<br/>	The next question you need to ask yourself is how you're going to<br/>store your data. This one question can make or break your code. No<br/>pressure. What it really centres on is how your code is going to be<br/>written, so that it accomodates the data, which is hopefully stored in the<br/>most efficient manner possible. Since we are going to be dealing with<br/>multiple items, each with a name and cost. We can store all the<br/>information for each item in one attribute, on our vendor. We can do this<br/>most effectively by storing it as a |-separated list. An example for a<br/>Ball item would be:<br/><br/>&amp;item-ball vendor=10|A big red ball|It's very bouncy and fun to play with.<br/><br/>	This would tell us that the cost is 10 pennies, the name of the<br/>object is a big red ball, and that the description of the object is 'It's<br/>very bouncy and fun to play with.'. With one of these attributes for each<br/>item we have, we are able to reference only one attribute, and get all the<br/>information for that item our vendor is selling. If all of our items are<br/>stored in attributes that start with 'item-', then they will be easy to<br/>find using code on our vendor, as well.<br/><br/>LET'S GET STARTED<br/><br/>	Okay, obviously, we're going to need an object, upon which to put<br/>our code. On your mush of choice, type:<br/><br/>	@create Vendor<br/>	@set Vendor=!no_command   &lt;Or: @set Vendor=commands on TinyMUSH&gt;<br/><br/>	Now, we're ready to code. First off, let's decide on what our<br/>vendor is going to sell. In the hopes of excommunicating the<br/>I-don't-understand-mushcode demons, let's have our Vendor sell a Bell, a<br/>Book, and a Candle. And let's also code commands that allow our vendor to<br/>sell more things, and edit the existing things, later. We will need our<br/>three objects, to be held by the Vendor so that they can be cloned for use<br/>by our customers.<br/><br/>	@create Bell<br/>	@set Bell=chown_ok<br/>	@create Book<br/>	@set Book=chown_ok<br/>	@create Candle<br/>	@set Candle=chown_ok<br/>	give Vendor=Bell<br/>	give Vendor=Book<br/>	give Vendor=Candle<br/><br/>	There. Now our Vendor has the three objects it will sell. We set<br/>them chown_ok so that when they are given to the customer, the customer<br/>will be able to @chown the object, and own it(saving your quota, if<br/>enabled on your mush).<br/>	Something I often do in cases like this is set the Vendor with the<br/>Opaque flag, which allows(or forces) the customer to use your code to view<br/>the items and their costs. Let's start with that code, and build from<br/>there. We've established our data format above, so we can begin coding<br/>with that in mind.<br/>	We know this will be a command, for the purpose of listing the<br/>items, so we can start out with the basis of: <br/><br/>&amp;cmd_list Vendor=$list:@pemit %#=<br/><br/>	Not bad, eh? If you are familiar with mushcode, or you've studied<br/>the previous three lessons, all of that should make sense. If any of it<br/>doesn't, go back and study Lesson 1. From this point, we need to decide<br/>how we want to graphically represent our listing. We will call on a number<br/>of the skills we learned in Lessons 2 and 3, as involves cosmetic coding,<br/>and attribute retrieval.<br/>	First, let's make a graphical header. I don't suggest much, unless<br/>you really want to make your vendor distinctive. For this, I would do the<br/>following:<br/><br/>&amp;header Vendor=[repeat(=,78)]%R|[center(%0,76)]|%R[repeat(=,78)]<br/><br/>	So, if we passed 'List of Items' as %0, our output would look<br/>like:<br/><br/>==============================================================================<br/>|                                List of Items                               |<br/>==============================================================================<br/><br/>	Not fancy, but not bad either. We can now add a ufun call to our<br/>header function, to start off our list command.<br/><br/>&amp;cmd_list Vendor=$list:@pemit %#=u(header,List of Items)<br/><br/>	We're moving a bit slow to start, but here we're going to kick<br/>things off quite a bit. We're going to do some pretty heavy parsing in an<br/>iter(), pulling the list of attributes on our Vendor object that begin<br/>with item-, using the lattr() function and some wildcard-matching. I'm<br/>telling you all this to give you something to look forward to, of course.<br/>First, we're going to learn a new substitution, that works in iter(), as<br/>well as learning to use the extract() function.<br/><br/>## VS. #@<br/><br/>	There is another substitution in iter() that is quite helpful, and<br/>that is the #@ substitution. As ## represents the individual item in the<br/>list, #@ represents the position of that item in the list. Here is a quick<br/>example, to familiarize yourself with this functionality. Consider the<br/>following three snippets of code:<br/><br/>	iter(a b c d,##)<br/>	iter(a b c d,#@)<br/>	iter(a b c d,#@&gt; ##)<br/><br/>	If you 'think' or 'say' those pieces of code, you will get 'a b c<br/>d' for the first one, '1 2 3 4' for the second, and '1&gt; a 2&gt; b 3&gt; c 4&gt; d'<br/>for the third. This shows you what each substitution represents. The ##<br/>means the list item, itself, and the #@ means where in the list that item<br/>is, ordinally. We're going to use this to our advantage in our display of<br/>our items, as we're going to reference them on the list by number, rather<br/>than by name.<br/>	Matching by name is possible, but there are a number of things to<br/>learn before handling string matching on a regular basis, and I want to<br/>make this vendor as simple as possible. How the use of this #@<br/>substitution works for us is that lattr() will always pull the attributes<br/>in the same order, sorting them the best way it can, as we learned the<br/>sort(), setunion() and other related functions do. So, we can reference<br/>the items by their position in the list of item- attributes, in any<br/>command on our vendor! And while that sounds completely confusing, trust<br/>me, it will all make sense in a few minutes. I hope.<br/><br/>MAKING A LIST. CHECKING IT TWICE.<br/><br/>	Alright, we know that we have a list of attributes that we want to<br/>find. We need to setup this list, first. Let's write our command for<br/>adding items to our vendor's list, and then from that we will know further<br/>how our information is being stored and can retrieve it more<br/>effectively. Some initial things to think about. We need to restrict who<br/>can add and delete items on the list. I usually restrict this to admin,<br/>and the person who owns the object. We can do both of these tests like<br/>this: [or(orflags(%#,Wr),controls(%#,me))]<br/>	That code tests for one of two conditions. 1) The character<br/>performing the command has either the Wizard or Royalty<br/>flag.(orflags(%#,WZ) in TinyMUSH). 2) The character performing the command<br/>has privileges over the object. Wizards will pass both tests, of course,<br/>but the or() function means that if /either/ case is true(evaluates to 1),<br/>then it will return a 1. If neither case returns a true expression, then<br/>or() returns a 0. This is called a boolean logic function. Look at the<br/>help files on your mush of choice for functions like and() and not(), for<br/>more of this kind.<br/>	Since there will be at least two commands(adding and deleting<br/>items) that use this test for privileges, let's set this test in a small<br/>ufunction on our Vendor, to avoid having to type it out each time we need<br/>it. <br/><br/>&amp;fn-priv Vendor=[or(orflags(%#,Wr),controls(%#,me))]<br/><br/>	Yes, it will recognize the %# as being the character that used the<br/>command, even though it's in a ufunction. By setting this function, now<br/>all we need to do to test to see if someone has privileges on our object<br/>is to call u(fn-priv) and test to see if it returns a 1 or a 0. This is<br/>very efficient, and very maintainable. If someone wants to add different<br/>permissions to the Vendor, they only have to change the fn-priv attribute,<br/>rather than several different command attributes.<br/>	We established above what our format would look like for storing<br/>the data on our items, so let's figure out what the best way to put all<br/>three pieces of information into one command so that they all get set at<br/>once. We know that we need to have 1) the name of the item, 2) its cost,<br/>and 3) a description of the item. Figuring out the format of your commands<br/>can sometimes be the hardest part of your job as a coder. You want to be<br/>able to make it as user-friendly as possible, and at the same time, make<br/>it as functional as possible. <br/>	I am going to suggest a format for this lesson, and in your later<br/>coding endeavours, you can choose to do a different way. Quite often, the<br/>format that a coder uses to build their commands is as distinctive as a<br/>fingerprint. For this command, I would suggest using the format:<br/><br/>item-add &lt;simple name&gt;<br/>item-edit &lt;simple name&gt;=&lt;attribute&gt;/&lt;new value&gt;<br/><br/>	Two commands? You said you could do it in one! Are you nuts?? No.<br/>Well, maybe I am, but let me explain the madness to my particular method.<br/>If we tried to put a lot of information into one command, for example:<br/><br/>item-add &lt;full name of item&gt;=&lt;cost&gt;/&lt;description&gt;<br/><br/>	It would get both unwieldy, increase the chance of mistakes, and<br/>we would have to use the item-edit command anyways. As well, by specifying<br/>the full name of the item, we force ourselves to intuit a 'good' name to<br/>store the information. Intuition has its place, but mushcode isn't a good<br/>area to try it. By using two commands, we allow ourselves the luxury of<br/>having complete control over all aspects of our items, and we learn to do<br/>some list-manipulation in the process. Yay us.<br/>	Let's start on the item-add command first. We know we need to test<br/>to see if the person invoking the command has permission to do so, and we<br/>need to check to see if there is already an attribute that exists by that<br/>name. These are simple checks to perform, if we use the method of multiple<br/>cases for a switch() that we learned in lesson three. Consider the<br/>following code:<br/><br/>&amp;cmd_itemadd Vendor=$item-add *:@pemit<br/>%#=switch(u(fn-priv):[hasattr(me,item-%0)],0:*,You don't have permission<br/>to do that.,*:1,There is already an item by that name.,&lt;default&gt;)<br/><br/>	We did something different here that we haven't done before. We<br/>passed a parameter in the command itself. This works identically to the<br/>way it works when passing parameters in ufun's, in that they go into the<br/>command code in order from %0-%9. In this case, they are read in by<br/>wildcards. You can have up to ten wildcards, and each would read into a<br/>separate register. If we had done the long form of the item-add command I<br/>suggested above, it would look like:<br/><br/>&amp;cmd_itemadd Vendor=$item-add *=*/*:&lt;code&gt;<br/><br/>	In that case, the first * would be %0, the second %1, and the<br/>third %2. As it is with the command we are using, we only have one<br/>wildcard, and so therefore we only need to worry about %0. The<br/>hasattr() function tests to see if there is an attribute on 'me', the<br/>Vendor, named item-%0. Yes, this means that there should not be spaces in<br/>our name. There are two ways to fix this. One, we can test to see if there<br/>is more than one word in %0, or we can simply edit out the spaces,<br/>replacing with another character.<br/>	Personally, I prefer the latter, as it allows us to be more<br/>descriptive with our attributes, and we aren't forced to make up ball,<br/>ball2, ball3, ball4, and remember what each one is. I now introduce you to<br/>a trick that has been used for years in mushcoding, called<br/>space2tilde. This is a simple substitution that replaces any spaces in a<br/>string with the character '~', known as a tilde. The function works like<br/>this:<br/><br/>&amp;space2tilde Vendor=[edit(%0,%b,~)]<br/><br/>	Very simple. The edit() function works just like the @edit<br/>command, replacing the existing text with the new value. The<br/>edit() function is done on a string, rather than the value of an<br/>attribute. This makes it more flexible for something like this. If we<br/>implement this in our code, it now looks like:<br/><br/>&amp;cmd_itemadd Vendor=$item-add *:@pemit<br/>%#=switch(u(fn-priv):[hasattr(me,setr(0,item-[u(space2tilde,%0)]))],0:*,You<br/>don't have permission to do that.,*:1,There is already an item stored with<br/>that name.,&lt;default code&gt;)<br/><br/>	Yes, I did implement the setr() function, saving the value returned<br/>by our space2tilde function, prefixed by item-. I did this because, if there<br/>is not an attribute already with that name, we will be setting one later in<br/>this command, and this way, I can save the value returned by that function<br/>rather than having to run it again, each time I need that substitution done.<br/>	Now, we are at the point of writing the code for setting an attribute<br/>on our object. We will do this using the set() function, which is a<br/>side-effect function that works equivalent to the @set command. We know that<br/>there are three fields that we need to fill in: Cost, Fullname, and<br/>Description. These can be set with default values, and then edited later with<br/>our item-edit command.<br/>	In the spirit of configurability, we should make it possible for<br/>our vendor owner to easily change the default value for his vendor's<br/>items. This is done most easily by storing the value in an attribute on<br/>the vendor, named default_value:<br/><br/>&amp;default_value Vendor=10<br/><br/>	Once this is set, it can be easily referenced in our code, and<br/>allows the player to change it easily without having to edit long command<br/>attributes. The set() function takes the syntax:<br/><br/>	set(&lt;object&gt;,&lt;attribute&gt;:&lt;value&gt;)<br/><br/>	In our case, the object is 'me', since we're setting the attribute<br/>on our vendor object, and the attribute name will be %q0, the space2tilde<br/>edited version of our item name from earlier in the code. Our value will<br/>be the contents of the default_value attribute, a fullname that can be<br/>easily represented by %0, and a description. We can easily intuit the<br/>description by placing an article(a, an, the) before the fullname. Again,<br/>these are values which will likely be edited later.<br/>	How do we know which article to use? MUSH provides us with a function<br/>that will do that for us, thankfully. The art() function's sole purpose is to<br/>take a string, and return the proper article that should precede it. So, we<br/>shall determine our article for %0 by running it through the art() function.<br/>Because we also want it to be nicely formatted, we'll capitalize it, too.<br/>	So, our set() function looks like this:<br/><br/>set(me,%q0:[v(default_value)]|%0|[capstr(art(%0))] %0)<br/><br/>	After this function is done, we would deliver a message of success<br/>to the player, and remind them that if they wish to change any of the<br/>values, that they should use the item-edit command. The set() function<br/>returns no value, so we don't have to worry about where we put it in our<br/>code. So, now our command looks like: <br/><br/>&amp;cmd_itemadd Vendor=$item-add *:@pemit<br/>%#=switch(u(fn-priv):[hasattr(me,item-[setr(0,u(space2tilde,%0))])],0:*,You<br/>don't have permission to do that.,*:1,There is already an item stored with<br/>that name.,set(me,%q0:[v(default_value)]|%0|[capstr(art(%0))] %0)Your item<br/>has been added. Use the item-edit command to change any of the values.)<br/><br/>	Voila. A working item-add command. We could type: item-add red<br/>ball, and it would add an attribute to itself(the Vendor object), that<br/>looks like:<br/><br/>&amp;item-red~ball Vendor=10|red ball|A red ball<br/><br/>	Obviously, our next project is to write the item-edit command. In<br/>this command, we can recycle the majority of the code from the beginning<br/>of the item-add command, and add one more test case for our switch(). That<br/>test will be to verify that they are trying to edit a valid category,<br/>either Cost, Fullname, or Description. <br/>	We know that the attribute will be named cmd_itemedit, and that<br/>it's going on the Vendor object. We know that the syntax of the command is<br/>item-edit &lt;name&gt;=&lt;category&gt;/&lt;new value&gt;. We can guess from this that we<br/>will need three wildcards in our command, for each of the three variable<br/>pieces of data. And we know that we will need to do some list<br/>manipulation, taking out an old value and replacing it with a new one.<br/>	Overall, we know a fair amount. We can write over 80% of the<br/>command, with just this knowledge alone. Let's look at how our command<br/>would start to take shape, and then dive into some of the specific<br/>elements that we need to include:<br/><br/>&amp;cmd_itemedit Vendor=$item-edit *=*/*:@pemit<br/>%#=switch(u(fn-priv):[hasattr(me,setr(0,item-[u(space2tilde,%0)]))]:&lt;code<br/>to test category&gt;,0:*:*,You can't do that.,*:0:*,I don't have that<br/>item.,*:*:0,You must specify one of the following categories: Cost<br/>Fullname Description,&lt;code to edit list&gt;)<br/><br/>YOU CAN BE A MEMBER(), WITHOUT A SECRET HANDSHAKE!<br/><br/>	We have a list. Cost Fullname Description. This is the order of<br/>elements in our data-storage attributes. We would like to know if a<br/>string, %1 in this case, is the same as one of the items in our list. Even<br/>more than that, it would be useful if we could learn which item in the<br/>list our string matches, if any. Introducing: member(). This function is<br/>quite useful in a case like this, as it does precisely what we're looking<br/>for. It takes a list, compares some test data against the list, and if the<br/>test data is the same as any item in the list, it returns the position of<br/>the item it matches. It tells us which 'member' of the list is the same.<br/>	In using member(), it is necessary to allow for the case of your<br/>text, if it is a string. member() is case-sensitive, and we never have a<br/>guarantee that our users will type exactly what we want them to, so we<br/>must accomodate for this, whenever possible. In this case, the following<br/>code will suffice:<br/><br/>	member(cost fullname description,lcstr(%1))<br/><br/>	As we've learned previously, lcstr() converts all the characters<br/>in a string to lower-case. If the converted %1 is a member of our list, we<br/>will get back 1, 2, or 3. If it is not, we will get a 0. Within our<br/>switch(), if we test for 0 we are testing for the validity of the category<br/>specified. The result of the member() function should also be saved into a<br/>memory register, since we will want to use it later in our list<br/>manipulation code.<br/>	So, now our code would look something like this:<br/><br/>&amp;cmd_itemedit Vendor=$item-edit *=*/*:@pemit<br/>%#=switch(u(fn-priv):[hasattr(me,setr(0,item-[u(space2tilde,%0)]))]:[setr(1,member(cost<br/>fullname description,lcstr(%1)))],0:*:*,You can't do that.,*:0:*,I don't<br/>have that item.,*:*:0,You must specify one of the following categories:<br/>Cost Fullname Description,&lt;code to edit list&gt;)<br/><br/>I'LL MATCH() YOUR BET<br/><br/>	I bet you're asking, 'What if they only type in name, or desc,<br/>instead of the full category word?' Excellent question, dear reader. There<br/>is a way to accomodate for this, but it is somewhat trickier, as it opens<br/>up a different opportunity for error.<br/>	This is the wonderful world of pattern-matching. A large-scale<br/>example is taking a list of all of the words in Gone with the Wind, and<br/>finding out how many of them contain the letter 'e'. There are a number of<br/>ways to accomplish pattern-matching, but to begin with, we should just<br/>learn about the match() function. In theory, it works quite similarly to<br/>the member() function, however it extends to you the ability to use<br/>wildcards in your test data. For example:<br/><br/>match(cost fullname description,*name*) <br/><br/>	Would return '2', since our test data would match 'fullname', and<br/>neither of the other two. Similarly, we could test for *desc*, *os*,<br/>*full*, and any other logical combination, and have it work. Difficulties<br/>ensue when you have a condition like *e* or *t*. Either of which would<br/>conceivably match more than one item in our list. It's highly unlikely<br/>that our users would type in 'e' to mean fullname, but...typoes DO happen.<br/>It is a fact of mushing.<br/>	You may be asking why I surrounded the text with<br/>asterisks. Another excellent question. Since we don't know which fraction<br/>of the word the user may insert, we are safest by surrounding our test<br/>data with wildcards, thereby opening up a wider field of possible<br/>matches. name* would not match on fullname, where *name would. *desc would<br/>not match on description, whereas desc* would. *text* is safest, as it<br/>guarantees the maximum number of possible results. <br/>	Another benefit of match() is that it is case-insensitive, so<br/>*desc* will match Description, and description can be matched with *Desc*.<br/>This is more convenient in most cases than member(), though member() is a<br/>good idea if you want to limit the possibilities for input.<br/><br/><br/>SUMMARY<br/><br/>	Okay, in this first installment of the mushcode vendor tutorial,<br/>we've come a long way towards understanding how the system is going to<br/>work, though we haven't coded very much. I've handled a lot more<br/>individual details in this lesson than I have in previous tutorials, so<br/>that you can understand both methods to make things simple, and methods to<br/>make them highly-functional, while still accomplishing both with your<br/>present coding skill.<br/>	We've discussed how to format our commands, passing parameters in<br/>commands, developing ways to store our data so that many commands can<br/>access it logically, and accounting for issues such as privilege, and the<br/>vaguaries of user's input.<br/>	Finally, we learned some pattern-matching techniques that we can<br/>use on lists in any coding project. In our next lesson, we will continue<br/>to build upon the basic data structure we have, finish the item-edit<br/>command, and build the mechanics of the code that allows us to handle<br/>multiple items being sold by our vendor.<br/>
    </div>
</div>
<script type="text/javascript">
    var selectText = function(element) {
        var doc = document;
        var text = doc.getElementById(element);

        if (doc.body.createTextRange) { // ms
            var range = doc.body.createTextRange();
            range.moveToElementText(text);
            range.select();
        } else if (window.getSelection) { // moz, opera, webkit
            var selection = window.getSelection();
            var range = doc.createRange();
            range.selectNodeContents(text);
            selection.removeAllRanges();
            selection.addRange(range);
        }
    }

    $('a.select-all').click(function () {
        selectText('code');
    });
</script>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
</body>

</html>
<script src="../Scripts/Google.js" type="text/javascript"></script>