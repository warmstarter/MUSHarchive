<!doctype html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>Code: Moe&#39;s Mushkode Manual -  Finishing a multiple-item vendor.</title>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <!-- Apple devices fullscreen -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <!-- Apple devices fullscreen -->
    <meta names="apple-mobile-web-app-status-bar-style" content="black-translucent" />

    <!-- Bootstrap -->
	<link rel="stylesheet" href="../Theme/Flat/html/css/bootstrap.min.css">
	<!-- Bootstrap responsive -->
	<link rel="stylesheet" href="../Theme/Flat/html/css/bootstrap-responsive.min.css">
	<!-- jQuery UI -->
	<link rel="stylesheet" href="../Theme/Flat/html/css/plugins/jquery-ui/smoothness/jquery-ui.css">
	<link rel="stylesheet" href="../Theme/Flat/html/css/plugins/jquery-ui/smoothness/jquery.ui.theme.css">
	<!-- Theme CSS -->
	<link rel="stylesheet" href="../Theme/Flat/html/css/style.css">
	<!-- Color CSS -->
	<link rel="stylesheet" href="../Theme/Flat/html/css/themes.css">


    <link rel="stylesheet" href="../Content/site.css">

    <!-- jQuery -->
    <script src="../Theme/Flat/html/js/jquery.min.js"></script>
    <!-- Nice Scroll -->
    <script src="../Theme/Flat/html/js/plugins/nicescroll/jquery.nicescroll.min.js"></script>
    <!-- jQuery UI -->
    <script src="../Theme/Flat/html/js/plugins/jquery-ui/jquery.ui.core.min.js"></script>
    <script src="../Theme/Flat/html/js/plugins/jquery-ui/jquery.ui.widget.min.js"></script>
    <script src="../Theme/Flat/html/js/plugins/jquery-ui/jquery.ui.mouse.min.js"></script>
    <script src="../Theme/Flat/html/js/plugins/jquery-ui/jquery.ui.resizable.min.js"></script>
    <script src="../Theme/Flat/html/js/plugins/jquery-ui/jquery.ui.sortable.min.js"></script>
    <!-- slimScroll -->
    <script src="../Theme/Flat/html/js/plugins/slimscroll/jquery.slimscroll.min.js"></script>
    <!-- Bootstrap -->
    <script src="../Theme/Flat/html/js/bootstrap.min.js"></script>
    <!-- Form -->
    <script src="../Theme/Flat/html/js/plugins/form/jquery.form.min.js"></script>

    <!-- Theme framework -->
    <script src="../Theme/Flat/html/js/eakroko.min.js"></script>
    <!-- Theme scripts -->
    <script src="../Theme/Flat/html/js/application.min.js"></script>

    <!--[if lte IE 9]>
		<script src="js/plugins/placeholder/jquery.placeholder.min.js"></script>
		<script>
			$(document).ready(function() {
				$('input, textarea').placeholder();
			});
		</script>
	<![endif]-->

    <!-- Favicon -->
    <link rel="shortcut icon" href="http://www.mushcode.com/File/img/favicon.ico" />
    <!-- Apple devices Homescreen icon -->
    <link rel="apple-touch-icon-precomposed" href="http://www.mushcode.com/File/img/apple-touch-icon-precomposed.png" />

</head>

<body class="theme-green">
    <div id="navigation">
        <div class="container-fluid">
            <a href="../index.html" id="brand">MUSHCode.com</a>
        </div>
    </div>
    <div class="container-fluid" id="content">
        <div id="left">
            <div class="subnav">
                <div class="subnav-title">
                    <a href="Moes-Mushkode-Manual----Finishing-a-multiple-item-vendor-.html#" class='toggle-subnav'>
                        <i class="icon-angle-down"></i>
                        <span>About</span>
                    </a>
                </div>
                <ul class="subnav-menu">
                    <li>
                        <a href="../index.html">Overview</a>
                    </li>
                </ul>
            </div>
            <div class="subnav">
                <div class="subnav-title">
                    <a href="Moes-Mushkode-Manual----Finishing-a-multiple-item-vendor-.html#" class='toggle-subnav'>
                        <i class="icon-angle-down"></i>
                        <span>Files</span>
                    </a>
                </div>
                <ul class="subnav-menu">
                    <li class='dropdown'>
                        <a href="Moes-Mushkode-Manual----Finishing-a-multiple-item-vendor-.html#" data-toggle="dropdown">Code</a>
                        
<ul class="dropdown-menu">
        <li>
            <a href="../Category/Administration.html">Administration</a>
        </li>
        <li>
            <a href="../Category/Building.html">Building</a>
        </li>
        <li>
            <a href="../Category/Bulletin-Board.html">Bulletin Board</a>
        </li>
        <li>
            <a href="../Category/Combat.html">Combat</a>
        </li>
        <li>
            <a href="../Category/Dynamic-Space.html">Dynamic Space</a>
        </li>
        <li>
            <a href="../Category/Fonts.html">Fonts</a>
        </li>
        <li>
            <a href="../Category/Functions.html">Functions</a>
        </li>
        <li>
            <a href="../Category/Games.html">Games</a>
        </li>
        <li>
            <a href="../Category/Globals.html">Globals</a>
        </li>
        <li>
            <a href="../Category/Mail-Systems.html">Mail Systems</a>
        </li>
        <li>
            <a href="../Category/Other.html">Other</a>
        </li>
        <li>
            <a href="../Category/Schedulers.html">Schedulers</a>
        </li>
        <li>
            <a href="../Category/Time.html">Time</a>
        </li>
        <li>
            <a href="../Category/Vehicles.html">Vehicles</a>
        </li>
        <li>
            <a href="../Category/Vendors.html">Vendors</a>
        </li>
        <li>
            <a href="../Category/Weather-Systems.html">Weather Systems</a>
        </li>
</ul>
                    </li>
                    <li class='dropdown'>
                        <a href="Moes-Mushkode-Manual----Finishing-a-multiple-item-vendor-.html#" data-toggle="dropdown">Classes</a>
                        
<ul class="dropdown-menu">
        <li>
            <a href="../Category/Administration.html">Administration</a>
        </li>
        <li>
            <a href="../Category/Building.html">Building</a>
        </li>
        <li>
            <a href="../Category/Globals.html">Globals</a>
        </li>
        <li>
            <a href="../Category/Hardcode.html">Hardcode</a>
        </li>
        <li>
            <a href="../Category/Other.html">Other</a>
        </li>
        <li>
            <a href="../Category/Softcode.html">Softcode</a>
        </li>
</ul>
                    </li>
                    <li>
                        <a href="../Manuals.html">Manuals</a>
                    </li>
                </ul>
            </div>
            <div class="subnav">
                <div class="subnav-title">
                    <a href="Moes-Mushkode-Manual----Finishing-a-multiple-item-vendor-.html#" class='toggle-subnav'>
                        <i class="icon-angle-down"></i>
                        <span>Misc</span>
                    </a>
                </div>
                <ul class="subnav-menu">
                    <li>
                        <a href="../Ascii2Mu.html">ASCII To MUSHCode</a>
                    </li>
                    <li>
                        <a href="../MushList.html">MUSH/MUX List</a>
                    </li>
                    <li>
                        <a href="../MushRoom.html">MUSHRoom</a>
                    </li>
                </ul>
            </div>
            <div class="subnav">
                <div class="subnav-title">
                    <a href="Moes-Mushkode-Manual----Finishing-a-multiple-item-vendor-.html#" class='toggle-subnav'>
                        <i class="icon-angle-down"></i>
                        <span>Contribute</span>
                    </a>
                </div>
                <ul class="subnav-menu">
                    <li>
                        <a href="../Submit.html">Submit</a>
                    </li>
                </ul>
            </div>
        </div>
        <div id="main">
            <div class="container-fluid">
                <div class="breadcrumbs">
                    <ul>
                        
    <li>
        <a href="../index.html">Home</a>
        <i class="icon-angle-right"></i>
    </li>
    <li>
        <a href="../Category/Vendors.html">Vendors</a>
        <i class="icon-angle-right"></i>
    </li>
    <li>
        <a href="Moes-Mushkode-Manual----Finishing-a-multiple-item-vendor-.html#">Moe&#39;s Mushkode Manual -  Finishing a multiple-item vendor.</a>
    </li>

                    </ul>
                </div>
                <div class="row-fluid">
                    <div class="span12">
                        



<div class="box">
    <div class="box-title title">
        <h2>
            Moe&#39;s Mushkode Manual -  Finishing a multiple-item vendor.
        </h2>
    </div>
    <div class="box-content">

        <div class="description">
            <p></p>
        </div>

        <div class="author">
            <strong>Author:</strong>
                <a href="../Author/Moe.html">Moe</a>
        </div>

        <div class="author">
            <strong>Category:</strong>
            <a href="../Category/Vendors.html">Vendors</a>
        </div>

            <div class="commands">
            <strong>Commands:</strong>
                    <a href="../Command/@apayment.html" class="command">@apayment</a>,
                    <a href="../Command/@payment.html" class="command">@payment</a>,
                    <a href="http://www.mushcode.com/Command/@pemit" class="command">@pemit</a>.
            </div>

            <div class="functions">
                <strong>Functions:</strong>
                        <a href="../Function/after.html" class="function">after&#40;&#41;</a>,
                        <a href="../Function/capstr.html" class="function">capstr&#40;&#41;</a>,
                        <a href="../Function/center.html" class="function">center&#40;&#41;</a>,
                        <a href="../Function/controls.html" class="function">controls&#40;&#41;</a>,
                        <a href="../Function/edit.html" class="function">edit&#40;&#41;</a>,
                        <a href="../Function/extract.html" class="function">extract&#40;&#41;</a>,
                        <a href="../Function/first.html" class="function">first&#40;&#41;</a>,
                        <a href="../Function/get.html" class="function">get&#40;&#41;</a>,
                        <a href="../Function/gt.html" class="function">gt&#40;&#41;</a>,
                        <a href="../Function/hasattr.html" class="function">hasattr&#40;&#41;</a>,
                        <a href="../Function/ifelse.html" class="function">ifelse&#40;&#41;</a>,
                        <a href="../Function/isnum.html" class="function">isnum&#40;&#41;</a>,
                        <a href="../Function/iter.html" class="function">iter&#40;&#41;</a>,
                        <a href="../Function/last.html" class="function">last&#40;&#41;</a>,
                        <a href="../Function/lattr.html" class="function">lattr&#40;&#41;</a>,
                        <a href="../Function/lcstr.html" class="function">lcstr&#40;&#41;</a>,
                        <a href="../Function/ljust.html" class="function">ljust&#40;&#41;</a>,
                        <a href="../Function/match.html" class="function">match&#40;&#41;</a>,
                        <a href="../Function/member.html" class="function">member&#40;&#41;</a>,
                        <a href="../Function/name.html" class="function">name&#40;&#41;</a>,
                        <a href="../Function/or.html" class="function">or&#40;&#41;</a>,
                        <a href="../Function/orflags.html" class="function">orflags&#40;&#41;</a>,
                        <a href="../Function/repeat.html" class="function">repeat&#40;&#41;</a>,
                        <a href="../Function/replace.html" class="function">replace&#40;&#41;</a>,
                        <a href="../Function/set.html" class="function">set&#40;&#41;</a>,
                        <a href="../Function/setq.html" class="function">setq&#40;&#41;</a>,
                        <a href="../Function/setr.html" class="function">setr&#40;&#41;</a>,
                        <a href="../Function/switch.html" class="function">switch&#40;&#41;</a>,
                        <a href="../Function/u.html" class="function">u&#40;&#41;</a>,
                        <a href="../Function/v.html" class="function">v&#40;&#41;</a>,
                        <a href="../Function/words.html" class="function">words&#40;&#41;</a>,
                        <a href="../Function/xget.html" class="function">xget&#40;&#41;</a>.
            </div>


            <div class="servers">
                <strong>Compatibility:</strong>
                        <a href="../Server/CobraMUSH.html" class="server">CobraMUSH</a>,
                        <a href="../Server/PennMUSH.html" class="server">PennMUSH</a>,
                        <a href="../Server/TinyBit.html" class="server">TinyBit</a>,
                        <a href="../Server/TinyMUSH.html" class="server">TinyMUSH</a>,
                        <a href="../Server/TinyMUX.html" class="server">TinyMUX</a>.
            </div>

    </div>
</div>


<div class="box box-bordered box-condensed">
    <div class="box-title">
        <h3>
	        <i class="icon-reorder"></i>
	        MUSHCode for Moe&#39;s Mushkode Manual -  Finishing a multiple-item vendor.
        </h3>
        <div class="actions">
	        <a class="btn btn-mini select-all" href="Moes-Mushkode-Manual----Finishing-a-multiple-item-vendor-.html#">
                    <i class="icon-resize-full"></i> Select Content
            </a>
        </div>
    </div>
    <div id="code" class="box-content content">
        ~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*<br/>|\    /|       |\    /|         |\    /|<br/>| \  / |       | \  / |         | \  / |<br/>|  \/  |oe's   |  \/  |ushkode  |  \/  |anual<br/>~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*<br/><br/>LESSON 5: PAY NO ATTENTION TO THE MAN BEHIND THE CURTAIN!<br/><br/>	In our previous lesson, we dealt with the outline of a<br/>multiple-item vendor. This built on what we had learned in Lessons 1, 2,<br/>and 3, regarding how to make commands and approach coding problems. In<br/>Lesson 4, we decided how we were going to store our data, how we were<br/>going to set new items, and allowed ourselves the beginnings of a command<br/>to edit the data we had set.<br/>	In this lesson, we're going to finish our multiple item vendor, by<br/>finishing off all of the commands that we began in Lesson 4. You thought I<br/>was nuts, leaving them all half-finished, but in truth, I really did know<br/>what I was doing. I needed to show you all of the beginnings of those<br/>commands, so that you would have a much better understanding of where we<br/>were going and what we were doing.<br/><br/>LIST? WE DON'T NEED NO STEENKIN' LIST!<br/><br/>	Actually, yes we do. We began making our list, and we set up the<br/>theory for it, without the actual code. I told you in Lesson 4 that you<br/>had something to look forward to, as regarded iter() parsing, and so here<br/>it goes. We learned what #@ meant, which to remind you quickly is the<br/>substitution in iter() that tells us what numerical member of our list<br/>we're working on.<br/>	We're going to read the list of attributes on our vendor that<br/>start with item- and turn that into a displayed list of items sold in our<br/>shop. The lattr() function is what we shall use to do that. lattr(&lt;obj&gt;)<br/>will return to us the full list of attributes on an object. However, it<br/>also gives us the opportunity to specify a subset of attributes, by<br/>providing a pattern to match. Yes, in case you haven't figured it out yet,<br/>a hefty portion of how a mush works is based on pattern-matching.<br/>	lattr(&lt;obj&gt;/&lt;attr-pattern&gt;) is the syntax for matching only<br/>certain attribute names from an object. For this application, the lattr()<br/>is going to be run by our vendor, and looking for attributes that start<br/>with the pattern item-. So, that code looks like:<br/><br/>	lattr(me/item-*)<br/><br/>	Yes, it really is that simple. This will return the list we want.<br/>And we know we want to move through this list, so we will be using iter().<br/>Each time we pass through the list, we want to take the value of the<br/>attribute, display certain aspects of it, namely the fullname and the<br/>cost, and the close off our display with a graphical footer that will<br/>offset our graphical header we coded previously.<br/>	To recap, here is the code for our graphical header, and the way<br/>our data is stored:<br/><br/>	&amp;header Vendor=[repeat(=,78)]%R|[center(%0,76)]|%R[repeat(=,78)]<br/>	&amp;item-red~ball Vendor=10|red ball|A red ball<br/><br/>	Remember that these are default values. Cost, fullname, and<br/>description, respectively. Our item-edit command will edit these to more<br/>descriptive values later. Now, let's fire up our code brains, and put<br/>together our list command. I'll give you some code, and then we'll talk<br/>our way through it.<br/><br/>&amp;cmd_list Vendor=$list:@pemit %#=u(header,List of<br/>Items)%R%b[ljust(Item,25)]Cost%R%b[ljust(----,25)]----%R[iter(lattr(me/item-*),%b[ljust(#@&gt;<br/>[extract(setr(0,v(##)),2,1,|)],25)][first(%q0,|)],,%r)]%R=[repeat(-,76)]=<br/><br/>	Most of this should be comprehensible to you, particularly if you<br/>have read the sections of Lesson 3 that deal with cosmetic coding. If you<br/>need a refresher on those, I suggest you pause here, and re-read that<br/>Lesson. For those of you that are ready to plow on ahead, here's a brief<br/>recap of what that code does.<br/>	The command name is 'list', and we will pemit a display to the<br/>user. Our first item is the graphical header, which puts our text 'List of<br/>Items', in an ascii box. After that, we put some column headers, for Item<br/>and Cost. We put a little divider line under those, and then we get down<br/>to the listing of our items. We list the attributes on our vendor that<br/>start with item-. For a nice display, we are numbering the display so that<br/>it looks good, and we can incorporate this into our buying command later.<br/>	After that, we take the value of our attribute, set it to a<br/>temporary memory register(%q0), and then extract the second element of the<br/>|-separated list. This will be the fullname of the item. That text is<br/>left-justified to a cell of 25 spaces. This can be increased or decreased<br/>as necessary. After that bit of text has been justified, our cost is<br/>displayed. The cost element of our data attribute is the first element in<br/>the list, so we use the first() function. Note that we specified that<br/>we're using the | delimiter. Our iter() will output with a %r carriage<br/>return as the separator, which will put everything on its own line. After<br/>our display, I add a very simple ascii footer to the end.<br/>	This is generic code that can be used in any vendor situation, and<br/>easily modified to display a list of most anything. If you wanted to<br/>personalize it further, you could add elements like the name of the<br/>location to the header, since it will likely be your shop or restaraunt's<br/>name. You can do ansi on the names, the costs, or in the header itself.<br/><br/>IT'S BROKEN! IT DOESN'T DISPLAY ANYTHING! YOU'RE LYING TO ME!<br/><br/>	No, it's not broken. Yes, it displays precious little at the<br/>moment, and no, I'm not lying to you. What's causing the difficulty is<br/>that we haven't added our items to our vendor's memory yet. We'd decided<br/>to sell a Bell, a Book, and a Candle, in the spirit of banishing mushkode<br/>demons.<br/>	In our previous lesson, we had coded our item-add command, that<br/>checked to see if the player using the command had privileges on our<br/>vendor, and a few other tests. To refresh your memory, it wound up looking<br/>something like this:<br/><br/>&amp;cmd_itemadd Vendor=$item-add *:@pemit<br/>%#=switch(u(fn-priv):[hasattr(me,setr(0,item-[u(space2tilde,%0)]))],0:*,You<br/>don't have permission to do that.,*:1,There is already an item stored with<br/>that name.,set(me,item-%q0:[v(default_value)]|%0|A %0)Your item has been<br/>added. Use the item-edit command to change any of the values.)<br/><br/>&amp;fn-priv Vendor=[or(orflags(%#,Wr),controls(%#,me))]<br/><br/>&amp;space2tilde Vendor=[edit(%0,%b,~)]<br/><br/>	To review any of the logic that went into building that code,<br/>please see Lesson 4. With this code in place, let's use it to add our<br/>Bell, Book, and Candle. The commands should go something like this:<br/><br/>	item-add Bell<br/>	item-add Book<br/>	item-add Candle<br/><br/>	Now that we have those, you should be able to use your 'list'<br/>command, and get a display that looks something like this:<br/><br/>==============================================================================<br/>|                                List of Items                               |<br/>==============================================================================<br/> Item                   Cost<br/> ----                   ----<br/> 1&gt; Bell                10<br/> 2&gt; Book                10<br/> 3&gt; Candle              10<br/>=----------------------------------------------------------------------------=<br/><br/>	Now, we need to work on the item-edit command a bit more. We did<br/>leave it dangling about half-finished in our last lesson, but that was<br/>because we needed to establish more than a small amount of theory before<br/>we could go on. When last we left our item-edit code, it looked something<br/>like this:<br/><br/>&amp;cmd_itemedit Vendor=$item-edit *=*/*:@pemit<br/>%#=switch(u(fn-priv):[hasattr(me,setr(0,item-[u(space2tilde,%0)]))]:[setr(1,memb<br/>er(cost fullname description,lcstr(%1)))],0:*:*,You can't do that.,*:0:*,I<br/>don't have that item.,*:*:0,You must specify one of the following<br/>categories: Cost Fullname Description,&lt;code to edit list&gt;)<br/><br/>	We'd discussed using match() vs. member(), but because we would<br/>like to make the user be specific in what they enter, I suggest we leave<br/>it with member() for now. Another case for using match() would be if we<br/>wanted to do partial name-matching on the list of available items to edit.<br/>The ability to do 'item-edit red=cost/20' instead of typing out 'red ball'<br/>for the item's name. Again, this can cause some difficulties of multiple<br/>matches, and perhaps we will explore how to handle that in a later lesson.<br/>For now, let's keep it simple.<br/>	Again, if any of the logic or illogic of the previous code needs<br/>explaining, please refer back to Lesson 4. For now, let's focus on editing<br/>the list, assuming that all of the tests for validity that we established<br/>above have been passed. The basic theory for editing the list is going to<br/>go something like this:<br/><br/>1) Get the list from the attribute on the vendor.<br/>2) Replace the old data with the new data.<br/>3) Re-set the attribute on the vendor.<br/>4) Provide a message of confirmation to the user that the task has been<br/>done.<br/><br/>	Overall, not too tough. We'll get to learn a new list function as<br/>well. Let's start with these, in order. To begin with, we need to get the<br/>list from the attribute. When I keep saying list, I mean the data that is<br/>stored in our item-&lt;name&gt; attribute. It is a |-separated list. Everything<br/>in mushcode is a list, remember? Rule #1! Everything can be viewed as a<br/>list. So, this is the list to which I refer, frequently. Since this code<br/>is all on our vendor, we can use v(), instead of get() or xget().<br/>	We can begin our &lt;code&gt; section with: setq(2,v(%q0)). This pulls our<br/>space2tilde-edited attribute name into the v(), which gets the value of that<br/>attribute, and then sets it into %q2, without displaying it. Now that we have<br/>this data, we can begin to manipulate it. As I said above, step #2 is to<br/>replace the old data with the new data. Believe it or not, there is a<br/>replace() function that will let us do just that. And it is because of this<br/>function that I made sure we set into a q-register the results of our<br/>member() test at the beginning.<br/>	The replace() function works like this:<br/>replace(&lt;list&gt;,&lt;position&gt;,&lt;word&gt;,[&lt;delimiter&gt;]). So, we have our list,<br/>stored in %q2. We have our position, stored in %q1. And we have our new<br/>data, as %2. We know our delimiter is |. The work is simplicity itself.<br/>replace(%q2,%q1,%2,|) is all the code we need to put our new data into our<br/>existing list. Now, step #3 of our code is to set this into the attribute<br/>again, so that it can be used by our vendor. We will use the tried and<br/>true set() function that we have used many times before. So that now, our<br/>code is: set(me,%q0:[replace(%q2,%q1,%2,|)]). After that, we give a<br/>confirmation message that we have set the new data, and we are done. Our<br/>code becomes:<br/><br/>&amp;cmd_itemedit Vendor=$item-edit *=*/*:@pemit<br/>%#=switch(u(fn-priv):[hasattr(me,setr(0,item-[u(space2tilde,%0)]))]:[setr(1,memb<br/>er(cost fullname description,lcstr(%1)))],0:*:*,You can't do that.,*:0:*,I<br/>don't have that item.,*:*:0,You must specify one of the following<br/>categories: Cost Fullname Description,setq(2,v(%q0))<br/>[set(me,%q0:[replace(%q2,%q1,%2,|)])]The new [capstr(%1)] for %0 has<br/>been set to: %2)<br/><br/>	Yes, I beautified the text display to our user a bit, by<br/>capitalizing the element we were editing, but that's purely personal<br/>preference. Again, you could do it in flashing ansi, if you wanted(please<br/>don't), or any other series of options. Many variations on code such as<br/>this will display the old and the new data.<br/><br/>BUT WHAT IS IT??<br/><br/>	I could spend some time with you, doing various edits on our Bell,<br/>Book, and Candle that we have set, but I would like to move on. With the<br/>command coded and working, it should be just fine and you can do with them<br/>as you wish. For now, I want to move onto what should be the last two<br/>'commands' we need to code. One of them is quite simple, and that is a<br/>command to get a bit more info about each item on our list. We have the<br/>Description element of our data, and we haven't used that yet.<br/>	So, let's make a 'study &lt;item&gt;' command. I choose this name<br/>because look, examine, and view are all standard commands for mushes. view<br/>being softcoded and often +view, but I want something that isn't going to<br/>conflict with anything else on the game. The shop this vendor is in may<br/>have views set, and we don't want to interrupt them.<br/>	This command will be really simple, and instead of going through<br/>the step-by-step development, I shall show you the code, discuss the more<br/>technical aspects of it, and then we shall move on to our last command,<br/>the one that allows us to order an item from the vendor.<br/><br/>&amp;cmd-study Vendor=$study *:@pemit<br/>%#=ifelse(hasattr(me,setr(0,item-[u(space2tilde,%0)])),You study the<br/>[extract(setr(1,v(%q0)),2,1,|)]:%R%r[last(%q1,|)]%RCost:<br/>[first(%q1,|)],I'm sorry. There is no item by that name. Please type<br/>'list' to see what is sold.)<br/><br/>	This time, if the attribute exists, we tell them they're looking at<br/>the item, giving the fullname. We then present the last element of the list,<br/>which is our description. After that, we remind them of what it costs. If the<br/>attribute does not exist, we kindly tell them they have entered incorrect<br/>information, and direct them where to find the proper item name.<br/><br/>YOU WANT FRIES WITH THAT?<br/><br/>	Okay, now the moment we've all been waiting for. No, I don't mean<br/>when I'm done talking, I mean the point where we write the command to buy<br/>an item from our vendor. In truth, we already know a fair amount of the<br/>code we need to write this command. We need to test to see if we have the<br/>item they're ordering. Then we need to set the cost for the item, and set<br/>it up so that we have a temporary attribute which holds who the current<br/>customer is, and what they have ordered. For the purposes of this vendor,<br/>we will only serve one customer at a time. It's easier, and teaches us<br/>some more about error-trapping in our code.<br/>	Something else that we will include here is that we gave ourselves<br/>our listing by number, as well as by name. So, we should allow ourselves<br/>the ability to purchase an item by name, or by number. This adds one more<br/>test to our code, but is easily implemented.<br/>	We could name our command any number of things. Buy, Order,<br/>Purchase, Select, Choose, or any other synonym of what we're trying to<br/>achieve. I'm going to choose 'buy', again just because it's easiest. So,<br/>our attribute will be named cmd-buy, and our command will have the syntax:<br/>buy *. We will only have to test for two things before getting to the meat<br/>of our code. Do we have the item, and are we serving a customer currently?<br/><br/>&amp;cmd-buy Vendor=$buy *:@pemit<br/>%#=ifelse(isnum(%0),u(do-number,%0),switch(hasattr(me,setr(0,item-[u(space2tilde,%0)])):[hasattr(me,current)],0:*,That<br/>isn't an item that we sell here. Please type 'list' to see what is<br/>available.,*:1,I'm sorry. I'm working on another order right now.,&lt;code&gt;))<br/><br/>	This is the first half of our buy code. This checks to see if the<br/>item specified was given by numerical value first. isnum() returns 1 or 0<br/>if the data is numerical. This adds a ufun to our code, which we will<br/>construct in just a moment. If it is not a number, we test to see if we<br/>have the item, and checks to see if we have an attribute called current.<br/>This will be set in the later part of this command when we establish that<br/>our customer has selected a valid item and we aren't serving anyone else.<br/>Like I said, we should save the information of who our customer is, and<br/>what item they have ordered. Using set() again, we would do:<br/><br/>	set(me,current:%#|%q0)<br/><br/>	Yeah, pretty simple. This saves the dbref of our customer(just in<br/>case. It's always better to work with dbrefs for identification purposes<br/>than names), and the attribute name of the item they have selected. The<br/>next thing we need to do is set the cost attribute on our vendor to be the<br/>cost of the item. We will take the first value in the list, stored in the<br/>attribute. This code is:<br/><br/>	set(me,cost:[first(v(%q0),|)])<br/><br/>	Again, a simple implementation of the first() and set() functions.<br/>Now we are going to need to give some output to our customer, informing<br/>them of the need to pay for the item. We could save the cost value in a<br/>memory register, but it is just as simple to read it off of the Vendor<br/>when it is needed. <br/>	Let's build our do-number ufun now. It will behave almost<br/>identically to the text-only version of the command, but must be dealt<br/>with separately. Within this, we need to test to see if the number they<br/>entered is larger than the number of items we have on our list. If it is,<br/>we must inform them of their incorrect choice, and if not, we must select<br/>the proper item and do all of our appropriate code to it.<br/><br/>&amp;do-number Vendor=[ifelse(gt(%0,words(setr(9,lattr(me/item-*)))),I'm<br/>sorry. There aren't that many items for sale.,ifelse(hasattr(me,current),I'm<br/>sorry. I'm working on another order right now.,u(sell-item,extract(%q9,%0,1))))]<br/><br/>&amp;sell-item<br/>Vendor=[set(me,current:%#|%0)][set(me,cost:[first(v(%0),|)])]Thank you for<br/>your purchase. Please 'give [name(me)]=[v(cost)]' to get your item.<br/><br/>	Now, why did I do two ufuns you ask? Well, look at the code that<br/>is in the second ufun. This is code that we can use for the text-version<br/>of our buy command as well. Why do it twice, when we can do it once, and<br/>just pass the information to reusable code?<br/>So, now our command looks like:<br/><br/>&amp;cmd-buy Vendor=$buy *:@pemit<br/>%#=ifelse(isnum(%0),u(do-number,%0),switch(hasattr(me,setr(0,item-[u(space2tilde,%0)])):[hasattr(me,current)],0:*,I'm<br/>sorry. That isn't an item that we sell here. Please type 'list' to see what<br/>is available.,*:1,I'm sorry. I'm working on another order right<br/>now.,u(sell-item,%q0)))<br/><br/>	You could, if you wanted to, go back and put the number<br/>functionality into our study command, using very similar principles. I<br/>leave this to you to do, on your own. It would work much the same way as<br/>this buy command has.<br/>	Now, you'll notice that none of this code actually gives the item<br/>to our customer. This is absolutely correct, and very astute on your part<br/>for noticing. That is handled by the standard hardcoded methods for<br/>vendors that I discussed at the beginning of Lesson 4, and is why we set<br/>the cost attribute. When our customer pays our vendor the correct number<br/>of coins, they will trigger both the @pay and @apay attributes, which will<br/>provide the item needed. So, now we need to write those two attributes.<br/><br/>WHAT?? I THOUGHT WE WERE DONE?<br/><br/>	Ha, tricked you. Well, not quite. We're done writing commands.<br/>We're not done writing code. The @pay attribute is quite simple. It serves<br/>as the message that the player receives when they have paid the amount of<br/>pennies indicated in the @cost. We need to embed one small bit of code in<br/>there to extract the fullname of the item they are buying. We don't even<br/>need to do this, but it is a cosmetic and personal touch that some users<br/>find worthwhile, and it gives us another opportunity to interact with our<br/>current attribute. Within the @pay, though, is where we indicate to the<br/>user that they should 'get' their item(@clone only puts a copy in the same<br/>room as the cloner, not in the inventory), and @chown, and @set !halt.<br/><br/>@pay Vendor=Upon receiving your coin, [name(me)] sets<br/>[setr(0,extract(v(last(v(current),|)),2,1,|))] on the counter. Please 'get<br/>%q0', then '@chown %q0' and '@set %q0=!halt'. Thank you for shopping!<br/><br/>	There is nothing here that we haven't seen before. The most<br/>complex part is the v(last(v(current),|)). Remember that our current<br/>attribute has two parts. The dbref and the attribute name of the item<br/>ordered. We take the last part of that, after the |. This is the attribute<br/>name. We put that within a v(), which returns the value of that attribute.<br/>From that list, we extract the fullname.<br/>	Now on to the @apay. Remember back from the beginning of our<br/>Vendor's construction, we created our Bell, Book, and Candle, and put the<br/>items into the Vendor's inventory. This is important, because the Vendor<br/>has to be able to see them in order to @clone them. All of the items,<br/>including the vendor, have to be owned by the same PC to have privileges<br/>to @clone things, as well.<br/><br/>@apay Vendor=@clone<br/>edit(after(last(setr(0,v(current)),|),item-),~,%b);@emit name(me) puts<br/>[name(first(%q0,|))]'s order on the counter.;@wipe me/current<br/><br/>	Because we have taken care of reminding our customer to get,<br/>chown, and unhalt their object in our @pay attribute, we don't need to do<br/>it here. We use our stored dbref in the current attribute to personalize<br/>an emit for the benefit of anyone else in the store. Then, we wipe the<br/>current attribute so that we can serve another customer.<br/><br/>SUMMARY<br/><br/>	We stored our data for our items, using the item-add command. We<br/>personalized it, using the item-edit command. Both of these commands were<br/>developed so that they could only be used by those with the privilege to<br/>use them. From there, we developed a method by which we could track who<br/>our current customer was, through a 'buy' command. This command was the<br/>culmination of our multiple-item vendor, because it set the cost and<br/>current item being sold. We have taken the functionality of MUSH's<br/>hardcoded vendor code and expanded it. We're still selling one item at a<br/>time, but we are able to select from a larger number of possible items.<br/>	Our vendor clones from a set of master objects in its inventory,<br/>and prompts our user to take care of the ownership and flag maintenance on<br/>the object. And in the end, they get what they wanted, and we get money.<br/>What's better than that?<br/>	Lesson 6 is going to go a wholly different direction, and is going<br/>to be about the development of an IC time system, using vector math. We'll<br/>discuss a fair amount of division, in dividing up our time, and we'll<br/>cover how to do both 2:1 and 3:1 timescales.<br/>
    </div>
</div>
<script type="text/javascript">
    var selectText = function(element) {
        var doc = document;
        var text = doc.getElementById(element);

        if (doc.body.createTextRange) { // ms
            var range = doc.body.createTextRange();
            range.moveToElementText(text);
            range.select();
        } else if (window.getSelection) { // moz, opera, webkit
            var selection = window.getSelection();
            var range = doc.createRange();
            range.selectNodeContents(text);
            selection.removeAllRanges();
            selection.addRange(range);
        }
    }

    $('a.select-all').click(function () {
        selectText('code');
    });
</script>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
</body>

</html>
<script src="../Scripts/Google.js" type="text/javascript"></script>