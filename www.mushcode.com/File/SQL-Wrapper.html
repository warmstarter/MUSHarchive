<!doctype html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>Code: SQL Wrapper</title>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <!-- Apple devices fullscreen -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <!-- Apple devices fullscreen -->
    <meta names="apple-mobile-web-app-status-bar-style" content="black-translucent" />

    <!-- Bootstrap -->
	<link rel="stylesheet" href="../Theme/Flat/html/css/bootstrap.min.css">
	<!-- Bootstrap responsive -->
	<link rel="stylesheet" href="../Theme/Flat/html/css/bootstrap-responsive.min.css">
	<!-- jQuery UI -->
	<link rel="stylesheet" href="../Theme/Flat/html/css/plugins/jquery-ui/smoothness/jquery-ui.css">
	<link rel="stylesheet" href="../Theme/Flat/html/css/plugins/jquery-ui/smoothness/jquery.ui.theme.css">
	<!-- Theme CSS -->
	<link rel="stylesheet" href="../Theme/Flat/html/css/style.css">
	<!-- Color CSS -->
	<link rel="stylesheet" href="../Theme/Flat/html/css/themes.css">


    <link rel="stylesheet" href="../Content/site.css">

    <!-- jQuery -->
    <script src="../Theme/Flat/html/js/jquery.min.js"></script>
    <!-- Nice Scroll -->
    <script src="../Theme/Flat/html/js/plugins/nicescroll/jquery.nicescroll.min.js"></script>
    <!-- jQuery UI -->
    <script src="../Theme/Flat/html/js/plugins/jquery-ui/jquery.ui.core.min.js"></script>
    <script src="../Theme/Flat/html/js/plugins/jquery-ui/jquery.ui.widget.min.js"></script>
    <script src="../Theme/Flat/html/js/plugins/jquery-ui/jquery.ui.mouse.min.js"></script>
    <script src="../Theme/Flat/html/js/plugins/jquery-ui/jquery.ui.resizable.min.js"></script>
    <script src="../Theme/Flat/html/js/plugins/jquery-ui/jquery.ui.sortable.min.js"></script>
    <!-- slimScroll -->
    <script src="../Theme/Flat/html/js/plugins/slimscroll/jquery.slimscroll.min.js"></script>
    <!-- Bootstrap -->
    <script src="../Theme/Flat/html/js/bootstrap.min.js"></script>
    <!-- Form -->
    <script src="../Theme/Flat/html/js/plugins/form/jquery.form.min.js"></script>

    <!-- Theme framework -->
    <script src="../Theme/Flat/html/js/eakroko.min.js"></script>
    <!-- Theme scripts -->
    <script src="../Theme/Flat/html/js/application.min.js"></script>

    <!--[if lte IE 9]>
		<script src="js/plugins/placeholder/jquery.placeholder.min.js"></script>
		<script>
			$(document).ready(function() {
				$('input, textarea').placeholder();
			});
		</script>
	<![endif]-->

    <!-- Favicon -->
    <link rel="shortcut icon" href="http://www.mushcode.com/File/img/favicon.ico" />
    <!-- Apple devices Homescreen icon -->
    <link rel="apple-touch-icon-precomposed" href="http://www.mushcode.com/File/img/apple-touch-icon-precomposed.png" />

</head>

<body class="theme-green">
    <div id="navigation">
        <div class="container-fluid">
            <a href="../index.html" id="brand">MUSHCode.com</a>
        </div>
    </div>
    <div class="container-fluid" id="content">
        <div id="left">
            <div class="subnav">
                <div class="subnav-title">
                    <a href="SQL-Wrapper.html#" class='toggle-subnav'>
                        <i class="icon-angle-down"></i>
                        <span>About</span>
                    </a>
                </div>
                <ul class="subnav-menu">
                    <li>
                        <a href="../index.html">Overview</a>
                    </li>
                </ul>
            </div>
            <div class="subnav">
                <div class="subnav-title">
                    <a href="SQL-Wrapper.html#" class='toggle-subnav'>
                        <i class="icon-angle-down"></i>
                        <span>Files</span>
                    </a>
                </div>
                <ul class="subnav-menu">
                    <li class='dropdown'>
                        <a href="SQL-Wrapper.html#" data-toggle="dropdown">Code</a>
                        
<ul class="dropdown-menu">
        <li>
            <a href="../Category/Administration.html">Administration</a>
        </li>
        <li>
            <a href="../Category/Building.html">Building</a>
        </li>
        <li>
            <a href="../Category/Bulletin-Board.html">Bulletin Board</a>
        </li>
        <li>
            <a href="../Category/Combat.html">Combat</a>
        </li>
        <li>
            <a href="../Category/Dynamic-Space.html">Dynamic Space</a>
        </li>
        <li>
            <a href="../Category/Fonts.html">Fonts</a>
        </li>
        <li>
            <a href="../Category/Functions.html">Functions</a>
        </li>
        <li>
            <a href="../Category/Games.html">Games</a>
        </li>
        <li>
            <a href="../Category/Globals.html">Globals</a>
        </li>
        <li>
            <a href="../Category/Mail-Systems.html">Mail Systems</a>
        </li>
        <li>
            <a href="../Category/Other.html">Other</a>
        </li>
        <li>
            <a href="../Category/Schedulers.html">Schedulers</a>
        </li>
        <li>
            <a href="../Category/Time.html">Time</a>
        </li>
        <li>
            <a href="../Category/Vehicles.html">Vehicles</a>
        </li>
        <li>
            <a href="../Category/Vendors.html">Vendors</a>
        </li>
        <li>
            <a href="../Category/Weather-Systems.html">Weather Systems</a>
        </li>
</ul>
                    </li>
                    <li class='dropdown'>
                        <a href="SQL-Wrapper.html#" data-toggle="dropdown">Classes</a>
                        
<ul class="dropdown-menu">
        <li>
            <a href="../Category/Administration.html">Administration</a>
        </li>
        <li>
            <a href="../Category/Building.html">Building</a>
        </li>
        <li>
            <a href="../Category/Globals.html">Globals</a>
        </li>
        <li>
            <a href="../Category/Hardcode.html">Hardcode</a>
        </li>
        <li>
            <a href="../Category/Other.html">Other</a>
        </li>
        <li>
            <a href="../Category/Softcode.html">Softcode</a>
        </li>
</ul>
                    </li>
                    <li>
                        <a href="../Manuals.html">Manuals</a>
                    </li>
                </ul>
            </div>
            <div class="subnav">
                <div class="subnav-title">
                    <a href="SQL-Wrapper.html#" class='toggle-subnav'>
                        <i class="icon-angle-down"></i>
                        <span>Misc</span>
                    </a>
                </div>
                <ul class="subnav-menu">
                    <li>
                        <a href="../Ascii2Mu.html">ASCII To MUSHCode</a>
                    </li>
                    <li>
                        <a href="../MushList.html">MUSH/MUX List</a>
                    </li>
                    <li>
                        <a href="../MushRoom.html">MUSHRoom</a>
                    </li>
                </ul>
            </div>
            <div class="subnav">
                <div class="subnav-title">
                    <a href="SQL-Wrapper.html#" class='toggle-subnav'>
                        <i class="icon-angle-down"></i>
                        <span>Contribute</span>
                    </a>
                </div>
                <ul class="subnav-menu">
                    <li>
                        <a href="../Submit.html">Submit</a>
                    </li>
                </ul>
            </div>
        </div>
        <div id="main">
            <div class="container-fluid">
                <div class="breadcrumbs">
                    <ul>
                        
    <li>
        <a href="../index.html">Home</a>
        <i class="icon-angle-right"></i>
    </li>
    <li>
        <a href="../Category/Functions.html">Functions</a>
        <i class="icon-angle-right"></i>
    </li>
    <li>
        <a href="SQL-Wrapper.html#">SQL Wrapper</a>
    </li>

                    </ul>
                </div>
                <div class="row-fluid">
                    <div class="span12">
                        



<div class="box">
    <div class="box-title title">
        <h2>
            SQL Wrapper
        </h2>
    </div>
    <div class="box-content">

        <div class="description">
            <p>Softcode is ugly. So is SQL. But when you try and combine them, that&#39;s a real recipe for disaster. There are so many things to watch for when bridging the gap between mushcode and the database. You get tired pretty quickly of all the sqlescape()s you have to do, of losing where you are in a query because of too much interpolated softcode, escaping all the commas so that the sql() function doesn&#39;t think you&#39;re passing too many arguments, etc etc etc. The list goes on and on, and I&#39;m sure you can think of more problems to add. This whole process has bugged enough people that it&#39;s started to become a fad to use a wrapper. That&#39;s what I&#39;m here to describe and give you. With a proper wrapper, all your mushcode can stay mushcode, with no hint of SQL or sqlescape(), and all your SQL can stay SQL, with no hint of mushcode.</p>
        </div>

        <div class="author">
            <strong>Author:</strong>
                <span>
                    <a href="../Author/Walker@M-U-S-H.html">Walker</a>@<a href="../Source/M-U-S-H.html">M*U*S*H</a>
                </span>
        </div>

        <div class="author">
            <strong>Category:</strong>
            <a href="../Category/Functions.html">Functions</a>
        </div>

            <div class="commands">
            <strong>Commands:</strong>
                    <a href="http://www.mushcode.com/Command/@create" class="command">@create</a>,
                    <a href="http://www.mushcode.com/Command/@describe" class="command">@describe</a>,
                    <a href="http://www.mushcode.com/Command/@set" class="command">@set</a>.
            </div>

            <div class="functions">
                <strong>Functions:</strong>
                        <a href="../Function/add.html" class="function">add&#40;&#41;</a>,
                        <a href="../Function/before.html" class="function">before&#40;&#41;</a>,
                        <a href="../Function/config.html" class="function">config&#40;&#41;</a>,
                        <a href="../Function/elements.html" class="function">elements&#40;&#41;</a>,
                        <a href="../Function/eval.html" class="function">eval&#40;&#41;</a>,
                        <a href="../Function/firstof.html" class="function">firstof&#40;&#41;</a>,
                        <a href="../Function/if.html" class="function">if&#40;&#41;</a>,
                        <a href="../Function/inc.html" class="function">inc&#40;&#41;</a>,
                        <a href="../Function/localize.html" class="function">localize&#40;&#41;</a>,
                        <a href="../Function/map.html" class="function">map&#40;&#41;</a>,
                        <a href="../Function/mapsql.html" class="function">mapsql&#40;&#41;</a>,
                        <a href="../Function/regeditall.html" class="function">regeditall&#40;&#41;</a>,
                        <a href="../Function/setq.html" class="function">setq&#40;&#41;</a>,
                        <a href="../Function/setr.html" class="function">setr&#40;&#41;</a>,
                        <a href="../Function/sql.html" class="function">sql&#40;&#41;</a>,
                        <a href="../Function/sqlescape.html" class="function">sqlescape&#40;&#41;</a>,
                        <a href="../Function/strlen.html" class="function">strlen&#40;&#41;</a>,
                        <a href="../Function/switch.html" class="function">switch&#40;&#41;</a>,
                        <a href="../Function/u.html" class="function">u&#40;&#41;</a>,
                        <a href="../Function/v.html" class="function">v&#40;&#41;</a>.
            </div>

            <div class="features">
                <strong>Features:</strong>
                        <a href="../Feature/Poundlambda.html" class="feature">#lambda</a>.
            </div>

            <div class="servers">
                <strong>Compatibility:</strong>
                        <a href="../Server/CobraMUSH.html" class="server">CobraMUSH</a>,
                        <a href="../Server/PennMUSH.html" class="server">PennMUSH</a>.
            </div>

    </div>
</div>

    <div class="box box-color green box-condensed box-bordered">
	    <div class="box-title">
            <h3>Instructions</h3>
        </div>
	    <div class="box-content">
		    Copy and paste the below code into a compatible MUSH or MUX.
	    </div>
    </div>

<div class="box box-bordered box-condensed">
    <div class="box-title">
        <h3>
	        <i class="icon-reorder"></i>
	        MUSHCode for SQL Wrapper
        </h3>
        <div class="actions">
	        <a class="btn btn-mini select-all" href="SQL-Wrapper.html#">
                    <i class="icon-resize-full"></i> Select Code
            </a>
        </div>
    </div>
    <div id="code" class="box-content content">
        <br/>@@ SQL Wrapper object.<br/>@@<br/>@@ Version: 1.2.<br/>@@<br/>@@ Originally authored by: Walker@M*U*S*H<br/>@@<br/>@@ Documentation in docff format by Cheetah@M*U*S*H<br/>@@<br/>@@ Code placed into the public domain. Friday, June 13th, 2008.<br/>@@ Documentation placed into public domain. Tuesday, January 12th, 2010.<br/>@@<br/><br/>@create SQL Wrapper<br/>@set SQL Wrapper = NO_COMMAND<br/><br/>@DESCRIBE SQL Wrapper=SQL Wrapper. Detailed in a CPO post: http://community.pennmush.org/story/sql-prepared-statements-mushcode<br/><br/>&amp;GLOB2LIKE SQL Wrapper="[regeditall(sqlescape(%0),\[_\%\],\\$0,((?:\[^\\\\\]|^)(?:\\\\\\\\\\\\\\\\)*)(\[?\\*\]),$1[switch($2,\\?,_,\\*,\%)])]"<br/>&amp;GLOB2LIKE`CC SQL Wrapper=glob_pattern r:string:like_pattern func nodirect<br/>&amp;GLOB2LIKE`DOC SQL Wrapper=Turns GLOB_PATTERN (with *s and ?s) into a glob pattern fit for SQL's LIKE: * -&gt; "\%" and "?" -&gt; "_". This can be automatically applied to your bind variable if you prefix the ? with a _. (e.g: _?) - It still does an sqlescape(), so your query is safe when you use _?.<br/><br/>&amp;MAPQUERY SQL Wrapper=localize(setq(i,0)[mapsql(%0,u(prepare,%1,%2,%3,%4,%5,%6,%7,%8,%9),firstof(elements(%1,2,:),%r),elements(%1,3,:))])<br/>&amp;MAPQUERY`CC SQL Wrapper=attrname_options:name:*:args r:string:mapped_query<br/>&amp;MAPQUERY`DOC SQL Wrapper=With ATTRNAME_OPTIONS formatted as &lt;attrname&gt;\[:&lt;rowsep&gt;\[:&lt;dofieldnames&gt;\]\], performs an SQL query, mapping ARGS to its bind variables in SQL`NAME, using either bind method. Result rows are passed to &lt;attrname&gt; as \%1-\%9, with row number as \%0. (Much like mapsql()). &lt;rowsep&gt; defaults to \%r, and &lt;dofieldnames&gt; makes the first call to &lt;attrname&gt; have a rownum of 0 and \%1-\%9 are the names of the columns.%r%tSee `query' for details.<br/><br/>&amp;PREPARE SQL Wrapper=regeditall(firstof(v(sql`[before(%0,:)]`[config(sql_platform)]),v(sql`[before(%0,:)])),(\[_@\]?)\\?(?:&lt;(\\d+)&gt;)?,u(switch($1,_,glob2like,@,sqlarray,sqlescape),v(if(strlen($2),add($2,1),setr(i,inc(%qi))))))<br/>&amp;PREPARE`CC SQL Wrapper=name:*:args r:string:query nodirect qreg:i<br/>&amp;PREPARE`DOC SQL Wrapper=Fills in ARGS in a query in SQL`NAME, taking care of processing prefixes for ? and making sure all data is run through sqlescape().<br/><br/>&amp;QUERY SQL Wrapper=localize(setq(i,0)[sql(eval(me,prepare),firstof(elements(%0,2,:),%b),firstof(elements(%0,3,:),%b))])<br/>&amp;QUERY`CC SQL Wrapper=name_options:*:args r:string:query_result<br/>&amp;QUERY`DOC SQL Wrapper=With NAME_OPTIONS formatted as &lt;name&gt;\[:&lt;rowsep&gt;\[:&lt;colsep&gt;\]\], perform a query that returns results, with result rows separated by &lt;rowsep&gt;, cols by &lt;colsep&gt; (Both a space by default). ARGS are mapped onto the SQL query in `SQL`&lt;name&gt;' as follows:%r%rThe value of the attribute is an SQL query that matches one of two formats:%r%t1) Position-based bind variables: SQL queries that use a ? in place of non-hardcoded variables.%r%t2) Number-based bind variables: SQL queries that use ?&lt;0&gt; through ?&lt;7&gt; for bind variable position.%r%rSQL-Platform specific queries can be created by using `SQL`name`&lt;platform&gt;'. platform is the value of config(sql_platform). If it exists, it will be used instead of `SQL`name'.%r%r?s can be prefixed by _ to tell the parser to turn MUSH-style globs into SQL-style globs, as per `glob2like'.%r%r?s prefixed by a @ tell the parser that that argument is a space-separated list intended to be turned into an SQL Array. e.g, it turns '1 2 3' into '("1", "2", "3")'. (Remember, in SQL, "1" is the same as 1 when it works with numbers.) This is useful for "SELECT * FROM foo WHERE fooid IN @?" queries.<br/><br/>&amp;SQL SQL Wrapper=SQL tree. no_command.<br/>@set SQL Wrapper/SQL=no_command<br/><br/>&amp;SQLARRAY SQL Wrapper=([map(#lambda/"\[sqlescape(\%0)\]",%0,%b,\,)])<br/>&amp;SQLARRAY`CC SQL Wrapper=list r:string:sql_array func nodirect<br/>&amp;SQLARRAY`DOC SQL Wrapper=Turns LIST into an SQL array. Used to implement @? in `query' and co.<br/><br/>&amp;SQLESCAPE SQL Wrapper="[sqlescape(%0)]"<br/>&amp;SQLESCAPE`CC SQL Wrapper=string r:string:escaped_string func nodirect<br/>&amp;SQLESCAPE`DOC SQL Wrapper=Quick wrapper around sqlescape(), turning STRING into an escaped version safe for SQL.<br/><br/>&amp;UPDATE SQL<br/>Wrapper=localize(if(strlen(setr(0,eval(me,query))),%q0,firstof(sql(select last_insert_id()),1)))<br/>&amp;UPDATE`CC SQL Wrapper=name_options:*:args r:string:status_or_result<br/>&amp;UPDATE`DOC SQL Wrapper=Identical to `query', with the same format for NAME_OPTIONS and ARGS, but designed for queries that perform updates - If the result string is empty, `update' assumes success, and returns 1. For details see the documentation for `query'.<br/>
    </div>
</div>
<script type="text/javascript">
    var selectText = function(element) {
        var doc = document;
        var text = doc.getElementById(element);

        if (doc.body.createTextRange) { // ms
            var range = doc.body.createTextRange();
            range.moveToElementText(text);
            range.select();
        } else if (window.getSelection) { // moz, opera, webkit
            var selection = window.getSelection();
            var range = doc.createRange();
            range.selectNodeContents(text);
            selection.removeAllRanges();
            selection.addRange(range);
        }
    }

    $('a.select-all').click(function () {
        selectText('code');
    });
</script>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
</body>

</html>
<script src="../Scripts/Google.js" type="text/javascript"></script>