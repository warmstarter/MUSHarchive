<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<meta http-equiv="Content-Style-Type" content="text/css" />
		<meta name="generator" content="MediaWiki 1.15.3" />
		<meta name="robots" content="noindex,nofollow" />
		<meta name="keywords" content="Utilities (used to be &quot;Mylib.tf&quot;),Galvin&#039;s Virtual Array" />
		<link rel="shortcut icon" href="/favicon.ico" />
		<link rel="search" type="application/opensearchdescription+xml" href="/wiki/opensearch_desc.php" title="GwenWiki (en)" />
		<link rel="alternate" type="application/rss+xml" title="GwenWiki RSS Feed" href="/wiki/index.php?title=Special:RecentChanges&amp;feed=rss" />
		<link rel="alternate" type="application/atom+xml" title="GwenWiki Atom Feed" href="/wiki/index.php?title=Special:RecentChanges&amp;feed=atom" />
		<title>Utilities (used to be &quot;Mylib.tf&quot;) - GwenWiki</title>
		<link rel="stylesheet" href="/wiki/skins/common/shared.css?207" type="text/css" media="screen" />
		<link rel="stylesheet" href="/wiki/skins/common/commonPrint.css?207" type="text/css" media="print" />
		<link rel="stylesheet" href="/wiki/skins/monobook/main.css?207" type="text/css" media="screen" />
		<!--[if lt IE 5.5000]><link rel="stylesheet" href="/wiki/skins/monobook/IE50Fixes.css?207" type="text/css" media="screen" /><![endif]-->
		<!--[if IE 5.5000]><link rel="stylesheet" href="/wiki/skins/monobook/IE55Fixes.css?207" type="text/css" media="screen" /><![endif]-->
		<!--[if IE 6]><link rel="stylesheet" href="/wiki/skins/monobook/IE60Fixes.css?207" type="text/css" media="screen" /><![endif]-->
		<!--[if IE 7]><link rel="stylesheet" href="/wiki/skins/monobook/IE70Fixes.css?207" type="text/css" media="screen" /><![endif]-->
		<link rel="stylesheet" href="/wiki/index.php?title=MediaWiki:Common.css&amp;usemsgcache=yes&amp;ctype=text%2Fcss&amp;smaxage=18000&amp;action=raw&amp;maxage=18000" type="text/css" />
		<link rel="stylesheet" href="/wiki/index.php?title=MediaWiki:Print.css&amp;usemsgcache=yes&amp;ctype=text%2Fcss&amp;smaxage=18000&amp;action=raw&amp;maxage=18000" type="text/css" media="print" />
		<link rel="stylesheet" href="/wiki/index.php?title=MediaWiki:Monobook.css&amp;usemsgcache=yes&amp;ctype=text%2Fcss&amp;smaxage=18000&amp;action=raw&amp;maxage=18000" type="text/css" />
		<link rel="stylesheet" href="/wiki/index.php?title=-&amp;action=raw&amp;maxage=18000&amp;gen=css" type="text/css" />
		<!--[if lt IE 7]><script type="text/javascript" src="/wiki/skins/common/IEFixes.js?207"></script>
		<meta http-equiv="imagetoolbar" content="no" /><![endif]-->

		<script type= "text/javascript">/*<![CDATA[*/
		var skin = "monobook";
		var stylepath = "/wiki/skins";
		var wgArticlePath = "/wiki/index.php/$1";
		var wgScriptPath = "/wiki";
		var wgScript = "/wiki/index.php";
		var wgVariantArticlePath = false;
		var wgActionPaths = {};
		var wgServer = "http://www.gwen-morse.com";
		var wgCanonicalNamespace = "";
		var wgCanonicalSpecialPageName = false;
		var wgNamespaceNumber = 0;
		var wgPageName = "Utilities_(used_to_be_\"Mylib.tf\")";
		var wgTitle = "Utilities (used to be \"Mylib.tf\")";
		var wgAction = "view";
		var wgArticleId = 69;
		var wgIsArticle = true;
		var wgUserName = null;
		var wgUserGroups = null;
		var wgUserLanguage = "en";
		var wgContentLanguage = "en";
		var wgBreakFrames = false;
		var wgCurRevisionId = 720;
		var wgVersion = "1.15.3";
		var wgEnableAPI = true;
		var wgEnableWriteAPI = true;
		var wgSeparatorTransformTable = ["", ""];
		var wgDigitTransformTable = ["", ""];
		var wgRestrictionEdit = [];
		var wgRestrictionMove = [];
		/*]]>*/</script>

		<script type="text/javascript" src="/wiki/skins/common/wikibits.js?207"><!-- wikibits js --></script>
		<!-- Head Scripts -->
		<script type="text/javascript" src="/wiki/skins/common/ajax.js?207"></script>
		<script type="text/javascript" src="/wiki/index.php?title=-&amp;action=raw&amp;gen=js&amp;useskin=monobook"><!-- site js --></script>
	</head>
<body class="mediawiki ltr ns-0 ns-subject page-Utilities_used_to_be_Mylib_tf skin-monobook">
	<div id="globalWrapper">
		<div id="column-content">
	<div id="content">
		<a name="top" id="top"></a>
				<h1 id="firstHeading" class="firstHeading">Utilities (used to be &quot;Mylib.tf&quot;)</h1>
		<div id="bodyContent">
			<h3 id="siteSub">From GwenWiki</h3>
			<div id="contentSub">
				<div id="mw-revision-info">Revision as of 21:23, 26 February 2011 by <a href="/wiki/index.php/User:Eachna" title="User:Eachna" class="mw-userlink">Eachna</a>  <span class="mw-usertoollinks">(<a href="/wiki/index.php?title=User_talk:Eachna&amp;action=edit&amp;redlink=1" class="new" title="User talk:Eachna (page does not exist)">Talk</a>&#32;|&#32;<a href="/wiki/index.php/Special:Contributions/Eachna" title="Special:Contributions/Eachna">contribs</a>)</span></div>

				<div id="mw-revision-nav">(<a href="/wiki/index.php?title=Utilities_(used_to_be_%22Mylib.tf%22)&amp;diff=prev&amp;oldid=720" title="Utilities (used to be &quot;Mylib.tf&quot;)">diff</a>) <a href="/wiki/index.php?title=Utilities_(used_to_be_%22Mylib.tf%22)&amp;direction=prev&amp;oldid=720" title="Utilities (used to be &quot;Mylib.tf&quot;)">← Older revision</a>&#32;|&#32;Current revision (diff)&#32;|&#32;Newer revision → (diff)</div>
			</div>
									<div id="jump-to-nav">Jump to: <a href="#column-one">navigation</a>, <a href="#searchInput">search</a></div>			<!-- start content -->
			<p>The starting section of this file duplicates <a href="/wiki/index.php/Galvin%27s_Virtual_Array" title="Galvin&#39;s Virtual Array">Galvin's Virtual Array</a>. It's Galvin's array code plus so much more.
</p>
<pre>
;=========================================================
;utilities.tf (formerly mylib.tf)
;This contains common functions missing in the main tf library
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;
;;; Virtual Array 
;;;
;;; Originally submitted to the Tinyfugue mailing list by Galvin &lt;kairo at mediaone dot net&gt;
;;; Modfied by Michael Hunger &lt;mh14 at inf.tu-dresden dot de&gt;
;;; Modified by Regan@ Many MU's
;;; Possibly modified by other members of the Tinyfugue mailing list.
;;;
;;; NOTES FROM GALVIN:
;;;
;;; You may store anything to be abbreviated in these lists, e.g. weapons,
;;; friends, npcs, scores etc.
;;;
;;; If you use text not containing other characters than letters, numbers and _
;;; you may also use this as an simple key-value hash list
;;; e.g. /set_array weapon s1 sword_with_a_very_long_id
;;;
;;; /def wield = /get_array weapon&nbsp;%1%;wield&nbsp;%?
;;;
;;; Usage:
;;; instead of: wield sword_with_a_very_long_id
;;; just use: /wield s1
;;;
;;; Some Examples:
;;; /test put_array('test_array', 1, 367382)
;;; /test put_array('test_array', 2, 'a string')
;;; /test echo(get_array('test_array', 1))
;;; /test echo(get_array('test_array', 2))
;;; 
;;; You should see 367382 and a string echoed to your screen.
;;; 
;;; Passing an array to a function
;;; 
;;; /def function_array = \
;;; /test array1&nbsp;:= get_array({*}, 1)&nbsp;%;\
;;; /test array2&nbsp;:= get_array({*}, 2)&nbsp;%;\
;;; /test echo(strcat(array1, ':', array2))
;;; 
;;; /test function_array('test_array')
;;; 
;;; What I wrote here was just some stuff off the top of my head real quick.  Hope it helps.
;;; Oh and /listarray is a real good debuging tool, I use this as well. SO /listarray test_array should return:
;;; test_array[1]:=367382
;;; test_array[2]:=a string
;;; test_array[3]:=
;;;
;;; /listarray only lists up till a blank entry, I thought about using entry 0 as the # of elements but decided 
;;; that some people may want to start arrays from 0 and not 1.
;;;
;;; Some get_array_count examples:
;
; /test put_array('halloween', 1, 'skeleton')
; /test put_array('halloween', 2, 'owls')
; /test put_array('halloween', 3, 'boo!')
; 
; /test echo(get_array_count('halloween', 1))
; returns 3
; /test echo(get_array_count('halloween', 2))
; returns 2
; 
; /test put_2array('double', 1, 1 , 'hmm')
; /test put_2array('double, 1, 2, 'burp!')
; /test put_2array('double, 1, 3, 'damn')
; /test echo(get_2array_count('double', 1, 1) 

;------------------------------------------------------------------------
;Get array / get 2array&nbsp;: A virtual array function to similate a real array
;usage:
;get_array(&quot;Array name here&quot;, I) &amp; get_2array(&quot;array name&quot;, I, I2)
;example get_array(&quot;Dir_Array&quot;, 43) returns the 43rd element from &quot;Dir_Stack&quot;
;
;------------------------------------------------------------------------
/def get_array = \
 /return _array_%1_%2

/def get_2array = \
 /return _array_%1_%2_%3

;------------------------------------------------------------------------
;PUT array / put 2array: A virtual array function to similate a real array
;usage:
;put_array(&quot;Array name here&quot;, I, st) &amp; put_2array(&quot;array name&quot;, I, I2, st)
;example put_array(&quot;Dir_Array&quot;, 43, &quot;sw&quot;) puts &quot;sw&quot; at element 43 in
;&quot;Dir_Array&quot;
;------------------------------------------------------------------------
/def put_array = \
 /IF (strlen({3}) &gt; 0) \
   /set _array_%1_%2=%3%;\
 /ELSE \
   /unset _array_%1_%2%;\
 /ENDIF%;\

/def put_2array = \
 /IF (strlen({4}) &gt; 0) \
   /set _array_%1_%2_%3=%4%;\
 /ELSE \
   /unset _array_%1_%2_%3%;\
 /ENDIF%;\

;------------------------------------------------------------------------
;PURGE array&nbsp;: Purges a virtual array made by get_array &amp; put_array
;usage:
;purge_array(&quot;Array name here&quot;)
;example purge_array(&quot;Dir_Array&quot;), deletes the whole array from memory
;NOTE: Purge array starts from element 0
;NOTE: this can also purge double dimensioned arrays too.
;------------------------------------------------------------------------
/def purge_array = \
 /quote -S /unset `/listvar -s _array_%1_*

;--------------------------------------------------------------------------
;listarray / list2array
;USAGE:
;/listarray array_name &lt;num&gt; &amp; /list2array array_name &lt;num&gt; &lt;num2&gt;
;Will list the whole array of array_name starting from element &lt;num&gt;
;/list2array only lists the second dimension from &lt;start&gt;
;--------------------------------------------------------------------------
/def listarray = \
 /test LA_Count&nbsp;:=&nbsp;%2 - 1%;\
 /test LA_Element&nbsp;:= &quot; &quot;%;\
 /while (strlen(LA_Element) &gt; 0) \
   /test ++LA_Count%;\
   /test LA_Element&nbsp;:= get_array({1}, LA_Count)%;\
   /test echo(strcat({1}, &quot;[&quot;, LA_Count, &quot;]:=&quot;, LA_Element))%;\
 /DONE

/def list2array = \
 /test LA2_Count&nbsp;:= -1%;\
 /test LA2_Element&nbsp;:= &quot; &quot;%;\
 /while (LA2_Count &lt; 255) \
   /test ++LA2_Count%;\
   /test LA2_Element&nbsp;:= get_2array({1}, {2}, LA2_Count)%;\
   /IF (strlen(LA2_Element) &gt; 0) \
     /test echo(strcat({1}, &quot;[&quot;, {2}, &quot;][&quot;, LA2_Count, &quot;]:=&quot;, LA2_Element))%;\
   /ENDIF%;\
 /DONE
;--------------------------------------------------------------------------
;GET array count / GET 2array count
; Written by: Ian Leisk who may actually be &quot;Galvin&quot;, but, may not (kairo at attbi dot com)!
;usage:
;get_array_count(&quot;Array name here&quot;, start)
;get_2array_count(&quot;Array name here&quot;, index, start)
;
;NOTE:
;These will count the number of elements starting at &quot;start&quot; till the first
;empty element.
;Get_array2_count will count the number of elements starting at index
;from &quot;start&quot;
;--------------------------------------------------------------------------

/def get_array_count = \
  /test GA_Name&nbsp;:= {1}&nbsp;%;\
  /test GA_Count&nbsp;:= {2} - 1&nbsp;%;\
  /test GA_Element&nbsp;:= &quot; &quot;&nbsp;%;\
  /while (strlen(GA_Element) &gt; 0) \
    /test ++GA_Count&nbsp;%;\
    /test GA_Element&nbsp;:= get_array(GA_Name, GA_Count)&nbsp;%;\
  /DONE&nbsp;%;\
  /return GA_Count - 1

/def get_2array_count = \
  /test GA2_Name&nbsp;:= {1}&nbsp;%;\
  /test GA2_Index&nbsp;:= {2}&nbsp;%;\
  /test GA2_Count&nbsp;:= {3} -1&nbsp;%;\
  /test GA2_Element&nbsp;:= &quot; &quot;&nbsp;%;\
  /while (strlen(GA2_Element) &gt; 0) \
     /test ++GA2_Count&nbsp;%;\
     /test GA2_Element&nbsp;:= get_2array(GA2_Name, GA2_Index, GA2_Count)&nbsp;%;\
  /DONE&nbsp;%;\
  /return GA2_Count - 1

;========================================================================
; tfwrite_array() / tfwrite_2array()
;
; Writes a virtual array to a disk file.
; USAGE:
; tfwrite_array(file_variable, &quot;array_name&quot;, start_index, size)
; tfwrite_2array(file_variable, &quot;array_name&quot;, index, start_index, size)
;
; file_variable&nbsp;: File variable of a tfopened file.
; &quot;array_name&quot; &nbsp;: Name of the array.
; start_index  &nbsp;: The element you want to start writing from.
; index        &nbsp;: Start_index of index [first dimension] (tfwrite_2array only)
; Size         &nbsp;: Number of elements to write.
;
; NOTES: tfwrite_2array() can't write the whole array to disk.  You must
;        write each dimension at a time.
;========================================================================
/def tfwrite_array = \
  /let file_&nbsp;%{1}&nbsp;%;\
  /let array_&nbsp;%{2}&nbsp;%;\
  /let start_&nbsp;%{3}&nbsp;%;\
  /let size_&nbsp;%{4}&nbsp;%;\
  /let count_ 0&nbsp;%;\
  /WHILE (++count_ &lt;= size_) \
    /test tfwrite(file_, get_array(array_, start_))&nbsp;%;\
    /test ++start_&nbsp;%;\
  /DONE

/def tfwrite_2array = \
  /let file_&nbsp;%{1}&nbsp;%;\
  /let array_&nbsp;%{2}&nbsp;%;\
  /let index_&nbsp;%{3}&nbsp;%;\
  /let start_&nbsp;%{4}&nbsp;%;\
  /let size_&nbsp;%{5}&nbsp;%;\
  /let count_ 0&nbsp;%;\
  /WHILE (++count_ &lt;= size_) \
    /test tfwrite(file_, get_2array(array_, index_, start_))&nbsp;%;\
    /test ++start_&nbsp;%;\
  /DONE

;========================================================================
; tfread_array() / tfread_2array()
;
; reads an array file from disk
; USAGE:
; x&nbsp;:= tfread_array(file_variable, &quot;array_name&quot;, start_index, size)
; x&nbsp;:= tfread_2array(file_variable, &quot;array_name&quot;, index, start_index, size)
;
; x            &nbsp;: Number of records read.
; file_variable&nbsp;: File variable of a tfopened file.
; &quot;array_name&quot; &nbsp;: Name of the array.
; start_index  &nbsp;: Starting element you want to read into.
; index        &nbsp;: Start_index of index [first dimension] (tfread_2array only)
; size         &nbsp;: Number of elements to read.
;========================================================================
/def tfread_array = \
  /let file_&nbsp;%{1}&nbsp;%;\
  /let array_&nbsp;%{2}&nbsp;%;\
  /let start_&nbsp;%{3}&nbsp;%;\
  /let size_&nbsp;%{4}&nbsp;%;\
  /let count_ 0&nbsp;%;\
  /let done_ 0&nbsp;%;\
  /let err_ 0&nbsp;%;\
  /let st_ 0&nbsp;%;\
  /test st_&nbsp;:= ''&nbsp;%;\
  /WHILE (!done_) \
    /test err_&nbsp;:= tfread(file_, st_)&nbsp;%;\
    /IF ( (err_&nbsp;!= -1) &amp; (count_ &lt; size_) ) \
      /test put_array(array_, start_, st_)&nbsp;%;\
      /test ++count_&nbsp;%;\
      /test ++start_&nbsp;%;\
    /ELSE \
      /test done_&nbsp;:= 1&nbsp;%;\
    /ENDIF&nbsp;%;\
  /DONE&nbsp;%;\
  /RETURN count_

/def tfread_2array = \
  /let file_&nbsp;%{1}&nbsp;%;\
  /let array_&nbsp;%{2}&nbsp;%;\
  /let index_&nbsp;%{3}&nbsp;%;\
  /let start_&nbsp;%{4}&nbsp;%;\
  /let size_&nbsp;%{5}&nbsp;%;\
  /let count_ 0&nbsp;%;\
  /let done_ 0&nbsp;%;\
  /let err_ 0&nbsp;%;\
  /let st_ 0&nbsp;%;\
  /test st_&nbsp;:= ''&nbsp;%;\
  /WHILE (!done_) \
    /test err_&nbsp;:= tfread(file_, st_)&nbsp;%;\
    /IF ( (err_&nbsp;!= -1) &amp; (count_ &lt; size_) ) \
      /test put_2array(array_, index_, start_, st_)&nbsp;%;\
      /test ++count_&nbsp;%;\
      /test ++start_&nbsp;%;\
    /ELSE \
      /test done_&nbsp;:= 1&nbsp;%;\
    /ENDIF&nbsp;%;\
  /DONE&nbsp;%;\
  /RETURN count_

;========================================================================
; strstr_array() / strstr_2array()
;
; Searches for a value in a virtual array and returns what element its found in.
; USAGE:
; x&nbsp;:= strstr_array(&quot;array_name&quot;, start_index, size, value)
; x&nbsp;:= strstr_2array(&quot;array_name&quot;, index, start_index, size, value)
;
; x            &nbsp;: Element of &quot;array_name&quot; that value was found in.
;                 -1 is returned if value was not found.
; &quot;array_name&quot; &nbsp;: Name of the array.
; start_index  &nbsp;: Element to start searching at
; index        &nbsp;: Start_index of index [first dimension] (strstr_2arrat only).
; size         &nbsp;: Number of elements to search.
; value        &nbsp;: The item your searching for.
;
; NOTES: Strstr_2array can't search all dimensions, you must search each dimension
;        at a time.
;        If value = &quot;&quot; then it will return the first element that is blank.
;========================================================================
/def strstr_array = \
  /let array_&nbsp;%{1}&nbsp;%;\
  /let start_&nbsp;%{2}&nbsp;%;\
  /let size_&nbsp;%{3}&nbsp;%;\
  /let value_ 0&nbsp;%;\
  /test value_&nbsp;:= {4}&nbsp;%;\
  /let count_ 0&nbsp;%;\
  /let pos_ 0&nbsp;%;\
  /let st_ 0&nbsp;%;\
  /test st_&nbsp;:= ''&nbsp;%;\
  /let element_ -1&nbsp;%;\
  /WHILE ( (++count_ &lt;= size_) &amp; (element_ = -1) ) \
    /test st_&nbsp;:= get_array(array_, start_)&nbsp;%;\
    /IF (value_ =~ '') \
      /IF (st_ =~ '') \
        /test element_&nbsp;:= start_&nbsp;%;\
      /ENDIF&nbsp;%;\
    /ELSE \
      /test pos_&nbsp;:= strstr(st_, value_)&nbsp;%;\
      /IF (pos_ &gt; -1) \
        /test element_&nbsp;:= start_&nbsp;%;\
      /ENDIF&nbsp;%;\
    /ENDIF&nbsp;%;\
    /test ++start_&nbsp;%;\
  /DONE&nbsp;%;\
  /RETURN element_

/def strstr_2array = \
  /let array_&nbsp;%{1}&nbsp;%;\
  /let index_&nbsp;%{2}&nbsp;%;\
  /let start_&nbsp;%{3}&nbsp;%;\
  /let size_&nbsp;%{4}&nbsp;%;\
  /let value_ 0&nbsp;%;\
  /test value_&nbsp;:= {5}&nbsp;%;\
  /let count_ 0&nbsp;%;\
  /let pos_ 0&nbsp;%;\
  /let st_ 0&nbsp;%;\
  /let element_ -1&nbsp;%;\
  /test st_&nbsp;:= ''&nbsp;%;\
  /WHILE ( (++count_ &lt;= size_) &amp; (element_ = -1) ) \
    /test st_&nbsp;:= get_2array(array_, index_, start_)&nbsp;%;\
    /IF (value_ =~ '') \
      /IF (st_ =~ '') \
        /test element_&nbsp;:= start_&nbsp;%;\
      /ENDIF&nbsp;%;\
    /ELSE \
      /test pos_&nbsp;:= strstr(st_, value_)&nbsp;%;\
      /IF (pos_ &gt; -1) \
        /test element_&nbsp;:= start_&nbsp;%;\
      /ENDIF&nbsp;%;\
    /ENDIF&nbsp;%;\
    /test ++start_&nbsp;%;\
  /DONE&nbsp;%;\
  /RETURN element_;

========================================================================
; searchstr_2array()
;
; Searches for a value in all dimensions of a virtual array and returns
; each element its found in. Multiple matches are put into a space-delimited
; list
; Modified by Regan @ Many MU's
;
; USAGE:
; x&nbsp;:= searchstr_2array(&quot;array_name&quot;, index, start_index, size, value)
;
; x            &nbsp;: Element of &quot;array_name&quot; that value was found in.
;                 -1 is returned if value was not found.
; &quot;array_name&quot; &nbsp;: Name of the array.
; start_index  &nbsp;: Element to start searching at
; index        &nbsp;: Start_index of index [first dimension] (strstr_2arrat only).
; size         &nbsp;: Number of elements to search.
; value        &nbsp;: The item your searching for.
;
;        If value = &quot;&quot; then it will return the first element that is blank.
;========================================================================

/def searchstr_2array = \
  /let array_&nbsp;%{1}&nbsp;%;\
  /let index_&nbsp;%{2}&nbsp;%;\
  /let start_&nbsp;%{3}&nbsp;%;\
  /let size_&nbsp;%{4}&nbsp;%;\
  /let value_ 0&nbsp;%;\
  /test value_&nbsp;:= {5}&nbsp;%;\
  /let count_ 0&nbsp;%;\
  /let pos_ 0&nbsp;%;\
  /let st_ 0&nbsp;%;\
  /let element_ -1&nbsp;%;\
  /test blank_&nbsp;:= ' '&nbsp;%;\
  /test list_&nbsp;:= ''&nbsp;%;\
  /test st_&nbsp;:= ''&nbsp;%;\
  /WHILE (++count_ &lt;= size_) \
    /test st_&nbsp;:= get_2array(array_, start_, index_)&nbsp;%;\
    /IF (value_ =~ '') \
      /IF (st_ =~ '') \
        /test element_&nbsp;:= start_&nbsp;%;\
        /IF (list_ =~ '') \
          /test list_&nbsp;:= element_&nbsp;%;\
        /ELSE \
          /test temp_&nbsp;:= strcat(list_, blank_)&nbsp;%:\
          /test list_&nbsp;:= strcat(temp_, element_)&nbsp;%;\
        /ENDIF&nbsp;%;\
      /ENDIF&nbsp;%;\
    /ELSE \
      /test pos_&nbsp;:= strstr(st_, value_)&nbsp;%;\
      /IF (pos_ &gt; -1) \
        /test element_&nbsp;:= start_&nbsp;%;\
        /IF (list_ =~ '') \
          /test list_&nbsp;:= element_&nbsp;%;\
        /ELSE \
          /test temp_&nbsp;:= strcat(list_, blank_)&nbsp;%;\
          /test list_&nbsp;:= strcat(temp_, element_)&nbsp;%;\
        /ENDIF&nbsp;%;\
      /ENDIF&nbsp;%;\
    /ENDIF&nbsp;%;\
    /test ++start_&nbsp;%;\
  /DONE&nbsp;%;\
  /RETURN list_

;==============================================================================
; chr2chr()
;
; Changes one character to difference character in a string
; USAGE:
; x&nbsp;:= chr2chr(&quot;string&quot;, &quot;searchchar&quot;, &quot;changechar&quot;)
;
; x          &nbsp;: contains &quot;string&quot; with all &quot;.&quot; as &quot;_&quot;.
; &quot;string&quot;   &nbsp;: any string.
; &quot;searchar&quot; &nbsp;: The character to be changed in &quot;string&quot;.
; &quot;changechar&nbsp;: The character to replace each occrance of &quot;searchar&quot; in
;               &quot;string&quot;.&quot;
;==============================================================================
/def chr2chr = \
  /let st_ 0&nbsp;%;\
  /test st_&nbsp;:= {1}&nbsp;%;\
  /let searchchar_ 0&nbsp;%;\
  /test searchchar_&nbsp;:= {2}&nbsp;%;\
  /let changechar_ 0&nbsp;%;\
  /test changechar_&nbsp;:= {3}&nbsp;%;\
  /let pos_ -1&nbsp;%;\
  /let pos2_ 0&nbsp;%;\
  /let done_ 0&nbsp;%;\
  /WHILE (!done_) \
    /test pos2_&nbsp;:= pos_&nbsp;%;\
    /test pos_&nbsp;:= strchr(substr(st_, pos_ + 1), searchchar_)&nbsp;%;\
    /IF (pos_ &gt; -1) \
      /test pos_&nbsp;:= pos_ + pos2_ + 1&nbsp;%;\
      /IF (substr(st_, pos_, 1) =~ searchchar_) \
        /test st_&nbsp;:= strcat(substr(st_, 0, pos_), changechar_, substr(st_, pos_ + 1))&nbsp;%;\
      /ENDIF&nbsp;%;\
    /ELSE \
      /test done_&nbsp;:= 1&nbsp;%;\
    /ENDIF&nbsp;%;\
  /DONE&nbsp;%;\
  /RETURN st_

;==============================================================================
; tfwrite_vars()
; Write variables to a disk file.
; USAGE:
; x&nbsp;:= tfwrite_vars(&quot;variables&quot;, &quot;matching&quot;, file_variable)
;
; x            &nbsp;: Number of variables written to disk.
; &quot;variables&quot;  &nbsp;: A string matching the variables you want to write to disk.
; &quot;matching&quot;   &nbsp;: &quot;simple&quot;: straightforward string comparison.
;                 &quot;glob&quot; &nbsp;: shell-like matching (as before version 3.2).
;                 &quot;regexp&quot;: regular expression.
;                 &quot;&quot;     &nbsp;: defaults to &quot;glob&quot;
; file_variable&nbsp;: File variable of a tfopened file.
;
; EXAMPLES:
; /set movie_title lord of the rings
; /set movie_year 2001
; /set movie_length 2 hours 59 min
; /test file_&nbsp;:= tfopen(&quot;movies.dat&quot;, &quot;w&quot;)
; /test tfwrite_vars(&quot;movie_*&quot;, &quot;glob&quot;, file_)
; /test tfclose(file_)
;
; This will write all 3 variables to disk.
;
; NOTES: The variables must be global variables made with /set or
;        /test var&nbsp;:= value.
;==============================================================================
/def tfwrite_vars = \
  /let vars_&nbsp;%{1}&nbsp;%;\
  /let matching_ 0&nbsp;%;\
  /test matching_&nbsp;:= {2}&nbsp;%;\
  /IF (matching_ =~ '') \
    /test matching_&nbsp;:= &quot;glob&quot;&nbsp;%;\
  /ENDIF&nbsp;%;\
  /let file_&nbsp;%{3}&nbsp;%;\
  /let count_ 0&nbsp;%;\
  /def tfwrite_vars2 = \
    /let var_&nbsp;%%{1}&nbsp;%%;\
    /test ++count_&nbsp;%%;\
    /test echo(strcat('::',$$[var_],'::'))&nbsp;%%;\
    /test tfwrite(file_, strcat(':',var_,'=',$$[var_], ':'))&nbsp;%;\
  /quote -S /test tfwrite_vars2(&quot;`&quot;/listvar -m$[matching_] -s $[vars_]&quot;&quot;)&nbsp;%;\
  /undef tfwrite_vars2&nbsp;%;\
  /return count_

;==============================================================================
; tfread_vars()
; Reads variables to a from a disk file that was written by tfwrite_vars()
; USAGE:
; x&nbsp;:= tfread_vars(file_variable)
;
; x            &nbsp;: number of variables read.
; file_variable&nbsp;: File variable of a tfopened file.
;
; EXAMPLES:
;
; /test file_&nbsp;:= tfopen(&quot;movies.dat&quot;, &quot;r&quot;)
; /test tfread_vars(file_)
; /test tfclose(file_)
;
; Now the variables will be set to the same values as shown in the
; tfwrite_vars() examples.
;
; NOTE: The variables do not have to exist prior to reading since they're
;       already written in the file by tfwrite_vars()
;==============================================================================
/def tfread_vars = \
  /let file_&nbsp;%{1}&nbsp;%;\
  /let done_ 0&nbsp;%;\
  /let st_ 0&nbsp;%;\
  /let pos_ 0&nbsp;%;\
  /let var_ 0&nbsp;%;\
  /let value_ 0&nbsp;%;\
  /let err_ 0&nbsp;%;\
  /let count_ 0&nbsp;%;\
  /WHILE (!done_) \
    /test err_&nbsp;:= tfread(file_, st_)&nbsp;%;\
    /IF (err_&nbsp;!= -1) \
      /test ++count_&nbsp;%;\
      /test st_&nbsp;:= substr(st_, 1, strlen(st_) - 2)&nbsp;%;\
      /test pos_&nbsp;:= strstr(st_, '=')&nbsp;%;\
      /test var_&nbsp;:= substr(st_, 0, pos_)&nbsp;%;\
      /test value_&nbsp;:= substr(st_, pos_ +1)&nbsp;%;\
      /eval /test $[var_]&nbsp;:= value_&nbsp;%;\
    /ELSE \
      /test done_&nbsp;:= 1&nbsp;%;\
    /ENDIF&nbsp;%;\
  /DONE&nbsp;%;\
  /RETURN count_

;==============================================================================
; delay()
;
; Delays an X number of seconds before returning.
; USAGE:
; delay(seconds)
;==============================================================================
/def delay = \
  /let seconds_&nbsp;%{1}&nbsp;%;\
  /let ctime_ 0&nbsp;%;\
  /test ctime_&nbsp;:= get_time(0)&nbsp;%;\
  /WHILE ( (get_time(0) - ctime_) &lt; seconds_ ) \
  /DONE

;==============================================================================
; get_time()
;
; returns hours, minutes, seconds in integer format
; USAGE:
; x&nbsp;:= get_time(0)
; x&nbsp;:= get_time(raw_time)
;
; x       &nbsp;: Time in seconds.
; 0       &nbsp;: Current time in seconds returned.
; raw_time&nbsp;: Raw time, raw time gets passed back from tinyfugue's time() function.
;            This will get converted to seconds.
;==============================================================================
/def get_time = \
  /let st_ 0&nbsp;%;\
  /let hours_ 0&nbsp;%;\
  /let min_ 0&nbsp;%;\
  /let sec_ 0&nbsp;%;\
  /IF ({*} = 0) \
    /test st_&nbsp;:= ftime('%%H:%%M:%%S', time())&nbsp;%;\
  /ELSE \
    /test st_&nbsp;:= ftime('%%H:%%M:%%S', {*})&nbsp;%;\
  /ENDIF&nbsp;%;\
  /test hours_&nbsp;:= substr(st_, 0, 2)&nbsp;%;\
  /test min_&nbsp;:= substr(st_, 3, 2)&nbsp;%;\
  /test sec_&nbsp;:= substr(st_, 6, 2)&nbsp;%;\
  /return time2sec(hours_, min_, sec_)

;==============================================================================
; time2sec()
;
; converts hours, min, sec to total seconds
; USAGE:
;
; x&nbsp;:= time2sec(hours, min, sec)
;
; x     &nbsp;: The total time in seconds of hours, min, sec.
; hours &nbsp;: Can range from 0 to 23.
; min   &nbsp;: Can range from 0 to 59.
; sec   &nbsp;: Can range from 0 to 59.
;==============================================================================
/def time2sec = \
  /let h_&nbsp;%{1}&nbsp;%;\
  /let m_&nbsp;%{2}&nbsp;%;\
  /let s_&nbsp;%{3}&nbsp;%;\
  /return h_ * 3600 + m_ * 60 + s_

;==============================================================================
; sec2time()
;
; converts total seconds back into hours, min, sec
; USAGE:
; sec2time(&quot;time_rec&quot;, seconds)
;
; &quot;time_rec&quot;&nbsp;: Contains the hours, min, seconds passed back.
;              get_rec(&quot;time_rec&quot;, &quot;hours&quot;) = hours.
;              get_rec(&quot;time_rec&quot;, &quot;min&quot;) = minutes.
;              get_rec(&quot;time_rec&quot;, &quot;sec&quot;) = seconds.
; seconds   &nbsp;: Value in seconds.
;
; NOTES: &quot;time_rec&quot; can be any record name you want.
;        If &quot;&quot; is specified for &quot;time_rec&quot; then no record gets used. See how this
;        is used in sec2clock.  Local vars are set in calling function to get
;        back the values from this function.
;==============================================================================
/def sec2time = \
  /let rec_ 0&nbsp;%;\
  /test rec_&nbsp;:= {1}&nbsp;%;\
  /let int_&nbsp;%{2}&nbsp;%;\
  /IF (rec_&nbsp;!~ '') \
    /let hours_ 0&nbsp;%;\
    /let min_ 0&nbsp;%;\
    /let sec_ 0&nbsp;%;\
  /ENDIF&nbsp;%;\
  /test hours_&nbsp;:= int_ / 3600&nbsp;%;\
  /let rem_ $[int_ - (hours_ * 3600)]&nbsp;%;\
  /test min_&nbsp;:= rem_ / 60&nbsp;%;\
  /test rem_&nbsp;:= rem_ - (min_ * 60)&nbsp;%;\
  /test sec_&nbsp;:= rem_&nbsp;%;\
  /IF (rec_&nbsp;!~ '') \
    /test del_rec(rec_, '')&nbsp;%;\
    /test add_rec(rec_, 'hours', hours_)&nbsp;%;\
    /test add_rec(rec_, 'min', min_)&nbsp;%;\
    /test add_rec(rec_, 'sec', sec_)&nbsp;%;\
  /ENDIF

;==============================================================================
; sec2clock()
;
; similar to sec2time except it turns seconds into a clock reading AM/PM
; USAGE:
; x&nbsp;:= sec2clock(value)
;
; x    &nbsp;: Time returned formatted in ##:##pm.  Example&nbsp;: &quot;3:04am&quot;
; value&nbsp;: Total seconds of time ranging over a 24 hour period.
;==============================================================================
/def sec2clock = \
  /let rawtime_&nbsp;%{1}&nbsp;%;\
  /let hours_ 0&nbsp;%;\
  /let min_ 0&nbsp;%;\
  /let sec_ 0&nbsp;%;\
  /let pm_ 0&nbsp;%;\
  /let st_ 0&nbsp;%;\
  /test sec2time('', rawtime_)&nbsp;%;\
  /IF (min_ &lt;= 9) \
    /test min_&nbsp;:= strcat('0', min_)&nbsp;%;\
  /ENDIF&nbsp;%;\
  /IF (rawtime_ &gt; 12 * 3600) \
    /test pm_&nbsp;:= 1&nbsp;%;\
    /test hours_&nbsp;:= hours_ - 12&nbsp;%;\
  /ELSE \
    /test pm_&nbsp;:= 0&nbsp;%;\
  /ENDIF&nbsp;%;\
  /test st_&nbsp;:= strcat(hours_, ':', min_)&nbsp;%;\
  /IF (pm_) \
    /test st_&nbsp;:= strcat(st_, 'pm')&nbsp;%;\
  /ELSE \
    /test st_&nbsp;:= strcat(st_, 'am')&nbsp;%;\
  /ENDIF&nbsp;%;\
  /return st_

;==============================================================================
; num2commas()
;
; returns a number formatted with comma's
; USAGE:
; x&nbsp;:= num2commas(value)
;
; x    &nbsp;: Value returned with commas. Example 1,345 from 1345.
; value&nbsp;: Any number.
;==============================================================================
/def num2commas = \
  /let st_&nbsp;%{1}&nbsp;%;\
  /let count_ $[strlen(st_)]&nbsp;%;\
  /let count2_ 0&nbsp;%;\
  /let st2_ 0&nbsp;%;\
  /test st2_&nbsp;:= ''&nbsp;%;\
  /WHILE (--count_ &gt;= 0) \
    /IF ( (count2_ = 3) &amp; (substr(st_, count_, 1)&nbsp;!~ '-') ) \
      /test st2_&nbsp;:= strcat(',', st2_)&nbsp;%;\
      /test count2_&nbsp;:= 0&nbsp;%;\
    /ENDIF&nbsp;%;\
    /test st2_&nbsp;:= strcat(substr(st_, count_, 1), st2_)&nbsp;%;\
    /test ++count2_&nbsp;%;\
  /DONE&nbsp;%;\
  /return st2_

;==============================================================================
; send_macro()
;
; Sends a macro to tinyfugue
; USAGE:
; send_macro(&quot;macro&quot;)
;
; &quot;macro&quot;  &nbsp;: A tinyfugue macro like &quot;/help&quot;
;
; NOTES: If &quot;macro&quot; doesn't begin with a &quot;/&quot; it will send it to the world you're
;        currently connected to.
;==============================================================================
/def send_macro = \
  /def send_macro2 = \
   &nbsp;%*&nbsp;%;\
  /send_macro2&nbsp;%;\
  /undef send_macro2

;==============================================================================
; strip_space()
;
; Strips all leading spaces from a string.
; USAGE:
; x&nbsp;:= strip_space(&quot;string&quot;)
;
; x       &nbsp;: Returned &quot;string&quot; with no leading spaces.
; &quot;string&quot;&nbsp;: Any string
;==============================================================================
/def strip_space = \
  /let st_ 0&nbsp;%;\
  /test st_&nbsp;:= {1}&nbsp;%;\
  /let st2_ 0&nbsp;%;\
  /let count_ -1&nbsp;%;\
  /test st2_&nbsp;:= ''&nbsp;%;\
  /WHILE (++count_ &lt;= strlen(st_) &amp; substr(st_, count_, 1) =~ ' ') \
  /DONE&nbsp;%;\
  /return substr(st_, count_, 255)

;==============================================================================
; parse_string()
;
; This function will parse a string by the separator you choose and place the
; elements back into an array of your choosing.
; USAGE:
; parse_string(&quot;array&quot;, &quot;sep&quot;, &quot;string&quot;)
;
; &quot;array&quot; &nbsp;: get_array(&quot;data&quot;, 0) = number of elements returned.
;            get_array(&quot;data&quot;, 1, 2, 3..) = &quot;string&quot; parsed out.
; &quot;sep&quot;   &nbsp;: The divider of elements in string.
; &quot;string&quot;&nbsp;: The string you want parsed.
;
; EXAMPLE:
; parse_string(&quot;data&quot;, &quot; &quot;, &quot;hp(45/100) sp(450/500)&quot;)
;
; get_array(&quot;data&quot;, 0) = 2
; get_array(&quot;data&quot;, 1) = &quot;hp(45/100)&quot;
; get_array(&quot;data&quot;, 2) = &quot;sp(450/500)&quot;
;==============================================================================
/def parse_string = \
  /let array_&nbsp;%{1}&nbsp;%;\
  /let sep_ 0&nbsp;%;\
  /test sep_&nbsp;:= {2}&nbsp;%;\
  /let data_ 0&nbsp;%;\
  /test data_&nbsp;:= {3}&nbsp;%;\
  /let count_ -1&nbsp;%;\
  /let parcount_ 0&nbsp;%;\
  /let ch_ 0&nbsp;%;\
  /let st_ 0&nbsp;%;\
  /let len_ 0&nbsp;%;\
  /test ch_&nbsp;:= ''&nbsp;%;\
  /test st_&nbsp;:= ''&nbsp;%;\
  /test len_&nbsp;:= strlen(data_)&nbsp;%;\
  /test purge_array(array_)&nbsp;%;\
  /WHILE (++count_ &lt;= len_) \
    /test ch_&nbsp;:= substr(data_, count_, 1)&nbsp;%;\
    /IF ( (ch_ =~ sep_) | (count_ = len_) ) \
      /test ++parcount_&nbsp;%;\
      /test put_array(array_, parcount_, st_)&nbsp;%;\
      /test st_&nbsp;:= ''&nbsp;%;\
    /ELSE \
      /test st_&nbsp;:= strcat(st_, ch_)&nbsp;%;\
    /ENDIF&nbsp;%;\
  /DONE&nbsp;%;\
  /test put_array(array_, 0, parcount_)

;==============================================================================
; search_literal()
;
; Search for a character in a string of characters.  Characters will be skipped
; in the string that start with a literal-switch.  The position of the character
; found will be based on the string returned with no literal switches.
; USAGE:
; x&nbsp;:= search_literal(&quot;data&quot;, &quot;string&quot;, char, litchar)
;
; x        &nbsp;: Position of char in &quot;string&quot;. -1 returned if nothing found.
; &quot;data&quot;   &nbsp;: Record that contains the following:
;             /rec&nbsp;:data.pos:    = position
;             /rec&nbsp;:data.st:     = &quot;string&quot; with no literal switches.
; &quot;string&quot; &nbsp;: String being searched.
; char     &nbsp;: Char to search for in &quot;string&quot; skipping literal switches.
; litchar  &nbsp;: The literal-switch of your choosing.
;
; EXAMPLES:
; x&nbsp;:= search_literal(&quot;data&quot;, &quot;/A/C/car/rocks&quot;, &quot;c&quot;, &quot;/&quot;)
; RETURNS:
; x&nbsp;:= 7
; /rec&nbsp;:data.pos:   = 7
; /rec&nbsp;:data.st:    = &quot;ACcarrocks&quot;
;
; NOTES: To use a literal-switch as data in the &quot;data&quot; use two of them in a row.
;        like &quot;\\&quot; would mean &quot;\&quot;
;==============================================================================
/def search_literal = \
  /let rec_ 0&nbsp;%;\
  /test rec_&nbsp;:= {1}&nbsp;%;\
  /let string_ 0&nbsp;%;\
  /test string_&nbsp;:= {2}&nbsp;%;\
  /let char_ 0&nbsp;%;\
  /test char_&nbsp;:= {3}&nbsp;%;\
  /let litchar_ 0&nbsp;%;\
  /test litchar_&nbsp;:= {4}&nbsp;%;\
  /let string2_ 0&nbsp;%;\
  /let lastch_ 0&nbsp;%;\
  /let ch_ 0&nbsp;%;\
  /let count_ -1&nbsp;%;\
  /let pos_ -1&nbsp;%;\
  /let length_ $[strlen(string_)]&nbsp;%;\
  /test string2_&nbsp;:= ''&nbsp;%;\
  /test lastch_&nbsp;:= ''&nbsp;%;\
  /test ch_&nbsp;:= ''&nbsp;%;\
  /WHILE (++count_ &lt;= length_) \
    /test lastch_&nbsp;:= ch_&nbsp;%;\
    /test ch_&nbsp;:= substr(string_, count_, 1)&nbsp;%;\
    /IF (ch_ =~ litchar_) \
      /IF (substr(string_, count_ + 1, 1) =~ litchar_) \
        /test string2_&nbsp;:= strcat(string2_, litchar_)&nbsp;%;\
        /test ++count_&nbsp;%;\
      /ENDIF&nbsp;%;\
    /ELSE \
      /IF ( (lastch_&nbsp;!~ litchar_) &amp; (ch_ =~ char_) &amp; (pos_ = -1) ) \
        /test pos_&nbsp;:= strlen(string2_)&nbsp;%;\
      /ENDIF&nbsp;%;\
      /test string2_&nbsp;:= strcat(string2_, ch_)&nbsp;%;\
    /ENDIF&nbsp;%;\
  /DONE&nbsp;%;\
  /test del_rec(rec_, '')&nbsp;%;\
  /test add_rec(rec_, 'pos', pos_)&nbsp;%;\
  /test add_rec(rec_, 'st', string2_)&nbsp;%;\
  /RETURN pos_

;==============================================================================
; find_string()
;
; Finds a string within a string and return the starting position, end
; position and length in a virtual array.
; USAGE:
; x&nbsp;:= find_string(&quot;pos&quot;, &quot;string&quot;, &quot;search&quot;, stringpos, skip)
;
; x         &nbsp;: -1 no string found, 1 string found.
; &quot;pos&quot;     &nbsp;: Position data returned in a record.
;              /rec&nbsp;:pos.found:        = 1 if string found -1 if not found.
;              /rec&nbsp;:pos.st:           = search data found.
;              /rec&nbsp;:pos.start:        = starting location in &quot;string&quot;.
;              /rec&nbsp;:pos.end:          = ending location in &quot;string&quot;.
;              /rec&nbsp;:pos.len:          = length of sub string found.
; &quot;string&quot;  &nbsp;: String being searched.
; &quot;search&quot;  &nbsp;: String your searching for.
; stringpos &nbsp;: Position in string to start searching at.
; skip      &nbsp;: Number of matches to skip before returning a real match.
;
; EXAMPLES:
; find_string(&quot;pos&quot;, &quot;Status is currently 45.65 degrees&quot;, &quot;y * d&quot;, 0, 0)
; RETURNS:
; /rec&nbsp;:pos.found:        = 1           {string found}
; /rec&nbsp;:pos.st:           = &quot;y 45.65 d&quot; {actual data found}
; /rec&nbsp;:pos.start:        = 18          {starting position}
; /rec&nbsp;:pos.end:          = 26          {ending position}
; /rec&nbsp;:pos.len:          = 9           {length}
;
; To pull out just the 45.65 in the example above you would need to do:
; find_string(&quot;pos&quot;, &quot;Status is currently 45.65 degrees&quot;, &quot;y (*) d&quot;, 0, 0)
;
; NOTES: Anything in () is returned, you can only have one set of () and
;        one &quot;*&quot; in your search.  Use ~( ~) ~* if you want that as part of
;        your search data. When using () with *, the * must be inside the
;        () or you may get strange results.
;==============================================================================
/def find_string2 = \
  /let string_ 0&nbsp;%;\
  /test string_&nbsp;:= {1}&nbsp;%;\
  /let search_&nbsp;:= 0&nbsp;%;\
  /test search_&nbsp;:= {2}&nbsp;%;\
  /let skip_&nbsp;%{3}&nbsp;%;\
  /let searchl_ $[strlen(search_)]&nbsp;%;\
  /let count_ 0&nbsp;%;\
  /let count2_ 0&nbsp;%;\
  /let done_ 0&nbsp;%;\
  /let pos_ 0&nbsp;%;\
  /let pos2_ 0&nbsp;%;\
  /WHILE (!done_) \
    /test pos_&nbsp;:= strstr(string_, search_)&nbsp;%;\
    /IF (pos_ &gt; -1) \
      /test ++count2_&nbsp;%;\
      /IF (count2_ &gt; skip_) \
        /test pos_&nbsp;:= pos2_ + pos_&nbsp;%;\
        /test done_&nbsp;:= 1&nbsp;%;\
      /ELSE \
        /test string_&nbsp;:= substr(string_, pos_ + searchl_)&nbsp;%;\
        /test pos2_&nbsp;:= pos2_ + pos_ + searchl_&nbsp;%;\
      /ENDIF&nbsp;%;\
    /ELSE \
      /test done_&nbsp;:= 1&nbsp;%;\
    /ENDIF&nbsp;%;\
  /DONE&nbsp;%;\
  /IF (count2_ &lt;= skip_) \
    /test pos_&nbsp;:= -1&nbsp;%;\
  /ENDIF&nbsp;%;\
  /RETURN pos_

/def find_string3 = \
  /let string_ 0&nbsp;%;\
  /test string_&nbsp;:= {1}&nbsp;%;\
  /let searchL_ 0&nbsp;%;\
  /test searchL_&nbsp;:= {2}&nbsp;%;\
  /let searchR_ 0&nbsp;%;\
  /test searchR_&nbsp;:= {3}&nbsp;%;\
  /let skip_&nbsp;%{4}&nbsp;%;\
  /let count_ 0&nbsp;%;\
  /let count2_ 0&nbsp;%;\
  /let done_ 0&nbsp;%;\
  /let posL_ 0&nbsp;%;\
  /let posR_ 0&nbsp;%;\
  /let pos2_ 0&nbsp;%;\
  /WHILE (!done_) \
    /test posL_&nbsp;:= strstr(string_, searchL_)&nbsp;%;\
    /IF (posL_ &gt; -1) \
      /test string_&nbsp;:= substr(string_, posL_ + strlen(searchL_))&nbsp;%;\
      /test posR_&nbsp;:= strstr(string_, searchR_)&nbsp;%;\
      /IF (posR_ &gt; -1) \
        /test ++count2_&nbsp;%;\
        /IF (count2_ &gt; skip_) \
          /test length_&nbsp;:= posR_ + strlen(searchL_) + strlen(searchR_)&nbsp;%;\
          /test pos_&nbsp;:= pos2_ + posL_&nbsp;%;\
          /test done_&nbsp;:= 1&nbsp;%;\
        /ELSE \
          /test pos2_&nbsp;:= pos2_ + posL_ + strlen(searchL_)&nbsp;%;\
        /ENDIF&nbsp;%;\
      /ELSE \
        /test done_&nbsp;:= 1&nbsp;%;\
      /ENDIF&nbsp;%;\
    /ELSE \
      /test done_&nbsp;:= 1&nbsp;%;\
    /ENDIF&nbsp;%;\
  /DONE&nbsp;%;\
  /IF (count2_ &lt;= skip_) \
    /test pos_&nbsp;:= -1&nbsp;%;\
  /ENDIF&nbsp;%;\
  /RETURN pos_

/def find_string = \
  /let rec_ 0&nbsp;%;\
  /test rec_&nbsp;:= {1}&nbsp;%;\
  /let string_ 0&nbsp;%;\
  /test string_&nbsp;:= {2}&nbsp;%;\
  /let search_ 0&nbsp;%;\
  /test search_&nbsp;:= {3}&nbsp;%;\
  /let stringpos_&nbsp;%{4}&nbsp;%;\
  /let skip_ 0&nbsp;%;\
  /test skip_&nbsp;:= {5}&nbsp;%;\
  /let found_ -1&nbsp;%;\
  /let pos_ -1&nbsp;%;\
  /let pos2_ 0&nbsp;%;\
  /let end_ 0&nbsp;%;\
  /let length_ 0&nbsp;%;\
  /let left_ 0&nbsp;%;\
  /let right_ 0&nbsp;%;\
  /let st_ 0&nbsp;%;\
  /let searchL_ 0&nbsp;%;\
  /let searchR_ 0&nbsp;%;\
  /test right_&nbsp;:= 0&nbsp;%;\
  /test st_&nbsp;:= ''&nbsp;%;\
  /test searchL_&nbsp;:= ''&nbsp;%;\
  /test searchR_&nbsp;:= ''&nbsp;%;\
  /test string_&nbsp;:= substr(string_, stringpos_)&nbsp;%;\
  /IF (search_&nbsp;!~ '') \
    /IF ( (search_ =~ '*') | (search_ =~ &quot;(*)&quot;) ) \
      /IF ( (skip_ = 0) &amp; (string_&nbsp;!~ '') )\
        /test found_&nbsp;:= 1&nbsp;%;\
        /test pos_&nbsp;:= 0&nbsp;%;\
        /test end_&nbsp;:= strlen(string_) - 1&nbsp;%;\
        /test length_&nbsp;:= end_ + 1&nbsp;%;\
        /test st_&nbsp;:= string_&nbsp;%;\
      /ENDIF&nbsp;%;\
    /ELSE \
      /test del_rec(rec_, '')&nbsp;%;\
      /test left_&nbsp;:= search_literal(rec_, search_, '(', '~')&nbsp;%;\
      /test right_&nbsp;:= search_literal(rec_, search_, ')', '~')&nbsp;%;\
      /test pos2_&nbsp;:= search_literal(rec_, search_, '*', '~')&nbsp;%;\
      /test search_&nbsp;:= get_rec(rec_, 'st')&nbsp;%;\
      /IF (left_ + right_ &gt; 0) \
        /test search_&nbsp;:= strcat(substr(search_, 0, left_), \
                                  substr(search_, left_ + 1, right_ - left_ - 1), \
                                  substr(search_, right_ + 1))&nbsp;%;\
        /test right_&nbsp;:= right_ - 2&nbsp;%;\
        /IF (pos2_ &gt; -1) \
          /test --pos2_&nbsp;%;\
        /ENDIF&nbsp;%;\
      /ENDIF&nbsp;%;\
      /IF (pos2_ = -1) \
        /test found_&nbsp;:= find_string2(string_, search_, skip_)&nbsp;%;\
        /IF (found_ &gt; -1) \
          /test pos_&nbsp;:= found_&nbsp;%;\
          /test length_&nbsp;:= strlen(search_)&nbsp;%;\
          /test end_&nbsp;:= pos_ + length_ - 1&nbsp;%;\
          /test st_&nbsp;:= search_&nbsp;%;\
          /test found_&nbsp;:= 1&nbsp;%;\
          /IF (left_ + right_ &gt; 0) \
            /test length_&nbsp;:= right_ - left_ + 1&nbsp;%;\
            /test pos_&nbsp;:= pos_ + left_&nbsp;%;\
            /test end_&nbsp;:= pos_ + right_ - 1&nbsp;%;\
            /test st_&nbsp;:= substr(string_, pos_, length_)&nbsp;%;\
          /ENDIF&nbsp;%;\
        /ENDIF&nbsp;%;\
      /ELSE \
        /test searchL_&nbsp;:= substr(search_, 0, pos2_)&nbsp;%;\
        /test searchR_&nbsp;:= substr(search_, pos2_ + 1)&nbsp;%;\
        /IF (find_string3(string_, searchL_, searchR_, skip_) &gt; -1) \
          /test found_&nbsp;:= 1&nbsp;%;\
          /test end_&nbsp;:= pos_ + length_ - 1&nbsp;%;\
          /test st_&nbsp;:= substr(string_, pos_, length_)&nbsp;%;\
          /IF (left_ + right_ &gt; 0) \
            /test pos_&nbsp;:= pos_ + left_&nbsp;%;\
            /test end_&nbsp;:= end_ - (strlen(search_) - right_) + 1&nbsp;%;\
            /test length_&nbsp;:= end_ - pos_ +1&nbsp;%;\
            /test st_&nbsp;:= substr(string_, pos_, length_)&nbsp;%;\
          /ENDIF&nbsp;%;\
        /ENDIF&nbsp;%;\
      /ENDIF&nbsp;%;\
    /ENDIF&nbsp;%;\
  /ENDIF&nbsp;%;\
  /test del_rec(rec_, '')&nbsp;%;\
  /IF (found_ = 1) \
    /test pos_&nbsp;:= pos_ + stringpos_&nbsp;%;\
    /test end_&nbsp;:= end_ + stringpos_&nbsp;%;\
  /ENDIF&nbsp;%;\
  /test add_rec(rec_, 'found', found_)&nbsp;%;\
  /test add_rec(rec_, 'st', st_)&nbsp;%;\
  /test add_rec(rec_, 'start', pos_)&nbsp;%;\
  /test add_rec(rec_, 'end', end_)&nbsp;%;\
  /test add_rec(rec_, 'len', length_)&nbsp;%;\
  /RETURN found_

;==============================================================================
; search_replace()
;
; Searches for a string and replaces each occurrence with a new string.
; USAGE
; x&nbsp;:= search_replace(&quot;record&quot;, &quot;string&quot;, &quot;search&quot;, &quot;replace&quot;, count, skip)
;
; x        &nbsp;: -1 no searches done, &gt;=1 = how many searches were done.
; &quot;record&quot; &nbsp;: /rec&nbsp;:record.replace:    = How many replaces were done. -1 = none
;             /rec&nbsp;:record.st:         = New string with replaced parts.
; &quot;string&quot; &nbsp;: String to have parts to be replaced.
; &quot;search&quot; &nbsp;: Sub string in &quot;string&quot; to be replaced.
; &quot;replace&quot;&nbsp;: New sub string that will replace each &quot;search&quot; string found.
; count    &nbsp;: How many replacements to do. 0 = unlimited.
; skip     &nbsp;: How many matches you want to skip before replacing. 0 = no skip.
;
; EXAMPLES:
; search_replace(&quot;search&quot;, &quot;Status is currently 45.65 degrees&quot;, &quot;y (*) d&quot;, &quot;34.2&quot;, 0, 0)
; RETURNS:
; /rec&nbsp;:search.replace:      = 1 (1 replacement was done)
; /rec&nbsp;:search.st:           = &quot;Status is currently 32.2 degrees&quot;
;
; NOTES: Anything in () is replaced.  You can only have one set of () and
;        one &quot;*&quot; in your search.  Use ~( ~) ~* if you want that as part of
;        your search data. When using () with *, the * must be inside the
;        () or you may get strange results.
;==============================================================================
/def search_replace = \
  /let rec_&nbsp;%{1}&nbsp;%;\
  /let string_ 0&nbsp;%;\
  /test string_&nbsp;:= {2}&nbsp;%;\
  /let search_ 0&nbsp;%;\
  /test search_&nbsp;:= {3}&nbsp;%;\
  /let replace_ 0&nbsp;%;\
  /test replace_&nbsp;:= {4}&nbsp;%;\
  /let count_&nbsp;%{5}&nbsp;%;\
  /let skip_&nbsp;%{6}&nbsp;%;\
  /let count2_ 0&nbsp;%;\
  /let pos_ 0&nbsp;%;\
  /let done_ 0&nbsp;%;\
  /let start_ 0&nbsp;%;\
  /let length_ 0&nbsp;%;\
  /let end_ 0&nbsp;%;\
  /WHILE (!done_) \
    /IF (find_string(rec_, string_, search_, pos_, skip_)&nbsp;!= -1) \
      /IF ( (count2_ &lt; count_) | (count_ = 0) ) \
        /test ++count2_&nbsp;%;\
        /test skip_&nbsp;:= 0&nbsp;%;\
        /test start_&nbsp;:= get_rec(rec_, &quot;start&quot;)&nbsp;%;\
        /test length_&nbsp;:= get_rec(rec_, &quot;len&quot;)&nbsp;%;\
        /test end_&nbsp;:= start_ + length_&nbsp;%;\
        /test string_&nbsp;:= strcat(substr(string_, 0, start_), \
                                replace_, \
                                substr(string_, end_))&nbsp;%;\
        /test pos_&nbsp;:= start_ + strlen(replace_)&nbsp;%;\
      /ELSE \
        /test done_&nbsp;:= 1&nbsp;%;\
      /ENDIF&nbsp;%;\
    /ELSE \
      /test done_&nbsp;:= 1&nbsp;%;\
    /ENDIF&nbsp;%;\
  /DONE&nbsp;%;\
  /test del_rec(rec_, '')&nbsp;%;\
  /IF (count2_ = 0) \
    /test count2_&nbsp;:= -1&nbsp;%;\
  /ENDIF&nbsp;%;\
  /test add_rec(rec_, 'replace', count2_)&nbsp;%;\
  /test add_rec(rec_, 'st', string_)&nbsp;%;\
  /RETURN count2_
;--------------------------------------------------------------------------
</pre>

<!-- 
NewPP limit report
Preprocessor node count: 4/1000000
Post-expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Expensive parser function count: 0/100
-->
<div class="printfooter">
Retrieved from "<a href="http://www.gwen-morse.com/wiki/index.php/Utilities_(used_to_be_%22Mylib.tf%22)">http://www.gwen-morse.com/wiki/index.php/Utilities_(used_to_be_%22Mylib.tf%22)</a>"</div>
						<!-- end content -->
						<div class="visualClear"></div>
		</div>
	</div>
		</div>
		<div id="column-one">
	<div id="p-cactions" class="portlet">
		<h5>Views</h5>
		<div class="pBody">
			<ul>
	
				 <li id="ca-nstab-main" class="selected"><a href="/wiki/index.php/Utilities_(used_to_be_%22Mylib.tf%22)" title="View the content page [c]" accesskey="c">Page</a></li>
				 <li id="ca-talk" class="new"><a href="/wiki/index.php?title=Talk:Utilities_(used_to_be_%22Mylib.tf%22)&amp;action=edit&amp;redlink=1" title="Discussion about the content page [t]" accesskey="t">Discussion</a></li>
				 <li id="ca-viewsource"><a href="/wiki/index.php?title=Utilities_(used_to_be_%22Mylib.tf%22)&amp;action=edit" title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></li>
				 <li id="ca-history"><a href="/wiki/index.php?title=Utilities_(used_to_be_%22Mylib.tf%22)&amp;action=history" title="Past revisions of this page [h]" accesskey="h">History</a></li>			</ul>
		</div>
	</div>
	<div class="portlet" id="p-personal">
		<h5>Personal tools</h5>
		<div class="pBody">
			<ul>
				<li id="pt-login"><a href="/wiki/index.php?title=Special:UserLogin&amp;returnto=Utilities_(used_to_be_%22Mylib.tf%22)" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li>
			</ul>
		</div>
	</div>
	<div class="portlet" id="p-logo">
		<a style="background-image: url(/home/public/wiki/guestbook.jpg);" href="/wiki/index.php/Main_Page" title="Visit the main page [z]" accesskey="z"></a>
	</div>
	<script type="text/javascript"> if (window.isMSIE55) fixalpha(); </script>
	<div class='generated-sidebar portlet' id='p-navigation'>
		<h5>Navigation</h5>
		<div class='pBody'>
			<ul>
				<li id="n-mainpage-description"><a href="/wiki/index.php/Main_Page">Main Page</a></li>
				<li id="n-MUSH-Code"><a href="/wiki/index.php/MUSHcode">MUSH Code</a></li>
				<li id="n-Tinyfugue-Client"><a href="/wiki/index.php/Tinyfugue">Tinyfugue Client</a></li>
				<li id="n-Muby-Client"><a href="/wiki/index.php/Muby">Muby Client</a></li>
				<li id="n-Roleplay"><a href="/wiki/index.php/Roleplay">Roleplay</a></li>
				<li id="n-Realms-of-Despair"><a href="/wiki/index.php/Realms_of_Despair">Realms of Despair</a></li>
				<li id="n-Sims"><a href="/wiki/index.php/Sims">Sims</a></li>
				<li id="n-Linux"><a href="/wiki/index.php/Linux">Linux</a></li>
				<li id="n-Health-and-Beauty"><a href="/wiki/index.php/HABA">Health and Beauty</a></li>
			</ul>
		</div>
	</div>
	<div class='generated-sidebar portlet' id='p-Wiki_Help'>
		<h5>Wiki Help</h5>
		<div class='pBody'>
			<ul>
				<li id="n-portal"><a href="/wiki/index.php/GwenWiki:Community_Portal" title="About the project, what you can do, where to find things">Community portal</a></li>
				<li id="n-currentevents"><a href="/wiki/index.php/GwenWiki:Current_events" title="Find background information on current events">Current events</a></li>
				<li id="n-recentchanges"><a href="/wiki/index.php/Special:RecentChanges" title="The list of recent changes in the wiki [r]" accesskey="r">Recent changes</a></li>
				<li id="n-randompage"><a href="/wiki/index.php/Special:Random" title="Load a random page [x]" accesskey="x">Random page</a></li>
				<li id="n-help"><a href="/wiki/index.php/Help:Contents" title="The place to find out">Help</a></li>
			</ul>
		</div>
	</div>
	<div id="p-search" class="portlet">
		<h5><label for="searchInput">Search</label></h5>
		<div id="searchBody" class="pBody">
			<form action="/wiki/index.php" id="searchform"><div>
				<input type='hidden' name="title" value="Special:Search"/>
				<input id="searchInput" name="search" type="text" title="Search GwenWiki [f]" accesskey="f" value="" />
				<input type='submit' name="go" class="searchButton" id="searchGoButton"	value="Go" title="Go to a page with this exact name if exists" />&nbsp;
				<input type='submit' name="fulltext" class="searchButton" id="mw-searchButton" value="Search" title="Search the pages for this text" />
			</div></form>
		</div>
	</div>
	<div class="portlet" id="p-tb">
		<h5>Toolbox</h5>
		<div class="pBody">
			<ul>
				<li id="t-whatlinkshere"><a href="/wiki/index.php/Special:WhatLinksHere/Utilities_(used_to_be_%22Mylib.tf%22)" title="List of all wiki pages that link here [j]" accesskey="j">What links here</a></li>
				<li id="t-recentchangeslinked"><a href="/wiki/index.php/Special:RecentChangesLinked/Utilities_(used_to_be_%22Mylib.tf%22)" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li>
<li id="t-specialpages"><a href="/wiki/index.php/Special:SpecialPages" title="List of all special pages [q]" accesskey="q">Special pages</a></li>
				<li id="t-print"><a href="/wiki/index.php?title=Utilities_(used_to_be_%22Mylib.tf%22)&amp;oldid=720&amp;printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li>				<li id="t-permalink"><a href="/wiki/index.php?title=Utilities_(used_to_be_%22Mylib.tf%22)&amp;oldid=720" title="Permanent link to this revision of the page">Permanent link</a></li>			</ul>
		</div>
	</div>
		</div><!-- end of the left (by default at least) column -->
			<div class="visualClear"></div>
			<div id="footer">
				<div id="f-poweredbyico"><a href="http://www.mediawiki.org/"><img src="/wiki/skins/common/images/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" /></a></div>
			<ul id="f-list">
					<li id="privacy"><a href="/wiki/index.php/GwenWiki:Privacy_policy" title="GwenWiki:Privacy policy">Privacy policy</a></li>
					<li id="about"><a href="/wiki/index.php/GwenWiki:About" title="GwenWiki:About">About GwenWiki</a></li>
					<li id="disclaimer"><a href="/wiki/index.php/GwenWiki:General_disclaimer" title="GwenWiki:General disclaimer">Disclaimers</a></li>
			</ul>
		</div>
</div>

		<script type="text/javascript">if (window.runOnloadHook) runOnloadHook();</script>
<!-- Served in 0.302 secs. --></body></html>
